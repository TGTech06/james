import{s as Xe,v as we,h as Ie,o as Ee,i as $e,d as g,r as ke,j as et,n as Ne}from"../chunks/scheduler.2364b0ad.js";import{S as tt,i as st,d as Y,v as at,j as v,s as R,u as Pe,k as p,c as V,w as Te,m as f,a as z,x as Re,f as Ve,t as je,g as _,y as qe,C as nt,D as lt,E as re,o as oe,l as S,A as te,p as ce,n as He,z as u,F as le,B as se,G as it,H as Se,q as ye,I as Le,J as Ae}from"../chunks/index.e0615928.js";import{g as ot}from"../chunks/globals.7f7f1b26.js";import{c as De,O as ct,v as Be}from"../chunks/question.e6fa980e.js";import{A as Je,N as We,S as Oe,H as Ue}from"../chunks/NavBar.74969093.js";import{c as fe,P as de,a as he,G as rt,b as me}from"../chunks/public.79d73255.js";import{w as _e}from"../chunks/index.db1f7a41.js";const{console:ut}=ot,b="src/routes/ask/+page.svelte";function Me(l,e,a){const t=l.slice();return t[33]=e[a],t}function xe(l,e,a){const t=l.slice();return t[36]=e[a],t}function ge(l){let e,a,t,i,r="Select Model",c,n,o,y="tiiuae/falcon-7b-instruct",m,H="meta-llama/Llama-2-70b-chat-hf",A,W="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",C,k,d,Z="Temperature",x,U,L,j,G,ee,w,X="Chat History",F,B,q,K,N,J,P,I,M=re(l[5]),E=[];for(let T=0;T<M.length;T+=1)E[T]=ve(xe(l,M,T));const ae={c:function(){e=v("div"),a=v("div"),t=v("div"),i=v("label"),i.textContent=r,c=R(),n=v("select"),o=v("option"),o.textContent=y,m=v("option"),m.textContent=H,A=v("option"),A.textContent=W,C=R(),k=v("div"),d=v("label"),d.textContent=Z,x=R(),U=v("input"),L=R(),j=v("span"),G=oe(l[1]),ee=R(),w=v("h2"),w.textContent=X,F=R(),B=v("button"),q=v("i"),K=oe(" New Chat"),N=R(),J=v("div");for(let O=0;O<E.length;O+=1)E[O].c();this.h()},l:function(O){e=p(O,"DIV",{class:!0});var s=S(e);a=p(s,"DIV",{class:!0});var h=S(a);t=p(h,"DIV",{class:!0});var D=S(t);i=p(D,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),te(i)!=="svelte-ppjgti"&&(i.textContent=r),c=V(D),n=p(D,"SELECT",{id:!0,style:!0,class:!0});var $=S(n);o=p($,"OPTION",{"data-svelte-h":!0}),te(o)!=="svelte-5vb6su"&&(o.textContent=y),m=p($,"OPTION",{"data-svelte-h":!0}),te(m)!=="svelte-ked52e"&&(m.textContent=H),A=p($,"OPTION",{"data-svelte-h":!0}),te(A)!=="svelte-1pj7l6c"&&(A.textContent=W),$.forEach(_),D.forEach(_),C=V(h),k=p(h,"DIV",{class:!0});var Q=S(k);d=p(Q,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),te(d)!=="svelte-9a09gc"&&(d.textContent=Z),x=V(Q),U=p(Q,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0,class:!0}),L=V(Q),j=p(Q,"SPAN",{class:!0});var ne=S(j);G=ce(ne,l[1]),ne.forEach(_),Q.forEach(_),h.forEach(_),ee=V(s),w=p(s,"H2",{class:!0,"data-svelte-h":!0}),te(w)!=="svelte-141gz04"&&(w.textContent=X),F=V(s),B=p(s,"BUTTON",{class:!0});var ie=S(B);q=p(ie,"I",{class:!0}),S(q).forEach(_),K=ce(ie," New Chat"),ie.forEach(_),N=V(s),J=p(s,"DIV",{class:!0});var Ce=S(J);for(let ue=0;ue<E.length;ue+=1)E[ue].l(Ce);Ce.forEach(_),s.forEach(_),this.h()},h:function(){f(i,"class","block text-lg font-semibold"),f(i,"for","model"),g(i,b,294,14,5688),o.__value="tiiuae/falcon-7b-instruct",le(o,o.__value),g(o,b,303,16,6006),m.__value="meta-llama/Llama-2-70b-chat-hf",le(m,m.__value),g(m,b,306,16,6135),A.__value="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",le(A,A.__value),g(A,b,309,16,6274),f(n,"id","model"),He(n,"width","200px"),f(n,"class","select select-sm select-primary"),l[0]===void 0&&et(()=>l[14].call(n)),g(n,b,297,14,5810),f(t,"class","mb-4"),g(t,b,293,12,5655),f(d,"class","block text-lg font-semibold"),f(d,"for","temperature"),g(d,b,315,14,6517),f(U,"type","range"),f(U,"id","temperature"),f(U,"min","0.1"),f(U,"max","1.0"),f(U,"step","0.2"),f(U,"class","input input-sm input-primary"),g(U,b,318,14,6644),f(j,"class","text-sm ml-2"),g(j,b,327,14,6917),f(k,"class","mb-4"),g(k,b,314,12,6484),f(a,"class","w-full md:w-3/4 mt-14"),g(a,b,292,10,5607),f(w,"class","text-2xl font-bold mb-4"),g(w,b,331,10,7012),f(q,"class","fas fa-plus"),g(q,b,334,12,7211),f(B,"class","btn btn-primary btn-sm mb-2"),g(B,b,333,10,7129),f(J,"class","overflow-y-auto h-96"),g(J,b,337,10,7277),f(e,"class","absolute left-0 top-0 bg-gray-800 rounded-lg p-4 sidebar s-uhtJAkW7ZDek"),g(e,b,291,8,5526)},m:function(O,s){z(O,e,s),u(e,a),u(a,t),u(t,i),u(t,c),u(t,n),u(n,o),u(n,m),u(n,A),Se(n,l[0],!0),u(a,C),u(a,k),u(k,d),u(k,x),u(k,U),le(U,l[1]),u(k,L),u(k,j),u(j,G),u(e,ee),u(e,w),u(e,F),u(e,B),u(B,q),u(B,K),u(e,N),u(e,J);for(let h=0;h<E.length;h+=1)E[h]&&E[h].m(J,null);P||(I=[se(n,"change",l[14]),se(U,"change",l[15]),se(U,"input",l[15]),se(B,"click",l[9],!1,!1,!1,!1)],P=!0)},p:function(O,s){if(s[0]&1&&Se(n,O[0]),s[0]&2&&le(U,O[1]),s[0]&2&&ye(G,O[1]),s[0]&6176){M=re(O[5]);let h;for(h=0;h<M.length;h+=1){const D=xe(O,M,h);E[h]?E[h].p(D,s):(E[h]=ve(D),E[h].c(),E[h].m(J,null))}for(;h<E.length;h+=1)E[h].d(1);E.length=M.length}},d:function(O){O&&_(e),Le(E,O),P=!1,ke(I)}};return Y("SvelteRegisterBlock",{block:ae,id:ge.name,type:"if",source:"(167:6) {#if isChatHistorySidebarOpen}",ctx:l}),ae}function Ze(l){let e,a="New Chat";const t={c:function(){e=v("span"),e.textContent=a,this.h()},l:function(r){e=p(r,"SPAN",{"data-svelte-h":!0}),te(e)!=="svelte-t9s83e"&&(e.textContent=a),this.h()},h:function(){g(e,b,346,18,7702)},m:function(r,c){z(r,e,c)},p:Ne,d:function(r){r&&_(e)}};return Y("SvelteRegisterBlock",{block:t,id:Ze.name,type:"else",source:"(222:16) {:else}",ctx:l}),t}function Ge(l){let e,a=l[36].firstUserMessage+"",t;const i={c:function(){e=v("span"),t=oe(a),this.h()},l:function(c){e=p(c,"SPAN",{});var n=S(e);t=ce(n,a),n.forEach(_),this.h()},h:function(){g(e,b,344,18,7623)},m:function(c,n){z(c,e,n),u(e,t)},p:function(c,n){n[0]&32&&a!==(a=c[36].firstUserMessage+"")&&ye(t,a)},d:function(c){c&&_(e)}};return Y("SvelteRegisterBlock",{block:i,id:Ge.name,type:"if",source:'(220:16) {#if chat.firstUserMessage !== \\"\\" && chat.firstUserMessage !== null}',ctx:l}),i}function ve(l){let e,a,t,i,r,c,n;function o(C,k){return C[36].firstUserMessage!==""&&C[36].firstUserMessage!==null?Ge:Ze}let y=o(l),m=y(l);function H(){return l[16](l[36])}function A(){return l[17](l[36])}const W={c:function(){e=v("div"),m.c(),a=R(),t=v("button"),i=v("i"),r=R(),this.h()},l:function(k){e=p(k,"DIV",{class:!0});var d=S(e);m.l(d),a=V(d),t=p(d,"BUTTON",{class:!0});var Z=S(t);i=p(Z,"I",{class:!0}),S(i).forEach(_),Z.forEach(_),r=V(d),d.forEach(_),this.h()},h:function(){f(i,"class","fas fa-trash-alt"),g(i,b,353,18,7970),f(t,"class","btn btn-error btn-sm"),g(t,b,349,16,7819),f(e,"class","flex items-center justify-between mb-2 s-uhtJAkW7ZDek"),g(e,b,339,14,7365)},m:function(k,d){z(k,e,d),m.m(e,null),u(e,a),u(e,t),u(t,i),u(e,r),c||(n=[se(t,"click",H,!1,!1,!1,!1),se(e,"click",A,!1,!1,!1,!1)],c=!0)},p:function(k,d){l=k,y===(y=o(l))&&m?m.p(l,d):(m.d(1),m=y(l),m&&(m.c(),m.m(e,a)))},d:function(k){k&&_(e),m.d(),c=!1,ke(n)}};return Y("SvelteRegisterBlock",{block:W,id:ve.name,type:"each",source:"(215:12) {#each $userChats as chat}",ctx:l}),W}function Fe(l){let e;const a={c:function(){e=v("i"),this.h()},l:function(i){e=p(i,"I",{class:!0}),S(e).forEach(_),this.h()},h:function(){f(e,"class","chevron fas fa-chevron-right text-2xl s-uhtJAkW7ZDek"),g(e,b,369,10,8362)},m:function(i,r){z(i,e,r)},d:function(i){i&&_(e)}};return Y("SvelteRegisterBlock",{block:a,id:Fe.name,type:"else",source:"(245:8) {:else}",ctx:l}),a}function Ke(l){let e;const a={c:function(){e=v("i"),this.h()},l:function(i){e=p(i,"I",{class:!0}),S(e).forEach(_),this.h()},h:function(){f(e,"class","chevron fas fa-chevron-left text-2xl s-uhtJAkW7ZDek"),g(e,b,367,10,8285)},m:function(i,r){z(i,e,r)},d:function(i){i&&_(e)}};return Y("SvelteRegisterBlock",{block:a,id:Ke.name,type:"if",source:"(243:8) {#if isChatHistorySidebarOpen}",ctx:l}),a}function ze(l){let e,a=re(l[6]),t=[];for(let r=0;r<a.length;r+=1)t[r]=pe(Me(l,a,r));const i={c:function(){e=v("div");for(let c=0;c<t.length;c+=1)t[c].c();this.h()},l:function(c){e=p(c,"DIV",{class:!0});var n=S(e);for(let o=0;o<t.length;o+=1)t[o].l(n);n.forEach(_),this.h()},h:function(){f(e,"class","chat-container overflow-y-auto h-96 s-uhtJAkW7ZDek"),g(e,b,384,12,8880)},m:function(c,n){z(c,e,n);for(let o=0;o<t.length;o+=1)t[o]&&t[o].m(e,null)},p:function(c,n){if(n[0]&64){a=re(c[6]);let o;for(o=0;o<a.length;o+=1){const y=Me(c,a,o);t[o]?t[o].p(y,n):(t[o]=pe(y),t[o].c(),t[o].m(e,null))}for(;o<t.length;o+=1)t[o].d(1);t.length=a.length}},d:function(c){c&&_(e),Le(t,c)}};return Y("SvelteRegisterBlock",{block:i,id:ze.name,type:"else",source:"(260:10) {:else}",ctx:l}),i}function Ye(l){let e,a="Select a chat from the history to view messages.";const t={c:function(){e=v("p"),e.textContent=a,this.h()},l:function(r){e=p(r,"P",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-ulna32"&&(e.textContent=a),this.h()},h:function(){f(e,"class","text-gray-500"),g(e,b,380,12,8744)},m:function(r,c){z(r,e,c)},p:Ne,d:function(r){r&&_(e)}};return Y("SvelteRegisterBlock",{block:t,id:Ye.name,type:"if",source:"(256:10) {#if selectedChatId === null}",ctx:l}),t}function pe(l){let e,a=l[33].message+"",t,i;const r={c:function(){e=v("div"),t=oe(a),i=R(),this.h()},l:function(n){e=p(n,"DIV",{class:!0});var o=S(e);t=ce(o,a),i=V(o),o.forEach(_),this.h()},h:function(){f(e,"class","chat-message s-uhtJAkW7ZDek"),Ae(e,"is-user-message",l[33].is_user_message),g(e,b,386,16,9001)},m:function(n,o){z(n,e,o),u(e,t),u(e,i)},p:function(n,o){o[0]&64&&a!==(a=n[33].message+"")&&ye(t,a),o[0]&64&&Ae(e,"is-user-message",n[33].is_user_message)},d:function(n){n&&_(e)}};return Y("SvelteRegisterBlock",{block:r,id:pe.name,type:"each",source:"(262:14) {#each $selectedChatMessages as message}",ctx:l}),r}function Qe(l){let e,a,t,i,r,c,n,o,y,m,H="Chat Messages",A,W,C,k,d,Z,x,U,L,j,G,ee;a=new We({$$inline:!0});let w=l[4]&&ge(l);function X(P,I){return P[4]?Ke:Fe}let F=X(l),B=F(l);function q(P,I){return P[3]===null?Ye:ze}let K=q(l),N=K(l);const J={c:function(){e=v("div"),Pe(a.$$.fragment),t=R(),i=v("div"),w&&w.c(),r=R(),c=v("div"),B.c(),n=R(),o=v("div"),y=v("div"),m=v("h1"),m.textContent=H,A=R(),N.c(),W=R(),C=v("div"),k=v("div"),d=v("textarea"),Z=R(),x=v("button"),U=oe("Ask the AI and Send Message"),this.h()},l:function(I){e=p(I,"DIV",{class:!0});var M=S(e);Te(a.$$.fragment,M),t=V(M),i=p(M,"DIV",{class:!0});var E=S(i);w&&w.l(E),r=V(E),c=p(E,"DIV",{class:!0,style:!0});var ae=S(c);B.l(ae),ae.forEach(_),n=V(E),o=p(E,"DIV",{class:!0});var T=S(o);y=p(T,"DIV",{class:!0});var O=S(y);m=p(O,"H1",{class:!0,"data-svelte-h":!0}),te(m)!=="svelte-fy4ok2"&&(m.textContent=H),A=V(O),N.l(O),O.forEach(_),W=V(T),C=p(T,"DIV",{class:!0});var s=S(C);k=p(s,"DIV",{class:!0});var h=S(k);d=p(h,"TEXTAREA",{id:!0,class:!0}),S(d).forEach(_),h.forEach(_),Z=V(s),x=p(s,"BUTTON",{class:!0});var D=S(x);U=ce(D,"Ask the AI and Send Message"),D.forEach(_),s.forEach(_),T.forEach(_),E.forEach(_),M.forEach(_),this.h()},h:function(){f(c,"class","sidebar-toggle-btn s-uhtJAkW7ZDek"),He(c,"left","1rem"),g(c,b,361,6,8119),f(m,"class","text-4xl font-bold mb-8"),g(m,b,378,10,8637),f(y,"class","w-full md:w-3/4"),g(y,b,377,8,8597),f(d,"id","question"),f(d,"class","textarea textarea-primary"),g(d,b,400,12,9386),f(k,"class","form-control mb-4"),g(k,b,399,10,9342),f(x,"class","btn btn-primary mb-4"),x.disabled=L=l[3]===null,g(x,b,408,10,9627),f(C,"class","w-full md:w-3/4 mt-4"),g(C,b,398,8,9297),f(o,"class","flex flex-col items-center justify-center w-full md:w-3/4 mx-auto s-uhtJAkW7ZDek"),g(o,b,374,6,8494),f(i,"class","relative flex flex-col md:flex-row min-h-screen s-uhtJAkW7ZDek"),g(i,b,287,4,5353),f(e,"class","flex flex-col bg-gray-900 text-white p-4 s-uhtJAkW7ZDek"),g(e,b,285,2,5279)},m:function(I,M){z(I,e,M),Re(a,e,null),u(e,t),u(e,i),w&&w.m(i,null),u(i,r),u(i,c),B.m(c,null),u(i,n),u(i,o),u(o,y),u(y,m),u(y,A),N.m(y,null),u(o,W),u(o,C),u(C,k),u(k,d),le(d,l[2]),u(C,Z),u(C,x),u(x,U),j=!0,G||(ee=[se(c,"click",l[18],!1,!1,!1,!1),se(d,"input",l[19]),se(x,"click",l[20],!1,!1,!1,!1)],G=!0)},p:function(I,M){I[4]?w?w.p(I,M):(w=ge(I),w.c(),w.m(i,r)):w&&(w.d(1),w=null),F!==(F=X(I))&&(B.d(1),B=F(I),B&&(B.c(),B.m(c,null))),K===(K=q(I))&&N?N.p(I,M):(N.d(1),N=K(I),N&&(N.c(),N.m(y,null))),M[0]&4&&le(d,I[2]),(!j||M[0]&8&&L!==(L=I[3]===null))&&it(x,"disabled",L)},i:function(I){j||(Ve(a.$$.fragment,I),j=!0)},o:function(I){je(a.$$.fragment,I),j=!1},d:function(I){I&&_(e),qe(a),w&&w.d(),B.d(),N.d(),G=!1,ke(ee)}};return Y("SvelteRegisterBlock",{block:J,id:Qe.name,type:"slot",source:"(161:0) <AuthCheck>",ctx:l}),J}function be(l){let e,a,t,i;t=new Je({props:{$$slots:{default:[Qe]},$$scope:{ctx:l}},$$inline:!0});const r={c:function(){e=v("link"),a=R(),Pe(t.$$.fragment),this.h()},l:function(n){e=p(n,"LINK",{rel:!0,href:!0}),a=V(n),Te(t.$$.fragment,n),this.h()},h:function(){f(e,"rel","stylesheet"),f(e,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),g(e,b,280,0,5148)},m:function(n,o){z(n,e,o),z(n,a,o),Re(t,n,o),i=!0},p:function(n,o){const y={};o[0]&127|o[1]&256&&(y.$$scope={dirty:o,ctx:n}),t.$set(y)},i:function(n){i||(Ve(t.$$.fragment,n),i=!0)},o:function(n){je(t.$$.fragment,n),i=!1},d:function(n){n&&(_(e),_(a)),qe(t,n)}};return Y("SvelteRegisterBlock",{block:r,id:be.name,type:"component",source:"",ctx:l}),r}function ft(l,e,a){let t,i,{$$slots:r={},$$scope:c}=e;at("Page",r,[]);const n=fe(he,de);let o,y,m="tiiuae/falcon-7b-instruct",H=.2,A="",W="";const C=_e([]);we(C,"userChats"),Ie(l,C,s=>a(5,t=s));const k=_e([]);we(k,"selectedChatMessages"),Ie(l,k,s=>a(6,i=s));let d=null;async function Z(){const s=await X(),h=Be(),{data:D,error:$}=await n.from("chats").insert([{user_id:s,chat_id:h,message:"",is_user_message:!0,timestamp:new Date().toISOString()}]);$?console.error("Error creating new chat:",$.message):C.update(Q=>[...Q,{chat_id:h}])}async function x(s){const{data:h,error:D}=await n.from("chats").select("message").eq("chat_id",s).eq("is_user_message",!0).order("timestamp",{ascending:!0}).range(1,2);return D?(console.error("Error fetching first user message:",D.message),""):h.length>0?h[0].message:""}async function U(){const s=await X(),{data:h,error:D}=await n.from("chats").select("chat_id").eq("user_id",s);if(D)console.error("Error fetching user chats:",D.message);else{const $=new Set,Q=[];for(const ne of h)if(!$.has(ne.chat_id)){$.add(ne.chat_id);const ie=await x(ne.chat_id);Q.push({...ne,firstUserMessage:ie})}C.set(Q)}}async function L(s){a(3,d=s);const{data:h,error:D}=await n.from("chats").select("message, is_user_message, timestamp").eq("chat_id",s).order("timestamp",{ascending:!0});D?console.error("Error fetching chat messages:",D.message):k.set(h)}async function j(s){await n.from("chats").insert([{user_id:s,chat_id:d,message:A,is_user_message:!0,timestamp:new Date().toISOString()}]),L(d),await w(s)}async function G(){const s=await X();console.log("userId",s),await j(s),await w(s)}async function ee(s,h){await n.from("chats").insert([{user_id:h,chat_id:d,message:s,is_user_message:!1,timestamp:new Date().toISOString()}]),L(d)}async function w(s){const h=fe(he,de);y=new Ue({apiKey:me}),o=new Oe(y,{client:h,tableName:"documents"});let D=await De(me,o,m,H,A);await ee(D,s),a(2,A="")}async function X(){const s=await n.auth.getUser();return s?s.data.user.id:null}function F(s){L(s)}async function B(s){const{data:h,error:D}=await n.from("chats").delete().eq("chat_id",s);D?console.error("Error deleting chat:",D.message):(await U(),k.set([]),a(3,d=null))}Ee(()=>{U()});let q=!1;function K(){a(4,q=!q)}const N=window.matchMedia("(max-width: 768px)"),J=[];Object.keys(e).forEach(s=>{!~J.indexOf(s)&&s.slice(0,2)!=="$$"&&s!=="slot"&&ut.warn(`<Page> was created with unknown prop '${s}'`)});function P(){m=nt(this),a(0,m)}function I(){H=lt(this.value),a(1,H)}const M=s=>B(s.chat_id),E=s=>F(s.chat_id.slice(0,36)),ae=()=>K();function T(){A=this.value,a(2,A)}const O=()=>G();return l.$capture_state=()=>({chatWithDoc:De,AuthCheck:Je,NavBar:We,onMount:Ee,onDestroy:$e,GoTrueAdminApi:rt,createClient:fe,SupabaseVectorStore:Oe,writable:_e,HuggingFaceInferenceEmbeddings:Ue,PUBLIC_SUPABASE_KEY:de,PUBLIC_SUPABASE_URL:he,PUBLIC_HUGGINGFACE_API_KEY:me,OpenAIEmbeddings:ct,uuidv4:Be,supabaseClient:n,vector:o,embeddings:y,model:m,temperature:H,question:A,responseText:W,userChats:C,selectedChatMessages:k,selectedChatId:d,createNewChat:Z,getFirstUserMessage:x,loadUserChats:U,loadChatMessages:L,sendMessage:j,sendUserMessageAndAIResponse:G,saveAIResponse:ee,getAIResponse:w,getCurrentUserId:X,selectChat:F,deleteChat:B,isChatHistorySidebarOpen:q,toggleSidebar:K,mediaQuery:N,$userChats:t,$selectedChatMessages:i}),l.$inject_state=s=>{"vector"in s&&(o=s.vector),"embeddings"in s&&(y=s.embeddings),"model"in s&&a(0,m=s.model),"temperature"in s&&a(1,H=s.temperature),"question"in s&&a(2,A=s.question),"responseText"in s&&(W=s.responseText),"selectedChatId"in s&&a(3,d=s.selectedChatId),"isChatHistorySidebarOpen"in s&&a(4,q=s.isChatHistorySidebarOpen)},e&&"$$inject"in e&&l.$inject_state(e.$$inject),[m,H,A,d,q,t,i,C,k,Z,G,F,B,K,P,I,M,E,ae,T,O]}class bt extends tt{constructor(e){super(e),st(this,e,ft,be,Xe,{},null,[-1,-1]),Y("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:be.name})}}export{bt as component};
