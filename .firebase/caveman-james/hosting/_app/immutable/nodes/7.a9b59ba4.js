var Ge=Object.defineProperty;var ze=(Y,i,O)=>i in Y?Ge(Y,i,{enumerable:!0,configurable:!0,writable:!0,value:O}):Y[i]=O;var Mt=(Y,i,O)=>(ze(Y,typeof i!="symbol"?i+"":i,O),O),re=(Y,i,O)=>{if(!i.has(Y))throw TypeError("Cannot "+O)};var P=(Y,i,O)=>(re(Y,i,"read from private field"),O?O.call(Y):i.get(Y)),at=(Y,i,O)=>{if(i.has(Y))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(Y):i.set(Y,O)},mt=(Y,i,O,g)=>(re(Y,i,"write to private field"),g?g.call(Y,O):i.set(Y,O),O);var ae=(Y,i,O,g)=>({set _(p){mt(Y,i,p,O)},get _(){return P(Y,i,g)}}),ht=(Y,i,O)=>(re(Y,i,"access private method"),O);import{s as safe_not_equal,o as onMount,d as add_location,r as run_all}from"../chunks/scheduler.2364b0ad.js";import{S as SvelteComponentDev,i as init,d as dispatch_dev,v as validate_slots,u as create_component,w as claim_component,x as mount_component,f as transition_in,t as transition_out,y as destroy_component,j as element,s as space,k as claim_element,l as children,c as claim_space,A as get_svelte_dataset,g as detach_dev,m as attr_dev,a as insert_hydration_dev,z as append_hydration_dev,F as set_input_value,B as listen_dev,o as text,p as claim_text,q as set_data_dev}from"../chunks/index.9f7452a2.js";import{a as Serializable,D as Document,O as OpenAIEmbeddings,S as SupabaseVectorStore,m as getEnv,A as AuthCheck,N as NavBar}from"../chunks/NavBar.c4a81580.js";import{c as commonjsRequire}from"../chunks/_commonjs-dynamic-modules.6fed1697.js";import{e as getAugmentedNamespace,c as createClient,P as PUBLIC_SUPABASE_KEY,a as PUBLIC_SUPABASE_URL,d as PUBLIC_OPENAI_API_KEY,_ as __vitePreload,b as PUBLIC_HUGGINGFACE_API_KEY}from"../chunks/public.9062b0fe.js";class BaseDocumentTransformer extends Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}}class TextSplitter extends BaseDocumentTransformer{constructor(i){if(super(i),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:O=>O.length}),this.chunkSize=(i==null?void 0:i.chunkSize)??this.chunkSize,this.chunkOverlap=(i==null?void 0:i.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(i==null?void 0:i.keepSeparator)??this.keepSeparator,this.lengthFunction=(i==null?void 0:i.lengthFunction)??(O=>O.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(i,O={}){return this.splitDocuments(i,O)}splitOnSeparator(i,O){let g;if(O)if(this.keepSeparator){const p=O.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");g=i.split(new RegExp(`(?=${p})`))}else g=i.split(O);else g=i.split("");return g.filter(p=>p!=="")}async createDocuments(i,O=[],g={}){const p=O.length>0?O:new Array(i.length).fill({}),{chunkHeader:I="",chunkOverlapHeader:N="(cont'd) ",appendChunkOverlapHeader:K=!1}=g,L=new Array;for(let m=0;m<i.length;m+=1){const E=i[m];let F=1,x=null;for(const v of await this.splitText(E)){let l=I,t=0;if(x){const b=E.indexOf(v),o=E.indexOf(x)+this.lengthFunction(x);t=(E.slice(o,b).match(/\n/g)||[]).length,K&&(l+=N)}F+=t;const n=(v.match(/\n/g)||[]).length,a=p[m].loc&&typeof p[m].loc=="object"?{...p[m].loc}:{};a.lines={from:F,to:F+n};const _={...p[m],loc:a};l+=v,L.push(new Document({pageContent:l,metadata:_})),F+=n,x=v}}return L}async splitDocuments(i,O={}){const g=i.filter(N=>N.pageContent!==void 0),p=g.map(N=>N.pageContent),I=g.map(N=>N.metadata);return this.createDocuments(p,I,O)}joinDocs(i,O){const g=i.join(O).trim();return g===""?null:g}mergeSplits(i,O){const g=[],p=[];let I=0;for(const K of i){const L=this.lengthFunction(K);if(I+L+(p.length>0?O.length:0)>this.chunkSize&&(I>this.chunkSize&&console.warn(`Created a chunk of size ${I}, +
which is longer than the specified ${this.chunkSize}`),p.length>0)){const m=this.joinDocs(p,O);for(m!==null&&g.push(m);I>this.chunkOverlap||I+L>this.chunkSize&&I>0;)I-=this.lengthFunction(p[0]),p.shift()}p.push(K),I+=L}const N=this.joinDocs(p,O);return N!==null&&g.push(N),g}}class RecursiveCharacterTextSplitter extends TextSplitter{constructor(i){super(i),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(i==null?void 0:i.separators)??this.separators,this.keepSeparator=(i==null?void 0:i.keepSeparator)??!0}async _splitText(i,O){const g=[];let p=O[O.length-1],I;for(let m=0;m<O.length;m+=1){const E=O[m];if(E===""){p=E;break}if(i.includes(E)){p=E,I=O.slice(m+1);break}}const N=this.splitOnSeparator(i,p);let K=[];const L=this.keepSeparator?"":p;for(const m of N)if(this.lengthFunction(m)<this.chunkSize)K.push(m);else{if(K.length){const E=this.mergeSplits(K,L);g.push(...E),K=[]}if(!I)g.push(m);else{const E=await this._splitText(m,I);g.push(...E)}}if(K.length){const m=this.mergeSplits(K,L);g.push(...m)}return g}async splitText(i){return this._splitText(i,this.separators)}static fromLanguage(i,O){return new RecursiveCharacterTextSplitter({...O,separators:RecursiveCharacterTextSplitter.getSeparatorsForLanguage(i)})}static getSeparatorsForLanguage(i){if(i==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(i==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(i==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(i==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(i==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(i==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(i==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(i==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(i==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(i==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(i==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(i==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(i==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(i==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(i==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(i==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${i} is not supported.`)}}async function computeSHA1FromFile(Y){const O=await(await fetch(Y)).arrayBuffer(),g=await crypto.subtle.digest("SHA-1",O),I=Array.from(new Uint8Array(g)).map(N=>N.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromFile: ",I),I}async function computeSHA1FromContent(Y){const O=new TextEncoder().encode(Y),g=await crypto.subtle.digest("SHA-1",O),I=Array.from(new Uint8Array(g)).map(N=>N.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromContent: ",I),I}var pdf={exports:{}};const __viteBrowserExternal=new Proxy({},{get(Y,i){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${i}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(i,O){module.exports=O()})(globalThis,()=>(()=>{var __webpack_modules__=[,(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.VerbosityLevel=i.Util=i.UnknownErrorException=i.UnexpectedResponseException=i.UNSUPPORTED_FEATURES=i.TextRenderingMode=i.StreamType=i.RenderingIntentFlag=i.PermissionFlag=i.PasswordResponses=i.PasswordException=i.PageActionEventType=i.OPS=i.MissingPDFException=i.LINE_FACTOR=i.LINE_DESCENT_FACTOR=i.InvalidPDFException=i.ImageKind=i.IDENTITY_MATRIX=i.FormatError=i.FontType=i.FeatureTest=i.FONT_IDENTITY_MATRIX=i.DocumentActionEventType=i.CMapCompressionType=i.BaseException=i.AnnotationType=i.AnnotationStateModelType=i.AnnotationReviewState=i.AnnotationReplyType=i.AnnotationMode=i.AnnotationMarkedState=i.AnnotationFlag=i.AnnotationFieldFlag=i.AnnotationEditorType=i.AnnotationEditorPrefix=i.AnnotationEditorParamsType=i.AnnotationBorderStyleType=i.AnnotationActionEventType=i.AbortException=void 0,i.arrayByteLength=it,i.arraysToBytes=dt,i.assert=h,i.bytesToString=k,i.createPromiseCapability=pt,i.createValidAbsoluteUrl=w,i.escapeString=Tt,i.getModificationDate=rt,i.getVerbosityLevel=et,i.info=ot,i.isArrayBuffer=Ot,i.isArrayEqual=Zt,i.isAscii=Rt,i.objectFromMap=nt,i.objectSize=lt,i.setVerbosityLevel=z,i.shadow=R,i.string32=tt,i.stringToBytes=q,i.stringToPDFString=Et,i.stringToUTF16BEString=Ft,i.stringToUTF8String=zt,i.unreachable=B,i.utf8StringToString=Ct,i.warn=_t,O(2);const g=[1,0,0,1,0,0];i.IDENTITY_MATRIX=g;const p=[.001,0,0,.001,0,0];i.FONT_IDENTITY_MATRIX=p;const I=1.35;i.LINE_FACTOR=I;const N=.35;i.LINE_DESCENT_FACTOR=N;const K={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};i.RenderingIntentFlag=K;const L={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};i.AnnotationMode=L;const m="pdfjs_internal_editor_";i.AnnotationEditorPrefix=m;const E={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};i.AnnotationEditorType=E;const F={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};i.AnnotationEditorParamsType=F;const x={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};i.PermissionFlag=x;const v={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};i.TextRenderingMode=v;const l={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};i.ImageKind=l;const t={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};i.AnnotationType=t;const n={MARKED:"Marked",REVIEW:"Review"};i.AnnotationStateModelType=n;const a={MARKED:"Marked",UNMARKED:"Unmarked"};i.AnnotationMarkedState=a;const _={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};i.AnnotationReviewState=_;const b={GROUP:"Group",REPLY:"R"};i.AnnotationReplyType=b;const o={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};i.AnnotationFlag=o;const e={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};i.AnnotationFieldFlag=e;const s={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};i.AnnotationBorderStyleType=s;const d={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};i.AnnotationActionEventType=d;const C={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};i.DocumentActionEventType=C;const y={O:"PageOpen",C:"PageClose"};i.PageActionEventType=y;const f={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};i.StreamType=f;const T={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};i.FontType=T;const Z={ERRORS:0,WARNINGS:1,INFOS:5};i.VerbosityLevel=Z;const st={NONE:0,BINARY:1,STREAM:2};i.CMapCompressionType=st;const J={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};i.OPS=J;const $={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};i.UNSUPPORTED_FEATURES=$;const U={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};i.PasswordResponses=U;let G=Z.WARNINGS;function z(Q){Number.isInteger(Q)&&(G=Q)}function et(){return G}function ot(Q){G>=Z.INFOS&&console.log(`Info: ${Q}`)}function _t(Q){G>=Z.WARNINGS&&console.log(`Warning: ${Q}`)}function B(Q){throw new Error(Q)}function h(Q,W){Q||B(W)}function c(Q){if(!Q)return!1;switch(Q.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function w(Q,W=null,H=null){if(!Q)return null;try{if(H&&typeof Q=="string"){if(H.addDefaultProtocol&&Q.startsWith("www.")){const bt=Q.match(/\./g);bt&&bt.length>=2&&(Q=`http://${Q}`)}if(H.tryConvertEncoding)try{Q=zt(Q)}catch{}}const gt=W?new URL(Q,W):new URL(Q);if(c(gt))return gt}catch{}return null}function R(Q,W,H){return Object.defineProperty(Q,W,{value:H,enumerable:!0,configurable:!0,writable:!1}),H}const D=function(){function W(H,gt){this.constructor===W&&B("Cannot initialize BaseException."),this.message=H,this.name=gt}return W.prototype=new Error,W.constructor=W,W}();i.BaseException=D;class j extends D{constructor(W,H){super(W,"PasswordException"),this.code=H}}i.PasswordException=j;class X extends D{constructor(W,H){super(W,"UnknownErrorException"),this.details=H}}i.UnknownErrorException=X;class V extends D{constructor(W){super(W,"InvalidPDFException")}}i.InvalidPDFException=V;class r extends D{constructor(W){super(W,"MissingPDFException")}}i.MissingPDFException=r;class u extends D{constructor(W,H){super(W,"UnexpectedResponseException"),this.status=H}}i.UnexpectedResponseException=u;class A extends D{constructor(W){super(W,"FormatError")}}i.FormatError=A;class S extends D{constructor(W){super(W,"AbortException")}}i.AbortException=S;function k(Q){(typeof Q!="object"||Q===null||Q.length===void 0)&&B("Invalid argument for bytesToString");const W=Q.length,H=8192;if(W<H)return String.fromCharCode.apply(null,Q);const gt=[];for(let bt=0;bt<W;bt+=H){const yt=Math.min(bt+H,W),St=Q.subarray(bt,yt);gt.push(String.fromCharCode.apply(null,St))}return gt.join("")}function q(Q){typeof Q!="string"&&B("Invalid argument for stringToBytes");const W=Q.length,H=new Uint8Array(W);for(let gt=0;gt<W;++gt)H[gt]=Q.charCodeAt(gt)&255;return H}function it(Q){if(Q.length!==void 0)return Q.length;if(Q.byteLength!==void 0)return Q.byteLength;B("Invalid argument for arrayByteLength")}function dt(Q){const W=Q.length;if(W===1&&Q[0]instanceof Uint8Array)return Q[0];let H=0;for(let yt=0;yt<W;yt++)H+=it(Q[yt]);let gt=0;const bt=new Uint8Array(H);for(let yt=0;yt<W;yt++){let St=Q[yt];St instanceof Uint8Array||(typeof St=="string"?St=q(St):St=new Uint8Array(St));const wt=St.byteLength;bt.set(St,gt),gt+=wt}return bt}function tt(Q){return String.fromCharCode(Q>>24&255,Q>>16&255,Q>>8&255,Q&255)}function lt(Q){return Object.keys(Q).length}function nt(Q){const W=Object.create(null);for(const[H,gt]of Q)W[H]=gt;return W}function ct(){const Q=new Uint8Array(4);return Q[0]=1,new Uint32Array(Q.buffer,0,1)[0]===1}function ft(){try{return new Function(""),!0}catch{return!1}}class M{static get isLittleEndian(){return R(this,"isLittleEndian",ct())}static get isEvalSupported(){return R(this,"isEvalSupported",ft())}static get isOffscreenCanvasSupported(){return R(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}i.FeatureTest=M;const ut=[...Array(256).keys()].map(Q=>Q.toString(16).padStart(2,"0"));class At{static makeHexColor(W,H,gt){return`#${ut[W]}${ut[H]}${ut[gt]}`}static scaleMinMax(W,H){let gt;W[0]?(W[0]<0&&(gt=H[0],H[0]=H[1],H[1]=gt),H[0]*=W[0],H[1]*=W[0],W[3]<0&&(gt=H[2],H[2]=H[3],H[3]=gt),H[2]*=W[3],H[3]*=W[3]):(gt=H[0],H[0]=H[2],H[2]=gt,gt=H[1],H[1]=H[3],H[3]=gt,W[1]<0&&(gt=H[2],H[2]=H[3],H[3]=gt),H[2]*=W[1],H[3]*=W[1],W[2]<0&&(gt=H[0],H[0]=H[1],H[1]=gt),H[0]*=W[2],H[1]*=W[2]),H[0]+=W[4],H[1]+=W[4],H[2]+=W[5],H[3]+=W[5]}static transform(W,H){return[W[0]*H[0]+W[2]*H[1],W[1]*H[0]+W[3]*H[1],W[0]*H[2]+W[2]*H[3],W[1]*H[2]+W[3]*H[3],W[0]*H[4]+W[2]*H[5]+W[4],W[1]*H[4]+W[3]*H[5]+W[5]]}static applyTransform(W,H){const gt=W[0]*H[0]+W[1]*H[2]+H[4],bt=W[0]*H[1]+W[1]*H[3]+H[5];return[gt,bt]}static applyInverseTransform(W,H){const gt=H[0]*H[3]-H[1]*H[2],bt=(W[0]*H[3]-W[1]*H[2]+H[2]*H[5]-H[4]*H[3])/gt,yt=(-W[0]*H[1]+W[1]*H[0]+H[4]*H[1]-H[5]*H[0])/gt;return[bt,yt]}static getAxialAlignedBoundingBox(W,H){const gt=At.applyTransform(W,H),bt=At.applyTransform(W.slice(2,4),H),yt=At.applyTransform([W[0],W[3]],H),St=At.applyTransform([W[2],W[1]],H);return[Math.min(gt[0],bt[0],yt[0],St[0]),Math.min(gt[1],bt[1],yt[1],St[1]),Math.max(gt[0],bt[0],yt[0],St[0]),Math.max(gt[1],bt[1],yt[1],St[1])]}static inverseTransform(W){const H=W[0]*W[3]-W[1]*W[2];return[W[3]/H,-W[1]/H,-W[2]/H,W[0]/H,(W[2]*W[5]-W[4]*W[3])/H,(W[4]*W[1]-W[5]*W[0])/H]}static apply3dTransform(W,H){return[W[0]*H[0]+W[1]*H[1]+W[2]*H[2],W[3]*H[0]+W[4]*H[1]+W[5]*H[2],W[6]*H[0]+W[7]*H[1]+W[8]*H[2]]}static singularValueDecompose2dScale(W){const H=[W[0],W[2],W[1],W[3]],gt=W[0]*H[0]+W[1]*H[2],bt=W[0]*H[1]+W[1]*H[3],yt=W[2]*H[0]+W[3]*H[2],St=W[2]*H[1]+W[3]*H[3],wt=(gt+St)/2,Dt=Math.sqrt((gt+St)**2-4*(gt*St-yt*bt))/2,kt=wt+Dt||1,xt=wt-Dt||1;return[Math.sqrt(kt),Math.sqrt(xt)]}static normalizeRect(W){const H=W.slice(0);return W[0]>W[2]&&(H[0]=W[2],H[2]=W[0]),W[1]>W[3]&&(H[1]=W[3],H[3]=W[1]),H}static intersect(W,H){const gt=Math.max(Math.min(W[0],W[2]),Math.min(H[0],H[2])),bt=Math.min(Math.max(W[0],W[2]),Math.max(H[0],H[2]));if(gt>bt)return null;const yt=Math.max(Math.min(W[1],W[3]),Math.min(H[1],H[3])),St=Math.min(Math.max(W[1],W[3]),Math.max(H[1],H[3]));return yt>St?null:[gt,yt,bt,St]}static bezierBoundingBox(W,H,gt,bt,yt,St,wt,Dt){const kt=[],xt=[[],[]];let Lt,It,Bt,Pt,Nt,qt,Xt,Vt;for(let $t=0;$t<2;++$t){if($t===0?(It=6*W-12*gt+6*yt,Lt=-3*W+9*gt-9*yt+3*wt,Bt=3*gt-3*W):(It=6*H-12*bt+6*St,Lt=-3*H+9*bt-9*St+3*Dt,Bt=3*bt-3*H),Math.abs(Lt)<1e-12){if(Math.abs(It)<1e-12)continue;Pt=-Bt/It,0<Pt&&Pt<1&&kt.push(Pt);continue}Xt=It*It-4*Bt*Lt,Vt=Math.sqrt(Xt),!(Xt<0)&&(Nt=(-It+Vt)/(2*Lt),0<Nt&&Nt<1&&kt.push(Nt),qt=(-It-Vt)/(2*Lt),0<qt&&qt<1&&kt.push(qt))}let Ht=kt.length,Ut;const Wt=Ht;for(;Ht--;)Pt=kt[Ht],Ut=1-Pt,xt[0][Ht]=Ut*Ut*Ut*W+3*Ut*Ut*Pt*gt+3*Ut*Pt*Pt*yt+Pt*Pt*Pt*wt,xt[1][Ht]=Ut*Ut*Ut*H+3*Ut*Ut*Pt*bt+3*Ut*Pt*Pt*St+Pt*Pt*Pt*Dt;return xt[0][Wt]=W,xt[1][Wt]=H,xt[0][Wt+1]=wt,xt[1][Wt+1]=Dt,xt[0].length=xt[1].length=Wt+2,[Math.min(...xt[0]),Math.min(...xt[1]),Math.max(...xt[0]),Math.max(...xt[1])]}}i.Util=At;const vt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Et(Q){if(Q[0]>="ï"){let H;if(Q[0]==="þ"&&Q[1]==="ÿ"?H="utf-16be":Q[0]==="ÿ"&&Q[1]==="þ"?H="utf-16le":Q[0]==="ï"&&Q[1]==="»"&&Q[2]==="¿"&&(H="utf-8"),H)try{const gt=new TextDecoder(H,{fatal:!0}),bt=q(Q);return gt.decode(bt)}catch(gt){_t(`stringToPDFString: "${gt}".`)}}const W=[];for(let H=0,gt=Q.length;H<gt;H++){const bt=vt[Q.charCodeAt(H)];W.push(bt?String.fromCharCode(bt):Q.charAt(H))}return W.join("")}function Tt(Q){return Q.replace(/([()\\\n\r])/g,W=>W===`
`?"\\n":W==="\r"?"\\r":`\\${W}`)}function Rt(Q){return/^[\x00-\x7F]*$/.test(Q)}function Ft(Q){const W=["þÿ"];for(let H=0,gt=Q.length;H<gt;H++){const bt=Q.charCodeAt(H);W.push(String.fromCharCode(bt>>8&255),String.fromCharCode(bt&255))}return W.join("")}function zt(Q){return decodeURIComponent(escape(Q))}function Ct(Q){return unescape(encodeURIComponent(Q))}function Ot(Q){return typeof Q=="object"&&Q!==null&&Q.byteLength!==void 0}function Zt(Q,W){if(Q.length!==W.length)return!1;for(let H=0,gt=Q.length;H<gt;H++)if(Q[H]!==W[H])return!1;return!0}function rt(Q=new Date){return[Q.getUTCFullYear().toString(),(Q.getUTCMonth()+1).toString().padStart(2,"0"),Q.getUTCDate().toString().padStart(2,"0"),Q.getUTCHours().toString().padStart(2,"0"),Q.getUTCMinutes().toString().padStart(2,"0"),Q.getUTCSeconds().toString().padStart(2,"0")].join("")}function pt(){const Q=Object.create(null);let W=!1;return Object.defineProperty(Q,"settled",{get(){return W}}),Q.promise=new Promise(function(H,gt){Q.resolve=function(bt){W=!0,H(bt)},Q.reject=function(bt){W=!0,gt(bt)}}),Q}},(Y,i,O)=>{O(3)},(Y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isNodeJS=void 0;const O=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");i.isNodeJS=O},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var Y,O,g,p,I,N,K,L,m,oe,F,x;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:l,NodeCMapReaderFactory:t,NodeStandardFontDataFactory:n}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=l,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=t,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=n}let createPDFNetworkStream;function setPDFNetworkStreamFactory(l){createPDFNetworkStream=l}function getDocument(l){const t=new PDFDocumentLoadingTask;let n;if(typeof l=="string"||l instanceof URL)n={url:l};else if((0,_util.isArrayBuffer)(l))n={data:l};else if(l instanceof PDFDataRangeTransport)n={range:l};else{if(typeof l!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!l.url&&!l.data&&!l.range)throw new Error("Invalid parameter object: need either .data, .range or .url");n=l}const a=Object.create(null);let _=null,b=null;for(const e in n){const s=n[e];switch(e){case"url":if(typeof window<"u")try{a[e]=new URL(s,window.location).href;continue}catch(d){(0,_util.warn)(`Cannot create valid URL: "${d}".`)}else if(typeof s=="string"||s instanceof URL){a[e]=s.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":_=s;continue;case"worker":b=s;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&s instanceof Buffer)a[e]=new Uint8Array(s);else{if(s instanceof Uint8Array)break;if(typeof s=="string")a[e]=(0,_util.stringToBytes)(s);else if(typeof s=="object"&&s!==null&&!isNaN(s.length))a[e]=new Uint8Array(s);else if((0,_util.isArrayBuffer)(s))a[e]=new Uint8Array(s);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}a[e]=s}if(a.CMapReaderFactory=a.CMapReaderFactory||DefaultCMapReaderFactory,a.StandardFontDataFactory=a.StandardFontDataFactory||DefaultStandardFontDataFactory,a.ignoreErrors=a.stopAtErrors!==!0,a.fontExtraProperties=a.fontExtraProperties===!0,a.pdfBug=a.pdfBug===!0,a.enableXfa=a.enableXfa===!0,(!Number.isInteger(a.rangeChunkSize)||a.rangeChunkSize<1)&&(a.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof a.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(a.docBaseUrl))&&(a.docBaseUrl=null),(!Number.isInteger(a.maxImageSize)||a.maxImageSize<-1)&&(a.maxImageSize=-1),typeof a.cMapUrl!="string"&&(a.cMapUrl=null),typeof a.standardFontDataUrl!="string"&&(a.standardFontDataUrl=null),typeof a.useWorkerFetch!="boolean"&&(a.useWorkerFetch=a.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&a.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof a.isEvalSupported!="boolean"&&(a.isEvalSupported=!0),typeof a.disableFontFace!="boolean"&&(a.disableFontFace=_is_node.isNodeJS),typeof a.useSystemFonts!="boolean"&&(a.useSystemFonts=!_is_node.isNodeJS&&!a.disableFontFace),(typeof a.ownerDocument!="object"||a.ownerDocument===null)&&(a.ownerDocument=globalThis.document),typeof a.disableRange!="boolean"&&(a.disableRange=!1),typeof a.disableStream!="boolean"&&(a.disableStream=!1),typeof a.disableAutoFetch!="boolean"&&(a.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(a.verbosity),!b){const e={verbosity:a.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};b=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=b}const o=t.docId;return b.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(b,a,_,o),s=new Promise(function(d){let C;_?C=new _transport_stream.PDFDataTransportStream({length:a.length,initialData:a.initialData,progressiveDone:a.progressiveDone,contentDispositionFilename:a.contentDispositionFilename,disableRange:a.disableRange,disableStream:a.disableStream},_):a.data||(C=createPDFNetworkStream({url:a.url,length:a.length,httpHeaders:a.httpHeaders,withCredentials:a.withCredentials,rangeChunkSize:a.rangeChunkSize,disableRange:a.disableRange,disableStream:a.disableStream})),d(C)});return Promise.all([e,s]).then(function([d,C]){if(t.destroyed)throw new Error("Loading aborted");const y=new _message_handler.MessageHandler(o,d,b.port),f=new WorkerTransport(y,t,C,a);t._transport=f,y.send("Ready",null)})}).catch(t._capability.reject),t}async function _fetchDocument(l,t,n,a){if(l.destroyed)throw new Error("Worker was destroyed");n&&(t.length=n.length,t.initialData=n.initialData,t.progressiveDone=n.progressiveDone,t.contentDispositionFilename=n.contentDispositionFilename);const _=await l.messageHandler.sendWithPromise("GetDocRequest",{docId:a,apiVersion:"2.16.105",source:{data:t.data,url:t.url,password:t.password,disableAutoFetch:t.disableAutoFetch,rangeChunkSize:t.rangeChunkSize,length:t.length},maxImageSize:t.maxImageSize,disableFontFace:t.disableFontFace,docBaseUrl:t.docBaseUrl,ignoreErrors:t.ignoreErrors,isEvalSupported:t.isEvalSupported,fontExtraProperties:t.fontExtraProperties,enableXfa:t.enableXfa,useSystemFonts:t.useSystemFonts,cMapUrl:t.useWorkerFetch?t.cMapUrl:null,standardFontDataUrl:t.useWorkerFetch?t.standardFontDataUrl:null});if(t.data&&(t.data=null),l.destroyed)throw new Error("Worker was destroyed");return _}const i=class i{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${ae(i,Y)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){var t;this.destroyed=!0,await((t=this._transport)==null?void 0:t.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};Y=new WeakMap,at(i,Y,0);let PDFDocumentLoadingTask=i;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(t,n,a=!1,_=null){this.length=t,this.initialData=n,this.progressiveDone=a,this.contentDispositionFilename=_,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,n){for(const a of this._rangeListeners)a(t,n)}onDataProgress(t,n){this._readyCapability.promise.then(()=>{for(const a of this._progressListeners)a(t,n)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const n of this._progressiveReadListeners)n(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,n){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(t,n){this._pdfInfo=t,this._transport=n,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(t,n,a,_,b=!1){this._pageIndex=t,this._pageInfo=n,this._ownerDocument=_,this._transport=a,this._stats=b?new _display_utils.StatTimer:null,this._pdfBug=b,this.commonObjs=a.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:n=this.rotate,offsetX:a=0,offsetY:_=0,dontFlip:b=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:t,rotation:n,offsetX:a,offsetY:_,dontFlip:b})}getAnnotations({intent:t="display"}={}){const n=this._transport.getRenderingIntent(t);let a=this._annotationPromises.get(n.cacheKey);return a||(a=this._transport.getAnnotations(this._pageIndex,n.renderingIntent),this._annotationPromises.set(n.cacheKey,a),a=a.then(_=>{for(const b of _)b.titleObj!==void 0&&Object.defineProperty(b,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),b.titleObj.str}}),b.contentsObj!==void 0&&Object.defineProperty(b,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),b.contentsObj.str}});return _})),a}getJSActions(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:n,intent:a="display",annotationMode:_=_util.AnnotationMode.ENABLE,transform:b=null,imageLayer:o=null,canvasFactory:e=null,background:s=null,optionalContentConfigPromise:d=null,annotationCanvasMap:C=null,pageColors:y=null,printAnnotationStorage:f=null}){var z,et;((z=arguments[0])==null?void 0:z.renderInteractiveForms)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&_===_util.AnnotationMode.ENABLE&&(_=_util.AnnotationMode.ENABLE_FORMS)),((et=arguments[0])==null?void 0:et.includeAnnotationStorage)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&_===_util.AnnotationMode.ENABLE&&(_=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");const T=this._transport.getRenderingIntent(a,_,f);this.pendingCleanup=!1,d||(d=this._transport.getOptionalContentConfig());let Z=this._intentStates.get(T.cacheKey);Z||(Z=Object.create(null),this._intentStates.set(T.cacheKey,Z)),Z.streamReaderCancelTimeout&&(clearTimeout(Z.streamReaderCancelTimeout),Z.streamReaderCancelTimeout=null);const st=e||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),J=!!(T.renderingIntent&_util.RenderingIntentFlag.PRINT);Z.displayReadyCapability||(Z.displayReadyCapability=(0,_util.createPromiseCapability)(),Z.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(T));const $=ot=>{Z.renderTasks.delete(U),(this.cleanupAfterRender||J)&&(this.pendingCleanup=!0),this._tryCleanup(),ot?(U.capability.reject(ot),this._abortOperatorList({intentState:Z,reason:ot instanceof Error?ot:new Error(ot)})):U.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},U=new InternalRenderTask({callback:$,params:{canvasContext:t,viewport:n,transform:b,imageLayer:o,background:s},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:C,operatorList:Z.operatorList,pageIndex:this._pageIndex,canvasFactory:st,useRequestAnimationFrame:!J,pdfBug:this._pdfBug,pageColors:y});(Z.renderTasks||(Z.renderTasks=new Set)).add(U);const G=U.task;return Promise.all([Z.displayReadyCapability.promise,d]).then(([ot,_t])=>{if(this.pendingCleanup){$();return}this._stats&&this._stats.time("Rendering"),U.initializeGraphics({transparency:ot,optionalContentConfig:_t}),U.operatorListChanged()}).catch($),G}getOperatorList({intent:t="display",annotationMode:n=_util.AnnotationMode.ENABLE,printAnnotationStorage:a=null}={}){function _(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(e))}const b=this._transport.getRenderingIntent(t,n,a,!0);let o=this._intentStates.get(b.cacheKey);o||(o=Object.create(null),this._intentStates.set(b.cacheKey,o));let e;return o.opListReadCapability||(e=Object.create(null),e.operatorListChanged=_,o.opListReadCapability=(0,_util.createPromiseCapability)(),(o.renderTasks||(o.renderTasks=new Set)).add(e),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(b)),o.opListReadCapability.promise}streamTextContent({disableCombineTextItems:t=!1,includeMarkedContent:n=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:t!==!0,includeMarkedContent:n===!0},{highWaterMark:100,size(_){return _.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(a=>_xfa_text.XfaText.textContent(a));const n=this.streamTextContent(t);return new Promise(function(a,_){function b(){o.read().then(function({value:s,done:d}){if(d){a(e);return}Object.assign(e.styles,s.styles),e.items.push(...s.items),b()},_)}const o=n.getReader(),e={items:[],styles:Object.create(null)};b()})}getStructTree(){return this._structTreePromise||(this._structTreePromise=this._transport.getStructTree(this._pageIndex))}_destroy(){this.destroyed=!0;const t=[];for(const n of this._intentStates.values())if(this._abortOperatorList({intentState:n,reason:new Error("Page was destroyed."),force:!0}),!n.opListReadCapability)for(const a of n.renderTasks)t.push(a.completed),a.cancel();this.objs.clear();for(const n of this._bitmaps)n.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(t)}cleanup(t=!1){return this.pendingCleanup=!0,this._tryCleanup(t)}_tryCleanup(t=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:n,operatorList:a}of this._intentStates.values())if(n.size>0||!a.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,t&&this._stats&&(this._stats=new _display_utils.StatTimer);for(const n of this._bitmaps)n.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(t,n){const a=this._intentStates.get(n);a&&(this._stats&&this._stats.timeEnd("Page Request"),a.displayReadyCapability&&a.displayReadyCapability.resolve(t))}_renderPageChunk(t,n){for(let a=0,_=t.length;a<_;a++)n.operatorList.fnArray.push(t.fnArray[a]),n.operatorList.argsArray.push(t.argsArray[a]);n.operatorList.lastChunk=t.lastChunk,n.operatorList.separateAnnots=t.separateAnnots;for(const a of n.renderTasks)a.operatorListChanged();t.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:t,cacheKey:n,annotationStorageMap:a}){const b=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:n,annotationStorage:a}).getReader(),o=this._intentStates.get(n);o.streamReader=b;const e=()=>{b.read().then(({value:s,done:d})=>{if(d){o.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(s,o),e())},s=>{if(o.streamReader=null,!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(const d of o.renderTasks)d.operatorListChanged();this._tryCleanup()}if(o.displayReadyCapability)o.displayReadyCapability.reject(s);else if(o.opListReadCapability)o.opListReadCapability.reject(s);else throw s}})};e()}_abortOperatorList({intentState:t,reason:n,force:a=!1}){if(t.streamReader){if(!a){if(t.renderTasks.size>0)return;if(n instanceof _display_utils.RenderingCancelledException){t.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:t,reason:n,force:!0}),t.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(t.streamReader.cancel(new _util.AbortException(n.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[_,b]of this._intentStates)if(b===t){this._intentStates.delete(_);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(t,n){const a={data:structuredClone(t,n)};this._deferred.then(()=>{for(const _ of this._listeners)_.call(this,a)})}addEventListener(t,n){this._listeners.push(n)}removeEventListener(t,n){const a=this._listeners.indexOf(n);this._listeners.splice(a,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const l=(O=document==null?void 0:document.currentScript)==null?void 0:O.src;l&&(PDFWorkerUtil.fallbackWorkerSrc=l.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(l,t){let n;try{if(n=new URL(l),!n.origin||n.origin==="null")return!1}catch{return!1}const a=new URL(t,n);return n.origin===a.origin},PDFWorkerUtil.createCDNWrapper=function(l){const t=`importScripts("${l}");`;return URL.createObjectURL(new Blob([t]))}}const _PDFWorker=class _PDFWorker{constructor({name:l=null,port:t=null,verbosity:n=(0,_util.getVerbosityLevel)()}={}){if(t&&P(_PDFWorker,g).has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=l,this.destroyed=!1,this.verbosity=n,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t){P(_PDFWorker,g).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(l){this._port=l,this._messageHandler=new _message_handler.MessageHandler("main","worker",l),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:l}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,l)||(l=PDFWorkerUtil.createCDNWrapper(new URL(l,window.location).href));const t=new Worker(l),n=new _message_handler.MessageHandler("main","worker",t),a=()=>{t.removeEventListener("error",_),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},_=()=>{this._webWorker||a()};t.addEventListener("error",_),n.on("test",o=>{if(t.removeEventListener("error",_),this.destroyed){a();return}o?(this._messageHandler=n,this._port=t,this._webWorker=t,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),n.destroy(),t.terminate())}),n.on("ready",o=>{if(t.removeEventListener("error",_),this.destroyed){a();return}try{b()}catch{this._setupFakeWorker()}});const b=()=>{const o=new Uint8Array;n.send("test",o,[o.buffer])};b();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(l=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new LoopbackPort;this._port=t;const n=`fake${PDFWorkerUtil.fakeWorkerId++}`,a=new _message_handler.MessageHandler(n+"_worker",n,t);l.setup(a,t);const _=new _message_handler.MessageHandler(n,n+"_worker",t);this._messageHandler=_,this._readyCapability.resolve(),_.send("configure",{verbosity:this.verbosity})}).catch(l=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${l.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),P(_PDFWorker,g).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(l){if(!(l!=null&&l.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return P(this,g).has(l.port)?P(this,g).get(l.port):new _PDFWorker(l)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var l;try{return((l=globalThis.pdfjsWorker)==null?void 0:l.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};g=new WeakMap,at(_PDFWorker,g,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{constructor(t,n,a,_){at(this,p,null);at(this,I,new Map);at(this,N,new Map);at(this,K,null);this.messageHandler=t,this.loadingTask=n,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:n.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:_.ownerDocument,styleElement:_.styleElement}),this._params=_,_.useWorkerFetch||(this.CMapReaderFactory=new _.CMapReaderFactory({baseUrl:_.cMapUrl,isCompressed:_.cMapPacked}),this.StandardFontDataFactory=new _.StandardFontDataFactory({baseUrl:_.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=a,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return P(this,p)}getRenderingIntent(t,n=_util.AnnotationMode.ENABLE,a=null,_=!1){let b=_util.RenderingIntentFlag.DISPLAY,o=null;switch(t){case"any":b=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":b=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${t}`)}switch(n){case _util.AnnotationMode.DISABLE:b+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:b+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:b+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,o=(b&_util.RenderingIntentFlag.PRINT&&a instanceof _annotation_storage.PrintAnnotationStorage?a:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${n}`)}return _&&(b+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:b,cacheKey:`${b}_${_annotation_storage.AnnotationStorage.getHash(o)}`,annotationStorageMap:o}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const a of P(this,I).values())t.push(a._destroy());P(this,I).clear(),P(this,N).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const n=this.messageHandler.sendWithPromise("Terminate",null);return t.push(n),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),mt(this,K,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:n}=this;t.on("GetReader",(a,_)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=b=>{this._lastProgress={loaded:b.loaded,total:b.total}},_.onPull=()=>{this._fullReader.read().then(function({value:b,done:o}){if(o){_.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(b),"GetReader - expected an ArrayBuffer."),_.enqueue(new Uint8Array(b),1,[b])}).catch(b=>{_.error(b)})},_.onCancel=b=>{this._fullReader.cancel(b),_.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",a=>{const _=(0,_util.createPromiseCapability)(),b=this._fullReader;return b.headersReady.then(()=>{var o;(!b.isStreamingSupported||!b.isRangeSupported)&&(this._lastProgress&&((o=n.onProgress)==null||o.call(n,this._lastProgress)),b.onProgress=e=>{var s;(s=n.onProgress)==null||s.call(n,{loaded:e.loaded,total:e.total})}),_.resolve({isStreamingSupported:b.isStreamingSupported,isRangeSupported:b.isRangeSupported,contentLength:b.contentLength})},_.reject),_.promise}),t.on("GetRangeReader",(a,_)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const b=this._networkStream.getRangeReader(a.begin,a.end);if(!b){_.close();return}_.onPull=()=>{b.read().then(function({value:o,done:e}){if(e){_.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(o),"GetRangeReader - expected an ArrayBuffer."),_.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{_.error(o)})},_.onCancel=o=>{b.cancel(o),_.ready.catch(e=>{if(!this.destroyed)throw e})}}),t.on("GetDoc",({pdfInfo:a})=>{this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,n._capability.resolve(new PDFDocumentProxy(a,this))}),t.on("DocException",function(a){let _;switch(a.name){case"PasswordException":_=new _util.PasswordException(a.message,a.code);break;case"InvalidPDFException":_=new _util.InvalidPDFException(a.message);break;case"MissingPDFException":_=new _util.MissingPDFException(a.message);break;case"UnexpectedResponseException":_=new _util.UnexpectedResponseException(a.message,a.status);break;case"UnknownErrorException":_=new _util.UnknownErrorException(a.message,a.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}n._capability.reject(_)}),t.on("PasswordRequest",a=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),n.onPassword){const _=b=>{b instanceof Error?this._passwordCapability.reject(b):this._passwordCapability.resolve({password:b})};try{n.onPassword(_,a.code)}catch(b){this._passwordCapability.reject(b)}}else this._passwordCapability.reject(new _util.PasswordException(a.message,a.code));return this._passwordCapability.promise}),t.on("DataLoaded",a=>{var _;(_=n.onProgress)==null||_.call(n,{loaded:a.length,total:a.length}),this.downloadInfoCapability.resolve(a)}),t.on("StartRenderPage",a=>{if(this.destroyed)return;P(this,I).get(a.pageIndex)._startRenderPage(a.transparency,a.cacheKey)}),t.on("commonobj",([a,_,b])=>{var o;if(!this.destroyed&&!this.commonObjs.has(a))switch(_){case"Font":const e=this._params;if("error"in b){const C=b.error;(0,_util.warn)(`Error during font loading: ${C}`),this.commonObjs.resolve(a,C);break}let s=null;e.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)&&(s={registerFont(C,y){globalThis.FontInspector.fontAdded(C,y)}});const d=new _font_loader.FontFaceObject(b,{isEvalSupported:e.isEvalSupported,disableFontFace:e.disableFontFace,ignoreErrors:e.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:s});this.fontLoader.bind(d).catch(C=>t.sendWithPromise("FontFallback",{id:a})).finally(()=>{!e.fontExtraProperties&&d.data&&(d.data=null),this.commonObjs.resolve(a,d)});break;case"FontPath":case"Image":this.commonObjs.resolve(a,b);break;default:throw new Error(`Got unknown common object type ${_}`)}}),t.on("obj",([a,_,b,o])=>{var s;if(this.destroyed)return;const e=P(this,I).get(_);if(!e.objs.has(a))switch(b){case"Image":e.objs.resolve(a,o);const d=8e6;if(o){let C;if(o.bitmap){const{bitmap:y,width:f,height:T}=o;C=f*T*4,e._bitmaps.add(y)}else C=((s=o.data)==null?void 0:s.length)||0;C>d&&(e.cleanupAfterRender=!0)}break;case"Pattern":e.objs.resolve(a,o);break;default:throw new Error(`Got unknown object type ${b}`)}}),t.on("DocProgress",a=>{var _;this.destroyed||(_=n.onProgress)==null||_.call(n,{loaded:a.loaded,total:a.total})}),t.on("DocStats",a=>{this.destroyed||mt(this,p,Object.freeze({streamTypes:Object.freeze(a.streamTypes),fontTypes:Object.freeze(a.fontTypes)}))}),t.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),t.on("FetchBuiltInCMap",a=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(a):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),t.on("FetchStandardFontData",a=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(a):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:t}){var n,a;this.destroyed||(a=(n=this.loadingTask).onUnsupportedFeature)==null||a.call(n,t)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const n=t-1,a=P(this,N).get(n);if(a)return a;const _=this.messageHandler.sendWithPromise("GetPage",{pageIndex:n}).then(b=>{if(this.destroyed)throw new Error("Transport destroyed");const o=new PDFPageProxy(n,b,this,this._params.ownerDocument,this._params.pdfBug);return P(this,I).set(n,o),o});return P(this,N).set(n,_),_}getPageIndex(t){return typeof t!="object"||t===null||!Number.isInteger(t.num)||t.num<0||!Number.isInteger(t.gen)||t.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,n){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:n})}saveDocument(){var t;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:((t=this._fullReader)==null?void 0:t.filename)??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||(this._getFieldObjectsPromise=this.messageHandler.sendWithPromise("GetFieldObjects",null))}hasJSActions(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(t=>new _optional_content_config.OptionalContentConfig(t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return P(this,K)||mt(this,K,this.messageHandler.sendWithPromise("GetMetadata",null).then(t=>{var n,a;return{info:t[0],metadata:t[1]?new _metadata.Metadata(t[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(const n of P(this,I).values())if(!n.cleanup())throw new Error(`startCleanup: Page ${n.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),mt(this,K,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){const t=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:t.disableAutoFetch,enableXfa:t.enableXfa})}}p=new WeakMap,I=new WeakMap,N=new WeakMap,K=new WeakMap;class PDFObjects{constructor(){at(this,m);at(this,L,Object.create(null))}get(t,n=null){if(n){const _=ht(this,m,oe).call(this,t);return _.capability.promise.then(()=>n(_.data)),null}const a=P(this,L)[t];if(!(a!=null&&a.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${t}.`);return a.data}has(t){const n=P(this,L)[t];return(n==null?void 0:n.capability.settled)||!1}resolve(t,n=null){const a=ht(this,m,oe).call(this,t);a.data=n,a.capability.resolve()}clear(){mt(this,L,Object.create(null))}}L=new WeakMap,m=new WeakSet,oe=function(t){const n=P(this,L)[t];return n||(P(this,L)[t]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(t){at(this,F,null);mt(this,F,t),this.onContinue=null}get promise(){return P(this,F).capability.promise}cancel(){P(this,F).cancel()}get separateAnnots(){const{separateAnnots:t}=P(this,F).operatorList;if(!t)return!1;const{annotationCanvasMap:n}=P(this,F);return t.form||t.canvas&&(n==null?void 0:n.size)>0}}F=new WeakMap,exports.RenderTask=RenderTask;const v=class v{constructor({callback:t,params:n,objs:a,commonObjs:_,annotationCanvasMap:b,operatorList:o,pageIndex:e,canvasFactory:s,useRequestAnimationFrame:d=!1,pdfBug:C=!1,pageColors:y=null}){this.callback=t,this.params=n,this.objs=a,this.commonObjs=_,this.annotationCanvasMap=b,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=e,this.canvasFactory=s,this._pdfBug=C,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:n}){var s;if(this.cancelled)return;if(this._canvas){if(P(v,x).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");P(v,x).add(this._canvas)}this._pdfBug&&((s=globalThis.StepperManager)!=null&&s.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:a,viewport:_,transform:b,imageLayer:o,background:e}=this.params;this.gfx=new _canvas.CanvasGraphics(a,this.commonObjs,this.objs,this.canvasFactory,o,n,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:b,viewport:_,transparency:t,background:e}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(t=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&P(v,x).delete(this._canvas),this.callback(t||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&P(v,x).delete(this._canvas),this.callback())))}};x=new WeakMap,at(v,x,new WeakSet);let InternalRenderTask=v;const version="2.16.105";exports.version=version;const build="172ccdbe5";exports.build=build},(Y,i,O)=>{var L,Ce,E;Object.defineProperty(i,"__esModule",{value:!0}),i.PrintAnnotationStorage=i.AnnotationStorage=void 0;var g=O(1),p=O(6),I=O(10);class N{constructor(){at(this,L);this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(x,v){const l=this._storage.get(x);return l===void 0?v:Object.assign(v,l)}getRawValue(x){return this._storage.get(x)}remove(x){if(this._storage.delete(x),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const v of this._storage.values())if(v instanceof p.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(x,v){const l=this._storage.get(x);let t=!1;if(l!==void 0)for(const[n,a]of Object.entries(v))l[n]!==a&&(t=!0,l[n]=a);else t=!0,this._storage.set(x,v);t&&ht(this,L,Ce).call(this),v instanceof p.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(v.constructor._type)}has(x){return this._storage.has(x)}getAll(){return this._storage.size>0?(0,g.objectFromMap)(this._storage):null}get size(){return this._storage.size}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new K(this)}get serializable(){if(this._storage.size===0)return null;const x=new Map;for(const[v,l]of this._storage){const t=l instanceof p.AnnotationEditor?l.serialize():l;t&&x.set(v,t)}return x}static getHash(x){if(!x)return"";const v=new I.MurmurHash3_64;for(const[l,t]of x)v.update(`${l}:${JSON.stringify(t)}`);return v.hexdigest()}}L=new WeakSet,Ce=function(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())},i.AnnotationStorage=N;class K extends N{constructor(v){super();at(this,E,null);mt(this,E,structuredClone(v.serializable))}get print(){(0,g.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return P(this,E)}}E=new WeakMap,i.PrintAnnotationStorage=K},(Y,i,O)=>{var N,K,L,m,E,F;Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditor=void 0;var g=O(7),p=O(1);const x=class x{constructor(l){at(this,N,this.focusin.bind(this));at(this,K,this.focusout.bind(this));at(this,L,!1);at(this,m,!1);at(this,E,!1);at(this,F,x._zIndex++);this.constructor===x&&(0,p.unreachable)("Cannot initialize AnnotationEditor."),this.parent=l.parent,this.id=l.id,this.width=this.height=null,this.pageIndex=l.parent.pageIndex,this.name=l.name,this.div=null;const[t,n]=this.parent.viewportBaseDimensions;this.x=l.x/t,this.y=l.y/n,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,p.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=P(this,F)}focusin(l){P(this,L)?mt(this,L,!1):this.parent.setSelected(this)}focusout(l){if(!this.isAttachedToDOM)return;const t=l.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(l.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(l){const t=this.parent.div.getBoundingClientRect();this.startX=l.clientX-t.x,this.startY=l.clientY-t.y,l.dataTransfer.setData("text/plain",this.id),l.dataTransfer.effectAllowed="move"}setAt(l,t,n,a){const[_,b]=this.parent.viewportBaseDimensions;[n,a]=this.screenToPageTranslation(n,a),this.x=(l+n)/_,this.y=(t+a)/b,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(l,t){const[n,a]=this.parent.viewportBaseDimensions;[l,t]=this.screenToPageTranslation(l,t),this.x+=l/n,this.y+=t/a,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(l,t){const{rotation:n}=this.parent.viewport;switch(n){case 90:return[t,-l];case 180:return[-l,-t];case 270:return[-t,l];default:return[l,t]}}setDims(l,t){const[n,a]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*l/n}%`,this.div.style.height=`${100*t/a}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",P(this,N)),this.div.addEventListener("focusout",P(this,K));const[l,t]=this.getInitialTranslation();return this.translate(l,t),(0,g.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(l){const t=g.KeyboardManager.platform.isMac;if(l.button!==0||l.ctrlKey&&t){l.preventDefault();return}l.ctrlKey&&!t||l.shiftKey||l.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this),mt(this,L,!0)}getRect(l,t){const[n,a]=this.parent.viewportBaseDimensions,[_,b]=this.parent.pageDimensions,o=_*l/n,e=b*t/a,s=this.x*_,d=this.y*b,C=this.width*_,y=this.height*b;switch(this.rotation){case 0:return[s+o,b-d-e-y,s+o+C,b-d-e];case 90:return[s+e,b-d+o,s+e+y,b-d+o+C];case 180:return[s-o-C,b-d+e,s-o,b-d+e+y];case 270:return[s-e-y,b-d-o-C,s-e,b-d-o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(l,t){const[n,a,_,b]=l,o=_-n,e=b-a;switch(this.rotation){case 0:return[n,t-b,o,e];case 90:return[n,t-a,e,o];case 180:return[_,t-a,o,e];case 270:return[_,t-b,e,o];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){mt(this,E,!0)}disableEditMode(){mt(this,E,!1)}isInEditMode(){return P(this,E)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var l;(l=this.div)==null||l.addEventListener("focusin",P(this,N))}serialize(){(0,p.unreachable)("An editor must be serializable")}static deserialize(l,t){const n=new this.prototype.constructor({parent:t,id:t.getNextId()});n.rotation=l.rotation;const[a,_]=t.pageDimensions,[b,o,e,s]=n.getRectInCurrentCoords(l.rect,_);return n.x=b/a,n.y=o/_,n.width=e/a,n.height=s/_,n}remove(){this.div.removeEventListener("focusin",P(this,N)),this.div.removeEventListener("focusout",P(this,K)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var l;(l=this.div)==null||l.classList.add("selectedEditor")}unselect(){var l;(l=this.div)==null||l.classList.remove("selectedEditor")}updateParams(l,t){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return P(this,m)}set isEditing(l){mt(this,m,l),l?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};N=new WeakMap,K=new WeakMap,L=new WeakMap,m=new WeakMap,E=new WeakMap,F=new WeakMap,Mt(x,"_colorManager",new g.ColorManager),Mt(x,"_zIndex",1);let I=x;i.AnnotationEditor=I},(Y,i,O)=>{var v,l,t,n,a,_,xe,e,d,C,y,f,T,Z,st,J,$,U,G,z,et,ot,_t,B,h,c,Te,R,le,j,jt,V,Jt,u,we,S,Pe,q,ce,dt,Qt,lt,te;Object.defineProperty(i,"__esModule",{value:!0}),i.KeyboardManager=i.CommandManager=i.ColorManager=i.AnnotationEditorUIManager=void 0,i.bindEvents=I,i.opacityToHex=N;var g=O(1),p=O(8);function I(ft,M,ut){for(const At of ut)M.addEventListener(At,ft[At].bind(ft))}function N(ft){return Math.round(Math.min(255,Math.max(1,255*ft))).toString(16).padStart(2,"0")}class K{constructor(){at(this,v,0)}getId(){return`${g.AnnotationEditorPrefix}${ae(this,v)._++}`}}v=new WeakMap;class L{constructor(M=128){at(this,l,[]);at(this,t,!1);at(this,n,void 0);at(this,a,-1);mt(this,n,M)}add({cmd:M,undo:ut,mustExec:At,type:vt=NaN,overwriteIfSameType:Et=!1,keepUndo:Tt=!1}){if(At&&M(),P(this,t))return;const Rt={cmd:M,undo:ut,type:vt};if(P(this,a)===-1){P(this,l).length>0&&(P(this,l).length=0),mt(this,a,0),P(this,l).push(Rt);return}if(Et&&P(this,l)[P(this,a)].type===vt){Tt&&(Rt.undo=P(this,l)[P(this,a)].undo),P(this,l)[P(this,a)]=Rt;return}const Ft=P(this,a)+1;Ft===P(this,n)?P(this,l).splice(0,1):(mt(this,a,Ft),Ft<P(this,l).length&&P(this,l).splice(Ft)),P(this,l).push(Rt)}undo(){P(this,a)!==-1&&(mt(this,t,!0),P(this,l)[P(this,a)].undo(),mt(this,t,!1),mt(this,a,P(this,a)-1))}redo(){P(this,a)<P(this,l).length-1&&(mt(this,a,P(this,a)+1),mt(this,t,!0),P(this,l)[P(this,a)].cmd(),mt(this,t,!1))}hasSomethingToUndo(){return P(this,a)!==-1}hasSomethingToRedo(){return P(this,a)<P(this,l).length-1}destroy(){mt(this,l,null)}}l=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,i.CommandManager=L;const o=class o{constructor(M){at(this,_);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const ut=o.platform.isMac;for(const[At,vt]of M)for(const Et of At){const Tt=Et.startsWith("mac+");ut&&Tt?(this.callbacks.set(Et.slice(4),vt),this.allKeys.add(Et.split("+").at(-1))):!ut&&!Tt&&(this.callbacks.set(Et,vt),this.allKeys.add(Et.split("+").at(-1)))}}static get platform(){const M=typeof navigator<"u"?navigator.platform:"";return(0,g.shadow)(this,"platform",{isWin:M.includes("Win"),isMac:M.includes("Mac")})}exec(M,ut){if(!this.allKeys.has(ut.key))return;const At=this.callbacks.get(ht(this,_,xe).call(this,ut));At&&(At.bind(M)(),ut.stopPropagation(),ut.preventDefault())}};_=new WeakSet,xe=function(M){M.altKey&&this.buffer.push("alt"),M.ctrlKey&&this.buffer.push("ctrl"),M.metaKey&&this.buffer.push("meta"),M.shiftKey&&this.buffer.push("shift"),this.buffer.push(M.key);const ut=this.buffer.join("+");return this.buffer.length=0,ut};let m=o;i.KeyboardManager=m;class E{constructor(){at(this,e,null)}copy(M){M&&(Array.isArray(M)?mt(this,e,M.map(ut=>ut.serialize())):mt(this,e,[M.serialize()]),mt(this,e,P(this,e).filter(ut=>!!ut)),P(this,e).length===0&&mt(this,e,null))}paste(){return P(this,e)}isEmpty(){return P(this,e)===null}destroy(){mt(this,e,null)}}e=new WeakMap;const s=class s{get _colors(){const M=new Map([["CanvasText",null],["Canvas",null]]);return(0,p.getColorValues)(M),(0,g.shadow)(this,"_colors",M)}convert(M){const ut=(0,p.getRGB)(M);if(!window.matchMedia("(forced-colors: active)").matches)return ut;for(const[At,vt]of this._colors)if(vt.every((Et,Tt)=>Et===ut[Tt]))return s._colorsMapping.get(At);return ut}getHexCode(M){const ut=this._colors.get(M);return ut?g.Util.makeHexColor(...ut):M}};Mt(s,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let F=s;i.ColorManager=F;const ct=class ct{constructor(M,ut){at(this,c);at(this,R);at(this,j);at(this,V);at(this,u);at(this,S);at(this,q);at(this,dt);at(this,lt);at(this,d,null);at(this,C,new Map);at(this,y,new Map);at(this,f,new E);at(this,T,new L);at(this,Z,0);at(this,st,null);at(this,J,null);at(this,$,new K);at(this,U,!1);at(this,G,g.AnnotationEditorType.NONE);at(this,z,new Set);at(this,et,this.keydown.bind(this));at(this,ot,this.onEditingAction.bind(this));at(this,_t,this.onPageChanging.bind(this));at(this,B,{isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});at(this,h,null);mt(this,h,M),mt(this,J,ut),P(this,J)._on("editingaction",P(this,ot)),P(this,J)._on("pagechanging",P(this,_t))}destroy(){ht(this,R,le).call(this),P(this,J)._off("editingaction",P(this,ot)),P(this,J)._off("pagechanging",P(this,_t));for(const M of P(this,y).values())M.destroy();P(this,y).clear(),P(this,C).clear(),mt(this,d,null),P(this,z).clear(),P(this,f).destroy(),P(this,T).destroy()}onPageChanging({pageNumber:M}){mt(this,Z,M-1)}focusMainContainer(){P(this,h).focus()}keydown(M){var ut;(ut=this.getActive())!=null&&ut.shouldGetKeyboardEvents()||ct._keyboardManager.exec(this,M)}onEditingAction(M){["undo","redo","cut","copy","paste","delete","selectAll"].includes(M.name)&&this[M.name]()}setEditingState(M){M?(ht(this,c,Te).call(this),ht(this,j,jt).call(this,{isEditing:P(this,G)!==g.AnnotationEditorType.NONE,isEmpty:ht(this,dt,Qt).call(this),hasSomethingToUndo:P(this,T).hasSomethingToUndo(),hasSomethingToRedo:P(this,T).hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:P(this,f).isEmpty()})):(ht(this,R,le).call(this),ht(this,j,jt).call(this,{isEditing:!1}))}registerEditorTypes(M){mt(this,st,M);for(const ut of P(this,st))ht(this,V,Jt).call(this,ut.defaultPropertiesToUpdate)}getId(){return P(this,$).getId()}addLayer(M){P(this,y).set(M.pageIndex,M),P(this,U)?M.enable():M.disable()}removeLayer(M){P(this,y).delete(M.pageIndex)}updateMode(M){if(mt(this,G,M),M===g.AnnotationEditorType.NONE)this.setEditingState(!1),ht(this,S,Pe).call(this);else{this.setEditingState(!0),ht(this,u,we).call(this);for(const ut of P(this,y).values())ut.updateMode(M)}}updateToolbar(M){M!==P(this,G)&&P(this,J).dispatch("switchannotationeditormode",{source:this,mode:M})}updateParams(M,ut){for(const At of P(this,z))At.updateParams(M,ut);for(const At of P(this,st))At.updateDefaultParams(M,ut)}getEditors(M){const ut=[];for(const At of P(this,C).values())At.pageIndex===M&&ut.push(At);return ut}getEditor(M){return P(this,C).get(M)}addEditor(M){P(this,C).set(M.id,M)}removeEditor(M){P(this,C).delete(M.id),this.unselect(M)}setActiveEditor(M){P(this,d)!==M&&(mt(this,d,M),M&&ht(this,V,Jt).call(this,M.propertiesToUpdate))}toggleSelected(M){if(P(this,z).has(M)){P(this,z).delete(M),M.unselect(),ht(this,j,jt).call(this,{hasSelectedEditor:this.hasSelection});return}P(this,z).add(M),M.select(),ht(this,V,Jt).call(this,M.propertiesToUpdate),ht(this,j,jt).call(this,{hasSelectedEditor:!0})}setSelected(M){for(const ut of P(this,z))ut!==M&&ut.unselect();P(this,z).clear(),P(this,z).add(M),M.select(),ht(this,V,Jt).call(this,M.propertiesToUpdate),ht(this,j,jt).call(this,{hasSelectedEditor:!0})}isSelected(M){return P(this,z).has(M)}unselect(M){M.unselect(),P(this,z).delete(M),ht(this,j,jt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return P(this,z).size!==0}undo(){P(this,T).undo(),ht(this,j,jt).call(this,{hasSomethingToUndo:P(this,T).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:ht(this,dt,Qt).call(this)})}redo(){P(this,T).redo(),ht(this,j,jt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:P(this,T).hasSomethingToRedo(),isEmpty:ht(this,dt,Qt).call(this)})}addCommands(M){P(this,T).add(M),ht(this,j,jt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:ht(this,dt,Qt).call(this)})}delete(){if(P(this,d)&&P(this,d).commitOrRemove(),!this.hasSelection)return;const M=[...P(this,z)],ut=()=>{for(const vt of M)vt.remove()},At=()=>{for(const vt of M)ht(this,q,ce).call(this,vt)};this.addCommands({cmd:ut,undo:At,mustExec:!0})}copy(){if(P(this,d)&&P(this,d).commitOrRemove(),this.hasSelection){const M=[];for(const ut of P(this,z))ut.isEmpty()||M.push(ut);if(M.length===0)return;P(this,f).copy(M),ht(this,j,jt).call(this,{hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(P(this,f).isEmpty())return;this.unselectAll();const M=P(this,y).get(P(this,Z)),ut=P(this,f).paste().map(Et=>M.deserialize(Et)),At=()=>{for(const Et of ut)ht(this,q,ce).call(this,Et);ht(this,lt,te).call(this,ut)},vt=()=>{for(const Et of ut)Et.remove()};this.addCommands({cmd:At,undo:vt,mustExec:!0})}selectAll(){for(const M of P(this,z))M.commit();ht(this,lt,te).call(this,P(this,C).values())}unselectAll(){if(P(this,d)){P(this,d).commitOrRemove();return}if(ht(this,lt,te).size!==0){for(const M of P(this,z))M.unselect();P(this,z).clear(),ht(this,j,jt).call(this,{hasSelectedEditor:!1})}}isActive(M){return P(this,d)===M}getActive(){return P(this,d)}getMode(){return P(this,G)}};d=new WeakMap,C=new WeakMap,y=new WeakMap,f=new WeakMap,T=new WeakMap,Z=new WeakMap,st=new WeakMap,J=new WeakMap,$=new WeakMap,U=new WeakMap,G=new WeakMap,z=new WeakMap,et=new WeakMap,ot=new WeakMap,_t=new WeakMap,B=new WeakMap,h=new WeakMap,c=new WeakSet,Te=function(){P(this,h).addEventListener("keydown",P(this,et))},R=new WeakSet,le=function(){P(this,h).removeEventListener("keydown",P(this,et))},j=new WeakSet,jt=function(M){Object.entries(M).some(([At,vt])=>P(this,B)[At]!==vt)&&P(this,J).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(P(this,B),M)})},V=new WeakSet,Jt=function(M){P(this,J).dispatch("annotationeditorparamschanged",{source:this,details:M})},u=new WeakSet,we=function(){if(!P(this,U)){mt(this,U,!0);for(const M of P(this,y).values())M.enable()}},S=new WeakSet,Pe=function(){if(this.unselectAll(),P(this,U)){mt(this,U,!1);for(const M of P(this,y).values())M.disable()}},q=new WeakSet,ce=function(M){const ut=P(this,y).get(M.pageIndex);ut?ut.addOrRebuild(M):this.addEditor(M)},dt=new WeakSet,Qt=function(){if(P(this,C).size===0)return!0;if(P(this,C).size===1)for(const M of P(this,C).values())return M.isEmpty();return!1},lt=new WeakSet,te=function(M){P(this,z).clear();for(const ut of M)ut.isEmpty()||(P(this,z).add(ut),ut.select());ht(this,j,jt).call(this,{hasSelectedEditor:!0})},Mt(ct,"_keyboardManager",new m([[["ctrl+a","mac+meta+a"],ct.prototype.selectAll],[["ctrl+c","mac+meta+c"],ct.prototype.copy],[["ctrl+v","mac+meta+v"],ct.prototype.paste],[["ctrl+x","mac+meta+x"],ct.prototype.cut],[["ctrl+z","mac+meta+z"],ct.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],ct.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],ct.prototype.delete],[["Escape","mac+Escape"],ct.prototype.unselectAll]]));let x=ct;i.AnnotationEditorUIManager=x},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StatTimer=i.RenderingCancelledException=i.PixelsPerInch=i.PageViewport=i.PDFDateString=i.DOMStandardFontDataFactory=i.DOMSVGFactory=i.DOMCanvasFactory=i.DOMCMapReaderFactory=i.AnnotationPrefix=void 0,i.deprecated=s,i.getColorValues=T,i.getCurrentTransform=Z,i.getCurrentTransformInverse=st,i.getFilenameFromUrl=a,i.getPdfFilenameFromUrl=_,i.getRGB=f,i.getXfaPageViewport=y,i.isDataScheme=t,i.isPdfFile=n,i.isValidFetchUrl=o,i.loadScript=e;var g=O(9),p=O(1);const I="http://www.w3.org/2000/svg",N="pdfjs_internal_id_";i.AnnotationPrefix=N;const J=class J{};Mt(J,"CSS",96),Mt(J,"PDF",72),Mt(J,"PDF_TO_CSS_UNITS",J.CSS/J.PDF);let K=J;i.PixelsPerInch=K;class L extends g.BaseCanvasFactory{constructor({ownerDocument:U=globalThis.document}={}){super(),this._document=U}_createCanvas(U,G){const z=this._document.createElement("canvas");return z.width=U,z.height=G,z}}i.DOMCanvasFactory=L;async function m($,U=!1){if(o($,document.baseURI)){const G=await fetch($);if(!G.ok)throw new Error(G.statusText);return U?new Uint8Array(await G.arrayBuffer()):(0,p.stringToBytes)(await G.text())}return new Promise((G,z)=>{const et=new XMLHttpRequest;et.open("GET",$,!0),U&&(et.responseType="arraybuffer"),et.onreadystatechange=()=>{if(et.readyState===XMLHttpRequest.DONE){if(et.status===200||et.status===0){let ot;if(U&&et.response?ot=new Uint8Array(et.response):!U&&et.responseText&&(ot=(0,p.stringToBytes)(et.responseText)),ot){G(ot);return}}z(new Error(et.statusText))}},et.send(null)})}class E extends g.BaseCMapReaderFactory{_fetchData(U,G){return m(U,this.isCompressed).then(z=>({cMapData:z,compressionType:G}))}}i.DOMCMapReaderFactory=E;class F extends g.BaseStandardFontDataFactory{_fetchData(U){return m(U,!0)}}i.DOMStandardFontDataFactory=F;class x extends g.BaseSVGFactory{_createSVG(U){return document.createElementNS(I,U)}}i.DOMSVGFactory=x;class v{constructor({viewBox:U,scale:G,rotation:z,offsetX:et=0,offsetY:ot=0,dontFlip:_t=!1}){this.viewBox=U,this.scale=G,this.rotation=z,this.offsetX=et,this.offsetY=ot;const B=(U[2]+U[0])/2,h=(U[3]+U[1])/2;let c,w,R,D;switch(z%=360,z<0&&(z+=360),z){case 180:c=-1,w=0,R=0,D=1;break;case 90:c=0,w=1,R=1,D=0;break;case 270:c=0,w=-1,R=-1,D=0;break;case 0:c=1,w=0,R=0,D=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}_t&&(R=-R,D=-D);let j,X,V,r;c===0?(j=Math.abs(h-U[1])*G+et,X=Math.abs(B-U[0])*G+ot,V=Math.abs(U[3]-U[1])*G,r=Math.abs(U[2]-U[0])*G):(j=Math.abs(B-U[0])*G+et,X=Math.abs(h-U[1])*G+ot,V=Math.abs(U[2]-U[0])*G,r=Math.abs(U[3]-U[1])*G),this.transform=[c*G,w*G,R*G,D*G,j-c*G*B-R*G*h,X-w*G*B-D*G*h],this.width=V,this.height=r}clone({scale:U=this.scale,rotation:G=this.rotation,offsetX:z=this.offsetX,offsetY:et=this.offsetY,dontFlip:ot=!1}={}){return new v({viewBox:this.viewBox.slice(),scale:U,rotation:G,offsetX:z,offsetY:et,dontFlip:ot})}convertToViewportPoint(U,G){return p.Util.applyTransform([U,G],this.transform)}convertToViewportRectangle(U){const G=p.Util.applyTransform([U[0],U[1]],this.transform),z=p.Util.applyTransform([U[2],U[3]],this.transform);return[G[0],G[1],z[0],z[1]]}convertToPdfPoint(U,G){return p.Util.applyInverseTransform([U,G],this.transform)}}i.PageViewport=v;class l extends p.BaseException{constructor(U,G){super(U,"RenderingCancelledException"),this.type=G}}i.RenderingCancelledException=l;function t($){const U=$.length;let G=0;for(;G<U&&$[G].trim()==="";)G++;return $.substring(G,G+5).toLowerCase()==="data:"}function n($){return typeof $=="string"&&/\.pdf$/i.test($)}function a($){const U=$.indexOf("#"),G=$.indexOf("?"),z=Math.min(U>0?U:$.length,G>0?G:$.length);return $.substring($.lastIndexOf("/",z)+1,z)}function _($,U="document.pdf"){if(typeof $!="string")return U;if(t($))return(0,p.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),U;const G=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,z=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,et=G.exec($);let ot=z.exec(et[1])||z.exec(et[2])||z.exec(et[3]);if(ot&&(ot=ot[0],ot.includes("%")))try{ot=z.exec(decodeURIComponent(ot))[0]}catch{}return ot||U}class b{constructor(){this.started=Object.create(null),this.times=[]}time(U){U in this.started&&(0,p.warn)(`Timer is already running for ${U}`),this.started[U]=Date.now()}timeEnd(U){U in this.started||(0,p.warn)(`Timer has not been started for ${U}`),this.times.push({name:U,start:this.started[U],end:Date.now()}),delete this.started[U]}toString(){const U=[];let G=0;for(const z of this.times){const et=z.name;et.length>G&&(G=et.length)}for(const z of this.times){const et=z.end-z.start;U.push(`${z.name.padEnd(G)} ${et}ms
`)}return U.join("")}}i.StatTimer=b;function o($,U){try{const{protocol:G}=U?new URL($,U):new URL($);return G==="http:"||G==="https:"}catch{return!1}}function e($,U=!1){return new Promise((G,z)=>{const et=document.createElement("script");et.src=$,et.onload=function(ot){U&&et.remove(),G(ot)},et.onerror=function(){z(new Error(`Cannot load script at: ${et.src}`))},(document.head||document.documentElement).append(et)})}function s($){console.log("Deprecated API usage: "+$)}let d;class C{static toDateObject(U){if(!U||typeof U!="string")return null;d||(d=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const G=d.exec(U);if(!G)return null;const z=parseInt(G[1],10);let et=parseInt(G[2],10);et=et>=1&&et<=12?et-1:0;let ot=parseInt(G[3],10);ot=ot>=1&&ot<=31?ot:1;let _t=parseInt(G[4],10);_t=_t>=0&&_t<=23?_t:0;let B=parseInt(G[5],10);B=B>=0&&B<=59?B:0;let h=parseInt(G[6],10);h=h>=0&&h<=59?h:0;const c=G[7]||"Z";let w=parseInt(G[8],10);w=w>=0&&w<=23?w:0;let R=parseInt(G[9],10)||0;return R=R>=0&&R<=59?R:0,c==="-"?(_t+=w,B+=R):c==="+"&&(_t-=w,B-=R),new Date(Date.UTC(z,et,ot,_t,B,h))}}i.PDFDateString=C;function y($,{scale:U=1,rotation:G=0}){const{width:z,height:et}=$.attributes.style,ot=[0,0,parseInt(z),parseInt(et)];return new v({viewBox:ot,scale:U,rotation:G})}function f($){if($.startsWith("#")){const U=parseInt($.slice(1),16);return[(U&16711680)>>16,(U&65280)>>8,U&255]}return $.startsWith("rgb(")?$.slice(4,-1).split(",").map(U=>parseInt(U)):$.startsWith("rgba(")?$.slice(5,-1).split(",").map(U=>parseInt(U)).slice(0,3):((0,p.warn)(`Not a valid color format: "${$}"`),[0,0,0])}function T($){const U=document.createElement("span");U.style.visibility="hidden",document.body.append(U);for(const G of $.keys()){U.style.color=G;const z=window.getComputedStyle(U).color;$.set(G,f(z))}U.remove()}function Z($){const{a:U,b:G,c:z,d:et,e:ot,f:_t}=$.getTransform();return[U,G,z,et,ot,_t]}function st($){const{a:U,b:G,c:z,d:et,e:ot,f:_t}=$.getTransform().invertSelf();return[U,G,z,et,ot,_t]}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseStandardFontDataFactory=i.BaseSVGFactory=i.BaseCanvasFactory=i.BaseCMapReaderFactory=void 0;var g=O(1);class p{constructor(){this.constructor===p&&(0,g.unreachable)("Cannot initialize BaseCanvasFactory.")}create(m,E){if(m<=0||E<=0)throw new Error("Invalid canvas size");const F=this._createCanvas(m,E);return{canvas:F,context:F.getContext("2d")}}reset(m,E,F){if(!m.canvas)throw new Error("Canvas is not specified");if(E<=0||F<=0)throw new Error("Invalid canvas size");m.canvas.width=E,m.canvas.height=F}destroy(m){if(!m.canvas)throw new Error("Canvas is not specified");m.canvas.width=0,m.canvas.height=0,m.canvas=null,m.context=null}_createCanvas(m,E){(0,g.unreachable)("Abstract method `_createCanvas` called.")}}i.BaseCanvasFactory=p;class I{constructor({baseUrl:m=null,isCompressed:E=!1}){this.constructor===I&&(0,g.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=m,this.isCompressed=E}async fetch({name:m}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!m)throw new Error("CMap name must be specified.");const E=this.baseUrl+m+(this.isCompressed?".bcmap":""),F=this.isCompressed?g.CMapCompressionType.BINARY:g.CMapCompressionType.NONE;return this._fetchData(E,F).catch(x=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${E}`)})}_fetchData(m,E){(0,g.unreachable)("Abstract method `_fetchData` called.")}}i.BaseCMapReaderFactory=I;class N{constructor({baseUrl:m=null}){this.constructor===N&&(0,g.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=m}async fetch({filename:m}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!m)throw new Error("Font filename must be specified.");const E=`${this.baseUrl}${m}`;return this._fetchData(E).catch(F=>{throw new Error(`Unable to load font data at: ${E}`)})}_fetchData(m){(0,g.unreachable)("Abstract method `_fetchData` called.")}}i.BaseStandardFontDataFactory=N;class K{constructor(){this.constructor===K&&(0,g.unreachable)("Cannot initialize BaseSVGFactory.")}create(m,E,F=!1){if(m<=0||E<=0)throw new Error("Invalid SVG dimensions");const x=this._createSVG("svg:svg");return x.setAttribute("version","1.1"),F||(x.setAttribute("width",`${m}px`),x.setAttribute("height",`${E}px`)),x.setAttribute("preserveAspectRatio","none"),x.setAttribute("viewBox",`0 0 ${m} ${E}`),x}createElement(m){if(typeof m!="string")throw new Error("Invalid SVG element type");return this._createSVG(m)}_createSVG(m){(0,g.unreachable)("Abstract method `_createSVG` called.")}}i.BaseSVGFactory=K},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MurmurHash3_64=void 0;var g=O(1);const p=3285377520,I=4294901760,N=65535;class K{constructor(m){this.h1=m?m&4294967295:p,this.h2=m?m&4294967295:p}update(m){let E,F;if(typeof m=="string"){E=new Uint8Array(m.length*2),F=0;for(let d=0,C=m.length;d<C;d++){const y=m.charCodeAt(d);y<=255?E[F++]=y:(E[F++]=y>>>8,E[F++]=y&255)}}else if((0,g.isArrayBuffer)(m))E=m.slice(),F=E.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const x=F>>2,v=F-x*4,l=new Uint32Array(E.buffer,0,x);let t=0,n=0,a=this.h1,_=this.h2;const b=3432918353,o=461845907,e=b&N,s=o&N;for(let d=0;d<x;d++)d&1?(t=l[d],t=t*b&I|t*e&N,t=t<<15|t>>>17,t=t*o&I|t*s&N,a^=t,a=a<<13|a>>>19,a=a*5+3864292196):(n=l[d],n=n*b&I|n*e&N,n=n<<15|n>>>17,n=n*o&I|n*s&N,_^=n,_=_<<13|_>>>19,_=_*5+3864292196);switch(t=0,v){case 3:t^=E[x*4+2]<<16;case 2:t^=E[x*4+1]<<8;case 1:t^=E[x*4],t=t*b&I|t*e&N,t=t<<15|t>>>17,t=t*o&I|t*s&N,x&1?a^=t:_^=t}this.h1=a,this.h2=_}hexdigest(){let m=this.h1,E=this.h2;m^=E>>>1,m=m*3981806797&I|m*36045&N,E=E*4283543511&I|((E<<16|m>>>16)*2950163797&I)>>>16,m^=E>>>1,m=m*444984403&I|m*60499&N,E=E*3301882366&I|((E<<16|m>>>16)*3120437893&I)>>>16,m^=E>>>1;const F=(m>>>0).toString(16),x=(E>>>0).toString(16);return F.padStart(8,"0")+x.padStart(8,"0")}}i.MurmurHash3_64=K},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FontLoader=i.FontFaceObject=void 0;var g=O(1);class p{constructor({docId:L,onUnsupportedFeature:m,ownerDocument:E=globalThis.document,styleElement:F=null}){this.constructor===p&&(0,g.unreachable)("Cannot initialize BaseFontLoader."),this.docId=L,this._onUnsupportedFeature=m,this._document=E,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(L){this.nativeFontFaces.push(L),this._document.fonts.add(L)}insertRule(L){let m=this.styleElement;m||(m=this.styleElement=this._document.createElement("style"),m.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(m));const E=m.sheet;E.insertRule(L,E.cssRules.length)}clear(){for(const L of this.nativeFontFaces)this._document.fonts.delete(L);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(L){if(L.attached||L.missingFile)return;if(L.attached=!0,this.isFontLoadingAPISupported){const E=L.createNativeFontFace();if(E){this.addNativeFontFace(E);try{await E.loaded}catch(F){throw this._onUnsupportedFeature({featureId:g.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,g.warn)(`Failed to load font '${E.family}': '${F}'.`),L.disableFontFace=!0,F}}return}const m=L.createFontFaceRule();if(m){if(this.insertRule(m),this.isSyncFontLoadingSupported)return;await new Promise(E=>{const F=this._queueLoadingCallback(E);this._prepareFontLoadEvent([m],[L],F)})}}_queueLoadingCallback(L){(0,g.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){var m;const L=!!((m=this._document)!=null&&m.fonts);return(0,g.shadow)(this,"isFontLoadingAPISupported",L)}get isSyncFontLoadingSupported(){(0,g.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,g.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(L,m,E){(0,g.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let I;i.FontLoader=I,i.FontLoader=I=class extends p{constructor(L){super(L),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let L=!1;if(typeof navigator>"u")L=!0;else{const m=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);(m==null?void 0:m[1])>=14&&(L=!0)}return(0,g.shadow)(this,"isSyncFontLoadingSupported",L)}_queueLoadingCallback(L){function m(){for((0,g.assert)(!F.done,"completeRequest() cannot be called twice."),F.done=!0;E.requests.length>0&&E.requests[0].done;){const x=E.requests.shift();setTimeout(x.callback,0)}}const E=this.loadingContext,F={id:`pdfjs-font-loading-${E.nextRequestId++}`,done:!1,complete:m,callback:L};return E.requests.push(F),F}get _loadTestFont(){const L=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,g.shadow)(this,"_loadTestFont",L())}_prepareFontLoadEvent(L,m,E){function F(st,J){return st.charCodeAt(J)<<24|st.charCodeAt(J+1)<<16|st.charCodeAt(J+2)<<8|st.charCodeAt(J+3)&255}function x(st,J,$,U){const G=st.substring(0,J),z=st.substring(J+$);return G+U+z}let v,l;const t=this._document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");let a=0;function _(st,J){if(a++,a>30){(0,g.warn)("Load test font never loaded."),J();return}if(n.font="30px "+st,n.fillText(".",0,20),n.getImageData(0,0,1,1).data[3]>0){J();return}setTimeout(_.bind(null,st,J))}const b=`lt${Date.now()}${this.loadTestFontId++}`;let o=this._loadTestFont;o=x(o,976,b.length,b);const s=16,d=1482184792;let C=F(o,s);for(v=0,l=b.length-3;v<l;v+=4)C=C-d+F(b,v)|0;v<b.length&&(C=C-d+F(b+"XXX",v)|0),o=x(o,s,4,(0,g.string32)(C));const y=`url(data:font/opentype;base64,${btoa(o)});`,f=`@font-face {font-family:"${b}";src:${y}}`;this.insertRule(f);const T=[];for(const st of m)T.push(st.loadedName);T.push(b);const Z=this._document.createElement("div");Z.style.visibility="hidden",Z.style.width=Z.style.height="10px",Z.style.position="absolute",Z.style.top=Z.style.left="0px";for(const st of T){const J=this._document.createElement("span");J.textContent="Hi",J.style.fontFamily=st,Z.append(J)}this._document.body.append(Z),_(b,()=>{Z.remove(),E.complete()})}};class N{constructor(L,{isEvalSupported:m=!0,disableFontFace:E=!1,ignoreErrors:F=!1,onUnsupportedFeature:x,fontRegistry:v=null}){this.compiledGlyphs=Object.create(null);for(const l in L)this[l]=L[l];this.isEvalSupported=m!==!1,this.disableFontFace=E===!0,this.ignoreErrors=F===!0,this._onUnsupportedFeature=x,this.fontRegistry=v}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let L;if(!this.cssFontInfo)L=new FontFace(this.loadedName,this.data,{});else{const m={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(m.style=`oblique ${this.cssFontInfo.italicAngle}deg`),L=new FontFace(this.cssFontInfo.fontFamily,this.data,m)}return this.fontRegistry&&this.fontRegistry.registerFont(this),L}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const L=(0,g.bytesToString)(this.data),m=`url(data:${this.mimetype};base64,${btoa(L)});`;let E;if(!this.cssFontInfo)E=`@font-face {font-family:"${this.loadedName}";src:${m}}`;else{let F=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(F+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),E=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${F}src:${m}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,m),E}getPathGenerator(L,m){if(this.compiledGlyphs[m]!==void 0)return this.compiledGlyphs[m];let E;try{E=L.get(this.loadedName+"_path_"+m)}catch(F){if(!this.ignoreErrors)throw F;return this._onUnsupportedFeature({featureId:g.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,g.warn)(`getPathGenerator - ignoring character: "${F}".`),this.compiledGlyphs[m]=function(x,v){}}if(this.isEvalSupported&&g.FeatureTest.isEvalSupported){const F=[];for(const x of E){const v=x.args!==void 0?x.args.join(","):"";F.push("c.",x.cmd,"(",v,`);
`)}return this.compiledGlyphs[m]=new Function("c","size",F.join(""))}return this.compiledGlyphs[m]=function(F,x){for(const v of E)v.cmd==="scale"&&(v.args=[x,-x]),F[v.cmd].apply(F,v.args)}}}i.FontFaceObject=N},(Y,i,O)=>{var et,he;Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasGraphics=void 0;var g=O(8),p=O(1),I=O(13),N=O(14),K=O(3);const L=16,m=100,E=4096,F=15,x=10,v=K.isNodeJS&&typeof Path2D>"u"?-1:1e3,l=16;function t(B,h){if(B._removeMirroring)throw new Error("Context is already forwarding operations.");B.__originalSave=B.save,B.__originalRestore=B.restore,B.__originalRotate=B.rotate,B.__originalScale=B.scale,B.__originalTranslate=B.translate,B.__originalTransform=B.transform,B.__originalSetTransform=B.setTransform,B.__originalResetTransform=B.resetTransform,B.__originalClip=B.clip,B.__originalMoveTo=B.moveTo,B.__originalLineTo=B.lineTo,B.__originalBezierCurveTo=B.bezierCurveTo,B.__originalRect=B.rect,B.__originalClosePath=B.closePath,B.__originalBeginPath=B.beginPath,B._removeMirroring=()=>{B.save=B.__originalSave,B.restore=B.__originalRestore,B.rotate=B.__originalRotate,B.scale=B.__originalScale,B.translate=B.__originalTranslate,B.transform=B.__originalTransform,B.setTransform=B.__originalSetTransform,B.resetTransform=B.__originalResetTransform,B.clip=B.__originalClip,B.moveTo=B.__originalMoveTo,B.lineTo=B.__originalLineTo,B.bezierCurveTo=B.__originalBezierCurveTo,B.rect=B.__originalRect,B.closePath=B.__originalClosePath,B.beginPath=B.__originalBeginPath,delete B._removeMirroring},B.save=function(){h.save(),this.__originalSave()},B.restore=function(){h.restore(),this.__originalRestore()},B.translate=function(w,R){h.translate(w,R),this.__originalTranslate(w,R)},B.scale=function(w,R){h.scale(w,R),this.__originalScale(w,R)},B.transform=function(w,R,D,j,X,V){h.transform(w,R,D,j,X,V),this.__originalTransform(w,R,D,j,X,V)},B.setTransform=function(w,R,D,j,X,V){h.setTransform(w,R,D,j,X,V),this.__originalSetTransform(w,R,D,j,X,V)},B.resetTransform=function(){h.resetTransform(),this.__originalResetTransform()},B.rotate=function(w){h.rotate(w),this.__originalRotate(w)},B.clip=function(w){h.clip(w),this.__originalClip(w)},B.moveTo=function(c,w){h.moveTo(c,w),this.__originalMoveTo(c,w)},B.lineTo=function(c,w){h.lineTo(c,w),this.__originalLineTo(c,w)},B.bezierCurveTo=function(c,w,R,D,j,X){h.bezierCurveTo(c,w,R,D,j,X),this.__originalBezierCurveTo(c,w,R,D,j,X)},B.rect=function(c,w,R,D){h.rect(c,w,R,D),this.__originalRect(c,w,R,D)},B.closePath=function(){h.closePath(),this.__originalClosePath()},B.beginPath=function(){h.beginPath(),this.__originalBeginPath()}}class n{constructor(h){this.canvasFactory=h,this.cache=Object.create(null)}getCanvas(h,c,w){let R;return this.cache[h]!==void 0?(R=this.cache[h],this.canvasFactory.reset(R,c,w)):(R=this.canvasFactory.create(c,w),this.cache[h]=R),R}delete(h){delete this.cache[h]}clear(){for(const h in this.cache){const c=this.cache[h];this.canvasFactory.destroy(c),delete this.cache[h]}}}function a(B,h,c,w,R,D,j,X,V,r){const[u,A,S,k,q,it]=(0,g.getCurrentTransform)(B);if(A===0&&S===0){const lt=j*u+q,nt=Math.round(lt),ct=X*k+it,ft=Math.round(ct),M=(j+V)*u+q,ut=Math.abs(Math.round(M)-nt)||1,At=(X+r)*k+it,vt=Math.abs(Math.round(At)-ft)||1;return B.setTransform(Math.sign(u),0,0,Math.sign(k),nt,ft),B.drawImage(h,c,w,R,D,0,0,ut,vt),B.setTransform(u,A,S,k,q,it),[ut,vt]}if(u===0&&k===0){const lt=X*S+q,nt=Math.round(lt),ct=j*A+it,ft=Math.round(ct),M=(X+r)*S+q,ut=Math.abs(Math.round(M)-nt)||1,At=(j+V)*A+it,vt=Math.abs(Math.round(At)-ft)||1;return B.setTransform(0,Math.sign(A),Math.sign(S),0,nt,ft),B.drawImage(h,c,w,R,D,0,0,vt,ut),B.setTransform(u,A,S,k,q,it),[vt,ut]}B.drawImage(h,c,w,R,D,j,X,V,r);const dt=Math.hypot(u,A),tt=Math.hypot(S,k);return[dt*V,tt*r]}function _(B){const{width:h,height:c}=B;if(h>v||c>v)return null;const w=1e3,R=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),D=h+1;let j=new Uint8Array(D*(c+1)),X,V,r;const u=h+7&-8;let A=new Uint8Array(u*c),S=0;for(const tt of B.data){let lt=128;for(;lt>0;)A[S++]=tt&lt?0:255,lt>>=1}let k=0;for(S=0,A[S]!==0&&(j[0]=1,++k),V=1;V<h;V++)A[S]!==A[S+1]&&(j[V]=A[S]?2:1,++k),S++;for(A[S]!==0&&(j[V]=2,++k),X=1;X<c;X++){S=X*u,r=X*D,A[S-u]!==A[S]&&(j[r]=A[S]?1:8,++k);let tt=(A[S]?4:0)+(A[S-u]?8:0);for(V=1;V<h;V++)tt=(tt>>2)+(A[S+1]?4:0)+(A[S-u+1]?8:0),R[tt]&&(j[r+V]=R[tt],++k),S++;if(A[S-u]!==A[S]&&(j[r+V]=A[S]?2:4,++k),k>w)return null}for(S=u*(c-1),r=X*D,A[S]!==0&&(j[r]=8,++k),V=1;V<h;V++)A[S]!==A[S+1]&&(j[r+V]=A[S]?4:8,++k),S++;if(A[S]!==0&&(j[r+V]=4,++k),k>w)return null;const q=new Int32Array([0,D,-1,0,-D,0,0,0,1]),it=new Path2D;for(X=0;k&&X<=c;X++){let tt=X*D;const lt=tt+h;for(;tt<lt&&!j[tt];)tt++;if(tt===lt)continue;it.moveTo(tt%D,X);const nt=tt;let ct=j[tt];do{const ft=q[ct];do tt+=ft;while(!j[tt]);const M=j[tt];M!==5&&M!==10?(ct=M,j[tt]=0):(ct=M&51*ct>>4,j[tt]&=ct>>2|ct<<2),it.lineTo(tt%D,tt/D|0),j[tt]||--k}while(nt!==tt);--X}return A=null,j=null,function(tt){tt.save(),tt.scale(1/h,-1/c),tt.translate(0,-c),tt.fill(it),tt.beginPath(),tt.restore()}}class b{constructor(h,c){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=p.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=p.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=p.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,h,c])}clone(){const h=Object.create(this);return h.clipBox=this.clipBox.slice(),h}setCurrentPoint(h,c){this.x=h,this.y=c}updatePathMinMax(h,c,w){[c,w]=p.Util.applyTransform([c,w],h),this.minX=Math.min(this.minX,c),this.minY=Math.min(this.minY,w),this.maxX=Math.max(this.maxX,c),this.maxY=Math.max(this.maxY,w)}updateRectMinMax(h,c){const w=p.Util.applyTransform(c,h),R=p.Util.applyTransform(c.slice(2),h);this.minX=Math.min(this.minX,w[0],R[0]),this.minY=Math.min(this.minY,w[1],R[1]),this.maxX=Math.max(this.maxX,w[0],R[0]),this.maxY=Math.max(this.maxY,w[1],R[1])}updateScalingPathMinMax(h,c){p.Util.scaleMinMax(h,c),this.minX=Math.min(this.minX,c[0]),this.maxX=Math.max(this.maxX,c[1]),this.minY=Math.min(this.minY,c[2]),this.maxY=Math.max(this.maxY,c[3])}updateCurvePathMinMax(h,c,w,R,D,j,X,V,r,u){const A=p.Util.bezierBoundingBox(c,w,R,D,j,X,V,r);if(u){u[0]=Math.min(u[0],A[0],A[2]),u[1]=Math.max(u[1],A[0],A[2]),u[2]=Math.min(u[2],A[1],A[3]),u[3]=Math.max(u[3],A[1],A[3]);return}this.updateRectMinMax(h,A)}getPathBoundingBox(h=I.PathType.FILL,c=null){const w=[this.minX,this.minY,this.maxX,this.maxY];if(h===I.PathType.STROKE){c||(0,p.unreachable)("Stroke bounding box must include transform.");const R=p.Util.singularValueDecompose2dScale(c),D=R[0]*this.lineWidth/2,j=R[1]*this.lineWidth/2;w[0]-=D,w[1]-=j,w[2]+=D,w[3]+=j}return w}updateClipFromPath(){const h=p.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(h||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(h){this.clipBox=h,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(h=I.PathType.FILL,c=null){return p.Util.intersect(this.clipBox,this.getPathBoundingBox(h,c))}}function o(B,h,c=null){if(typeof ImageData<"u"&&h instanceof ImageData){B.putImageData(h,0,0);return}const w=h.height,R=h.width,D=w%l,j=(w-D)/l,X=D===0?j:j+1,V=B.createImageData(R,l);let r=0,u;const A=h.data,S=V.data;let k,q,it,dt,tt,lt,nt,ct;if(c)switch(c.length){case 1:tt=c[0],lt=c[0],nt=c[0],ct=c[0];break;case 4:tt=c[0],lt=c[1],nt=c[2],ct=c[3];break}if(h.kind===p.ImageKind.GRAYSCALE_1BPP){const ft=A.byteLength,M=new Uint32Array(S.buffer,0,S.byteLength>>2),ut=M.length,At=R+7>>3;let vt=4294967295,Et=p.FeatureTest.isLittleEndian?4278190080:255;for(ct&&ct[0]===255&&ct[255]===0&&([vt,Et]=[Et,vt]),k=0;k<X;k++){for(it=k<j?l:D,u=0,q=0;q<it;q++){const Tt=ft-r;let Rt=0;const Ft=Tt>At?R:Tt*8-7,zt=Ft&-8;let Ct=0,Ot=0;for(;Rt<zt;Rt+=8)Ot=A[r++],M[u++]=Ot&128?vt:Et,M[u++]=Ot&64?vt:Et,M[u++]=Ot&32?vt:Et,M[u++]=Ot&16?vt:Et,M[u++]=Ot&8?vt:Et,M[u++]=Ot&4?vt:Et,M[u++]=Ot&2?vt:Et,M[u++]=Ot&1?vt:Et;for(;Rt<Ft;Rt++)Ct===0&&(Ot=A[r++],Ct=128),M[u++]=Ot&Ct?vt:Et,Ct>>=1}for(;u<ut;)M[u++]=0;B.putImageData(V,0,k*l)}}else if(h.kind===p.ImageKind.RGBA_32BPP){const ft=!!(tt||lt||nt);for(q=0,dt=R*l*4,k=0;k<j;k++){if(S.set(A.subarray(r,r+dt)),r+=dt,ft)for(let M=0;M<dt;M+=4)tt&&(S[M+0]=tt[S[M+0]]),lt&&(S[M+1]=lt[S[M+1]]),nt&&(S[M+2]=nt[S[M+2]]);B.putImageData(V,0,q),q+=l}if(k<X){if(dt=R*D*4,S.set(A.subarray(r,r+dt)),ft)for(let M=0;M<dt;M+=4)tt&&(S[M+0]=tt[S[M+0]]),lt&&(S[M+1]=lt[S[M+1]]),nt&&(S[M+2]=nt[S[M+2]]);B.putImageData(V,0,q)}}else if(h.kind===p.ImageKind.RGB_24BPP){const ft=!!(tt||lt||nt);for(it=l,dt=R*it,k=0;k<X;k++){for(k>=j&&(it=D,dt=R*it),u=0,q=dt;q--;)S[u++]=A[r++],S[u++]=A[r++],S[u++]=A[r++],S[u++]=255;if(ft)for(let M=0;M<u;M+=4)tt&&(S[M+0]=tt[S[M+0]]),lt&&(S[M+1]=lt[S[M+1]]),nt&&(S[M+2]=nt[S[M+2]]);B.putImageData(V,0,k*l)}}else throw new Error(`bad image kind: ${h.kind}`)}function e(B,h){if(h.bitmap){B.drawImage(h.bitmap,0,0);return}const c=h.height,w=h.width,R=c%l,D=(c-R)/l,j=R===0?D:D+1,X=B.createImageData(w,l);let V=0;const r=h.data,u=X.data;for(let A=0;A<j;A++){const S=A<D?l:R;({srcPos:V}=(0,N.applyMaskImageData)({src:r,srcPos:V,dest:u,width:w,height:S})),B.putImageData(X,0,A*l)}}function s(B,h){const c=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let w=0,R=c.length;w<R;w++){const D=c[w];B[D]!==void 0&&(h[D]=B[D])}B.setLineDash!==void 0&&(h.setLineDash(B.getLineDash()),h.lineDashOffset=B.lineDashOffset)}function d(B,h){B.strokeStyle=B.fillStyle=h||"#000000",B.fillRule="nonzero",B.globalAlpha=1,B.lineWidth=1,B.lineCap="butt",B.lineJoin="miter",B.miterLimit=10,B.globalCompositeOperation="source-over",B.font="10px sans-serif",B.setLineDash!==void 0&&(B.setLineDash([]),B.lineDashOffset=0)}function C(B,h,c,w){const R=B.length;for(let D=3;D<R;D+=4){const j=B[D];if(j===0)B[D-3]=h,B[D-2]=c,B[D-1]=w;else if(j<255){const X=255-j;B[D-3]=B[D-3]*j+h*X>>8,B[D-2]=B[D-2]*j+c*X>>8,B[D-1]=B[D-1]*j+w*X>>8}}}function y(B,h,c){const w=B.length,R=1/255;for(let D=3;D<w;D+=4){const j=c?c[B[D]]:B[D];h[D]=h[D]*j*R|0}}function f(B,h,c){const w=B.length;for(let R=3;R<w;R+=4){const D=B[R-3]*77+B[R-2]*152+B[R-1]*28;h[R]=c?h[R]*c[D>>8]>>8:h[R]*D>>16}}function T(B,h,c,w,R,D,j,X,V,r,u){const A=!!D,S=A?D[0]:0,k=A?D[1]:0,q=A?D[2]:0;let it;R==="Luminosity"?it=f:it=y;const tt=Math.min(w,Math.ceil(1048576/c));for(let lt=0;lt<w;lt+=tt){const nt=Math.min(tt,w-lt),ct=B.getImageData(X-r,lt+(V-u),c,nt),ft=h.getImageData(X,lt+V,c,nt);A&&C(ct.data,S,k,q),it(ct.data,ft.data,j),h.putImageData(ft,X,lt+V)}}function Z(B,h,c,w){const R=w[0],D=w[1],j=w[2]-R,X=w[3]-D;j===0||X===0||(T(h.context,c,j,X,h.subtype,h.backdrop,h.transferMap,R,D,h.offsetX,h.offsetY),B.save(),B.globalAlpha=1,B.globalCompositeOperation="source-over",B.setTransform(1,0,0,1,0,0),B.drawImage(c.canvas,0,0),B.restore())}function st(B,h){const c=p.Util.singularValueDecompose2dScale(B);c[0]=Math.fround(c[0]),c[1]=Math.fround(c[1]);const w=Math.fround((globalThis.devicePixelRatio||1)*g.PixelsPerInch.PDF_TO_CSS_UNITS);return h!==void 0?h:c[0]<=w||c[1]<=w}const J=["butt","round","square"],$=["miter","round","bevel"],U={},G={},_t=class _t{constructor(h,c,w,R,D,j,X,V){at(this,et);this.ctx=h,this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=c,this.objs=w,this.canvasFactory=R,this.imageLayer=D,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=j,this.cachedCanvases=new n(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=X,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=(V==null?void 0:V.background)||null,this.foregroundColor=(V==null?void 0:V.foreground)||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(h,c=null){return typeof h=="string"?h.startsWith("g_")?this.commonObjs.get(h):this.objs.get(h):c}beginDrawing({transform:h,viewport:c,transparency:w=!1,background:R=null}){const D=this.ctx.canvas.width,j=this.ctx.canvas.height,X=R||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const V=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const r=this.backgroundColor=this.ctx.fillStyle;let u=!0,A=X;if(this.ctx.fillStyle=X,A=this.ctx.fillStyle,u=typeof A=="string"&&/^#[0-9A-Fa-f]{6}$/.test(A),V==="#000000"&&r==="#ffffff"||V===r||!u)this.foregroundColor=this.backgroundColor=null;else{const[S,k,q]=(0,g.getRGB)(A),it=tt=>(tt/=255,tt<=.03928?tt/12.92:((tt+.055)/1.055)**2.4),dt=Math.round(.2126*it(S)+.7152*it(k)+.0722*it(q));this.selectColor=(tt,lt,nt)=>{const ct=.2126*it(tt)+.7152*it(lt)+.0722*it(nt);return Math.round(ct)===dt?r:V}}}if(this.ctx.fillStyle=this.backgroundColor||X,this.ctx.fillRect(0,0,D,j),this.ctx.restore(),w){const V=this.cachedCanvases.getCanvas("transparent",D,j);this.compositeCtx=this.ctx,this.transparentCanvas=V.canvas,this.ctx=V.context,this.ctx.save(),this.ctx.transform(...(0,g.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),d(this.ctx,this.foregroundColor),h&&(this.ctx.transform(...h),this.outputScaleX=h[0],this.outputScaleY=h[0]),this.ctx.transform(...c.transform),this.viewportScale=c.scale,this.baseTransform=(0,g.getCurrentTransform)(this.ctx),this.imageLayer&&((0,g.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(h,c,w,R){const D=h.argsArray,j=h.fnArray;let X=c||0;const V=D.length;if(V===X)return X;const r=V-X>x&&typeof w=="function",u=r?Date.now()+F:0;let A=0;const S=this.commonObjs,k=this.objs;let q;for(;;){if(R!==void 0&&X===R.nextBreakPoint)return R.breakIt(X,w),X;if(q=j[X],q!==p.OPS.dependency)this[q].apply(this,D[X]);else for(const it of D[X]){const dt=it.startsWith("g_")?S:k;if(!dt.has(it))return dt.get(it,w),X}if(X++,X===V)return X;if(r&&++A>x){if(Date.now()>u)return w(),X;A=0}}}endDrawing(){ht(this,et,he).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const h of this._cachedBitmapsMap.values()){for(const c of h.values())typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement&&(c.width=c.height=0);h.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(h,c){const w=h.width,R=h.height;let D=Math.max(Math.hypot(c[0],c[1]),1),j=Math.max(Math.hypot(c[2],c[3]),1),X=w,V=R,r="prescale1",u,A;for(;D>2&&X>1||j>2&&V>1;){let S=X,k=V;D>2&&X>1&&(S=Math.ceil(X/2),D/=X/S),j>2&&V>1&&(k=Math.ceil(V/2),j/=V/k),u=this.cachedCanvases.getCanvas(r,S,k),A=u.context,A.clearRect(0,0,S,k),A.drawImage(h,0,0,X,V,0,0,S,k),h=u.canvas,X=S,V=k,r=r==="prescale1"?"prescale2":"prescale1"}return{img:h,paintWidth:X,paintHeight:V}}_createMaskCanvas(h){const c=this.ctx,{width:w,height:R}=h,D=this.current.fillColor,j=this.current.patternFill,X=(0,g.getCurrentTransform)(c);let V,r,u,A;if((h.bitmap||h.data)&&h.count>1){const ut=h.bitmap||h.data.buffer,At=X.slice(0,4);r=JSON.stringify(j?At:[At,D]),V=this._cachedBitmapsMap.get(ut),V||(V=new Map,this._cachedBitmapsMap.set(ut,V));const vt=V.get(r);if(vt&&!j){const Et=Math.round(Math.min(X[0],X[2])+X[4]),Tt=Math.round(Math.min(X[1],X[3])+X[5]);return{canvas:vt,offsetX:Et,offsetY:Tt}}u=vt}u||(A=this.cachedCanvases.getCanvas("maskCanvas",w,R),e(A.context,h));let S=p.Util.transform(X,[1/w,0,0,-1/R,0,0]);S=p.Util.transform(S,[1,0,0,1,0,-R]);const k=p.Util.applyTransform([0,0],S),q=p.Util.applyTransform([w,R],S),it=p.Util.normalizeRect([k[0],k[1],q[0],q[1]]),dt=Math.round(it[2]-it[0])||1,tt=Math.round(it[3]-it[1])||1,lt=this.cachedCanvases.getCanvas("fillCanvas",dt,tt),nt=lt.context,ct=Math.min(k[0],q[0]),ft=Math.min(k[1],q[1]);nt.translate(-ct,-ft),nt.transform(...S),u||(u=this._scaleImage(A.canvas,(0,g.getCurrentTransformInverse)(nt)),u=u.img,V&&j&&V.set(r,u)),nt.imageSmoothingEnabled=st((0,g.getCurrentTransform)(nt),h.interpolate),a(nt,u,0,0,u.width,u.height,0,0,w,R),nt.globalCompositeOperation="source-in";const M=p.Util.transform((0,g.getCurrentTransformInverse)(nt),[1,0,0,1,-ct,-ft]);return nt.fillStyle=j?D.getPattern(c,this,M,I.PathType.FILL):D,nt.fillRect(0,0,w,R),V&&!j&&(this.cachedCanvases.delete("fillCanvas"),V.set(r,lt.canvas)),{canvas:lt.canvas,offsetX:Math.round(ct),offsetY:Math.round(ft)}}setLineWidth(h){h!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=h,this.ctx.lineWidth=h}setLineCap(h){this.ctx.lineCap=J[h]}setLineJoin(h){this.ctx.lineJoin=$[h]}setMiterLimit(h){this.ctx.miterLimit=h}setDash(h,c){const w=this.ctx;w.setLineDash!==void 0&&(w.setLineDash(h),w.lineDashOffset=c)}setRenderingIntent(h){}setFlatness(h){}setGState(h){for(let c=0,w=h.length;c<w;c++){const R=h[c],D=R[0],j=R[1];switch(D){case"LW":this.setLineWidth(j);break;case"LC":this.setLineCap(j);break;case"LJ":this.setLineJoin(j);break;case"ML":this.setMiterLimit(j);break;case"D":this.setDash(j[0],j[1]);break;case"RI":this.setRenderingIntent(j);break;case"FL":this.setFlatness(j);break;case"Font":this.setFont(j[0],j[1]);break;case"CA":this.current.strokeAlpha=R[1];break;case"ca":this.current.fillAlpha=R[1],this.ctx.globalAlpha=R[1];break;case"BM":this.ctx.globalCompositeOperation=j;break;case"SMask":this.current.activeSMask=j?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=j}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const h=this.inSMaskMode;this.current.activeSMask&&!h?this.beginSMaskMode():!this.current.activeSMask&&h&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const h=this.ctx.canvas.width,c=this.ctx.canvas.height,w="smaskGroupAt"+this.groupLevel,R=this.cachedCanvases.getCanvas(w,h,c);this.suspendedCtx=this.ctx,this.ctx=R.context;const D=this.ctx;D.setTransform(...(0,g.getCurrentTransform)(this.suspendedCtx)),s(this.suspendedCtx,D),t(D,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),s(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(h){if(!this.current.activeSMask)return;h?(h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.ceil(h[2]),h[3]=Math.ceil(h[3])):h=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const c=this.current.activeSMask,w=this.suspendedCtx;Z(w,c,this.ctx,h),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(s(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const h=this.current;this.stateStack.push(h),this.current=h.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),s(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(h,c,w,R,D,j){this.ctx.transform(h,c,w,R,D,j),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(h,c,w){const R=this.ctx,D=this.current;let j=D.x,X=D.y,V,r;const u=(0,g.getCurrentTransform)(R),A=u[0]===0&&u[3]===0||u[1]===0&&u[2]===0,S=A?w.slice(0):null;for(let k=0,q=0,it=h.length;k<it;k++)switch(h[k]|0){case p.OPS.rectangle:j=c[q++],X=c[q++];const dt=c[q++],tt=c[q++],lt=j+dt,nt=X+tt;R.moveTo(j,X),dt===0||tt===0?R.lineTo(lt,nt):(R.lineTo(lt,X),R.lineTo(lt,nt),R.lineTo(j,nt)),A||D.updateRectMinMax(u,[j,X,lt,nt]),R.closePath();break;case p.OPS.moveTo:j=c[q++],X=c[q++],R.moveTo(j,X),A||D.updatePathMinMax(u,j,X);break;case p.OPS.lineTo:j=c[q++],X=c[q++],R.lineTo(j,X),A||D.updatePathMinMax(u,j,X);break;case p.OPS.curveTo:V=j,r=X,j=c[q+4],X=c[q+5],R.bezierCurveTo(c[q],c[q+1],c[q+2],c[q+3],j,X),D.updateCurvePathMinMax(u,V,r,c[q],c[q+1],c[q+2],c[q+3],j,X,S),q+=6;break;case p.OPS.curveTo2:V=j,r=X,R.bezierCurveTo(j,X,c[q],c[q+1],c[q+2],c[q+3]),D.updateCurvePathMinMax(u,V,r,j,X,c[q],c[q+1],c[q+2],c[q+3],S),j=c[q+2],X=c[q+3],q+=4;break;case p.OPS.curveTo3:V=j,r=X,j=c[q+2],X=c[q+3],R.bezierCurveTo(c[q],c[q+1],j,X,j,X),D.updateCurvePathMinMax(u,V,r,c[q],c[q+1],j,X,j,X,S),q+=4;break;case p.OPS.closePath:R.closePath();break}A&&D.updateScalingPathMinMax(u,S),D.setCurrentPoint(j,X)}closePath(){this.ctx.closePath()}stroke(h){h=typeof h<"u"?h:!0;const c=this.ctx,w=this.current.strokeColor;c.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof w=="object"&&(w!=null&&w.getPattern)?(c.save(),c.strokeStyle=w.getPattern(c,this,(0,g.getCurrentTransformInverse)(c),I.PathType.STROKE),this.rescaleAndStroke(!1),c.restore()):this.rescaleAndStroke(!0)),h&&this.consumePath(this.current.getClippedPathBoundingBox()),c.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(h){h=typeof h<"u"?h:!0;const c=this.ctx,w=this.current.fillColor,R=this.current.patternFill;let D=!1;R&&(c.save(),c.fillStyle=w.getPattern(c,this,(0,g.getCurrentTransformInverse)(c),I.PathType.FILL),D=!0);const j=this.current.getClippedPathBoundingBox();this.contentVisible&&j!==null&&(this.pendingEOFill?(c.fill("evenodd"),this.pendingEOFill=!1):c.fill()),D&&c.restore(),h&&this.consumePath(j)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=U}eoClip(){this.pendingClip=G}beginText(){this.current.textMatrix=p.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const h=this.pendingTextPaths,c=this.ctx;if(h===void 0){c.beginPath();return}c.save(),c.beginPath();for(const w of h)c.setTransform(...w.transform),c.translate(w.x,w.y),w.addToPath(c,w.fontSize);c.restore(),c.clip(),c.beginPath(),delete this.pendingTextPaths}setCharSpacing(h){this.current.charSpacing=h}setWordSpacing(h){this.current.wordSpacing=h}setHScale(h){this.current.textHScale=h/100}setLeading(h){this.current.leading=-h}setFont(h,c){const w=this.commonObjs.get(h),R=this.current;if(!w)throw new Error(`Can't find font for ${h}`);if(R.fontMatrix=w.fontMatrix||p.FONT_IDENTITY_MATRIX,(R.fontMatrix[0]===0||R.fontMatrix[3]===0)&&(0,p.warn)("Invalid font matrix for font "+h),c<0?(c=-c,R.fontDirection=-1):R.fontDirection=1,this.current.font=w,this.current.fontSize=c,w.isType3Font)return;const D=w.loadedName||"sans-serif";let j="normal";w.black?j="900":w.bold&&(j="bold");const X=w.italic?"italic":"normal",V=`"${D}", ${w.fallbackName}`;let r=c;c<L?r=L:c>m&&(r=m),this.current.fontSizeScale=c/r,this.ctx.font=`${X} ${j} ${r}px ${V}`}setTextRenderingMode(h){this.current.textRenderingMode=h}setTextRise(h){this.current.textRise=h}moveText(h,c){this.current.x=this.current.lineX+=h,this.current.y=this.current.lineY+=c}setLeadingMoveText(h,c){this.setLeading(-c),this.moveText(h,c)}setTextMatrix(h,c,w,R,D,j){this.current.textMatrix=[h,c,w,R,D,j],this.current.textMatrixScale=Math.hypot(h,c),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(h,c,w,R){const D=this.ctx,j=this.current,X=j.font,V=j.textRenderingMode,r=j.fontSize/j.fontSizeScale,u=V&p.TextRenderingMode.FILL_STROKE_MASK,A=!!(V&p.TextRenderingMode.ADD_TO_PATH_FLAG),S=j.patternFill&&!X.missingFile;let k;(X.disableFontFace||A||S)&&(k=X.getPathGenerator(this.commonObjs,h)),X.disableFontFace||S?(D.save(),D.translate(c,w),D.beginPath(),k(D,r),R&&D.setTransform(...R),(u===p.TextRenderingMode.FILL||u===p.TextRenderingMode.FILL_STROKE)&&D.fill(),(u===p.TextRenderingMode.STROKE||u===p.TextRenderingMode.FILL_STROKE)&&D.stroke(),D.restore()):((u===p.TextRenderingMode.FILL||u===p.TextRenderingMode.FILL_STROKE)&&D.fillText(h,c,w),(u===p.TextRenderingMode.STROKE||u===p.TextRenderingMode.FILL_STROKE)&&D.strokeText(h,c,w)),A&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,g.getCurrentTransform)(D),x:c,y:w,fontSize:r,addToPath:k})}get isFontSubpixelAAEnabled(){const{context:h}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);h.scale(1.5,1),h.fillText("I",0,10);const c=h.getImageData(0,0,10,10).data;let w=!1;for(let R=3;R<c.length;R+=4)if(c[R]>0&&c[R]<255){w=!0;break}return(0,p.shadow)(this,"isFontSubpixelAAEnabled",w)}showText(h){const c=this.current,w=c.font;if(w.isType3Font)return this.showType3Text(h);const R=c.fontSize;if(R===0)return;const D=this.ctx,j=c.fontSizeScale,X=c.charSpacing,V=c.wordSpacing,r=c.fontDirection,u=c.textHScale*r,A=h.length,S=w.vertical,k=S?1:-1,q=w.defaultVMetrics,it=R*c.fontMatrix[0],dt=c.textRenderingMode===p.TextRenderingMode.FILL&&!w.disableFontFace&&!c.patternFill;D.save(),D.transform(...c.textMatrix),D.translate(c.x,c.y+c.textRise),r>0?D.scale(u,-1):D.scale(u,1);let tt;if(c.patternFill){D.save();const M=c.fillColor.getPattern(D,this,(0,g.getCurrentTransformInverse)(D),I.PathType.FILL);tt=(0,g.getCurrentTransform)(D),D.restore(),D.fillStyle=M}let lt=c.lineWidth;const nt=c.textMatrixScale;if(nt===0||lt===0){const M=c.textRenderingMode&p.TextRenderingMode.FILL_STROKE_MASK;(M===p.TextRenderingMode.STROKE||M===p.TextRenderingMode.FILL_STROKE)&&(lt=this.getSinglePixelWidth())}else lt/=nt;j!==1&&(D.scale(j,j),lt/=j),D.lineWidth=lt;let ct=0,ft;for(ft=0;ft<A;++ft){const M=h[ft];if(typeof M=="number"){ct+=k*M*R/1e3;continue}let ut=!1;const At=(M.isSpace?V:0)+X,vt=M.fontChar,Et=M.accent;let Tt,Rt,Ft=M.width;if(S){const Ct=M.vmetric||q,Ot=-(M.vmetric?Ct[1]:Ft*.5)*it,Zt=Ct[2]*it;Ft=Ct?-Ct[0]:Ft,Tt=Ot/j,Rt=(ct+Zt)/j}else Tt=ct/j,Rt=0;if(w.remeasure&&Ft>0){const Ct=D.measureText(vt).width*1e3/R*j;if(Ft<Ct&&this.isFontSubpixelAAEnabled){const Ot=Ft/Ct;ut=!0,D.save(),D.scale(Ot,1),Tt/=Ot}else Ft!==Ct&&(Tt+=(Ft-Ct)/2e3*R/j)}if(this.contentVisible&&(M.isInFont||w.missingFile)){if(dt&&!Et)D.fillText(vt,Tt,Rt);else if(this.paintChar(vt,Tt,Rt,tt),Et){const Ct=Tt+R*Et.offset.x/j,Ot=Rt-R*Et.offset.y/j;this.paintChar(Et.fontChar,Ct,Ot,tt)}}let zt;S?zt=Ft*it-At*r:zt=Ft*it+At*r,ct+=zt,ut&&D.restore()}S?c.y-=ct:c.x+=ct*u,D.restore(),this.compose()}showType3Text(h){const c=this.ctx,w=this.current,R=w.font,D=w.fontSize,j=w.fontDirection,X=R.vertical?1:-1,V=w.charSpacing,r=w.wordSpacing,u=w.textHScale*j,A=w.fontMatrix||p.FONT_IDENTITY_MATRIX,S=h.length,k=w.textRenderingMode===p.TextRenderingMode.INVISIBLE;let q,it,dt,tt;if(!(k||D===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,c.save(),c.transform(...w.textMatrix),c.translate(w.x,w.y),c.scale(u,j),q=0;q<S;++q){if(it=h[q],typeof it=="number"){tt=X*it*D/1e3,this.ctx.translate(tt,0),w.x+=tt*u;continue}const lt=(it.isSpace?r:0)+V,nt=R.charProcOperatorList[it.operatorListId];if(!nt){(0,p.warn)(`Type3 character "${it.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=it,this.save(),c.scale(D,D),c.transform(...A),this.executeOperatorList(nt),this.restore()),dt=p.Util.applyTransform([it.width,0],A)[0]*D+lt,c.translate(dt,0),w.x+=dt*u}c.restore(),this.processingType3=null}}setCharWidth(h,c){}setCharWidthAndBounds(h,c,w,R,D,j){this.ctx.rect(w,R,D-w,j-R),this.ctx.clip(),this.endPath()}getColorN_Pattern(h){let c;if(h[0]==="TilingPattern"){const w=h[1],R=this.baseTransform||(0,g.getCurrentTransform)(this.ctx),D={createCanvasGraphics:j=>new _t(j,this.commonObjs,this.objs,this.canvasFactory)};c=new I.TilingPattern(h,w,this.ctx,D,R)}else c=this._getPattern(h[1],h[2]);return c}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(h,c,w){var D;const R=((D=this.selectColor)==null?void 0:D.call(this,h,c,w))||p.Util.makeHexColor(h,c,w);this.ctx.strokeStyle=R,this.current.strokeColor=R}setFillRGBColor(h,c,w){var D;const R=((D=this.selectColor)==null?void 0:D.call(this,h,c,w))||p.Util.makeHexColor(h,c,w);this.ctx.fillStyle=R,this.current.fillColor=R,this.current.patternFill=!1}_getPattern(h,c=null){let w;return this.cachedPatterns.has(h)?w=this.cachedPatterns.get(h):(w=(0,I.getShadingPattern)(this.objs.get(h)),this.cachedPatterns.set(h,w)),c&&(w.matrix=c),w}shadingFill(h){if(!this.contentVisible)return;const c=this.ctx;this.save();const w=this._getPattern(h);c.fillStyle=w.getPattern(c,this,(0,g.getCurrentTransformInverse)(c),I.PathType.SHADING);const R=(0,g.getCurrentTransformInverse)(c);if(R){const D=c.canvas,j=D.width,X=D.height,V=p.Util.applyTransform([0,0],R),r=p.Util.applyTransform([0,X],R),u=p.Util.applyTransform([j,0],R),A=p.Util.applyTransform([j,X],R),S=Math.min(V[0],r[0],u[0],A[0]),k=Math.min(V[1],r[1],u[1],A[1]),q=Math.max(V[0],r[0],u[0],A[0]),it=Math.max(V[1],r[1],u[1],A[1]);this.ctx.fillRect(S,k,q-S,it-k)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,p.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,p.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(h,c){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(h)&&h.length===6&&this.transform(...h),this.baseTransform=(0,g.getCurrentTransform)(this.ctx),c)){const w=c[2]-c[0],R=c[3]-c[1];this.ctx.rect(c[0],c[1],w,R),this.current.updateRectMinMax((0,g.getCurrentTransform)(this.ctx),c),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(h){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const c=this.ctx;h.isolated||(0,p.info)("TODO: Support non-isolated groups."),h.knockout&&(0,p.warn)("Knockout groups not supported.");const w=(0,g.getCurrentTransform)(c);if(h.matrix&&c.transform(...h.matrix),!h.bbox)throw new Error("Bounding box is required.");let R=p.Util.getAxialAlignedBoundingBox(h.bbox,(0,g.getCurrentTransform)(c));const D=[0,0,c.canvas.width,c.canvas.height];R=p.Util.intersect(R,D)||[0,0,0,0];const j=Math.floor(R[0]),X=Math.floor(R[1]);let V=Math.max(Math.ceil(R[2])-j,1),r=Math.max(Math.ceil(R[3])-X,1),u=1,A=1;V>E&&(u=V/E,V=E),r>E&&(A=r/E,r=E),this.current.startNewPathAndClipBox([0,0,V,r]);let S="groupAt"+this.groupLevel;h.smask&&(S+="_smask_"+this.smaskCounter++%2);const k=this.cachedCanvases.getCanvas(S,V,r),q=k.context;q.scale(1/u,1/A),q.translate(-j,-X),q.transform(...w),h.smask?this.smaskStack.push({canvas:k.canvas,context:q,offsetX:j,offsetY:X,scaleX:u,scaleY:A,subtype:h.smask.subtype,backdrop:h.smask.backdrop,transferMap:h.smask.transferMap||null,startTransformInverse:null}):(c.setTransform(1,0,0,1,0,0),c.translate(j,X),c.scale(u,A),c.save()),s(c,q),this.ctx=q,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(c),this.groupLevel++}endGroup(h){if(!this.contentVisible)return;this.groupLevel--;const c=this.ctx,w=this.groupStack.pop();if(this.ctx=w,this.ctx.imageSmoothingEnabled=!1,h.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const R=(0,g.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...R);const D=p.Util.getAxialAlignedBoundingBox([0,0,c.canvas.width,c.canvas.height],R);this.ctx.drawImage(c.canvas,0,0),this.ctx.restore(),this.compose(D)}}beginAnnotation(h,c,w,R,D){if(ht(this,et,he).call(this),d(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(c)&&c.length===4){const j=c[2]-c[0],X=c[3]-c[1];if(D&&this.annotationCanvasMap){w=w.slice(),w[4]-=c[0],w[5]-=c[1],c=c.slice(),c[0]=c[1]=0,c[2]=j,c[3]=X;const[V,r]=p.Util.singularValueDecompose2dScale((0,g.getCurrentTransform)(this.ctx)),{viewportScale:u}=this,A=Math.ceil(j*this.outputScaleX*u),S=Math.ceil(X*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(A,S);const{canvas:k,context:q}=this.annotationCanvas;this.annotationCanvasMap.set(h,k),this.annotationCanvas.savedCtx=this.ctx,this.ctx=q,this.ctx.setTransform(V,0,0,-r,0,X*r),d(this.ctx,this.foregroundColor)}else d(this.ctx,this.foregroundColor),this.ctx.rect(c[0],c[1],j,X),this.ctx.clip(),this.endPath()}this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...w),this.transform(...R)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(h){if(!this.contentVisible)return;const c=h.count;h=this.getObject(h.data,h),h.count=c;const w=this.ctx,R=this.processingType3;if(R&&(R.compiled===void 0&&(R.compiled=_(h)),R.compiled)){R.compiled(w);return}const D=this._createMaskCanvas(h),j=D.canvas;w.save(),w.setTransform(1,0,0,1,0,0),w.drawImage(j,D.offsetX,D.offsetY),w.restore(),this.compose()}paintImageMaskXObjectRepeat(h,c,w=0,R=0,D,j){if(!this.contentVisible)return;h=this.getObject(h.data,h);const X=this.ctx;X.save();const V=(0,g.getCurrentTransform)(X);X.transform(c,w,R,D,0,0);const r=this._createMaskCanvas(h);X.setTransform(1,0,0,1,0,0);for(let u=0,A=j.length;u<A;u+=2){const S=p.Util.transform(V,[c,w,R,D,j[u],j[u+1]]),[k,q]=p.Util.applyTransform([0,0],S);X.drawImage(r.canvas,k,q)}X.restore(),this.compose()}paintImageMaskXObjectGroup(h){if(!this.contentVisible)return;const c=this.ctx,w=this.current.fillColor,R=this.current.patternFill;for(const D of h){const{data:j,width:X,height:V,transform:r}=D,u=this.cachedCanvases.getCanvas("maskCanvas",X,V),A=u.context;A.save();const S=this.getObject(j,D);e(A,S),A.globalCompositeOperation="source-in",A.fillStyle=R?w.getPattern(A,this,(0,g.getCurrentTransformInverse)(c),I.PathType.FILL):w,A.fillRect(0,0,X,V),A.restore(),c.save(),c.transform(...r),c.scale(1,-1),a(c,u.canvas,0,0,X,V,0,-1,1,1),c.restore()}this.compose()}paintImageXObject(h){if(!this.contentVisible)return;const c=this.getObject(h);if(!c){(0,p.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(c)}paintImageXObjectRepeat(h,c,w,R){if(!this.contentVisible)return;const D=this.getObject(h);if(!D){(0,p.warn)("Dependent image isn't ready yet");return}const j=D.width,X=D.height,V=[];for(let r=0,u=R.length;r<u;r+=2)V.push({transform:[c,0,0,w,R[r],R[r+1]],x:0,y:0,w:j,h:X});this.paintInlineImageXObjectGroup(D,V)}paintInlineImageXObject(h){if(!this.contentVisible)return;const c=h.width,w=h.height,R=this.ctx;this.save(),R.scale(1/c,-1/w);let D;if(typeof HTMLElement=="function"&&h instanceof HTMLElement||!h.data)D=h;else{const r=this.cachedCanvases.getCanvas("inlineImage",c,w),u=r.context;o(u,h,this.current.transferMaps),D=r.canvas}const j=this._scaleImage(D,(0,g.getCurrentTransformInverse)(R));R.imageSmoothingEnabled=st((0,g.getCurrentTransform)(R),h.interpolate);const[X,V]=a(R,j.img,0,0,j.paintWidth,j.paintHeight,0,-w,c,w);if(this.imageLayer){const[r,u]=p.Util.applyTransform([0,-w],(0,g.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:h,left:r,top:u,width:X,height:V})}this.compose(),this.restore()}paintInlineImageXObjectGroup(h,c){if(!this.contentVisible)return;const w=this.ctx,R=h.width,D=h.height,j=this.cachedCanvases.getCanvas("inlineImage",R,D),X=j.context;o(X,h,this.current.transferMaps);for(const V of c){if(w.save(),w.transform(...V.transform),w.scale(1,-1),a(w,j.canvas,V.x,V.y,V.w,V.h,0,-1,1,1),this.imageLayer){const[r,u]=p.Util.applyTransform([V.x,V.y],(0,g.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:h,left:r,top:u,width:R,height:D})}w.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(h){}markPointProps(h,c){}beginMarkedContent(h){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(h,c){h==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(c)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(h){const c=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(h);const w=this.ctx;this.pendingClip&&(c||(this.pendingClip===G?w.clip("evenodd"):w.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),w.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const h=(0,g.getCurrentTransform)(this.ctx);if(h[1]===0&&h[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(h[0]),Math.abs(h[3]));else{const c=Math.abs(h[0]*h[3]-h[2]*h[1]),w=Math.hypot(h[0],h[2]),R=Math.hypot(h[1],h[3]);this._cachedGetSinglePixelWidth=Math.max(w,R)/c}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:h}=this.current,c=(0,g.getCurrentTransform)(this.ctx);let w,R;if(c[1]===0&&c[2]===0){const D=Math.abs(c[0]),j=Math.abs(c[3]);if(h===0)w=1/D,R=1/j;else{const X=D*h,V=j*h;w=X<1?1/X:1,R=V<1?1/V:1}}else{const D=Math.abs(c[0]*c[3]-c[2]*c[1]),j=Math.hypot(c[0],c[1]),X=Math.hypot(c[2],c[3]);if(h===0)w=X/D,R=j/D;else{const V=h*D;w=X>V?X/V:1,R=j>V?j/V:1}}this._cachedScaleForStroking=[w,R]}return this._cachedScaleForStroking}rescaleAndStroke(h){const{ctx:c}=this,{lineWidth:w}=this.current,[R,D]=this.getScaleForStroking();if(c.lineWidth=w||1,R===1&&D===1){c.stroke();return}let j,X,V;h&&(j=(0,g.getCurrentTransform)(c),X=c.getLineDash().slice(),V=c.lineDashOffset),c.scale(R,D);const r=Math.max(R,D);c.setLineDash(c.getLineDash().map(u=>u/r)),c.lineDashOffset/=r,c.stroke(),h&&(c.setTransform(...j),c.setLineDash(X),c.lineDashOffset=V)}isContentVisible(){for(let h=this.markedContentStack.length-1;h>=0;h--)if(!this.markedContentStack[h].visible)return!1;return!0}};et=new WeakSet,he=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)};let z=_t;i.CanvasGraphics=z;for(const B in p.OPS)z.prototype[B]!==void 0&&(z.prototype[p.OPS[B]]=z.prototype[B])},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TilingPattern=i.PathType=void 0,i.getShadingPattern=l;var g=O(1),p=O(8),I=O(3);const N={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};i.PathType=N;function K(a,_){if(!_||I.isNodeJS)return;const b=_[2]-_[0],o=_[3]-_[1],e=new Path2D;e.rect(_[0],_[1],b,o),a.clip(e)}class L{constructor(){this.constructor===L&&(0,g.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,g.unreachable)("Abstract method `getPattern` called.")}}class m extends L{constructor(_){super(),this._type=_[1],this._bbox=_[2],this._colorStops=_[3],this._p0=_[4],this._p1=_[5],this._r0=_[6],this._r1=_[7],this.matrix=null}_createGradient(_){let b;this._type==="axial"?b=_.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(b=_.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const o of this._colorStops)b.addColorStop(o[0],o[1]);return b}getPattern(_,b,o,e){let s;if(e===N.STROKE||e===N.FILL){const d=b.current.getClippedPathBoundingBox(e,(0,p.getCurrentTransform)(_))||[0,0,0,0],C=Math.ceil(d[2]-d[0])||1,y=Math.ceil(d[3]-d[1])||1,f=b.cachedCanvases.getCanvas("pattern",C,y,!0),T=f.context;T.clearRect(0,0,T.canvas.width,T.canvas.height),T.beginPath(),T.rect(0,0,T.canvas.width,T.canvas.height),T.translate(-d[0],-d[1]),o=g.Util.transform(o,[1,0,0,1,d[0],d[1]]),T.transform(...b.baseTransform),this.matrix&&T.transform(...this.matrix),K(T,this._bbox),T.fillStyle=this._createGradient(T),T.fill(),s=_.createPattern(f.canvas,"no-repeat");const Z=new DOMMatrix(o);try{s.setTransform(Z)}catch(st){(0,g.warn)(`RadialAxialShadingPattern.getPattern: "${st==null?void 0:st.message}".`)}}else K(_,this._bbox),s=this._createGradient(_);return s}}function E(a,_,b,o,e,s,d,C){const y=_.coords,f=_.colors,T=a.data,Z=a.width*4;let st;y[b+1]>y[o+1]&&(st=b,b=o,o=st,st=s,s=d,d=st),y[o+1]>y[e+1]&&(st=o,o=e,e=st,st=d,d=C,C=st),y[b+1]>y[o+1]&&(st=b,b=o,o=st,st=s,s=d,d=st);const J=(y[b]+_.offsetX)*_.scaleX,$=(y[b+1]+_.offsetY)*_.scaleY,U=(y[o]+_.offsetX)*_.scaleX,G=(y[o+1]+_.offsetY)*_.scaleY,z=(y[e]+_.offsetX)*_.scaleX,et=(y[e+1]+_.offsetY)*_.scaleY;if($>=et)return;const ot=f[s],_t=f[s+1],B=f[s+2],h=f[d],c=f[d+1],w=f[d+2],R=f[C],D=f[C+1],j=f[C+2],X=Math.round($),V=Math.round(et);let r,u,A,S,k,q,it,dt;for(let tt=X;tt<=V;tt++){if(tt<G){let M;tt<$?M=0:M=($-tt)/($-G),r=J-(J-U)*M,u=ot-(ot-h)*M,A=_t-(_t-c)*M,S=B-(B-w)*M}else{let M;tt>et?M=1:G===et?M=0:M=(G-tt)/(G-et),r=U-(U-z)*M,u=h-(h-R)*M,A=c-(c-D)*M,S=w-(w-j)*M}let lt;tt<$?lt=0:tt>et?lt=1:lt=($-tt)/($-et),k=J-(J-z)*lt,q=ot-(ot-R)*lt,it=_t-(_t-D)*lt,dt=B-(B-j)*lt;const nt=Math.round(Math.min(r,k)),ct=Math.round(Math.max(r,k));let ft=Z*tt+nt*4;for(let M=nt;M<=ct;M++)lt=(r-M)/(r-k),lt<0?lt=0:lt>1&&(lt=1),T[ft++]=u-(u-q)*lt|0,T[ft++]=A-(A-it)*lt|0,T[ft++]=S-(S-dt)*lt|0,T[ft++]=255}}function F(a,_,b){const o=_.coords,e=_.colors;let s,d;switch(_.type){case"lattice":const C=_.verticesPerRow,y=Math.floor(o.length/C)-1,f=C-1;for(s=0;s<y;s++){let T=s*C;for(let Z=0;Z<f;Z++,T++)E(a,b,o[T],o[T+1],o[T+C],e[T],e[T+1],e[T+C]),E(a,b,o[T+C+1],o[T+1],o[T+C],e[T+C+1],e[T+1],e[T+C])}break;case"triangles":for(s=0,d=o.length;s<d;s+=3)E(a,b,o[s],o[s+1],o[s+2],e[s],e[s+1],e[s+2]);break;default:throw new Error("illegal figure")}}class x extends L{constructor(_){super(),this._coords=_[2],this._colors=_[3],this._figures=_[4],this._bounds=_[5],this._bbox=_[7],this._background=_[8],this.matrix=null}_createMeshCanvas(_,b,o){const C=Math.floor(this._bounds[0]),y=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-C,T=Math.ceil(this._bounds[3])-y,Z=Math.min(Math.ceil(Math.abs(f*_[0]*1.1)),3e3),st=Math.min(Math.ceil(Math.abs(T*_[1]*1.1)),3e3),J=f/Z,$=T/st,U={coords:this._coords,colors:this._colors,offsetX:-C,offsetY:-y,scaleX:1/J,scaleY:1/$},G=Z+2*2,z=st+2*2,et=o.getCanvas("mesh",G,z,!1),ot=et.context,_t=ot.createImageData(Z,st);if(b){const h=_t.data;for(let c=0,w=h.length;c<w;c+=4)h[c]=b[0],h[c+1]=b[1],h[c+2]=b[2],h[c+3]=255}for(const h of this._figures)F(_t,h,U);return ot.putImageData(_t,2,2),{canvas:et.canvas,offsetX:C-2*J,offsetY:y-2*$,scaleX:J,scaleY:$}}getPattern(_,b,o,e){K(_,this._bbox);let s;if(e===N.SHADING)s=g.Util.singularValueDecompose2dScale((0,p.getCurrentTransform)(_));else if(s=g.Util.singularValueDecompose2dScale(b.baseTransform),this.matrix){const C=g.Util.singularValueDecompose2dScale(this.matrix);s=[s[0]*C[0],s[1]*C[1]]}const d=this._createMeshCanvas(s,e===N.SHADING?null:this._background,b.cachedCanvases);return e!==N.SHADING&&(_.setTransform(...b.baseTransform),this.matrix&&_.transform(...this.matrix)),_.translate(d.offsetX,d.offsetY),_.scale(d.scaleX,d.scaleY),_.createPattern(d.canvas,"no-repeat")}}class v extends L{getPattern(){return"hotpink"}}function l(a){switch(a[0]){case"RadialAxial":return new m(a);case"Mesh":return new x(a);case"Dummy":return new v}throw new Error(`Unknown IR type: ${a[0]}`)}const t={COLORED:1,UNCOLORED:2};class n{static get MAX_PATTERN_SIZE(){return(0,g.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(_,b,o,e,s){this.operatorList=_[2],this.matrix=_[3]||[1,0,0,1,0,0],this.bbox=_[4],this.xstep=_[5],this.ystep=_[6],this.paintType=_[7],this.tilingType=_[8],this.color=b,this.ctx=o,this.canvasGraphicsFactory=e,this.baseTransform=s}createPatternCanvas(_){const b=this.operatorList,o=this.bbox,e=this.xstep,s=this.ystep,d=this.paintType,C=this.tilingType,y=this.color,f=this.canvasGraphicsFactory;(0,g.info)("TilingType: "+C);const T=o[0],Z=o[1],st=o[2],J=o[3],$=g.Util.singularValueDecompose2dScale(this.matrix),U=g.Util.singularValueDecompose2dScale(this.baseTransform),G=[$[0]*U[0],$[1]*U[1]],z=this.getSizeAndScale(e,this.ctx.canvas.width,G[0]),et=this.getSizeAndScale(s,this.ctx.canvas.height,G[1]),ot=_.cachedCanvases.getCanvas("pattern",z.size,et.size,!0),_t=ot.context,B=f.createCanvasGraphics(_t);B.groupLevel=_.groupLevel,this.setFillAndStrokeStyleToContext(B,d,y);let h=T,c=Z,w=st,R=J;return T<0&&(h=0,w+=Math.abs(T)),Z<0&&(c=0,R+=Math.abs(Z)),_t.translate(-(z.scale*h),-(et.scale*c)),B.transform(z.scale,0,0,et.scale,0,0),_t.save(),this.clipBbox(B,h,c,w,R),B.baseTransform=(0,p.getCurrentTransform)(B.ctx),B.executeOperatorList(b),B.endDrawing(),{canvas:ot.canvas,scaleX:z.scale,scaleY:et.scale,offsetX:h,offsetY:c}}getSizeAndScale(_,b,o){_=Math.abs(_);const e=Math.max(n.MAX_PATTERN_SIZE,b);let s=Math.ceil(_*o);return s>=e?s=e:o=s/_,{scale:o,size:s}}clipBbox(_,b,o,e,s){const d=e-b,C=s-o;_.ctx.rect(b,o,d,C),_.current.updateRectMinMax((0,p.getCurrentTransform)(_.ctx),[b,o,e,s]),_.clip(),_.endPath()}setFillAndStrokeStyleToContext(_,b,o){const e=_.ctx,s=_.current;switch(b){case t.COLORED:const d=this.ctx;e.fillStyle=d.fillStyle,e.strokeStyle=d.strokeStyle,s.fillColor=d.fillStyle,s.strokeColor=d.strokeStyle;break;case t.UNCOLORED:const C=g.Util.makeHexColor(o[0],o[1],o[2]);e.fillStyle=C,e.strokeStyle=C,s.fillColor=C,s.strokeColor=C;break;default:throw new g.FormatError(`Unsupported paint type: ${b}`)}}getPattern(_,b,o,e){let s=o;e!==N.SHADING&&(s=g.Util.transform(s,b.baseTransform),this.matrix&&(s=g.Util.transform(s,this.matrix)));const d=this.createPatternCanvas(b);let C=new DOMMatrix(s);C=C.translate(d.offsetX,d.offsetY),C=C.scale(1/d.scaleX,1/d.scaleY);const y=_.createPattern(d.canvas,"repeat");try{y.setTransform(C)}catch(f){(0,g.warn)(`TilingPattern.getPattern: "${f==null?void 0:f.message}".`)}return y}}i.TilingPattern=n},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.applyMaskImageData=p;var g=O(1);function p({src:I,srcPos:N=0,dest:K,destPos:L=0,width:m,height:E,inverseDecode:F=!1}){const x=g.FeatureTest.isLittleEndian?4278190080:255,[v,l]=F?[0,x]:[x,0],t=m>>3,n=m&7,a=I.length;K=new Uint32Array(K.buffer);for(let _=0;_<E;_++){for(const o=N+t;N<o;N++){const e=N<a?I[N]:255;K[L++]=e&128?l:v,K[L++]=e&64?l:v,K[L++]=e&32?l:v,K[L++]=e&16?l:v,K[L++]=e&8?l:v,K[L++]=e&4?l:v,K[L++]=e&2?l:v,K[L++]=e&1?l:v}if(n===0)continue;const b=N<a?I[N++]:255;for(let o=0;o<n;o++)K[L++]=b&1<<7-o?l:v}return{srcPos:N,destPos:L}}},(Y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlobalWorkerOptions=void 0;const O=Object.create(null);i.GlobalWorkerOptions=O,O.workerPort=O.workerPort===void 0?null:O.workerPort,O.workerSrc=O.workerSrc===void 0?"":O.workerSrc},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MessageHandler=void 0;var g=O(1);const p={UNKNOWN:0,DATA:1,ERROR:2},I={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function N(L){switch(L instanceof Error||typeof L=="object"&&L!==null||(0,g.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),L.name){case"AbortException":return new g.AbortException(L.message);case"MissingPDFException":return new g.MissingPDFException(L.message);case"PasswordException":return new g.PasswordException(L.message,L.code);case"UnexpectedResponseException":return new g.UnexpectedResponseException(L.message,L.status);case"UnknownErrorException":return new g.UnknownErrorException(L.message,L.details);default:return new g.UnknownErrorException(L.message,L.toString())}}class K{constructor(m,E,F){this.sourceName=m,this.targetName=E,this.comObj=F,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=x=>{const v=x.data;if(v.targetName!==this.sourceName)return;if(v.stream){this._processStreamMessage(v);return}if(v.callback){const t=v.callbackId,n=this.callbackCapabilities[t];if(!n)throw new Error(`Cannot resolve callback ${t}`);if(delete this.callbackCapabilities[t],v.callback===p.DATA)n.resolve(v.data);else if(v.callback===p.ERROR)n.reject(N(v.reason));else throw new Error("Unexpected callback case");return}const l=this.actionHandler[v.action];if(!l)throw new Error(`Unknown action from worker: ${v.action}`);if(v.callbackId){const t=this.sourceName,n=v.sourceName;new Promise(function(a){a(l(v.data))}).then(function(a){F.postMessage({sourceName:t,targetName:n,callback:p.DATA,callbackId:v.callbackId,data:a})},function(a){F.postMessage({sourceName:t,targetName:n,callback:p.ERROR,callbackId:v.callbackId,reason:N(a)})});return}if(v.streamId){this._createStreamSink(v);return}l(v.data)},F.addEventListener("message",this._onComObjOnMessage)}on(m,E){const F=this.actionHandler;if(F[m])throw new Error(`There is already an actionName called "${m}"`);F[m]=E}send(m,E,F){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:m,data:E},F)}sendWithPromise(m,E,F){const x=this.callbackId++,v=(0,g.createPromiseCapability)();this.callbackCapabilities[x]=v;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:m,callbackId:x,data:E},F)}catch(l){v.reject(l)}return v.promise}sendWithStream(m,E,F,x){const v=this.streamId++,l=this.sourceName,t=this.targetName,n=this.comObj;return new ReadableStream({start:a=>{const _=(0,g.createPromiseCapability)();return this.streamControllers[v]={controller:a,startCall:_,pullCall:null,cancelCall:null,isClosed:!1},n.postMessage({sourceName:l,targetName:t,action:m,streamId:v,data:E,desiredSize:a.desiredSize},x),_.promise},pull:a=>{const _=(0,g.createPromiseCapability)();return this.streamControllers[v].pullCall=_,n.postMessage({sourceName:l,targetName:t,stream:I.PULL,streamId:v,desiredSize:a.desiredSize}),_.promise},cancel:a=>{(0,g.assert)(a instanceof Error,"cancel must have a valid reason");const _=(0,g.createPromiseCapability)();return this.streamControllers[v].cancelCall=_,this.streamControllers[v].isClosed=!0,n.postMessage({sourceName:l,targetName:t,stream:I.CANCEL,streamId:v,reason:N(a)}),_.promise}},F)}_createStreamSink(m){const E=m.streamId,F=this.sourceName,x=m.sourceName,v=this.comObj,l=this,t=this.actionHandler[m.action],n={enqueue(a,_=1,b){if(this.isCancelled)return;const o=this.desiredSize;this.desiredSize-=_,o>0&&this.desiredSize<=0&&(this.sinkCapability=(0,g.createPromiseCapability)(),this.ready=this.sinkCapability.promise),v.postMessage({sourceName:F,targetName:x,stream:I.ENQUEUE,streamId:E,chunk:a},b)},close(){this.isCancelled||(this.isCancelled=!0,v.postMessage({sourceName:F,targetName:x,stream:I.CLOSE,streamId:E}),delete l.streamSinks[E])},error(a){(0,g.assert)(a instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,v.postMessage({sourceName:F,targetName:x,stream:I.ERROR,streamId:E,reason:N(a)}))},sinkCapability:(0,g.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:m.desiredSize,ready:null};n.sinkCapability.resolve(),n.ready=n.sinkCapability.promise,this.streamSinks[E]=n,new Promise(function(a){a(t(m.data,n))}).then(function(){v.postMessage({sourceName:F,targetName:x,stream:I.START_COMPLETE,streamId:E,success:!0})},function(a){v.postMessage({sourceName:F,targetName:x,stream:I.START_COMPLETE,streamId:E,reason:N(a)})})}_processStreamMessage(m){const E=m.streamId,F=this.sourceName,x=m.sourceName,v=this.comObj,l=this.streamControllers[E],t=this.streamSinks[E];switch(m.stream){case I.START_COMPLETE:m.success?l.startCall.resolve():l.startCall.reject(N(m.reason));break;case I.PULL_COMPLETE:m.success?l.pullCall.resolve():l.pullCall.reject(N(m.reason));break;case I.PULL:if(!t){v.postMessage({sourceName:F,targetName:x,stream:I.PULL_COMPLETE,streamId:E,success:!0});break}t.desiredSize<=0&&m.desiredSize>0&&t.sinkCapability.resolve(),t.desiredSize=m.desiredSize,new Promise(function(n){n(t.onPull&&t.onPull())}).then(function(){v.postMessage({sourceName:F,targetName:x,stream:I.PULL_COMPLETE,streamId:E,success:!0})},function(n){v.postMessage({sourceName:F,targetName:x,stream:I.PULL_COMPLETE,streamId:E,reason:N(n)})});break;case I.ENQUEUE:if((0,g.assert)(l,"enqueue should have stream controller"),l.isClosed)break;l.controller.enqueue(m.chunk);break;case I.CLOSE:if((0,g.assert)(l,"close should have stream controller"),l.isClosed)break;l.isClosed=!0,l.controller.close(),this._deleteStreamController(l,E);break;case I.ERROR:(0,g.assert)(l,"error should have stream controller"),l.controller.error(N(m.reason)),this._deleteStreamController(l,E);break;case I.CANCEL_COMPLETE:m.success?l.cancelCall.resolve():l.cancelCall.reject(N(m.reason)),this._deleteStreamController(l,E);break;case I.CANCEL:if(!t)break;new Promise(function(n){n(t.onCancel&&t.onCancel(N(m.reason)))}).then(function(){v.postMessage({sourceName:F,targetName:x,stream:I.CANCEL_COMPLETE,streamId:E,success:!0})},function(n){v.postMessage({sourceName:F,targetName:x,stream:I.CANCEL_COMPLETE,streamId:E,reason:N(n)})}),t.sinkCapability.reject(N(m.reason)),t.isCancelled=!0,delete this.streamSinks[E];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(m,E){await Promise.allSettled([m.startCall&&m.startCall.promise,m.pullCall&&m.pullCall.promise,m.cancelCall&&m.cancelCall.promise]),delete this.streamControllers[E]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}i.MessageHandler=K},(Y,i,O)=>{var I,N;Object.defineProperty(i,"__esModule",{value:!0}),i.Metadata=void 0;var g=O(1);class p{constructor({parsedData:L,rawData:m}){at(this,I,void 0);at(this,N,void 0);mt(this,I,L),mt(this,N,m)}getRaw(){return P(this,N)}get(L){return P(this,I).get(L)??null}getAll(){return(0,g.objectFromMap)(P(this,I))}has(L){return P(this,I).has(L)}}I=new WeakMap,N=new WeakMap,i.Metadata=p},(Y,i,O)=>{var K,L,m,E,F,x,de;Object.defineProperty(i,"__esModule",{value:!0}),i.OptionalContentConfig=void 0;var g=O(1);const p=Symbol("INTERNAL");class I{constructor(t,n){at(this,K,!0);this.name=t,this.intent=n}get visible(){return P(this,K)}_setVisible(t,n){t!==p&&(0,g.unreachable)("Internal method `_setVisible` called."),mt(this,K,n)}}K=new WeakMap;class N{constructor(t){at(this,x);at(this,L,!0);at(this,m,new Map);at(this,E,null);at(this,F,null);if(this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,mt(this,F,t.order);for(const n of t.groups)P(this,m).set(n.id,new I(n.name,n.intent));if(t.baseState==="OFF")for(const n of P(this,m).values())n._setVisible(p,!1);for(const n of t.on)P(this,m).get(n)._setVisible(p,!0);for(const n of t.off)P(this,m).get(n)._setVisible(p,!1);mt(this,E,new Map);for(const[n,a]of P(this,m))P(this,E).set(n,a.visible)}}isVisible(t){if(P(this,m).size===0)return!0;if(!t)return(0,g.warn)("Optional content group not defined."),!0;if(t.type==="OCG")return P(this,m).has(t.id)?P(this,m).get(t.id).visible:((0,g.warn)(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return ht(this,x,de).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const n of t.ids){if(!P(this,m).has(n))return(0,g.warn)(`Optional content group not found: ${n}`),!0;if(P(this,m).get(n).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const n of t.ids){if(!P(this,m).has(n))return(0,g.warn)(`Optional content group not found: ${n}`),!0;if(!P(this,m).get(n).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const n of t.ids){if(!P(this,m).has(n))return(0,g.warn)(`Optional content group not found: ${n}`),!0;if(!P(this,m).get(n).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const n of t.ids){if(!P(this,m).has(n))return(0,g.warn)(`Optional content group not found: ${n}`),!0;if(P(this,m).get(n).visible)return!1}return!0}return(0,g.warn)(`Unknown optional content policy ${t.policy}.`),!0}return(0,g.warn)(`Unknown group type ${t.type}.`),!0}setVisibility(t,n=!0){if(!P(this,m).has(t)){(0,g.warn)(`Optional content group not found: ${t}`);return}P(this,m).get(t)._setVisible(p,!!n),mt(this,L,null)}get hasInitialVisibility(){if(P(this,L)!==null)return P(this,L);for(const[t,n]of P(this,m)){const a=P(this,E).get(t);if(n.visible!==a)return mt(this,L,!1)}return mt(this,L,!0)}getOrder(){return P(this,m).size?P(this,F)?P(this,F).slice():[...P(this,m).keys()]:null}getGroups(){return P(this,m).size>0?(0,g.objectFromMap)(P(this,m)):null}getGroup(t){return P(this,m).get(t)||null}}L=new WeakMap,m=new WeakMap,E=new WeakMap,F=new WeakMap,x=new WeakSet,de=function(t){const n=t.length;if(n<2)return!0;const a=t[0];for(let _=1;_<n;_++){const b=t[_];let o;if(Array.isArray(b))o=ht(this,x,de).call(this,b);else if(P(this,m).has(b))o=P(this,m).get(b).visible;else return(0,g.warn)(`Optional content group not found: ${b}`),!0;switch(a){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return a==="And"},i.OptionalContentConfig=N},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFDataTransportStream=void 0;var g=O(1),p=O(8);class I{constructor(m,E){(0,g.assert)(E,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=m.progressiveDone||!1,this._contentDispositionFilename=m.contentDispositionFilename||null;const F=m.initialData;if((F==null?void 0:F.length)>0){const x=new Uint8Array(F).buffer;this._queuedChunks.push(x)}this._pdfDataRangeTransport=E,this._isStreamingSupported=!m.disableStream,this._isRangeSupported=!m.disableRange,this._contentLength=m.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((x,v)=>{this._onReceiveData({begin:x,chunk:v})}),this._pdfDataRangeTransport.addProgressListener((x,v)=>{this._onProgress({loaded:x,total:v})}),this._pdfDataRangeTransport.addProgressiveReadListener(x=>{this._onReceiveData({chunk:x})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(m){const E=new Uint8Array(m.chunk).buffer;if(m.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(E):this._queuedChunks.push(E);else{const F=this._rangeReaders.some(function(x){return x._begin!==m.begin?!1:(x._enqueue(E),!0)});(0,g.assert)(F,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var m;return((m=this._fullRequestReader)==null?void 0:m._loaded)??0}_onProgress(m){if(m.total===void 0){const E=this._rangeReaders[0];E!=null&&E.onProgress&&E.onProgress({loaded:m.loaded})}else{const E=this._fullRequestReader;E!=null&&E.onProgress&&E.onProgress({loaded:m.loaded,total:m.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(m){const E=this._rangeReaders.indexOf(m);E>=0&&this._rangeReaders.splice(E,1)}getFullReader(){(0,g.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const m=this._queuedChunks;return this._queuedChunks=null,new N(this,m,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(m,E){if(E<=this._progressiveDataLength)return null;const F=new K(this,m,E);return this._pdfDataRangeTransport.requestDataRange(m,E),this._rangeReaders.push(F),F}cancelAllRequests(m){this._fullRequestReader&&this._fullRequestReader.cancel(m);for(const E of this._rangeReaders.slice(0))E.cancel(m);this._pdfDataRangeTransport.abort()}}i.PDFDataTransportStream=I;class N{constructor(m,E,F=!1,x=null){this._stream=m,this._done=F||!1,this._filename=(0,p.isPdfFile)(x)?x:null,this._queuedChunks=E||[],this._loaded=0;for(const v of this._queuedChunks)this._loaded+=v.byteLength;this._requests=[],this._headersReady=Promise.resolve(),m._fullRequestReader=this,this.onProgress=null}_enqueue(m){this._done||(this._requests.length>0?this._requests.shift().resolve({value:m,done:!1}):this._queuedChunks.push(m),this._loaded+=m.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const m=(0,g.createPromiseCapability)();return this._requests.push(m),m.promise}cancel(m){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class K{constructor(m,E,F){this._stream=m,this._begin=E,this._end=F,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(m){if(!this._done){if(this._requests.length===0)this._queuedChunk=m;else{this._requests.shift().resolve({value:m,done:!1});for(const F of this._requests)F.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const E=this._queuedChunk;return this._queuedChunk=null,{value:E,done:!1}}if(this._done)return{value:void 0,done:!0};const m=(0,g.createPromiseCapability)();return this._requests.push(m),m.promise}cancel(m){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(Y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaText=void 0;class O{static textContent(p){const I=[],N={items:I,styles:Object.create(null)};function K(L){var F;if(!L)return;let m=null;const E=L.name;if(E==="#text")m=L.value;else if(O.shouldBuildText(E))(F=L==null?void 0:L.attributes)!=null&&F.textContent?m=L.attributes.textContent:L.value&&(m=L.value);else return;if(m!==null&&I.push({str:m}),!!L.children)for(const x of L.children)K(x)}return K(p),N}static shouldBuildText(p){return!(p==="textarea"||p==="input"||p==="option"||p==="select")}}i.XfaText=O},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NodeStandardFontDataFactory=i.NodeCanvasFactory=i.NodeCMapReaderFactory=void 0;var g=O(9);const p=function(L){return new Promise((m,E)=>{require$$5.readFile(L,(x,v)=>{if(x||!v){E(new Error(x));return}m(new Uint8Array(v))})})};class I extends g.BaseCanvasFactory{_createCanvas(m,E){return require$$5.createCanvas(m,E)}}i.NodeCanvasFactory=I;class N extends g.BaseCMapReaderFactory{_fetchData(m,E){return p(m).then(F=>({cMapData:F,compressionType:E}))}}i.NodeCMapReaderFactory=N;class K extends g.BaseStandardFontDataFactory{_fetchData(m){return p(m)}}i.NodeStandardFontDataFactory=K},(Y,i,O)=>{var L,m,E,F,x,v,l,t,n,ue,_,ke,o,fe,s,Fe;Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditorLayer=void 0;var g=O(7),p=O(1),I=O(23),N=O(24);const C=class C{constructor(f){at(this,n);at(this,_);at(this,o);at(this,s);at(this,L,void 0);at(this,m,!1);at(this,E,this.pointerup.bind(this));at(this,F,this.pointerdown.bind(this));at(this,x,new Map);at(this,v,!1);at(this,l,!1);at(this,t,void 0);C._initialized||(C._initialized=!0,I.FreeTextEditor.initialize(f.l10n),N.InkEditor.initialize(f.l10n),f.uiManager.registerEditorTypes([I.FreeTextEditor,N.InkEditor])),mt(this,t,f.uiManager),this.annotationStorage=f.annotationStorage,this.pageIndex=f.pageIndex,this.div=f.div,mt(this,L,f.accessibilityManager),P(this,t).addLayer(this)}updateToolbar(f){P(this,t).updateToolbar(f)}updateMode(f=P(this,t).getMode()){ht(this,s,Fe).call(this),f===p.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),P(this,t).unselectAll()}addInkEditorIfNeeded(f){if(!f&&P(this,t).getMode()!==p.AnnotationEditorType.INK)return;if(!f){for(const Z of P(this,x).values())if(Z.isEmpty()){Z.setInBackground();return}}ht(this,o,fe).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(f){P(this,t).setEditingState(f)}addCommands(f){P(this,t).addCommands(f)}enable(){this.div.style.pointerEvents="auto";for(const f of P(this,x).values())f.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const f of P(this,x).values())f.disableEditing()}setActiveEditor(f){P(this,t).getActive()!==f&&P(this,t).setActiveEditor(f)}enableClick(){this.div.addEventListener("pointerdown",P(this,F)),this.div.addEventListener("pointerup",P(this,E))}disableClick(){this.div.removeEventListener("pointerdown",P(this,F)),this.div.removeEventListener("pointerup",P(this,E))}attach(f){P(this,x).set(f.id,f)}detach(f){var T;P(this,x).delete(f.id),(T=P(this,L))==null||T.removePointerInTextLayer(f.contentDiv)}remove(f){P(this,t).removeEditor(f),this.detach(f),this.annotationStorage.remove(f.id),f.div.style.display="none",setTimeout(()=>{f.div.style.display="",f.div.remove(),f.isAttachedToDOM=!1,document.activeElement===document.body&&P(this,t).focusMainContainer()},0),P(this,l)||this.addInkEditorIfNeeded(!1)}add(f){if(ht(this,n,ue).call(this,f),P(this,t).addEditor(f),this.attach(f),!f.isAttachedToDOM){const T=f.render();this.div.append(T),f.isAttachedToDOM=!0}this.moveEditorInDOM(f),f.onceAdded(),this.addToAnnotationStorage(f)}moveEditorInDOM(f){var T;(T=P(this,L))==null||T.moveElementInDOM(this.div,f.div,f.contentDiv,!0)}addToAnnotationStorage(f){!f.isEmpty()&&!this.annotationStorage.has(f.id)&&this.annotationStorage.setValue(f.id,f)}addOrRebuild(f){f.needsToBeRebuilt()?f.rebuild():this.add(f)}addANewEditor(f){const T=()=>{this.addOrRebuild(f)},Z=()=>{f.remove()};this.addCommands({cmd:T,undo:Z,mustExec:!0})}addUndoableEditor(f){const T=()=>{this.addOrRebuild(f)},Z=()=>{f.remove()};this.addCommands({cmd:T,undo:Z,mustExec:!1})}getNextId(){return P(this,t).getId()}deserialize(f){switch(f.annotationType){case p.AnnotationEditorType.FREETEXT:return I.FreeTextEditor.deserialize(f,this);case p.AnnotationEditorType.INK:return N.InkEditor.deserialize(f,this)}return null}setSelected(f){P(this,t).setSelected(f)}toggleSelected(f){P(this,t).toggleSelected(f)}isSelected(f){return P(this,t).isSelected(f)}unselect(f){P(this,t).unselect(f)}pointerup(f){const T=g.KeyboardManager.platform.isMac;if(!(f.button!==0||f.ctrlKey&&T)&&f.target===this.div&&P(this,v)){if(mt(this,v,!1),!P(this,m)){mt(this,m,!0);return}ht(this,o,fe).call(this,f)}}pointerdown(f){const T=g.KeyboardManager.platform.isMac;if(f.button!==0||f.ctrlKey&&T||f.target!==this.div)return;mt(this,v,!0);const Z=P(this,t).getActive();mt(this,m,!Z||Z.isEmpty())}drop(f){const T=f.dataTransfer.getData("text/plain"),Z=P(this,t).getEditor(T);if(!Z)return;f.preventDefault(),f.dataTransfer.dropEffect="move",ht(this,n,ue).call(this,Z);const st=this.div.getBoundingClientRect(),J=f.clientX-st.x,$=f.clientY-st.y;Z.translate(J-Z.startX,$-Z.startY),this.moveEditorInDOM(Z),Z.div.focus()}dragover(f){f.preventDefault()}destroy(){var f,T;((f=P(this,t).getActive())==null?void 0:f.parent)===this&&P(this,t).setActiveEditor(null);for(const Z of P(this,x).values())(T=P(this,L))==null||T.removePointerInTextLayer(Z.contentDiv),Z.isAttachedToDOM=!1,Z.div.remove(),Z.parent=null;this.div=null,P(this,x).clear(),P(this,t).removeLayer(this)}render(f){this.viewport=f.viewport,(0,g.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(const T of P(this,t).getEditors(this.pageIndex))this.add(T);this.updateMode()}update(f){this.viewport=f.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){const[f,T,Z,st]=this.viewport.viewBox,J=Z-f,$=st-T;return[J,$]}get viewportBaseDimensions(){const{width:f,height:T,rotation:Z}=this.viewport;return Z%180===0?[f,T]:[T,f]}setDimensions(){const{width:f,height:T,rotation:Z}=this.viewport,st=Z%180!==0,J=Math.floor(f)+"px",$=Math.floor(T)+"px";this.div.style.width=st?$:J,this.div.style.height=st?J:$,this.div.setAttribute("data-main-rotation",Z)}};L=new WeakMap,m=new WeakMap,E=new WeakMap,F=new WeakMap,x=new WeakMap,v=new WeakMap,l=new WeakMap,t=new WeakMap,n=new WeakSet,ue=function(f){var T;f.parent!==this&&(this.attach(f),f.pageIndex=this.pageIndex,(T=f.parent)==null||T.detach(f),f.parent=this,f.div&&f.isAttachedToDOM&&(f.div.remove(),this.div.append(f.div)))},_=new WeakSet,ke=function(f){switch(P(this,t).getMode()){case p.AnnotationEditorType.FREETEXT:return new I.FreeTextEditor(f);case p.AnnotationEditorType.INK:return new N.InkEditor(f)}return null},o=new WeakSet,fe=function(f){const T=this.getNextId(),Z=ht(this,_,ke).call(this,{parent:this,id:T,x:f.offsetX,y:f.offsetY});return Z&&this.add(Z),Z},s=new WeakSet,Fe=function(){mt(this,l,!0);for(const f of P(this,x).values())f.isEmpty()&&f.remove();mt(this,l,!1)},Mt(C,"_initialized",!1);let K=C;i.AnnotationEditorLayer=K},(Y,i,O)=>{var K,L,m,E,F,x,v,l,Re,n,Me,_,Oe,o,pe;Object.defineProperty(i,"__esModule",{value:!0}),i.FreeTextEditor=void 0;var g=O(1),p=O(7),I=O(6);const s=class s extends I.AnnotationEditor{constructor(y){super({...y,name:"freeTextEditor"});at(this,l);at(this,n);at(this,_);at(this,o);at(this,K,this.editorDivBlur.bind(this));at(this,L,this.editorDivFocus.bind(this));at(this,m,this.editorDivKeydown.bind(this));at(this,E,void 0);at(this,F,"");at(this,x,!1);at(this,v,void 0);mt(this,E,y.color||s._defaultColor||I.AnnotationEditor._defaultLineColor),mt(this,v,y.fontSize||s._defaultFontSize)}static initialize(y){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(T=>[T,y.get(T)]));const f=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(f.getPropertyValue("--freetext-padding"))}static updateDefaultParams(y,f){switch(y){case g.AnnotationEditorParamsType.FREETEXT_SIZE:s._defaultFontSize=f;break;case g.AnnotationEditorParamsType.FREETEXT_COLOR:s._defaultColor=f;break}}updateParams(y,f){switch(y){case g.AnnotationEditorParamsType.FREETEXT_SIZE:ht(this,l,Re).call(this,f);break;case g.AnnotationEditorParamsType.FREETEXT_COLOR:ht(this,n,Me).call(this,f);break}}static get defaultPropertiesToUpdate(){return[[g.AnnotationEditorParamsType.FREETEXT_SIZE,s._defaultFontSize],[g.AnnotationEditorParamsType.FREETEXT_COLOR,s._defaultColor||I.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[g.AnnotationEditorParamsType.FREETEXT_SIZE,P(this,v)],[g.AnnotationEditorParamsType.FREETEXT_COLOR,P(this,E)]]}getInitialTranslation(){return[-s._internalPadding*this.parent.scaleFactor,-(s._internalPadding+P(this,v))*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(g.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",P(this,m)),this.editorDiv.addEventListener("focus",P(this,L)),this.editorDiv.addEventListener("blur",P(this,K)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",P(this,m)),this.editorDiv.removeEventListener("focus",P(this,L)),this.editorDiv.removeEventListener("blur",P(this,K)),this.div.focus(),this.isEditing=!1)}focusin(y){super.focusin(y),y.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}commit(){super.commit(),P(this,x)||(mt(this,x,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),mt(this,F,ht(this,_,Oe).call(this).trimEnd()),ht(this,o,pe).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(y){this.enableEditMode(),this.editorDiv.focus()}keydown(y){y.target===this.div&&y.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(y){s._keyboardManager.exec(this,y)}editorDivFocus(y){this.isEditing=!0}editorDivBlur(y){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let y,f;this.width&&(y=this.x,f=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),s._l10nPromise.get("editor_free_text_aria_label").then(Z=>{var st;return(st=this.editorDiv)==null?void 0:st.setAttribute("aria-label",Z)}),s._l10nPromise.get("free_text_default_content").then(Z=>{var st;return(st=this.editorDiv)==null?void 0:st.setAttribute("default-content",Z)}),this.editorDiv.contentEditable=!0;const{style:T}=this.editorDiv;if(T.fontSize=`calc(${P(this,v)}px * var(--scale-factor))`,T.color=P(this,E),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,p.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Z,st]=this.parent.viewportBaseDimensions;this.setAt(y*Z,f*st,this.width*Z,this.height*st);for(const J of P(this,F).split(`
`)){const $=document.createElement("div");$.append(J?document.createTextNode(J):document.createElement("br")),this.editorDiv.append($)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(y,f){const T=super.deserialize(y,f);return mt(T,v,y.fontSize),mt(T,E,g.Util.makeHexColor(...y.color)),mt(T,F,y.value),T}serialize(){if(this.isEmpty())return null;const y=s._internalPadding*this.parent.scaleFactor,f=this.getRect(y,y),T=I.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:g.AnnotationEditorType.FREETEXT,color:T,fontSize:P(this,v),value:P(this,F),pageIndex:this.parent.pageIndex,rect:f,rotation:this.rotation}}};K=new WeakMap,L=new WeakMap,m=new WeakMap,E=new WeakMap,F=new WeakMap,x=new WeakMap,v=new WeakMap,l=new WeakSet,Re=function(y){const f=Z=>{this.editorDiv.style.fontSize=`calc(${Z}px * var(--scale-factor))`,this.translate(0,-(Z-P(this,v))*this.parent.scaleFactor),mt(this,v,Z),ht(this,o,pe).call(this)},T=P(this,v);this.parent.addCommands({cmd:()=>{f(y)},undo:()=>{f(T)},mustExec:!0,type:g.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},n=new WeakSet,Me=function(y){const f=P(this,E);this.parent.addCommands({cmd:()=>{mt(this,E,y),this.editorDiv.style.color=y},undo:()=>{mt(this,E,f),this.editorDiv.style.color=f},mustExec:!0,type:g.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},_=new WeakSet,Oe=function(){const y=this.editorDiv.getElementsByTagName("div");if(y.length===0)return this.editorDiv.innerText;const f=[];for(let T=0,Z=y.length;T<Z;T++){const J=y[T].firstChild;(J==null?void 0:J.nodeName)==="#text"?f.push(J.data):f.push("")}return f.join(`
`)},o=new WeakSet,pe=function(){const[y,f]=this.parent.viewportBaseDimensions,T=this.div.getBoundingClientRect();this.width=T.width/y,this.height=T.height/f},Mt(s,"_freeTextDefaultContent",""),Mt(s,"_l10nPromise"),Mt(s,"_internalPadding",0),Mt(s,"_defaultColor",null),Mt(s,"_defaultFontSize",10),Mt(s,"_keyboardManager",new p.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],s.prototype.commitOrRemove]])),Mt(s,"_type","freetext");let N=s;i.FreeTextEditor=N},(Y,i,O)=>{var m,E,F,x,v,l,t,n,a,_,b,o,e,s,d,De,y,Ie,T,Le,st,Ne,$,ge,G,Ue,et,Be,_t,je,h,Gt,w,me,D,ee,X,ne,r,Yt,A,_e,k,se,it,be,tt,qe,nt,We,ft,He,ut,Ae,vt,ie,Tt,Kt,Ft,ye;Object.defineProperty(i,"__esModule",{value:!0}),i.InkEditor=void 0,Object.defineProperty(i,"fitCurve",{enumerable:!0,get:function(){return I.fitCurve}});var g=O(1),p=O(6),I=O(25),N=O(7);const K=16,Ct=class Ct extends p.AnnotationEditor{constructor(rt){super({...rt,name:"inkEditor"});at(this,d);at(this,y);at(this,T);at(this,st);at(this,$);at(this,G);at(this,et);at(this,_t);at(this,h);at(this,w);at(this,D);at(this,X);at(this,r);at(this,A);at(this,k);at(this,tt);at(this,nt);at(this,ft);at(this,ut);at(this,vt);at(this,Tt);at(this,Ft);at(this,m,0);at(this,E,0);at(this,F,0);at(this,x,this.canvasPointermove.bind(this));at(this,v,this.canvasPointerleave.bind(this));at(this,l,this.canvasPointerup.bind(this));at(this,t,this.canvasPointerdown.bind(this));at(this,n,!1);at(this,a,!1);at(this,_,null);at(this,b,null);at(this,o,0);at(this,e,0);at(this,s,null);this.color=rt.color||null,this.thickness=rt.thickness||null,this.opacity=rt.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(rt){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(pt=>[pt,rt.get(pt)]))}static updateDefaultParams(rt,pt){switch(rt){case g.AnnotationEditorParamsType.INK_THICKNESS:Ct._defaultThickness=pt;break;case g.AnnotationEditorParamsType.INK_COLOR:Ct._defaultColor=pt;break;case g.AnnotationEditorParamsType.INK_OPACITY:Ct._defaultOpacity=pt/100;break}}updateParams(rt,pt){switch(rt){case g.AnnotationEditorParamsType.INK_THICKNESS:ht(this,d,De).call(this,pt);break;case g.AnnotationEditorParamsType.INK_COLOR:ht(this,y,Ie).call(this,pt);break;case g.AnnotationEditorParamsType.INK_OPACITY:ht(this,T,Le).call(this,pt);break}}static get defaultPropertiesToUpdate(){return[[g.AnnotationEditorParamsType.INK_THICKNESS,Ct._defaultThickness],[g.AnnotationEditorParamsType.INK_COLOR,Ct._defaultColor||p.AnnotationEditor._defaultLineColor],[g.AnnotationEditorParamsType.INK_OPACITY,Math.round(Ct._defaultOpacity*100)]]}get propertiesToUpdate(){return[[g.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Ct._defaultThickness],[g.AnnotationEditorParamsType.INK_COLOR,this.color||Ct._defaultColor||p.AnnotationEditor._defaultLineColor],[g.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Ct._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(ht(this,D,ee).call(this),ht(this,X,ne).call(this)),this.isAttachedToDOM||(this.parent.add(this),ht(this,r,Yt).call(this)),ht(this,Tt,Kt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,P(this,b).disconnect(),mt(this,b,null),super.remove())}enableEditMode(){P(this,n)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",P(this,t)),this.canvas.addEventListener("pointerup",P(this,l)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",P(this,t)),this.canvas.removeEventListener("pointerup",P(this,l)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){P(this,n)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),mt(this,n,!0),this.div.classList.add("disabled"),ht(this,Tt,Kt).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(rt){super.focusin(rt),this.enableEditMode()}canvasPointerdown(rt){rt.button!==0||!this.isInEditMode()||P(this,n)||(this.setInForeground(),rt.type!=="mouse"&&this.div.focus(),rt.stopPropagation(),this.canvas.addEventListener("pointerleave",P(this,v)),this.canvas.addEventListener("pointermove",P(this,x)),ht(this,G,Ue).call(this,rt.offsetX,rt.offsetY))}canvasPointermove(rt){rt.stopPropagation(),ht(this,et,Be).call(this,rt.offsetX,rt.offsetY)}canvasPointerup(rt){rt.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(rt.stopPropagation(),ht(this,w,me).call(this,rt),this.setInBackground())}canvasPointerleave(rt){ht(this,w,me).call(this,rt),this.setInBackground()}render(){if(this.div)return this.div;let rt,pt;this.width&&(rt=this.x,pt=this.y),super.render(),Ct._l10nPromise.get("editor_ink_aria_label").then(bt=>{var yt;return(yt=this.div)==null?void 0:yt.setAttribute("aria-label",bt)});const[Q,W,H,gt]=ht(this,st,Ne).call(this);if(this.setAt(Q,W,0,0),this.setDims(H,gt),ht(this,D,ee).call(this),this.width){const[bt,yt]=this.parent.viewportBaseDimensions;this.setAt(rt*bt,pt*yt,this.width*bt,this.height*yt),mt(this,a,!0),ht(this,r,Yt).call(this),this.setDims(this.width*bt,this.height*yt),ht(this,h,Gt).call(this),ht(this,Ft,ye).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return ht(this,X,ne).call(this),this.div}setDimensions(rt,pt){const Q=Math.round(rt),W=Math.round(pt);if(P(this,o)===Q&&P(this,e)===W)return;mt(this,o,Q),mt(this,e,W),this.canvas.style.visibility="hidden",P(this,m)&&Math.abs(P(this,m)-rt/pt)>.01&&(pt=Math.ceil(rt/P(this,m)),this.setDims(rt,pt));const[H,gt]=this.parent.viewportBaseDimensions;this.width=rt/H,this.height=pt/gt,P(this,n)&&ht(this,A,_e).call(this,rt,pt),ht(this,r,Yt).call(this),ht(this,h,Gt).call(this),this.canvas.style.visibility="visible"}static deserialize(rt,pt){var Dt,kt;const Q=super.deserialize(rt,pt);Q.thickness=rt.thickness,Q.color=g.Util.makeHexColor(...rt.color),Q.opacity=rt.opacity;const[W,H]=pt.pageDimensions,gt=Q.width*W,bt=Q.height*H,yt=pt.scaleFactor,St=rt.thickness/2;mt(Q,m,gt/bt),mt(Q,n,!0),mt(Q,o,Math.round(gt)),mt(Q,e,Math.round(bt));for(const{bezier:xt}of rt.paths){const Lt=[];Q.paths.push(Lt);let It=yt*(xt[0]-St),Bt=yt*(bt-xt[1]-St);for(let Nt=2,qt=xt.length;Nt<qt;Nt+=6){const Xt=yt*(xt[Nt]-St),Vt=yt*(bt-xt[Nt+1]-St),Ht=yt*(xt[Nt+2]-St),Ut=yt*(bt-xt[Nt+3]-St),Wt=yt*(xt[Nt+4]-St),$t=yt*(bt-xt[Nt+5]-St);Lt.push([[It,Bt],[Xt,Vt],[Ht,Ut],[Wt,$t]]),It=Wt,Bt=$t}const Pt=ht(this,it,be).call(this,Lt);Q.bezierPath2D.push(Pt)}const wt=ht(Dt=Q,ut,Ae).call(Dt);return mt(Q,F,Math.max(K,wt[2]-wt[0])),mt(Q,E,Math.max(K,wt[3]-wt[1])),ht(kt=Q,A,_e).call(kt,gt,bt),Q}serialize(){if(this.isEmpty())return null;const rt=this.getRect(0,0),pt=this.rotation%180===0?rt[3]-rt[1]:rt[2]-rt[0],Q=p.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:g.AnnotationEditorType.INK,color:Q,thickness:this.thickness,opacity:this.opacity,paths:ht(this,tt,qe).call(this,this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,pt),pageIndex:this.parent.pageIndex,rect:rt,rotation:this.rotation}}};m=new WeakMap,E=new WeakMap,F=new WeakMap,x=new WeakMap,v=new WeakMap,l=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,_=new WeakMap,b=new WeakMap,o=new WeakMap,e=new WeakMap,s=new WeakMap,d=new WeakSet,De=function(rt){const pt=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=rt,ht(this,Tt,Kt).call(this)},undo:()=>{this.thickness=pt,ht(this,Tt,Kt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},y=new WeakSet,Ie=function(rt){const pt=this.color;this.parent.addCommands({cmd:()=>{this.color=rt,ht(this,h,Gt).call(this)},undo:()=>{this.color=pt,ht(this,h,Gt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},T=new WeakSet,Le=function(rt){rt/=100;const pt=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=rt,ht(this,h,Gt).call(this)},undo:()=>{this.opacity=pt,ht(this,h,Gt).call(this)},mustExec:!0,type:g.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},st=new WeakSet,Ne=function(){const{width:rt,height:pt,rotation:Q}=this.parent.viewport;switch(Q){case 90:return[0,rt,rt,pt];case 180:return[rt,pt,rt,pt];case 270:return[pt,0,rt,pt];default:return[0,0,rt,pt]}},$=new WeakSet,ge=function(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,N.opacityToHex)(this.opacity)}`},G=new WeakSet,Ue=function(rt,pt){this.isEditing=!0,P(this,a)||(mt(this,a,!0),ht(this,r,Yt).call(this),this.thickness||(this.thickness=Ct._defaultThickness),this.color||(this.color=Ct._defaultColor||p.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Ct._defaultOpacity)),this.currentPath.push([rt,pt]),mt(this,_,null),ht(this,$,ge).call(this),this.ctx.beginPath(),this.ctx.moveTo(rt,pt),mt(this,s,()=>{P(this,s)&&(P(this,_)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):ht(this,h,Gt).call(this),this.ctx.lineTo(...P(this,_)),mt(this,_,null),this.ctx.stroke()),window.requestAnimationFrame(P(this,s)))}),window.requestAnimationFrame(P(this,s))},et=new WeakSet,Be=function(rt,pt){const[Q,W]=this.currentPath.at(-1);rt===Q&&pt===W||(this.currentPath.push([rt,pt]),mt(this,_,[rt,pt]))},_t=new WeakSet,je=function(rt,pt){var St;this.ctx.closePath(),mt(this,s,null),rt=Math.min(Math.max(rt,0),this.canvas.width),pt=Math.min(Math.max(pt,0),this.canvas.height);const[Q,W]=this.currentPath.at(-1);(rt!==Q||pt!==W)&&this.currentPath.push([rt,pt]);let H;if(this.currentPath.length!==1)H=(0,I.fitCurve)(this.currentPath,30,null);else{const wt=[rt,pt];H=[[wt,wt.slice(),wt.slice(),wt]]}const gt=ht(St=Ct,it,be).call(St,H);this.currentPath.length=0;const bt=()=>{this.paths.push(H),this.bezierPath2D.push(gt),this.rebuild()},yt=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(ht(this,D,ee).call(this),ht(this,X,ne).call(this)),ht(this,Tt,Kt).call(this))};this.parent.addCommands({cmd:bt,undo:yt,mustExec:!0})},h=new WeakSet,Gt=function(){if(this.isEmpty()){ht(this,k,se).call(this);return}ht(this,$,ge).call(this);const{canvas:rt,ctx:pt}=this;pt.setTransform(1,0,0,1,0,0),pt.clearRect(0,0,rt.width,rt.height),ht(this,k,se).call(this);for(const Q of this.bezierPath2D)pt.stroke(Q)},w=new WeakSet,me=function(rt){ht(this,_t,je).call(this,rt.offsetX,rt.offsetY),this.canvas.removeEventListener("pointerleave",P(this,v)),this.canvas.removeEventListener("pointermove",P(this,x)),this.parent.addToAnnotationStorage(this)},D=new WeakSet,ee=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Ct._l10nPromise.get("editor_ink_canvas_aria_label").then(rt=>{var pt;return(pt=this.canvas)==null?void 0:pt.setAttribute("aria-label",rt)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},X=new WeakSet,ne=function(){mt(this,b,new ResizeObserver(rt=>{const pt=rt[0].contentRect;pt.width&&pt.height&&this.setDimensions(pt.width,pt.height)})),P(this,b).observe(this.div)},r=new WeakSet,Yt=function(){if(!P(this,a))return;const[rt,pt]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*rt),this.canvas.height=Math.ceil(this.height*pt),ht(this,k,se).call(this)},A=new WeakSet,_e=function(rt,pt){const Q=ht(this,vt,ie).call(this),W=(rt-Q)/P(this,F),H=(pt-Q)/P(this,E);this.scaleFactor=Math.min(W,H)},k=new WeakSet,se=function(){const rt=ht(this,vt,ie).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+rt,this.translationY*this.scaleFactor+rt)},it=new WeakSet,be=function(rt){const pt=new Path2D;for(let Q=0,W=rt.length;Q<W;Q++){const[H,gt,bt,yt]=rt[Q];Q===0&&pt.moveTo(...H),pt.bezierCurveTo(gt[0],gt[1],bt[0],bt[1],yt[0],yt[1])}return pt},tt=new WeakSet,qe=function(rt,pt,Q,W){const gt=[],bt=this.thickness/2;let yt,St;for(const wt of this.paths){yt=[],St=[];for(let Dt=0,kt=wt.length;Dt<kt;Dt++){const[xt,Lt,It,Bt]=wt[Dt],Pt=rt*(xt[0]+pt)+bt,Nt=W-rt*(xt[1]+Q)-bt,qt=rt*(Lt[0]+pt)+bt,Xt=W-rt*(Lt[1]+Q)-bt,Vt=rt*(It[0]+pt)+bt,Ht=W-rt*(It[1]+Q)-bt,Ut=rt*(Bt[0]+pt)+bt,Wt=W-rt*(Bt[1]+Q)-bt;Dt===0&&(yt.push(Pt,Nt),St.push(Pt,Nt)),yt.push(qt,Xt,Vt,Ht,Ut,Wt),ht(this,nt,We).call(this,Pt,Nt,qt,Xt,Vt,Ht,Ut,Wt,4,St)}gt.push({bezier:yt,points:St})}return gt},nt=new WeakSet,We=function(rt,pt,Q,W,H,gt,bt,yt,St,wt){if(ht(this,ft,He).call(this,rt,pt,Q,W,H,gt,bt,yt)){wt.push(bt,yt);return}for(let Dt=1;Dt<St-1;Dt++){const kt=Dt/St,xt=1-kt;let Lt=kt*rt+xt*Q,It=kt*pt+xt*W,Bt=kt*Q+xt*H,Pt=kt*W+xt*gt;const Nt=kt*H+xt*bt,qt=kt*gt+xt*yt;Lt=kt*Lt+xt*Bt,It=kt*It+xt*Pt,Bt=kt*Bt+xt*Nt,Pt=kt*Pt+xt*qt,Lt=kt*Lt+xt*Bt,It=kt*It+xt*Pt,wt.push(Lt,It)}wt.push(bt,yt)},ft=new WeakSet,He=function(rt,pt,Q,W,H,gt,bt,yt){const wt=(3*Q-2*rt-bt)**2,Dt=(3*W-2*pt-yt)**2,kt=(3*H-rt-2*bt)**2,xt=(3*gt-pt-2*yt)**2;return Math.max(wt,kt)+Math.max(Dt,xt)<=10},ut=new WeakSet,Ae=function(){let rt=1/0,pt=-1/0,Q=1/0,W=-1/0;for(const H of this.paths)for(const[gt,bt,yt,St]of H){const wt=g.Util.bezierBoundingBox(...gt,...bt,...yt,...St);rt=Math.min(rt,wt[0]),Q=Math.min(Q,wt[1]),pt=Math.max(pt,wt[2]),W=Math.max(W,wt[3])}return[rt,Q,pt,W]},vt=new WeakSet,ie=function(){return P(this,n)?Math.ceil(this.thickness*this.parent.scaleFactor):0},Tt=new WeakSet,Kt=function(rt=!1){if(this.isEmpty())return;if(!P(this,n)){ht(this,h,Gt).call(this);return}const pt=ht(this,ut,Ae).call(this),Q=ht(this,vt,ie).call(this);mt(this,F,Math.max(K,pt[2]-pt[0])),mt(this,E,Math.max(K,pt[3]-pt[1]));const W=Math.ceil(Q+P(this,F)*this.scaleFactor),H=Math.ceil(Q+P(this,E)*this.scaleFactor),[gt,bt]=this.parent.viewportBaseDimensions;this.width=W/gt,this.height=H/bt,mt(this,m,W/H),ht(this,Ft,ye).call(this);const yt=this.translationX,St=this.translationY;this.translationX=-pt[0],this.translationY=-pt[1],ht(this,r,Yt).call(this),ht(this,h,Gt).call(this),mt(this,o,W),mt(this,e,H),this.setDims(W,H);const wt=rt?Q/this.scaleFactor/2:0;this.translate(yt-this.translationX-wt,St-this.translationY-wt)},Ft=new WeakSet,ye=function(){const{style:rt}=this.div;P(this,m)>=1?(rt.minHeight=`${K}px`,rt.minWidth=`${Math.round(P(this,m)*K)}px`):(rt.minWidth=`${K}px`,rt.minHeight=`${Math.round(K/P(this,m))}px`)},at(Ct,it),Mt(Ct,"_defaultColor",null),Mt(Ct,"_defaultOpacity",1),Mt(Ct,"_defaultThickness",1),Mt(Ct,"_l10nPromise"),Mt(Ct,"_type","ink");let L=Ct;i.InkEditor=L},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.fitCurve=void 0;const g=O(26);i.fitCurve=g},Y=>{function i(l,t,n){if(!Array.isArray(l))throw new TypeError("First argument should be an array");if(l.forEach(o=>{if(!Array.isArray(o)||o.some(e=>typeof e!="number")||o.length!==l[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),l=l.filter((o,e)=>e===0||!o.every((s,d)=>s===l[e-1][d])),l.length<2)return[];const a=l.length,_=F(l[1],l[0]),b=F(l[a-2],l[a-1]);return O(l,_,b,t,n)}function O(l,t,n,a,_){var o,e,s,d,C,y,f,T,Z,st,J,$,U;if(l.length===2)return $=x.vectorLen(x.subtract(l[0],l[1]))/3,o=[l[0],x.addArrays(l[0],x.mulItems(t,$)),x.addArrays(l[1],x.mulItems(n,$)),l[1]],[o];if(e=K(l),[o,d,y]=g(l,e,e,t,n,_),d===0||d<a)return[o];if(d<a*a)for(s=e,C=d,f=y,U=0;U<20;U++){if(s=I(o,l,s),[o,d,y]=g(l,e,s,t,n,_),d<a)return[o];if(y===f){let G=d/C;if(G>.9999&&G<1.0001)break}C=d,f=y}return J=[],T=x.subtract(l[y-1],l[y+1]),T.every(G=>G===0)&&(T=x.subtract(l[y-1],l[y]),[T[0],T[1]]=[-T[1],T[0]]),Z=x.normalize(T),st=x.mulItems(Z,-1),J=J.concat(O(l.slice(0,y+1),t,Z,a,_)),J=J.concat(O(l.slice(y),st,n,a,_)),J}function g(l,t,n,a,_,b){var o,e,s;return o=p(l,n,a,_),[e,s]=L(l,o,t),b&&b({bez:o,points:l,params:t,maxErr:e,maxPoint:s}),[o,e,s]}function p(l,t,n,a){var _,b,o,e,s,d,C,y,f,T,Z,st,J,$,U,G,z,et=l[0],ot=l[l.length-1];for(_=[et,null,null,ot],b=x.zeros_Xx2x2(t.length),J=0,$=t.length;J<$;J++)G=t[J],z=1-G,o=b[J],o[0]=x.mulItems(n,3*G*(z*z)),o[1]=x.mulItems(a,3*z*(G*G));for(e=[[0,0],[0,0]],s=[0,0],J=0,$=l.length;J<$;J++)G=t[J],o=b[J],e[0][0]+=x.dot(o[0],o[0]),e[0][1]+=x.dot(o[0],o[1]),e[1][0]+=x.dot(o[0],o[1]),e[1][1]+=x.dot(o[1],o[1]),U=x.subtract(l[J],v.q([et,et,ot,ot],G)),s[0]+=x.dot(o[0],U),s[1]+=x.dot(o[1],U);return d=e[0][0]*e[1][1]-e[1][0]*e[0][1],C=e[0][0]*s[1]-e[1][0]*s[0],y=s[0]*e[1][1]-s[1]*e[0][1],f=d===0?0:y/d,T=d===0?0:C/d,st=x.vectorLen(x.subtract(et,ot)),Z=1e-6*st,f<Z||T<Z?(_[1]=x.addArrays(et,x.mulItems(n,st/3)),_[2]=x.addArrays(ot,x.mulItems(a,st/3))):(_[1]=x.addArrays(et,x.mulItems(n,f)),_[2]=x.addArrays(ot,x.mulItems(a,T))),_}function I(l,t,n){return n.map((a,_)=>N(l,t[_],a))}function N(l,t,n){var a=x.subtract(v.q(l,n),t),_=v.qprime(l,n),b=x.mulMatrix(a,_),o=x.sum(x.squareItems(_))+2*x.mulMatrix(a,v.qprimeprime(l,n));return o===0?n:n-b/o}function K(l){var t=[],n,a,_;return l.forEach((b,o)=>{n=o?a+x.vectorLen(x.subtract(b,_)):0,t.push(n),a=n,_=b}),t=t.map(b=>b/a),t}function L(l,t,n){var a,_,b,o,e,s,d,C;_=0,b=Math.floor(l.length/2);const y=m(t,10);for(e=0,s=l.length;e<s;e++)d=l[e],C=E(t,n[e],y,10),o=x.subtract(v.q(t,C),d),a=o[0]*o[0]+o[1]*o[1],a>_&&(_=a,b=e);return[_,b]}var m=function(l,t){for(var n,a=[0],_=l[0],b=0,o=1;o<=t;o++)n=v.q(l,o/t),b+=x.vectorLen(x.subtract(n,_)),a.push(b),_=n;return a=a.map(e=>e/b),a};function E(l,t,n,a){if(t<0)return 0;if(t>1)return 1;for(var _,b,o,e,s,d=1;d<=a;d++)if(t<=n[d]){e=(d-1)/a,o=d/a,b=n[d-1],_=n[d],s=(t-b)/(_-b)*(o-e)+e;break}return s}function F(l,t){return x.normalize(x.subtract(l,t))}class x{static zeros_Xx2x2(t){for(var n=[];t--;)n.push([0,0]);return n}static mulItems(t,n){return t.map(a=>a*n)}static mulMatrix(t,n){return t.reduce((a,_,b)=>a+_*n[b],0)}static subtract(t,n){return t.map((a,_)=>a-n[_])}static addArrays(t,n){return t.map((a,_)=>a+n[_])}static addItems(t,n){return t.map(a=>a+n)}static sum(t){return t.reduce((n,a)=>n+a)}static dot(t,n){return x.mulMatrix(t,n)}static vectorLen(t){return Math.hypot(...t)}static divItems(t,n){return t.map(a=>a/n)}static squareItems(t){return t.map(n=>n*n)}static normalize(t){return this.divItems(t,this.vectorLen(t))}}class v{static q(t,n){var a=1-n,_=x.mulItems(t[0],a*a*a),b=x.mulItems(t[1],3*a*a*n),o=x.mulItems(t[2],3*a*n*n),e=x.mulItems(t[3],n*n*n);return x.addArrays(x.addArrays(_,b),x.addArrays(o,e))}static qprime(t,n){var a=1-n,_=x.mulItems(x.subtract(t[1],t[0]),3*a*a),b=x.mulItems(x.subtract(t[2],t[1]),6*a*n),o=x.mulItems(x.subtract(t[3],t[2]),3*n*n);return x.addArrays(x.addArrays(_,b),o)}static qprimeprime(t,n){return x.addArrays(x.mulItems(x.addArrays(x.subtract(t[2],x.mulItems(t[1],2)),t[0]),6*(1-n)),x.mulItems(x.addArrays(x.subtract(t[3],x.mulItems(t[2],2)),t[1]),6*n))}}Y.exports=i,Y.exports.fitCubic=O,Y.exports.createTangent=F},(Y,i,O)=>{var h,ve,w,Se,D,Ee;Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationLayer=void 0;var g=O(1),p=O(8),I=O(5),N=O(28),K=O(29);const L=1e3,m=9,E=new WeakSet;function F(V){return{width:V[2]-V[0],height:V[3]-V[1]}}class x{static create(r){switch(r.data.annotationType){case g.AnnotationType.LINK:return new l(r);case g.AnnotationType.TEXT:return new t(r);case g.AnnotationType.WIDGET:switch(r.data.fieldType){case"Tx":return new a(r);case"Btn":return r.data.radioButton?new b(r):r.data.checkBox?new _(r):new o(r);case"Ch":return new e(r)}return new n(r);case g.AnnotationType.POPUP:return new s(r);case g.AnnotationType.FREETEXT:return new C(r);case g.AnnotationType.LINE:return new y(r);case g.AnnotationType.SQUARE:return new f(r);case g.AnnotationType.CIRCLE:return new T(r);case g.AnnotationType.POLYLINE:return new Z(r);case g.AnnotationType.CARET:return new J(r);case g.AnnotationType.INK:return new $(r);case g.AnnotationType.POLYGON:return new st(r);case g.AnnotationType.HIGHLIGHT:return new U(r);case g.AnnotationType.UNDERLINE:return new G(r);case g.AnnotationType.SQUIGGLY:return new z(r);case g.AnnotationType.STRIKEOUT:return new et(r);case g.AnnotationType.STAMP:return new ot(r);case g.AnnotationType.FILEATTACHMENT:return new _t(r);default:return new v(r)}}}class v{constructor(r,{isRenderable:u=!1,ignoreBorder:A=!1,createQuadrilaterals:S=!1}={}){this.isRenderable=u,this.data=r.data,this.layer=r.layer,this.page=r.page,this.viewport=r.viewport,this.linkService=r.linkService,this.downloadManager=r.downloadManager,this.imageResourcesPath=r.imageResourcesPath,this.renderForms=r.renderForms,this.svgFactory=r.svgFactory,this.annotationStorage=r.annotationStorage,this.enableScripting=r.enableScripting,this.hasJSActions=r.hasJSActions,this._fieldObjects=r.fieldObjects,this._mouseState=r.mouseState,u&&(this.container=this._createContainer(A)),S&&(this.quadrilaterals=this._createQuadrilaterals(A))}_createContainer(r=!1){const u=this.data,A=this.page,S=this.viewport,k=document.createElement("section"),{width:q,height:it}=F(u.rect),[dt,tt,lt,nt]=S.viewBox,ct=lt-dt,ft=nt-tt;k.setAttribute("data-annotation-id",u.id);const M=g.Util.normalizeRect([u.rect[0],A.view[3]-u.rect[1]+A.view[1],u.rect[2],A.view[3]-u.rect[3]+A.view[1]]);if(!r&&u.borderStyle.width>0){k.style.borderWidth=`${u.borderStyle.width}px`;const At=u.borderStyle.horizontalCornerRadius,vt=u.borderStyle.verticalCornerRadius;if(At>0||vt>0){const Tt=`calc(${At}px * var(--scale-factor)) / calc(${vt}px * var(--scale-factor))`;k.style.borderRadius=Tt}else if(this instanceof b){const Tt=`calc(${q}px * var(--scale-factor)) / calc(${it}px * var(--scale-factor))`;k.style.borderRadius=Tt}switch(u.borderStyle.style){case g.AnnotationBorderStyleType.SOLID:k.style.borderStyle="solid";break;case g.AnnotationBorderStyleType.DASHED:k.style.borderStyle="dashed";break;case g.AnnotationBorderStyleType.BEVELED:(0,g.warn)("Unimplemented border style: beveled");break;case g.AnnotationBorderStyleType.INSET:(0,g.warn)("Unimplemented border style: inset");break;case g.AnnotationBorderStyleType.UNDERLINE:k.style.borderBottomStyle="solid";break}const Et=u.borderColor||null;Et?k.style.borderColor=g.Util.makeHexColor(Et[0]|0,Et[1]|0,Et[2]|0):k.style.borderWidth=0}k.style.left=`${100*(M[0]-dt)/ct}%`,k.style.top=`${100*(M[1]-tt)/ft}%`;const{rotation:ut}=u;return u.hasOwnCanvas||ut===0?(k.style.width=`${100*q/ct}%`,k.style.height=`${100*it/ft}%`):this.setRotation(ut,k),k}setRotation(r,u=this.container){const[A,S,k,q]=this.viewport.viewBox,it=k-A,dt=q-S,{width:tt,height:lt}=F(this.data.rect);let nt,ct;r%180===0?(nt=100*tt/it,ct=100*lt/dt):(nt=100*lt/it,ct=100*tt/dt),u.style.width=`${nt}%`,u.style.height=`${ct}%`,u.setAttribute("data-main-rotation",(360-r)%360)}get _commonActions(){const r=(u,A,S)=>{const k=S.detail[u];S.target.style[A]=N.ColorConverters[`${k[0]}_HTML`](k.slice(1))};return(0,g.shadow)(this,"_commonActions",{display:u=>{const A=u.detail.display%2===1;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:A,print:u.detail.display===0||u.detail.display===3})},print:u=>{this.annotationStorage.setValue(this.data.id,{print:u.detail.print})},hidden:u=>{this.container.style.visibility=u.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:u.detail.hidden})},focus:u=>{setTimeout(()=>u.target.focus({preventScroll:!1}),0)},userName:u=>{u.target.title=u.detail.userName},readonly:u=>{u.detail.readonly?u.target.setAttribute("readonly",""):u.target.removeAttribute("readonly")},required:u=>{this._setRequired(u.target,u.detail.required)},bgColor:u=>{r("bgColor","backgroundColor",u)},fillColor:u=>{r("fillColor","backgroundColor",u)},fgColor:u=>{r("fgColor","color",u)},textColor:u=>{r("textColor","color",u)},borderColor:u=>{r("borderColor","borderColor",u)},strokeColor:u=>{r("strokeColor","borderColor",u)},rotation:u=>{const A=u.detail.rotation;this.setRotation(A),this.annotationStorage.setValue(this.data.id,{rotation:A})}})}_dispatchEventFromSandbox(r,u){const A=this._commonActions;for(const S of Object.keys(u.detail)){const k=r[S]||A[S];k&&k(u)}}_setDefaultPropertiesFromJS(r){if(!this.enableScripting)return;const u=this.annotationStorage.getRawValue(this.data.id);if(!u)return;const A=this._commonActions;for(const[S,k]of Object.entries(u)){const q=A[S];if(q){const it={detail:{[S]:k},target:r};q(it),delete u[S]}}}_createQuadrilaterals(r=!1){if(!this.data.quadPoints)return null;const u=[],A=this.data.rect;for(const S of this.data.quadPoints)this.data.rect=[S[2].x,S[2].y,S[1].x,S[1].y],u.push(this._createContainer(r));return this.data.rect=A,u}_createPopup(r,u){let A=this.container;this.quadrilaterals&&(r=r||this.quadrilaterals,A=this.quadrilaterals[0]),r||(r=document.createElement("div"),r.className="popupTriggerArea",A.append(r));const k=new d({container:A,trigger:r,color:u.color,titleObj:u.titleObj,modificationDate:u.modificationDate,contentsObj:u.contentsObj,richText:u.richText,hideWrapper:!0}).render();k.style.left="100%",A.append(k)}_renderQuadrilaterals(r){for(const u of this.quadrilaterals)u.className=r;return this.quadrilaterals}render(){(0,g.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(r,u=null){const A=[];if(this._fieldObjects){const S=this._fieldObjects[r];if(S)for(const{page:k,id:q,exportValues:it}of S){if(k===-1||q===u)continue;const dt=typeof it=="string"?it:null,tt=document.querySelector(`[data-element-id="${q}"]`);if(tt&&!E.has(tt)){(0,g.warn)(`_getElementsByName - element not allowed: ${q}`);continue}A.push({id:q,exportValue:dt,domElement:tt})}return A}for(const S of document.getElementsByName(r)){const{id:k,exportValue:q}=S;k!==u&&E.has(S)&&A.push({id:k,exportValue:q,domElement:S})}return A}static get platform(){const r=typeof navigator<"u"?navigator.platform:"";return(0,g.shadow)(this,"platform",{isWin:r.includes("Win"),isMac:r.includes("Mac")})}}class l extends v{constructor(r,u=null){super(r,{isRenderable:!0,ignoreBorder:!!(u!=null&&u.ignoreBorder),createQuadrilaterals:!0}),this.isTooltipOnly=r.data.isTooltipOnly}render(){const{data:r,linkService:u}=this,A=document.createElement("a");A.setAttribute("data-element-id",r.id);let S=!1;return r.url?(u.addLinkAttributes(A,r.url,r.newWindow),S=!0):r.action?(this._bindNamedAction(A,r.action),S=!0):r.dest?(this._bindLink(A,r.dest),S=!0):(r.actions&&(r.actions.Action||r.actions["Mouse Up"]||r.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(A,r),S=!0),r.resetForm?(this._bindResetFormAction(A,r.resetForm),S=!0):this.isTooltipOnly&&!S&&(this._bindLink(A,""),S=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((k,q)=>{const it=q===0?A:A.cloneNode();return k.append(it),k}):(this.container.className="linkAnnotation",S&&this.container.append(A),this.container)}_bindLink(r,u){r.href=this.linkService.getDestinationHash(u),r.onclick=()=>(u&&this.linkService.goToDestination(u),!1),(u||u==="")&&(r.className="internalLink")}_bindNamedAction(r,u){r.href=this.linkService.getAnchorUrl(""),r.onclick=()=>(this.linkService.executeNamedAction(u),!1),r.className="internalLink"}_bindJSAction(r,u){r.href=this.linkService.getAnchorUrl("");const A=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const S of Object.keys(u.actions)){const k=A.get(S);k&&(r[k]=()=>{var q;return(q=this.linkService.eventBus)==null||q.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u.id,name:S}}),!1})}r.onclick||(r.onclick=()=>!1),r.className="internalLink"}_bindResetFormAction(r,u){const A=r.onclick;if(A||(r.href=this.linkService.getAnchorUrl("")),r.className="internalLink",!this._fieldObjects){(0,g.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),A||(r.onclick=()=>!1);return}r.onclick=()=>{var lt;A&&A();const{fields:S,refs:k,include:q}=u,it=[];if(S.length!==0||k.length!==0){const nt=new Set(k);for(const ct of S){const ft=this._fieldObjects[ct]||[];for(const{id:M}of ft)nt.add(M)}for(const ct of Object.values(this._fieldObjects))for(const ft of ct)nt.has(ft.id)===q&&it.push(ft)}else for(const nt of Object.values(this._fieldObjects))it.push(...nt);const dt=this.annotationStorage,tt=[];for(const nt of it){const{id:ct}=nt;switch(tt.push(ct),nt.type){case"text":{const M=nt.defaultValue||"";dt.setValue(ct,{value:M});break}case"checkbox":case"radiobutton":{const M=nt.defaultValue===nt.exportValues;dt.setValue(ct,{value:M});break}case"combobox":case"listbox":{const M=nt.defaultValue||"";dt.setValue(ct,{value:M});break}default:continue}const ft=document.querySelector(`[data-element-id="${ct}"]`);if(ft){if(!E.has(ft)){(0,g.warn)(`_bindResetFormAction - element not allowed: ${ct}`);continue}}else continue;ft.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((lt=this.linkService.eventBus)==null||lt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:tt,name:"ResetForm"}})),!1}}}class t extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u})}render(){this.container.className="textAnnotation";const r=document.createElement("img");return r.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",r.alt="[{{type}} Annotation]",r.dataset.l10nId="text_annotation_type",r.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(r,this.data),this.container.append(r),this.container}}class n extends v{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(r){const{isWin:u,isMac:A}=v.platform;return u&&r.ctrlKey||A&&r.metaKey}_setEventListener(r,u,A,S){u.includes("mouse")?r.addEventListener(u,k=>{var q;(q=this.linkService.eventBus)==null||q.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:S(k),shift:k.shiftKey,modifier:this._getKeyModifier(k)}})}):r.addEventListener(u,k=>{var q;(q=this.linkService.eventBus)==null||q.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:S(k)}})})}_setEventListeners(r,u,A){var S;for(const[k,q]of u)(q==="Action"||(S=this.data.actions)!=null&&S[q])&&this._setEventListener(r,k,q,A)}_setBackgroundColor(r){const u=this.data.backgroundColor||null;r.style.backgroundColor=u===null?"transparent":g.Util.makeHexColor(u[0],u[1],u[2])}_setTextStyle(r){const u=["left","center","right"],{fontColor:A}=this.data.defaultAppearanceData,S=this.data.defaultAppearanceData.fontSize||m,k=r.style;let q;if(this.data.multiLine){const it=Math.abs(this.data.rect[3]-this.data.rect[1]),dt=Math.round(it/(g.LINE_FACTOR*S))||1,tt=it/dt;q=Math.min(S,Math.round(tt/g.LINE_FACTOR))}else{const it=Math.abs(this.data.rect[3]-this.data.rect[1]);q=Math.min(S,Math.round(it/g.LINE_FACTOR))}k.fontSize=`calc(${q}px * var(--scale-factor))`,k.color=g.Util.makeHexColor(A[0],A[1],A[2]),this.data.textAlignment!==null&&(k.textAlign=u[this.data.textAlignment])}_setRequired(r,u){u?r.setAttribute("required",!0):r.removeAttribute("required"),r.setAttribute("aria-required",u)}}class a extends n{constructor(r){const u=r.renderForms||!r.data.hasAppearance&&!!r.data.fieldValue;super(r,{isRenderable:u})}setPropertyOnSiblings(r,u,A,S){const k=this.annotationStorage;for(const q of this._getElementsByName(r.name,r.id))q.domElement&&(q.domElement[u]=A),k.setValue(q.id,{[S]:A})}render(){var S;const r=this.annotationStorage,u=this.data.id;this.container.className="textWidgetAnnotation";let A=null;if(this.renderForms){const k=r.getValue(u,{value:this.data.fieldValue});let q=k.formattedValue||k.value||"";const it=r.getValue(u,{charLimit:this.data.maxLen}).charLimit;it&&q.length>it&&(q=q.slice(0,it));const dt={userValue:q,formattedValue:null,valueOnFocus:""};this.data.multiLine?(A=document.createElement("textarea"),A.textContent=q,this.data.doNotScroll&&(A.style.overflowY="hidden")):(A=document.createElement("input"),A.type="text",A.setAttribute("value",q),this.data.doNotScroll&&(A.style.overflowX="hidden")),E.add(A),A.setAttribute("data-element-id",u),A.disabled=this.data.readOnly,A.name=this.data.fieldName,A.tabIndex=L,this._setRequired(A,this.data.required),it&&(A.maxLength=it),A.addEventListener("input",lt=>{r.setValue(u,{value:lt.target.value}),this.setPropertyOnSiblings(A,"value",lt.target.value,"value")}),A.addEventListener("resetform",lt=>{const nt=this.data.defaultFieldValue??"";A.value=dt.userValue=nt,dt.formattedValue=null});let tt=lt=>{const{formattedValue:nt}=dt;nt!=null&&(lt.target.value=nt),lt.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){A.addEventListener("focus",nt=>{dt.userValue&&(nt.target.value=dt.userValue),dt.valueOnFocus=nt.target.value}),A.addEventListener("updatefromsandbox",nt=>{const ct={value(ft){dt.userValue=ft.detail.value??"",r.setValue(u,{value:dt.userValue.toString()}),ft.target.value=dt.userValue},formattedValue(ft){const{formattedValue:M}=ft.detail;dt.formattedValue=M,M!=null&&ft.target!==document.activeElement&&(ft.target.value=M),r.setValue(u,{formattedValue:M})},selRange(ft){ft.target.setSelectionRange(...ft.detail.selRange)},charLimit:ft=>{var vt;const{charLimit:M}=ft.detail,{target:ut}=ft;if(M===0){ut.removeAttribute("maxLength");return}ut.setAttribute("maxLength",M);let At=dt.userValue;!At||At.length<=M||(At=At.slice(0,M),ut.value=dt.userValue=At,r.setValue(u,{value:At}),(vt=this.linkService.eventBus)==null||vt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u,name:"Keystroke",value:At,willCommit:!0,commitKey:1,selStart:ut.selectionStart,selEnd:ut.selectionEnd}}))}};this._dispatchEventFromSandbox(ct,nt)}),A.addEventListener("keydown",nt=>{var M;let ct=-1;if(nt.key==="Escape"?ct=0:nt.key==="Enter"?ct=2:nt.key==="Tab"&&(ct=3),ct===-1)return;const{value:ft}=nt.target;dt.valueOnFocus!==ft&&(dt.userValue=ft,(M=this.linkService.eventBus)==null||M.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u,name:"Keystroke",value:ft,willCommit:!0,commitKey:ct,selStart:nt.target.selectionStart,selEnd:nt.target.selectionEnd}}))});const lt=tt;tt=null,A.addEventListener("blur",nt=>{var ft;const{value:ct}=nt.target;dt.userValue=ct,this._mouseState.isDown&&dt.valueOnFocus!==ct&&((ft=this.linkService.eventBus)==null||ft.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u,name:"Keystroke",value:ct,willCommit:!0,commitKey:1,selStart:nt.target.selectionStart,selEnd:nt.target.selectionEnd}})),lt(nt)}),(S=this.data.actions)!=null&&S.Keystroke&&A.addEventListener("beforeinput",nt=>{var Tt;const{data:ct,target:ft}=nt,{value:M,selectionStart:ut,selectionEnd:At}=ft;let vt=ut,Et=At;switch(nt.inputType){case"deleteWordBackward":{const Rt=M.substring(0,ut).match(/\w*[^\w]*$/);Rt&&(vt-=Rt[0].length);break}case"deleteWordForward":{const Rt=M.substring(ut).match(/^[^\w]*\w*/);Rt&&(Et+=Rt[0].length);break}case"deleteContentBackward":ut===At&&(vt-=1);break;case"deleteContentForward":ut===At&&(Et+=1);break}nt.preventDefault(),(Tt=this.linkService.eventBus)==null||Tt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u,name:"Keystroke",value:M,change:ct||"",willCommit:!1,selStart:vt,selEnd:Et}})}),this._setEventListeners(A,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],nt=>nt.target.value)}if(tt&&A.addEventListener("blur",tt),this.data.comb){const nt=(this.data.rect[2]-this.data.rect[0])/it;A.classList.add("comb"),A.style.letterSpacing=`calc(${nt}px * var(--scale-factor) - 1ch)`}}else A=document.createElement("div"),A.textContent=this.data.fieldValue,A.style.verticalAlign="middle",A.style.display="table-cell";return this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class _ extends n{constructor(r){super(r,{isRenderable:r.renderForms})}render(){const r=this.annotationStorage,u=this.data,A=u.id;let S=r.getValue(A,{value:u.exportValue===u.fieldValue}).value;typeof S=="string"&&(S=S!=="Off",r.setValue(A,{value:S})),this.container.className="buttonWidgetAnnotation checkBox";const k=document.createElement("input");return E.add(k),k.setAttribute("data-element-id",A),k.disabled=u.readOnly,this._setRequired(k,this.data.required),k.type="checkbox",k.name=u.fieldName,S&&k.setAttribute("checked",!0),k.setAttribute("exportValue",u.exportValue),k.tabIndex=L,k.addEventListener("change",q=>{const{name:it,checked:dt}=q.target;for(const tt of this._getElementsByName(it,A)){const lt=dt&&tt.exportValue===u.exportValue;tt.domElement&&(tt.domElement.checked=lt),r.setValue(tt.id,{value:lt})}r.setValue(A,{value:dt})}),k.addEventListener("resetform",q=>{const it=u.defaultFieldValue||"Off";q.target.checked=it===u.exportValue}),this.enableScripting&&this.hasJSActions&&(k.addEventListener("updatefromsandbox",q=>{const it={value(dt){dt.target.checked=dt.detail.value!=="Off",r.setValue(A,{value:dt.target.checked})}};this._dispatchEventFromSandbox(it,q)}),this._setEventListeners(k,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],q=>q.target.checked)),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class b extends n{constructor(r){super(r,{isRenderable:r.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const r=this.annotationStorage,u=this.data,A=u.id;let S=r.getValue(A,{value:u.fieldValue===u.buttonValue}).value;typeof S=="string"&&(S=S!==u.buttonValue,r.setValue(A,{value:S}));const k=document.createElement("input");if(E.add(k),k.setAttribute("data-element-id",A),k.disabled=u.readOnly,this._setRequired(k,this.data.required),k.type="radio",k.name=u.fieldName,S&&k.setAttribute("checked",!0),k.tabIndex=L,k.addEventListener("change",q=>{const{name:it,checked:dt}=q.target;for(const tt of this._getElementsByName(it,A))r.setValue(tt.id,{value:!1});r.setValue(A,{value:dt})}),k.addEventListener("resetform",q=>{const it=u.defaultFieldValue;q.target.checked=it!=null&&it===u.buttonValue}),this.enableScripting&&this.hasJSActions){const q=u.buttonValue;k.addEventListener("updatefromsandbox",it=>{const dt={value:tt=>{const lt=q===tt.detail.value;for(const nt of this._getElementsByName(tt.target.name)){const ct=lt&&nt.id===A;nt.domElement&&(nt.domElement.checked=ct),r.setValue(nt.id,{value:ct})}}};this._dispatchEventFromSandbox(dt,it)}),this._setEventListeners(k,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],it=>it.target.checked)}return this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class o extends l{constructor(r){super(r,{ignoreBorder:r.data.hasAppearance})}render(){const r=super.render();r.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(r.title=this.data.alternativeText);const u=r.lastChild;return this.enableScripting&&this.hasJSActions&&u&&(this._setDefaultPropertiesFromJS(u),u.addEventListener("updatefromsandbox",A=>{this._dispatchEventFromSandbox({},A)})),r}}class e extends n{constructor(r){super(r,{isRenderable:r.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const r=this.annotationStorage,u=this.data.id,A=r.getValue(u,{value:this.data.fieldValue}),S=document.createElement("select");E.add(S),S.setAttribute("data-element-id",u),S.disabled=this.data.readOnly,this._setRequired(S,this.data.required),S.name=this.data.fieldName,S.tabIndex=L;let k=this.data.combo&&this.data.options.length>0;this.data.combo||(S.size=this.data.options.length,this.data.multiSelect&&(S.multiple=!0)),S.addEventListener("resetform",tt=>{const lt=this.data.defaultFieldValue;for(const nt of S.options)nt.selected=nt.value===lt});for(const tt of this.data.options){const lt=document.createElement("option");lt.textContent=tt.displayValue,lt.value=tt.exportValue,A.value.includes(tt.exportValue)&&(lt.setAttribute("selected",!0),k=!1),S.append(lt)}let q=null;if(k){const tt=document.createElement("option");tt.value=" ",tt.setAttribute("hidden",!0),tt.setAttribute("selected",!0),S.prepend(tt),q=()=>{tt.remove(),S.removeEventListener("input",q),q=null},S.addEventListener("input",q)}const it=(tt,lt)=>{const nt=lt?"value":"textContent",ct=tt.target.options;return tt.target.multiple?Array.prototype.filter.call(ct,ft=>ft.selected).map(ft=>ft[nt]):ct.selectedIndex===-1?null:ct[ct.selectedIndex][nt]},dt=tt=>{const lt=tt.target.options;return Array.prototype.map.call(lt,nt=>({displayValue:nt.textContent,exportValue:nt.value}))};return this.enableScripting&&this.hasJSActions?(S.addEventListener("updatefromsandbox",tt=>{const lt={value(nt){q==null||q();const ct=nt.detail.value,ft=new Set(Array.isArray(ct)?ct:[ct]);for(const M of S.options)M.selected=ft.has(M.value);r.setValue(u,{value:it(nt,!0)})},multipleSelection(nt){S.multiple=!0},remove(nt){const ct=S.options,ft=nt.detail.remove;ct[ft].selected=!1,S.remove(ft),ct.length>0&&Array.prototype.findIndex.call(ct,ut=>ut.selected)===-1&&(ct[0].selected=!0),r.setValue(u,{value:it(nt,!0),items:dt(nt)})},clear(nt){for(;S.length!==0;)S.remove(0);r.setValue(u,{value:null,items:[]})},insert(nt){const{index:ct,displayValue:ft,exportValue:M}=nt.detail.insert,ut=S.children[ct],At=document.createElement("option");At.textContent=ft,At.value=M,ut?ut.before(At):S.append(At),r.setValue(u,{value:it(nt,!0),items:dt(nt)})},items(nt){const{items:ct}=nt.detail;for(;S.length!==0;)S.remove(0);for(const ft of ct){const{displayValue:M,exportValue:ut}=ft,At=document.createElement("option");At.textContent=M,At.value=ut,S.append(At)}S.options.length>0&&(S.options[0].selected=!0),r.setValue(u,{value:it(nt,!0),items:dt(nt)})},indices(nt){const ct=new Set(nt.detail.indices);for(const ft of nt.target.options)ft.selected=ct.has(ft.index);r.setValue(u,{value:it(nt,!0)})},editable(nt){nt.target.disabled=!nt.detail.editable}};this._dispatchEventFromSandbox(lt,tt)}),S.addEventListener("input",tt=>{var ct;const lt=it(tt,!0),nt=it(tt,!1);r.setValue(u,{value:lt}),(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:u,name:"Keystroke",value:nt,changeEx:lt,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(S,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],tt=>tt.target.checked)):S.addEventListener("input",function(tt){r.setValue(u,{value:it(tt,!0)})}),this.data.combo&&this._setTextStyle(S),this._setBackgroundColor(S),this._setDefaultPropertiesFromJS(S),this.container.append(S),this.container}}class s extends v{constructor(r){var A,S,k;const u=!!((A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u})}render(){const r=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",r.includes(this.data.parentType))return this.container;const u=`[data-annotation-id="${this.data.parentId}"]`,A=this.layer.querySelectorAll(u);if(A.length===0)return this.container;const S=new d({container:this.container,trigger:Array.from(A),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),k=this.page,q=g.Util.normalizeRect([this.data.parentRect[0],k.view[3]-this.data.parentRect[1]+k.view[1],this.data.parentRect[2],k.view[3]-this.data.parentRect[3]+k.view[1]]),it=q[0]+this.data.parentRect[2]-this.data.parentRect[0],dt=q[1],[tt,lt,nt,ct]=this.viewport.viewBox,ft=nt-tt,M=ct-lt;return this.container.style.left=`${100*(it-tt)/ft}%`,this.container.style.top=`${100*(dt-lt)/M}%`,this.container.append(S.render()),this.container}}class d{constructor(r){this.container=r.container,this.trigger=r.trigger,this.color=r.color,this.titleObj=r.titleObj,this.modificationDate=r.modificationDate,this.contentsObj=r.contentsObj,this.richText=r.richText,this.hideWrapper=r.hideWrapper||!1,this.pinned=!1}render(){var it,dt;const u=document.createElement("div");u.className="popupWrapper",this.hideElement=this.hideWrapper?u:this.container,this.hideElement.hidden=!0;const A=document.createElement("div");A.className="popup";const S=this.color;if(S){const tt=.7*(255-S[0])+S[0],lt=.7*(255-S[1])+S[1],nt=.7*(255-S[2])+S[2];A.style.backgroundColor=g.Util.makeHexColor(tt|0,lt|0,nt|0)}const k=document.createElement("h1");k.dir=this.titleObj.dir,k.textContent=this.titleObj.str,A.append(k);const q=p.PDFDateString.toDateObject(this.modificationDate);if(q){const tt=document.createElement("span");tt.className="popupDate",tt.textContent="{{date}}, {{time}}",tt.dataset.l10nId="annotation_date_string",tt.dataset.l10nArgs=JSON.stringify({date:q.toLocaleDateString(),time:q.toLocaleTimeString()}),A.append(tt)}if((it=this.richText)!=null&&it.str&&(!((dt=this.contentsObj)!=null&&dt.str)||this.contentsObj.str===this.richText.str))K.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:A}),A.lastChild.className="richText popupContent";else{const tt=this._formatContents(this.contentsObj);A.append(tt)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const tt of this.trigger)tt.addEventListener("click",this._toggle.bind(this)),tt.addEventListener("mouseover",this._show.bind(this,!1)),tt.addEventListener("mouseout",this._hide.bind(this,!1));return A.addEventListener("click",this._hide.bind(this,!0)),u.append(A),u}_formatContents({str:r,dir:u}){const A=document.createElement("p");A.className="popupContent",A.dir=u;const S=r.split(/(?:\r\n?|\n)/);for(let k=0,q=S.length;k<q;++k){const it=S[k];A.append(document.createTextNode(it)),k<q-1&&A.append(document.createElement("br"))}return A}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(r=!1){r&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(r=!0){r&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class C extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0}),this.textContent=r.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){const r=document.createElement("div");r.className="annotationTextContent",r.setAttribute("role","comment");for(const u of this.textContent){const A=document.createElement("span");A.textContent=u,r.append(A)}this.container.append(r)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class y extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const r=this.data,{width:u,height:A}=F(r.rect),S=this.svgFactory.create(u,A,!0),k=this.svgFactory.createElement("svg:line");return k.setAttribute("x1",r.rect[2]-r.lineCoordinates[0]),k.setAttribute("y1",r.rect[3]-r.lineCoordinates[1]),k.setAttribute("x2",r.rect[2]-r.lineCoordinates[2]),k.setAttribute("y2",r.rect[3]-r.lineCoordinates[3]),k.setAttribute("stroke-width",r.borderStyle.width||1),k.setAttribute("stroke","transparent"),k.setAttribute("fill","transparent"),S.append(k),this.container.append(S),this._createPopup(k,r),this.container}}class f extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const r=this.data,{width:u,height:A}=F(r.rect),S=this.svgFactory.create(u,A,!0),k=r.borderStyle.width,q=this.svgFactory.createElement("svg:rect");return q.setAttribute("x",k/2),q.setAttribute("y",k/2),q.setAttribute("width",u-k),q.setAttribute("height",A-k),q.setAttribute("stroke-width",k||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),S.append(q),this.container.append(S),this._createPopup(q,r),this.container}}class T extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const r=this.data,{width:u,height:A}=F(r.rect),S=this.svgFactory.create(u,A,!0),k=r.borderStyle.width,q=this.svgFactory.createElement("svg:ellipse");return q.setAttribute("cx",u/2),q.setAttribute("cy",A/2),q.setAttribute("rx",u/2-k/2),q.setAttribute("ry",A/2-k/2),q.setAttribute("stroke-width",k||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),S.append(q),this.container.append(S),this._createPopup(q,r),this.container}}class Z extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const r=this.data,{width:u,height:A}=F(r.rect),S=this.svgFactory.create(u,A,!0);let k=[];for(const it of r.vertices){const dt=it.x-r.rect[0],tt=r.rect[3]-it.y;k.push(dt+","+tt)}k=k.join(" ");const q=this.svgFactory.createElement(this.svgElementName);return q.setAttribute("points",k),q.setAttribute("stroke-width",r.borderStyle.width||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),S.append(q),this.container.append(S),this._createPopup(q,r),this.container}}class st extends Z{constructor(r){super(r),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class J extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class $ extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const r=this.data,{width:u,height:A}=F(r.rect),S=this.svgFactory.create(u,A,!0);for(const k of r.inkLists){let q=[];for(const dt of k){const tt=dt.x-r.rect[0],lt=r.rect[3]-dt.y;q.push(`${tt},${lt}`)}q=q.join(" ");const it=this.svgFactory.createElement(this.svgElementName);it.setAttribute("points",q),it.setAttribute("stroke-width",r.borderStyle.width||1),it.setAttribute("stroke","transparent"),it.setAttribute("fill","transparent"),this._createPopup(it,r),S.append(it)}return this.container.append(S),this.container}}class U extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class G extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class z extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class et extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class ot extends v{constructor(r){var A,S,k;const u=!!(r.data.hasPopup||(A=r.data.titleObj)!=null&&A.str||(S=r.data.contentsObj)!=null&&S.str||(k=r.data.richText)!=null&&k.str);super(r,{isRenderable:u,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class _t extends v{constructor(r){var S;super(r,{isRenderable:!0});const{filename:u,content:A}=this.data.file;this.filename=(0,p.getFilenameFromUrl)(u),this.content=A,(S=this.linkService.eventBus)==null||S.dispatch("fileattachmentannotation",{source:this,filename:u,content:A})}render(){var u,A;this.container.className="fileAttachmentAnnotation";const r=document.createElement("div");return r.className="popupTriggerArea",r.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((u=this.data.titleObj)!=null&&u.str||(A=this.data.contentsObj)!=null&&A.str||this.data.richText)&&this._createPopup(r,this.data),this.container.append(r),this.container}_download(){var r;(r=this.downloadManager)==null||r.openOrDownloadData(this.container,this.content,this.filename)}}const X=class X{static render(r){var it,dt;const{annotations:u,div:A,viewport:S,accessibilityManager:k}=r;ht(this,w,Se).call(this,A,S);let q=0;for(const tt of u){if(tt.annotationType!==g.AnnotationType.POPUP){const{width:nt,height:ct}=F(tt.rect);if(nt<=0||ct<=0)continue}const lt=x.create({data:tt,layer:A,page:r.page,viewport:S,linkService:r.linkService,downloadManager:r.downloadManager,imageResourcesPath:r.imageResourcesPath||"",renderForms:r.renderForms!==!1,svgFactory:new p.DOMSVGFactory,annotationStorage:r.annotationStorage||new I.AnnotationStorage,enableScripting:r.enableScripting,hasJSActions:r.hasJSActions,fieldObjects:r.fieldObjects,mouseState:r.mouseState||{isDown:!1}});if(lt.isRenderable){const nt=lt.render();if(tt.hidden&&(nt.style.visibility="hidden"),Array.isArray(nt))for(const ct of nt)ct.style.zIndex=q++,ht(it=X,h,ve).call(it,ct,tt.id,A,k);else nt.style.zIndex=q++,lt instanceof s?A.prepend(nt):ht(dt=X,h,ve).call(dt,nt,tt.id,A,k)}}ht(this,D,Ee).call(this,A,r.annotationCanvasMap)}static update(r){const{annotationCanvasMap:u,div:A,viewport:S}=r;ht(this,w,Se).call(this,A,S),ht(this,D,Ee).call(this,A,u),A.hidden=!1}};h=new WeakSet,ve=function(r,u,A,S){const k=r.firstChild||r;k.id=`${p.AnnotationPrefix}${u}`,A.append(r),S==null||S.moveElementInDOM(A,r,k,!1)},w=new WeakSet,Se=function(r,{width:u,height:A,rotation:S}){const{style:k}=r,q=S%180!==0,it=Math.floor(u)+"px",dt=Math.floor(A)+"px";k.width=q?dt:it,k.height=q?it:dt,r.setAttribute("data-main-rotation",S)},D=new WeakSet,Ee=function(r,u){if(u){for(const[A,S]of u){const k=r.querySelector(`[data-annotation-id="${A}"]`);if(!k)continue;const{firstChild:q}=k;q?q.nodeName==="CANVAS"?q.replaceWith(S):q.before(S):k.append(S)}u.clear()}},at(X,h),at(X,w),at(X,D);let B=X;i.AnnotationLayer=B},(Y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorConverters=void 0;function O(p){return Math.floor(Math.max(0,Math.min(1,p))*255).toString(16).padStart(2,"0")}class g{static CMYK_G([I,N,K,L]){return["G",1-Math.min(1,.3*I+.59*K+.11*N+L)]}static G_CMYK([I]){return["CMYK",0,0,0,1-I]}static G_RGB([I]){return["RGB",I,I,I]}static G_HTML([I]){const N=O(I);return`#${N}${N}${N}`}static RGB_G([I,N,K]){return["G",.3*I+.59*N+.11*K]}static RGB_HTML([I,N,K]){const L=O(I),m=O(N),E=O(K);return`#${L}${m}${E}`}static T_HTML(){return"#00000000"}static CMYK_RGB([I,N,K,L]){return["RGB",1-Math.min(1,I+L),1-Math.min(1,K+L),1-Math.min(1,N+L)]}static CMYK_HTML(I){const N=this.CMYK_RGB(I).slice(1);return this.RGB_HTML(N)}static RGB_CMYK([I,N,K]){const L=1-I,m=1-N,E=1-K,F=Math.min(L,m,E);return["CMYK",L,m,E,F]}}i.ColorConverters=g},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaLayer=void 0;var g=O(20);class p{static setupStorage(N,K,L,m,E){const F=m.getValue(K,{value:null});switch(L.name){case"textarea":if(F.value!==null&&(N.textContent=F.value),E==="print")break;N.addEventListener("input",x=>{m.setValue(K,{value:x.target.value})});break;case"input":if(L.attributes.type==="radio"||L.attributes.type==="checkbox"){if(F.value===L.attributes.xfaOn?N.setAttribute("checked",!0):F.value===L.attributes.xfaOff&&N.removeAttribute("checked"),E==="print")break;N.addEventListener("change",x=>{m.setValue(K,{value:x.target.checked?x.target.getAttribute("xfaOn"):x.target.getAttribute("xfaOff")})})}else{if(F.value!==null&&N.setAttribute("value",F.value),E==="print")break;N.addEventListener("input",x=>{m.setValue(K,{value:x.target.value})})}break;case"select":if(F.value!==null)for(const x of L.children)x.attributes.value===F.value&&(x.attributes.selected=!0);N.addEventListener("input",x=>{const v=x.target.options,l=v.selectedIndex===-1?"":v[v.selectedIndex].value;m.setValue(K,{value:l})});break}}static setAttributes({html:N,element:K,storage:L=null,intent:m,linkService:E}){const{attributes:F}=K,x=N instanceof HTMLAnchorElement;F.type==="radio"&&(F.name=`${F.name}-${m}`);for(const[v,l]of Object.entries(F))if(l!=null)switch(v){case"class":l.length&&N.setAttribute(v,l.join(" "));break;case"dataId":break;case"id":N.setAttribute("data-element-id",l);break;case"style":Object.assign(N.style,l);break;case"textContent":N.textContent=l;break;default:(!x||v!=="href"&&v!=="newWindow")&&N.setAttribute(v,l)}x&&E.addLinkAttributes(N,F.href,F.newWindow),L&&F.dataId&&this.setupStorage(N,F.dataId,K,L)}static render(N){var t;const K=N.annotationStorage,L=N.linkService,m=N.xfaHtml,E=N.intent||"display",F=document.createElement(m.name);m.attributes&&this.setAttributes({html:F,element:m,intent:E,linkService:L});const x=[[m,-1,F]],v=N.div;if(v.append(F),N.viewport){const n=`matrix(${N.viewport.transform.join(",")})`;v.style.transform=n}E!=="richText"&&v.setAttribute("class","xfaLayer xfaFont");const l=[];for(;x.length>0;){const[n,a,_]=x.at(-1);if(a+1===n.children.length){x.pop();continue}const b=n.children[++x.at(-1)[1]];if(b===null)continue;const{name:o}=b;if(o==="#text"){const s=document.createTextNode(b.value);l.push(s),_.append(s);continue}let e;if((t=b==null?void 0:b.attributes)!=null&&t.xmlns?e=document.createElementNS(b.attributes.xmlns,o):e=document.createElement(o),_.append(e),b.attributes&&this.setAttributes({html:e,element:b,storage:K,intent:E,linkService:L}),b.children&&b.children.length>0)x.push([b,-1,e]);else if(b.value){const s=document.createTextNode(b.value);g.XfaText.shouldBuildText(o)&&l.push(s),e.append(s)}}for(const n of v.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))n.setAttribute("readOnly",!0);return{textDivs:l}}static update(N){const K=`matrix(${N.viewport.transform.join(",")})`;N.div.style.transform=K,N.div.hidden=!1}}i.XfaLayer=p},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextLayerRenderTask=void 0,i.renderTextLayer=_;var g=O(1),p=O(8);const I=1e5,N=30,K=.8,L=new Map,m=/^\s+$/g;function E(b,o){const e=L.get(b);if(e)return e;o.save(),o.font=`${N}px ${b}`;const s=o.measureText("");let d=s.fontBoundingBoxAscent,C=Math.abs(s.fontBoundingBoxDescent);if(d){o.restore();const f=d/(d+C);return L.set(b,f),f}o.strokeStyle="red",o.clearRect(0,0,N,N),o.strokeText("g",0,0);let y=o.getImageData(0,0,N,N).data;C=0;for(let f=y.length-1-3;f>=0;f-=4)if(y[f]>0){C=Math.ceil(f/4/N);break}o.clearRect(0,0,N,N),o.strokeText("A",0,N),y=o.getImageData(0,0,N,N).data,d=0;for(let f=0,T=y.length;f<T;f+=4)if(y[f]>0){d=N-Math.floor(f/4/N);break}if(o.restore(),d){const f=d/(d+C);return L.set(b,f),f}return L.set(b,K),K}function F(b,o,e,s){const d=document.createElement("span"),C=b._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:o.str!=="",hasEOL:o.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:o.str!=="",hasEOL:o.hasEOL,fontSize:0};b._textDivs.push(d);const y=g.Util.transform(b._viewport.transform,o.transform);let f=Math.atan2(y[1],y[0]);const T=e[o.fontName];T.vertical&&(f+=Math.PI/2);const Z=Math.hypot(y[2],y[3]),st=Z*E(T.fontFamily,s);let J,$;f===0?(J=y[4],$=y[5]-st):(J=y[4]+st*Math.sin(f),$=y[5]-st*Math.cos(f)),d.style.left=`${J}px`,d.style.top=`${$}px`,d.style.fontSize=`${Z}px`,d.style.fontFamily=T.fontFamily,C.fontSize=Z,d.setAttribute("role","presentation"),d.textContent=o.str,d.dir=o.dir,b._fontInspectorEnabled&&(d.dataset.fontName=o.fontName),f!==0&&(C.angle=f*(180/Math.PI));let U=!1;if(o.str.length>1||b._enhanceTextSelection&&m.test(o.str))U=!0;else if(o.str!==" "&&o.transform[0]!==o.transform[3]){const G=Math.abs(o.transform[0]),z=Math.abs(o.transform[3]);G!==z&&Math.max(G,z)/Math.min(G,z)>1.5&&(U=!0)}if(U&&(T.vertical?C.canvasWidth=o.height*b._viewport.scale:C.canvasWidth=o.width*b._viewport.scale),b._textDivProperties.set(d,C),b._textContentStream&&b._layoutText(d),b._enhanceTextSelection&&C.hasText){let G=1,z=0;f!==0&&(G=Math.cos(f),z=Math.sin(f));const et=(T.vertical?o.height:o.width)*b._viewport.scale,ot=Z;let _t,B;f!==0?(_t=[G,z,-z,G,J,$],B=g.Util.getAxialAlignedBoundingBox([0,0,et,ot],_t)):B=[J,$,J+et,$+ot],b._bounds.push({left:B[0],top:B[1],right:B[2],bottom:B[3],div:d,size:[et,ot],m:_t})}}function x(b){if(b._canceled)return;const o=b._textDivs,e=b._capability,s=o.length;if(s>I){b._renderingDone=!0,e.resolve();return}if(!b._textContentStream)for(let d=0;d<s;d++)b._layoutText(o[d]);b._renderingDone=!0,e.resolve()}function v(b,o,e){let s=0;for(let d=0;d<e;d++){const C=b[o++];C>0&&(s=s?Math.min(C,s):C)}return s}function l(b){const o=b._bounds,e=b._viewport,s=t(e.width,e.height,o);for(let d=0;d<s.length;d++){const C=o[d].div,y=b._textDivProperties.get(C);if(y.angle===0){y.paddingLeft=o[d].left-s[d].left,y.paddingTop=o[d].top-s[d].top,y.paddingRight=s[d].right-o[d].right,y.paddingBottom=s[d].bottom-o[d].bottom,b._textDivProperties.set(C,y);continue}const f=s[d],T=o[d],Z=T.m,st=Z[0],J=Z[1],$=[[0,0],[0,T.size[1]],[T.size[0],0],T.size],U=new Float64Array(64);for(let z=0,et=$.length;z<et;z++){const ot=g.Util.applyTransform($[z],Z);U[z+0]=st&&(f.left-ot[0])/st,U[z+4]=J&&(f.top-ot[1])/J,U[z+8]=st&&(f.right-ot[0])/st,U[z+12]=J&&(f.bottom-ot[1])/J,U[z+16]=J&&(f.left-ot[0])/-J,U[z+20]=st&&(f.top-ot[1])/st,U[z+24]=J&&(f.right-ot[0])/-J,U[z+28]=st&&(f.bottom-ot[1])/st,U[z+32]=st&&(f.left-ot[0])/-st,U[z+36]=J&&(f.top-ot[1])/-J,U[z+40]=st&&(f.right-ot[0])/-st,U[z+44]=J&&(f.bottom-ot[1])/-J,U[z+48]=J&&(f.left-ot[0])/J,U[z+52]=st&&(f.top-ot[1])/-st,U[z+56]=J&&(f.right-ot[0])/J,U[z+60]=st&&(f.bottom-ot[1])/-st}const G=1+Math.min(Math.abs(st),Math.abs(J));y.paddingLeft=v(U,32,16)/G,y.paddingTop=v(U,48,16)/G,y.paddingRight=v(U,0,16)/G,y.paddingBottom=v(U,16,16)/G,b._textDivProperties.set(C,y)}}function t(b,o,e){const s=e.map(function(C,y){return{x1:C.left,y1:C.top,x2:C.right,y2:C.bottom,index:y,x1New:void 0,x2New:void 0}});n(b,s);const d=new Array(e.length);for(const C of s){const y=C.index;d[y]={left:C.x1New,top:0,right:C.x2New,bottom:0}}e.map(function(C,y){const f=d[y],T=s[y];T.x1=C.top,T.y1=b-f.right,T.x2=C.bottom,T.y2=b-f.left,T.index=y,T.x1New=void 0,T.x2New=void 0}),n(o,s);for(const C of s){const y=C.index;d[y].top=C.x1New,d[y].bottom=C.x2New}return d}function n(b,o){o.sort(function(d,C){return d.x1-C.x1||d.index-C.index});const s=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(const d of o){let C=0;for(;C<s.length&&s[C].end<=d.y1;)C++;let y=s.length-1;for(;y>=0&&s[y].start>=d.y2;)y--;let f,T,Z,st,J=-1/0;for(Z=C;Z<=y;Z++){f=s[Z],T=f.boundary;let G;T.x2>d.x1?G=T.index>d.index?T.x1New:d.x1:T.x2New===void 0?G=(T.x2+d.x1)/2:G=T.x2New,G>J&&(J=G)}for(d.x1New=J,Z=C;Z<=y;Z++)f=s[Z],T=f.boundary,T.x2New===void 0?T.x2>d.x1?T.index>d.index&&(T.x2New=T.x2):T.x2New=J:T.x2New>J&&(T.x2New=Math.max(J,T.x2));const $=[];let U=null;for(Z=C;Z<=y;Z++){f=s[Z],T=f.boundary;const G=T.x2>d.x2?T:d;U===G?$.at(-1).end=f.end:($.push({start:f.start,end:f.end,boundary:G}),U=G)}for(s[C].start<d.y1&&($[0].start=d.y1,$.unshift({start:s[C].start,end:d.y1,boundary:s[C].boundary})),d.y2<s[y].end&&($.at(-1).end=d.y2,$.push({start:d.y2,end:s[y].end,boundary:s[y].boundary})),Z=C;Z<=y;Z++){if(f=s[Z],T=f.boundary,T.x2New!==void 0)continue;let G=!1;for(st=C-1;!G&&st>=0&&s[st].start>=T.y1;st--)G=s[st].boundary===T;for(st=y+1;!G&&st<s.length&&s[st].end<=T.y2;st++)G=s[st].boundary===T;for(st=0;!G&&st<$.length;st++)G=$[st].boundary===T;G||(T.x2New=J)}Array.prototype.splice.apply(s,[C,y-C+1,...$])}for(const d of s){const C=d.boundary;C.x2New===void 0&&(C.x2New=Math.max(b,C.x2))}}class a{constructor({textContent:o,textContentStream:e,container:s,viewport:d,textDivs:C,textContentItemsStr:y,enhanceTextSelection:f}){var T;f&&(0,p.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=o,this._textContentStream=e,this._container=s,this._document=s.ownerDocument,this._viewport=d,this._textDivs=C||[],this._textContentItemsStr=y||[],this._enhanceTextSelection=!!f,this._fontInspectorEnabled=!!((T=globalThis.FontInspector)!=null&&T.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,g.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new g.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(o,e){for(let s=0,d=o.length;s<d;s++){if(o[s].str===void 0){if(o[s].type==="beginMarkedContentProps"||o[s].type==="beginMarkedContent"){const C=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),o[s].id!==null&&this._container.setAttribute("id",`${o[s].id}`),C.append(this._container)}else o[s].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(o[s].str),F(this,o[s],e,this._layoutTextCtx)}}_layoutText(o){const e=this._textDivProperties.get(o);let s="";if(e.canvasWidth!==0&&e.hasText){const{fontFamily:d}=o.style,{fontSize:C}=e;(C!==this._layoutTextLastFontSize||d!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${C*this._devicePixelRatio}px ${d}`,this._layoutTextLastFontSize=C,this._layoutTextLastFontFamily=d);const{width:y}=this._layoutTextCtx.measureText(o.textContent);if(y>0){const f=this._devicePixelRatio*e.canvasWidth/y;this._enhanceTextSelection&&(e.scale=f),s=`scaleX(${f})`}}if(e.angle!==0&&(s=`rotate(${e.angle}deg) ${s}`),s.length>0&&(this._enhanceTextSelection&&(e.originalTransform=s),o.style.transform=s),e.hasText&&this._container.append(o),e.hasEOL){const d=document.createElement("br");d.setAttribute("role","presentation"),this._container.append(d)}}_render(o=0){const e=(0,g.createPromiseCapability)();let s=Object.create(null);const d=this._document.createElement("canvas");if(d.height=d.width=N,this._layoutTextCtx=d.getContext("2d",{alpha:!1}),this._textContent){const C=this._textContent.items,y=this._textContent.styles;this._processItems(C,y),e.resolve()}else if(this._textContentStream){const C=()=>{this._reader.read().then(({value:y,done:f})=>{if(f){e.resolve();return}Object.assign(s,y.styles),this._processItems(y.items,s),C()},e.reject)};this._reader=this._textContentStream.getReader(),C()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');e.promise.then(()=>{s=null,o?this._renderTimer=setTimeout(()=>{x(this),this._renderTimer=null},o):x(this)},this._capability.reject)}expandTextDivs(o=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(l(this),this._bounds=null);const e=[],s=[];for(let d=0,C=this._textDivs.length;d<C;d++){const y=this._textDivs[d],f=this._textDivProperties.get(y);f.hasText&&(o?(e.length=0,s.length=0,f.originalTransform&&e.push(f.originalTransform),f.paddingTop>0?(s.push(`${f.paddingTop}px`),e.push(`translateY(${-f.paddingTop}px)`)):s.push(0),f.paddingRight>0?s.push(`${f.paddingRight/f.scale}px`):s.push(0),f.paddingBottom>0?s.push(`${f.paddingBottom}px`):s.push(0),f.paddingLeft>0?(s.push(`${f.paddingLeft/f.scale}px`),e.push(`translateX(${-f.paddingLeft/f.scale}px)`)):s.push(0),y.style.padding=s.join(" "),e.length&&(y.style.transform=e.join(" "))):(y.style.padding=null,y.style.transform=f.originalTransform))}}}i.TextLayerRenderTask=a;function _(b){const o=new a({textContent:b.textContent,textContentStream:b.textContentStream,container:b.container,viewport:b.viewport,textDivs:b.textDivs,textContentItemsStr:b.textContentItemsStr,enhanceTextSelection:b.enhanceTextSelection});return o._render(b.timeout),o}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SVGGraphics=void 0;var g=O(8),p=O(1),I=O(3);let N=class{constructor(){(0,p.unreachable)("Not implemented: SVGGraphics")}};i.SVGGraphics=N;{let t=function(e){let s=[];const d=[];for(const C of e){if(C.fn==="save"){s.push({fnId:92,fn:"group",items:[]}),d.push(s),s=s.at(-1).items;continue}C.fn==="restore"?s=d.pop():s.push(C)}return s},n=function(e){if(Number.isInteger(e))return e.toString();const s=e.toFixed(10);let d=s.length-1;if(s[d]!=="0")return s;do d--;while(s[d]==="0");return s.substring(0,s[d]==="."?d:d+1)},a=function(e){if(e[4]===0&&e[5]===0){if(e[1]===0&&e[2]===0)return e[0]===1&&e[3]===1?"":`scale(${n(e[0])} ${n(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2]){const s=Math.acos(e[0])*180/Math.PI;return`rotate(${n(s)})`}}else if(e[0]===1&&e[1]===0&&e[2]===0&&e[3]===1)return`translate(${n(e[4])} ${n(e[5])})`;return`matrix(${n(e[0])} ${n(e[1])} ${n(e[2])} ${n(e[3])} ${n(e[4])} ${n(e[5])})`};const K={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},L="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/1999/xlink",E=["butt","round","square"],F=["miter","round","bevel"],x=function(e,s="",d=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!d)return URL.createObjectURL(new Blob([e],{type:s}));const C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let y=`data:${s};base64,`;for(let f=0,T=e.length;f<T;f+=3){const Z=e[f]&255,st=e[f+1]&255,J=e[f+2]&255,$=Z>>2,U=(Z&3)<<4|st>>4,G=f+1<T?(st&15)<<2|J>>6:64,z=f+2<T?J&63:64;y+=C[$]+C[U]+C[G]+C[z]}return y},v=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),s=12,d=new Int32Array(256);for(let J=0;J<256;J++){let $=J;for(let U=0;U<8;U++)$&1?$=3988292384^$>>1&2147483647:$=$>>1&2147483647;d[J]=$}function C(J,$,U){let G=-1;for(let z=$;z<U;z++){const et=(G^J[z])&255,ot=d[et];G=G>>>8^ot}return G^-1}function y(J,$,U,G){let z=G;const et=$.length;U[z]=et>>24&255,U[z+1]=et>>16&255,U[z+2]=et>>8&255,U[z+3]=et&255,z+=4,U[z]=J.charCodeAt(0)&255,U[z+1]=J.charCodeAt(1)&255,U[z+2]=J.charCodeAt(2)&255,U[z+3]=J.charCodeAt(3)&255,z+=4,U.set($,z),z+=$.length;const ot=C(U,G+4,z);U[z]=ot>>24&255,U[z+1]=ot>>16&255,U[z+2]=ot>>8&255,U[z+3]=ot&255}function f(J,$,U){let G=1,z=0;for(let et=$;et<U;++et)G=(G+(J[et]&255))%65521,z=(z+G)%65521;return z<<16|G}function T(J){if(!I.isNodeJS)return Z(J);try{let $;parseInt(process.versions.node)>=8?$=J:$=Buffer.from(J);const U=require$$5.deflateSync($,{level:9});return U instanceof Uint8Array?U:new Uint8Array(U)}catch($){(0,p.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+$)}return Z(J)}function Z(J){let $=J.length;const U=65535,G=Math.ceil($/U),z=new Uint8Array(2+$+G*5+4);let et=0;z[et++]=120,z[et++]=156;let ot=0;for(;$>U;)z[et++]=0,z[et++]=255,z[et++]=255,z[et++]=0,z[et++]=0,z.set(J.subarray(ot,ot+U),et),et+=U,ot+=U,$-=U;z[et++]=1,z[et++]=$&255,z[et++]=$>>8&255,z[et++]=~$&65535&255,z[et++]=(~$&65535)>>8&255,z.set(J.subarray(ot),et),et+=J.length-ot;const _t=f(J,0,J.length);return z[et++]=_t>>24&255,z[et++]=_t>>16&255,z[et++]=_t>>8&255,z[et++]=_t&255,z}function st(J,$,U,G){const z=J.width,et=J.height;let ot,_t,B;const h=J.data;switch($){case p.ImageKind.GRAYSCALE_1BPP:_t=0,ot=1,B=z+7>>3;break;case p.ImageKind.RGB_24BPP:_t=2,ot=8,B=z*3;break;case p.ImageKind.RGBA_32BPP:_t=6,ot=8,B=z*4;break;default:throw new Error("invalid format")}const c=new Uint8Array((1+B)*et);let w=0,R=0;for(let u=0;u<et;++u)c[w++]=0,c.set(h.subarray(R,R+B),w),R+=B,w+=B;if($===p.ImageKind.GRAYSCALE_1BPP&&G){w=0;for(let u=0;u<et;u++){w++;for(let A=0;A<B;A++)c[w++]^=255}}const D=new Uint8Array([z>>24&255,z>>16&255,z>>8&255,z&255,et>>24&255,et>>16&255,et>>8&255,et&255,ot,_t,0,0,0]),j=T(c),X=e.length+s*3+D.length+j.length,V=new Uint8Array(X);let r=0;return V.set(e,r),r+=e.length,y("IHDR",D,V,r),r+=s+D.length,y("IDATA",j,V,r),r+=s+j.length,y("IEND",new Uint8Array(0),V,r),x(V,"image/png",U)}return function($,U,G){const z=$.kind===void 0?p.ImageKind.GRAYSCALE_1BPP:$.kind;return st($,z,U,G)}}();class l{constructor(){this.fontSizeScale=1,this.fontWeight=K.fontWeight,this.fontSize=0,this.textMatrix=p.IDENTITY_MATRIX,this.fontMatrix=p.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=p.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=K.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(s,d){this.x=s,this.y=d}}let _=0,b=0,o=0;i.SVGGraphics=N=class{constructor(e,s,d=!1){(0,g.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new g.DOMSVGFactory,this.current=new l,this.transformMatrix=p.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=s,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!d,this._operatorIdMapping=[];for(const C in p.OPS)this._operatorIdMapping[p.OPS[C]]=C}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const s=e.fnArray,d=e.argsArray;for(let C=0,y=s.length;C<y;C++)if(s[C]===p.OPS.dependency)for(const f of d[C]){const T=f.startsWith("g_")?this.commonObjs:this.objs,Z=new Promise(st=>{T.get(f,st)});this.current.dependencies.push(Z)}return Promise.all(this.current.dependencies)}transform(e,s,d,C,y,f){const T=[e,s,d,C,y,f];this.transformMatrix=p.Util.transform(this.transformMatrix,T),this.tgrp=null}getSVG(e,s){this.viewport=s;const d=this._initialize(s);return this.loadDependencies(e).then(()=>(this.transformMatrix=p.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),d))}convertOpList(e){const s=this._operatorIdMapping,d=e.argsArray,C=e.fnArray,y=[];for(let f=0,T=C.length;f<T;f++){const Z=C[f];y.push({fnId:Z,fn:s[Z],args:d[f]})}return t(y)}executeOpTree(e){for(const s of e){const d=s.fn,C=s.fnId,y=s.args;switch(C|0){case p.OPS.beginText:this.beginText();break;case p.OPS.dependency:break;case p.OPS.setLeading:this.setLeading(y);break;case p.OPS.setLeadingMoveText:this.setLeadingMoveText(y[0],y[1]);break;case p.OPS.setFont:this.setFont(y);break;case p.OPS.showText:this.showText(y[0]);break;case p.OPS.showSpacedText:this.showText(y[0]);break;case p.OPS.endText:this.endText();break;case p.OPS.moveText:this.moveText(y[0],y[1]);break;case p.OPS.setCharSpacing:this.setCharSpacing(y[0]);break;case p.OPS.setWordSpacing:this.setWordSpacing(y[0]);break;case p.OPS.setHScale:this.setHScale(y[0]);break;case p.OPS.setTextMatrix:this.setTextMatrix(y[0],y[1],y[2],y[3],y[4],y[5]);break;case p.OPS.setTextRise:this.setTextRise(y[0]);break;case p.OPS.setTextRenderingMode:this.setTextRenderingMode(y[0]);break;case p.OPS.setLineWidth:this.setLineWidth(y[0]);break;case p.OPS.setLineJoin:this.setLineJoin(y[0]);break;case p.OPS.setLineCap:this.setLineCap(y[0]);break;case p.OPS.setMiterLimit:this.setMiterLimit(y[0]);break;case p.OPS.setFillRGBColor:this.setFillRGBColor(y[0],y[1],y[2]);break;case p.OPS.setStrokeRGBColor:this.setStrokeRGBColor(y[0],y[1],y[2]);break;case p.OPS.setStrokeColorN:this.setStrokeColorN(y);break;case p.OPS.setFillColorN:this.setFillColorN(y);break;case p.OPS.shadingFill:this.shadingFill(y[0]);break;case p.OPS.setDash:this.setDash(y[0],y[1]);break;case p.OPS.setRenderingIntent:this.setRenderingIntent(y[0]);break;case p.OPS.setFlatness:this.setFlatness(y[0]);break;case p.OPS.setGState:this.setGState(y[0]);break;case p.OPS.fill:this.fill();break;case p.OPS.eoFill:this.eoFill();break;case p.OPS.stroke:this.stroke();break;case p.OPS.fillStroke:this.fillStroke();break;case p.OPS.eoFillStroke:this.eoFillStroke();break;case p.OPS.clip:this.clip("nonzero");break;case p.OPS.eoClip:this.clip("evenodd");break;case p.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case p.OPS.paintImageXObject:this.paintImageXObject(y[0]);break;case p.OPS.paintInlineImageXObject:this.paintInlineImageXObject(y[0]);break;case p.OPS.paintImageMaskXObject:this.paintImageMaskXObject(y[0]);break;case p.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(y[0],y[1]);break;case p.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case p.OPS.closePath:this.closePath();break;case p.OPS.closeStroke:this.closeStroke();break;case p.OPS.closeFillStroke:this.closeFillStroke();break;case p.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case p.OPS.nextLine:this.nextLine();break;case p.OPS.transform:this.transform(y[0],y[1],y[2],y[3],y[4],y[5]);break;case p.OPS.constructPath:this.constructPath(y[0],y[1]);break;case p.OPS.endPath:this.endPath();break;case 92:this.group(s.items);break;default:(0,p.warn)(`Unimplemented operator ${d}`);break}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,s,d,C,y,f){const T=this.current;T.textMatrix=T.lineMatrix=[e,s,d,C,y,f],T.textMatrixScale=Math.hypot(e,s),T.x=T.lineX=0,T.y=T.lineY=0,T.xcoords=[],T.ycoords=[],T.tspan=this.svgFactory.createElement("svg:tspan"),T.tspan.setAttributeNS(null,"font-family",T.fontFamily),T.tspan.setAttributeNS(null,"font-size",`${n(T.fontSize)}px`),T.tspan.setAttributeNS(null,"y",n(-T.y)),T.txtElement=this.svgFactory.createElement("svg:text"),T.txtElement.append(T.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=p.IDENTITY_MATRIX,e.lineMatrix=p.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,s){const d=this.current;d.x=d.lineX+=e,d.y=d.lineY+=s,d.xcoords=[],d.ycoords=[],d.tspan=this.svgFactory.createElement("svg:tspan"),d.tspan.setAttributeNS(null,"font-family",d.fontFamily),d.tspan.setAttributeNS(null,"font-size",`${n(d.fontSize)}px`),d.tspan.setAttributeNS(null,"y",n(-d.y))}showText(e){const s=this.current,d=s.font,C=s.fontSize;if(C===0)return;const y=s.fontSizeScale,f=s.charSpacing,T=s.wordSpacing,Z=s.fontDirection,st=s.textHScale*Z,J=d.vertical,$=J?1:-1,U=d.defaultVMetrics,G=C*s.fontMatrix[0];let z=0;for(const _t of e){if(_t===null){z+=Z*T;continue}else if(typeof _t=="number"){z+=$*_t*C/1e3;continue}const B=(_t.isSpace?T:0)+f,h=_t.fontChar;let c,w,R=_t.width;if(J){let j;const X=_t.vmetric||U;j=_t.vmetric?X[1]:R*.5,j=-j*G;const V=X[2]*G;R=X?-X[0]:R,c=j/y,w=(z+V)/y}else c=z/y,w=0;(_t.isInFont||d.missingFile)&&(s.xcoords.push(s.x+c),J&&s.ycoords.push(-s.y+w),s.tspan.textContent+=h);let D;J?D=R*G-B*Z:D=R*G+B*Z,z+=D}s.tspan.setAttributeNS(null,"x",s.xcoords.map(n).join(" ")),J?s.tspan.setAttributeNS(null,"y",s.ycoords.map(n).join(" ")):s.tspan.setAttributeNS(null,"y",n(-s.y)),J?s.y-=z:s.x+=z*st,s.tspan.setAttributeNS(null,"font-family",s.fontFamily),s.tspan.setAttributeNS(null,"font-size",`${n(s.fontSize)}px`),s.fontStyle!==K.fontStyle&&s.tspan.setAttributeNS(null,"font-style",s.fontStyle),s.fontWeight!==K.fontWeight&&s.tspan.setAttributeNS(null,"font-weight",s.fontWeight);const et=s.textRenderingMode&p.TextRenderingMode.FILL_STROKE_MASK;if(et===p.TextRenderingMode.FILL||et===p.TextRenderingMode.FILL_STROKE?(s.fillColor!==K.fillColor&&s.tspan.setAttributeNS(null,"fill",s.fillColor),s.fillAlpha<1&&s.tspan.setAttributeNS(null,"fill-opacity",s.fillAlpha)):s.textRenderingMode===p.TextRenderingMode.ADD_TO_PATH?s.tspan.setAttributeNS(null,"fill","transparent"):s.tspan.setAttributeNS(null,"fill","none"),et===p.TextRenderingMode.STROKE||et===p.TextRenderingMode.FILL_STROKE){const _t=1/(s.textMatrixScale||1);this._setStrokeAttributes(s.tspan,_t)}let ot=s.textMatrix;s.textRise!==0&&(ot=ot.slice(),ot[5]+=s.textRise),s.txtElement.setAttributeNS(null,"transform",`${a(ot)} scale(${n(st)}, -1)`),s.txtElement.setAttributeNS(L,"xml:space","preserve"),s.txtElement.append(s.tspan),s.txtgrp.append(s.txtElement),this._ensureTransformGroup().append(s.txtElement)}setLeadingMoveText(e,s){this.setLeading(-s),this.moveText(e,s)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const s=x(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${s}); }
`}setFont(e){const s=this.current,d=this.commonObjs.get(e[0]);let C=e[1];s.font=d,this.embedFonts&&!d.missingFile&&!this.embeddedFonts[d.loadedName]&&(this.addFontStyle(d),this.embeddedFonts[d.loadedName]=d),s.fontMatrix=d.fontMatrix||p.FONT_IDENTITY_MATRIX;let y="normal";d.black?y="900":d.bold&&(y="bold");const f=d.italic?"italic":"normal";C<0?(C=-C,s.fontDirection=-1):s.fontDirection=1,s.fontSize=C,s.fontFamily=d.loadedName,s.fontWeight=y,s.fontStyle=f,s.tspan=this.svgFactory.createElement("svg:tspan"),s.tspan.setAttributeNS(null,"y",n(-s.y)),s.xcoords=[],s.ycoords=[]}endText(){var s;const e=this.current;e.textRenderingMode&p.TextRenderingMode.ADD_TO_PATH_FLAG&&((s=e.txtElement)!=null&&s.hasChildNodes())&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=E[e]}setLineJoin(e){this.current.lineJoin=F[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,s,d){this.current.strokeColor=p.Util.makeHexColor(e,s,d)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,s,d){this.current.fillColor=p.Util.makeHexColor(e,s,d),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const s=this.viewport.width,d=this.viewport.height,C=p.Util.inverseTransform(this.transformMatrix),y=p.Util.applyTransform([0,0],C),f=p.Util.applyTransform([0,d],C),T=p.Util.applyTransform([s,0],C),Z=p.Util.applyTransform([s,d],C),st=Math.min(y[0],f[0],T[0],Z[0]),J=Math.min(y[1],f[1],T[1],Z[1]),$=Math.max(y[0],f[0],T[0],Z[0]),U=Math.max(y[1],f[1],T[1],Z[1]),G=this.svgFactory.createElement("svg:rect");G.setAttributeNS(null,"x",st),G.setAttributeNS(null,"y",J),G.setAttributeNS(null,"width",$-st),G.setAttributeNS(null,"height",U-J),G.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&G.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(G)}_makeColorN_Pattern(e){return e[0]==="TilingPattern"?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const s=e[1],d=e[2],C=e[3]||p.IDENTITY_MATRIX,[y,f,T,Z]=e[4],st=e[5],J=e[6],$=e[7],U=`shading${o++}`,[G,z,et,ot]=p.Util.normalizeRect([...p.Util.applyTransform([y,f],C),...p.Util.applyTransform([T,Z],C)]),[_t,B]=p.Util.singularValueDecompose2dScale(C),h=st*_t,c=J*B,w=this.svgFactory.createElement("svg:pattern");w.setAttributeNS(null,"id",U),w.setAttributeNS(null,"patternUnits","userSpaceOnUse"),w.setAttributeNS(null,"width",h),w.setAttributeNS(null,"height",c),w.setAttributeNS(null,"x",`${G}`),w.setAttributeNS(null,"y",`${z}`);const R=this.svg,D=this.transformMatrix,j=this.current.fillColor,X=this.current.strokeColor,V=this.svgFactory.create(et-G,ot-z);if(this.svg=V,this.transformMatrix=C,$===2){const r=p.Util.makeHexColor(...s);this.current.fillColor=r,this.current.strokeColor=r}return this.executeOpTree(this.convertOpList(d)),this.svg=R,this.transformMatrix=D,this.current.fillColor=j,this.current.strokeColor=X,w.append(V.childNodes[0]),this.defs.append(w),`url(#${U})`}_makeShadingPattern(e){switch(typeof e=="string"&&(e=this.objs.get(e)),e[0]){case"RadialAxial":const s=`shading${o++}`,d=e[3];let C;switch(e[1]){case"axial":const y=e[4],f=e[5];C=this.svgFactory.createElement("svg:linearGradient"),C.setAttributeNS(null,"id",s),C.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),C.setAttributeNS(null,"x1",y[0]),C.setAttributeNS(null,"y1",y[1]),C.setAttributeNS(null,"x2",f[0]),C.setAttributeNS(null,"y2",f[1]);break;case"radial":const T=e[4],Z=e[5],st=e[6],J=e[7];C=this.svgFactory.createElement("svg:radialGradient"),C.setAttributeNS(null,"id",s),C.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),C.setAttributeNS(null,"cx",Z[0]),C.setAttributeNS(null,"cy",Z[1]),C.setAttributeNS(null,"r",J),C.setAttributeNS(null,"fx",T[0]),C.setAttributeNS(null,"fy",T[1]),C.setAttributeNS(null,"fr",st);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(const y of d){const f=this.svgFactory.createElement("svg:stop");f.setAttributeNS(null,"offset",y[0]),f.setAttributeNS(null,"stop-color",y[1]),C.append(f)}return this.defs.append(C),`url(#${s})`;case"Mesh":return(0,p.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,s){this.current.dashArray=e,this.current.dashPhase=s}constructPath(e,s){const d=this.current;let C=d.x,y=d.y,f=[],T=0;for(const Z of e)switch(Z|0){case p.OPS.rectangle:C=s[T++],y=s[T++];const st=s[T++],J=s[T++],$=C+st,U=y+J;f.push("M",n(C),n(y),"L",n($),n(y),"L",n($),n(U),"L",n(C),n(U),"Z");break;case p.OPS.moveTo:C=s[T++],y=s[T++],f.push("M",n(C),n(y));break;case p.OPS.lineTo:C=s[T++],y=s[T++],f.push("L",n(C),n(y));break;case p.OPS.curveTo:C=s[T+4],y=s[T+5],f.push("C",n(s[T]),n(s[T+1]),n(s[T+2]),n(s[T+3]),n(C),n(y)),T+=6;break;case p.OPS.curveTo2:f.push("C",n(C),n(y),n(s[T]),n(s[T+1]),n(s[T+2]),n(s[T+3])),C=s[T+2],y=s[T+3],T+=4;break;case p.OPS.curveTo3:C=s[T+2],y=s[T+3],f.push("C",n(s[T]),n(s[T+1]),n(C),n(y),n(C),n(y)),T+=4;break;case p.OPS.closePath:f.push("Z");break}f=f.join(" "),d.path&&e.length>0&&e[0]!==p.OPS.rectangle&&e[0]!==p.OPS.moveTo?f=d.path.getAttributeNS(null,"d")+f:(d.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(d.path)),d.path.setAttributeNS(null,"d",f),d.path.setAttributeNS(null,"fill","none"),d.element=d.path,d.setCurrentPoint(C,y)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element){this.pendingClip=null;return}const s=`clippath${_++}`,d=this.svgFactory.createElement("svg:clipPath");d.setAttributeNS(null,"id",s),d.setAttributeNS(null,"transform",a(this.transformMatrix));const C=e.element.cloneNode(!0);if(this.pendingClip==="evenodd"?C.setAttributeNS(null,"clip-rule","evenodd"):C.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,d.append(C),this.defs.append(d),e.activeClipUrl){e.clipGroup=null;for(const y of this.extraStack)y.clipGroup=null;d.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl=`url(#${s})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const s=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",s)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[s,d]of e)switch(s){case"LW":this.setLineWidth(d);break;case"LC":this.setLineCap(d);break;case"LJ":this.setLineJoin(d);break;case"ML":this.setMiterLimit(d);break;case"D":this.setDash(d[0],d[1]);break;case"RI":this.setRenderingIntent(d);break;case"FL":this.setFlatness(d);break;case"Font":this.setFont(d);break;case"CA":this.setStrokeAlpha(d);break;case"ca":this.setFillAlpha(d);break;default:(0,p.warn)(`Unimplemented graphic state operator ${s}`);break}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,s=1){const d=this.current;let C=d.dashArray;s!==1&&C.length>0&&(C=C.map(function(y){return s*y})),e.setAttributeNS(null,"stroke",d.strokeColor),e.setAttributeNS(null,"stroke-opacity",d.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",n(d.miterLimit)),e.setAttributeNS(null,"stroke-linecap",d.lineCap),e.setAttributeNS(null,"stroke-linejoin",d.lineJoin),e.setAttributeNS(null,"stroke-width",n(s*d.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",C.map(n).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",n(s*d.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(e)}paintImageXObject(e){const s=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);if(!s){(0,p.warn)(`Dependent image with object ID ${e} is not ready yet`);return}this.paintInlineImageXObject(s)}paintInlineImageXObject(e,s){const d=e.width,C=e.height,y=v(e,this.forceDataSchema,!!s),f=this.svgFactory.createElement("svg:rect");f.setAttributeNS(null,"x","0"),f.setAttributeNS(null,"y","0"),f.setAttributeNS(null,"width",n(d)),f.setAttributeNS(null,"height",n(C)),this.current.element=f,this.clip("nonzero");const T=this.svgFactory.createElement("svg:image");T.setAttributeNS(m,"xlink:href",y),T.setAttributeNS(null,"x","0"),T.setAttributeNS(null,"y",n(-C)),T.setAttributeNS(null,"width",n(d)+"px"),T.setAttributeNS(null,"height",n(C)+"px"),T.setAttributeNS(null,"transform",`scale(${n(1/d)} ${n(-1/C)})`),s?s.append(T):this._ensureTransformGroup().append(T)}paintImageMaskXObject(e){const s=this.current,d=e.width,C=e.height,y=s.fillColor;s.maskId=`mask${b++}`;const f=this.svgFactory.createElement("svg:mask");f.setAttributeNS(null,"id",s.maskId);const T=this.svgFactory.createElement("svg:rect");T.setAttributeNS(null,"x","0"),T.setAttributeNS(null,"y","0"),T.setAttributeNS(null,"width",n(d)),T.setAttributeNS(null,"height",n(C)),T.setAttributeNS(null,"fill",y),T.setAttributeNS(null,"mask",`url(#${s.maskId})`),this.defs.append(f),this._ensureTransformGroup().append(T),this.paintInlineImageXObject(e,f)}paintFormXObjectBegin(e,s){if(Array.isArray(e)&&e.length===6&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),s){const d=s[2]-s[0],C=s[3]-s[1],y=this.svgFactory.createElement("svg:rect");y.setAttributeNS(null,"x",s[0]),y.setAttributeNS(null,"y",s[1]),y.setAttributeNS(null,"width",n(d)),y.setAttributeNS(null,"height",n(C)),this.current.element=y,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const s=this.svgFactory.create(e.width,e.height),d=this.svgFactory.createElement("svg:defs");s.append(d),this.defs=d;const C=this.svgFactory.createElement("svg:g");return C.setAttributeNS(null,"transform",a(e.transform)),s.append(C),this.svg=C,s}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",a(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNodeStream=void 0;var g=O(1),p=O(33);const I=require$$5,N=require$$5,K=require$$5,L=require$$5,m=/^file:\/\/\/[a-zA-Z]:\//;function E(b){const o=L.parse(b);return o.protocol==="file:"||o.host?o:/^[a-z]:[/\\]/i.test(b)?L.parse(`file:///${b}`):(o.host||(o.protocol="file:"),o)}class F{constructor(o){this.source=o,this.url=E(o.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&o.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var o;return((o=this._fullRequestReader)==null?void 0:o._loaded)??0}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new a(this):new t(this),this._fullRequestReader}getRangeReader(o,e){if(e<=this._progressiveDataLength)return null;const s=this.isFsUrl?new _(this,o,e):new n(this,o,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(o){this._fullRequestReader&&this._fullRequestReader.cancel(o);for(const e of this._rangeRequestReaders.slice(0))e.cancel(o)}}i.PDFNodeStream=F;class x{constructor(o){this._url=o.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=o.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=(0,g.createPromiseCapability)(),this._headersCapability=(0,g.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const o=this._readableStream.read();return o===null?(this._readCapability=(0,g.createPromiseCapability)(),this.read()):(this._loaded+=o.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(o).buffer,done:!1})}cancel(o){if(!this._readableStream){this._error(o);return}this._readableStream.destroy(o)}_error(o){this._storedError=o,this._readCapability.resolve()}_setReadableStream(o){this._readableStream=o,o.on("readable",()=>{this._readCapability.resolve()}),o.on("end",()=>{o.destroy(),this._done=!0,this._readCapability.resolve()}),o.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new g.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class v{constructor(o){this._url=o.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,g.createPromiseCapability)();const e=o.source;this._isStreamingSupported=!e.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const o=this._readableStream.read();return o===null?(this._readCapability=(0,g.createPromiseCapability)(),this.read()):(this._loaded+=o.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(o).buffer,done:!1})}cancel(o){if(!this._readableStream){this._error(o);return}this._readableStream.destroy(o)}_error(o){this._storedError=o,this._readCapability.resolve()}_setReadableStream(o){this._readableStream=o,o.on("readable",()=>{this._readCapability.resolve()}),o.on("end",()=>{o.destroy(),this._done=!0,this._readCapability.resolve()}),o.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function l(b,o){return{protocol:b.protocol,auth:b.auth,host:b.hostname,port:b.port,path:b.path,method:"GET",headers:o}}class t extends x{constructor(o){super(o);const e=s=>{if(s.statusCode===404){const f=new g.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=f,this._headersCapability.reject(f);return}this._headersCapability.resolve(),this._setReadableStream(s);const d=f=>this._readableStream.headers[f.toLowerCase()],{allowRangeRequests:C,suggestedLength:y}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:o.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=C,this._contentLength=y||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(d)};this._request=null,this._url.protocol==="http:"?this._request=N.request(l(this._url,o.httpHeaders),e):this._request=K.request(l(this._url,o.httpHeaders),e),this._request.on("error",s=>{this._storedError=s,this._headersCapability.reject(s)}),this._request.end()}}class n extends v{constructor(o,e,s){super(o),this._httpHeaders={};for(const C in o.httpHeaders){const y=o.httpHeaders[C];typeof y>"u"||(this._httpHeaders[C]=y)}this._httpHeaders.Range=`bytes=${e}-${s-1}`;const d=C=>{if(C.statusCode===404){const y=new g.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=y;return}this._setReadableStream(C)};this._request=null,this._url.protocol==="http:"?this._request=N.request(l(this._url,this._httpHeaders),d):this._request=K.request(l(this._url,this._httpHeaders),d),this._request.on("error",C=>{this._storedError=C}),this._request.end()}}class a extends x{constructor(o){super(o);let e=decodeURIComponent(this._url.path);m.test(this._url.href)&&(e=e.replace(/^\//,"")),I.lstat(e,(s,d)=>{if(s){s.code==="ENOENT"&&(s=new g.MissingPDFException(`Missing PDF "${e}".`)),this._storedError=s,this._headersCapability.reject(s);return}this._contentLength=d.size,this._setReadableStream(I.createReadStream(e)),this._headersCapability.resolve()})}}class _ extends v{constructor(o,e,s){super(o);let d=decodeURIComponent(this._url.path);m.test(this._url.href)&&(d=d.replace(/^\//,"")),this._setReadableStream(I.createReadStream(d,{start:e,end:s-1}))}}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createResponseStatusError=L,i.extractFilenameFromHeader=K,i.validateRangeRequestCapabilities=N,i.validateResponseStatus=m;var g=O(1),p=O(34),I=O(8);function N({getResponseHeader:E,isHttp:F,rangeChunkSize:x,disableRange:v}){const l={allowRangeRequests:!1,suggestedLength:void 0},t=parseInt(E("Content-Length"),10);return!Number.isInteger(t)||(l.suggestedLength=t,t<=2*x)||v||!F||E("Accept-Ranges")!=="bytes"||(E("Content-Encoding")||"identity")!=="identity"||(l.allowRangeRequests=!0),l}function K(E){const F=E("Content-Disposition");if(F){let x=(0,p.getFilenameFromContentDispositionHeader)(F);if(x.includes("%"))try{x=decodeURIComponent(x)}catch{}if((0,I.isPdfFile)(x))return x}return null}function L(E,F){return E===404||E===0&&F.startsWith("file:")?new g.MissingPDFException('Missing PDF "'+F+'".'):new g.UnexpectedResponseException(`Unexpected server response (${E}) while retrieving PDF "${F}".`,E)}function m(E){return E===200||E===206}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getFilenameFromContentDispositionHeader=p;var g=O(1);function p(I){let N=!0,K=L("filename\\*","i").exec(I);if(K){K=K[1];let t=x(K);return t=unescape(t),t=v(t),t=l(t),E(t)}if(K=F(I),K){const t=l(K);return E(t)}if(K=L("filename","i").exec(I),K){K=K[1];let t=x(K);return t=l(t),E(t)}function L(t,n){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',n)}function m(t,n){if(t){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const a=new TextDecoder(t,{fatal:!0}),_=(0,g.stringToBytes)(n);n=a.decode(_),N=!1}catch{}}return n}function E(t){return N&&/[\x80-\xff]/.test(t)&&(t=m("utf-8",t),N&&(t=m("iso-8859-1",t))),t}function F(t){const n=[];let a;const _=L("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(a=_.exec(t))!==null;){let[,o,e,s]=a;if(o=parseInt(o,10),o in n){if(o===0)break;continue}n[o]=[e,s]}const b=[];for(let o=0;o<n.length&&o in n;++o){let[e,s]=n[o];s=x(s),e&&(s=unescape(s),o===0&&(s=v(s))),b.push(s)}return b.join("")}function x(t){if(t.startsWith('"')){const n=t.slice(1).split('\\"');for(let a=0;a<n.length;++a){const _=n[a].indexOf('"');_!==-1&&(n[a]=n[a].slice(0,_),n.length=a+1),n[a]=n[a].replace(/\\(.)/g,"$1")}t=n.join('"')}return t}function v(t){const n=t.indexOf("'");if(n===-1)return t;const a=t.slice(0,n),b=t.slice(n+1).replace(/^[^']*'/,"");return m(a,b)}function l(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(n,a,_,b){if(_==="q"||_==="Q")return b=b.replace(/_/g," "),b=b.replace(/=([0-9a-fA-F]{2})/g,function(o,e){return String.fromCharCode(parseInt(e,16))}),m(a,b);try{b=atob(b)}catch{}return m(a,b)})}return""}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNetworkStream=void 0;var g=O(1),p=O(33);const I=200,N=206;function K(x){const v=x.response;return typeof v!="string"?v:(0,g.stringToBytes)(v).buffer}class L{constructor(v,l={}){this.url=v,this.isHttp=/^https?:/i.test(v),this.httpHeaders=this.isHttp&&l.httpHeaders||Object.create(null),this.withCredentials=l.withCredentials||!1,this.getXhr=l.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(v,l,t){const n={begin:v,end:l};for(const a in t)n[a]=t[a];return this.request(n)}requestFull(v){return this.request(v)}request(v){const l=this.getXhr(),t=this.currXhrId++,n=this.pendingRequests[t]={xhr:l};l.open("GET",this.url),l.withCredentials=this.withCredentials;for(const a in this.httpHeaders){const _=this.httpHeaders[a];typeof _>"u"||l.setRequestHeader(a,_)}return this.isHttp&&"begin"in v&&"end"in v?(l.setRequestHeader("Range",`bytes=${v.begin}-${v.end-1}`),n.expectedStatus=N):n.expectedStatus=I,l.responseType="arraybuffer",v.onError&&(l.onerror=function(a){v.onError(l.status)}),l.onreadystatechange=this.onStateChange.bind(this,t),l.onprogress=this.onProgress.bind(this,t),n.onHeadersReceived=v.onHeadersReceived,n.onDone=v.onDone,n.onError=v.onError,n.onProgress=v.onProgress,l.send(null),t}onProgress(v,l){var n;const t=this.pendingRequests[v];t&&((n=t.onProgress)==null||n.call(t,l))}onStateChange(v,l){var o,e,s;const t=this.pendingRequests[v];if(!t)return;const n=t.xhr;if(n.readyState>=2&&t.onHeadersReceived&&(t.onHeadersReceived(),delete t.onHeadersReceived),n.readyState!==4||!(v in this.pendingRequests))return;if(delete this.pendingRequests[v],n.status===0&&this.isHttp){(o=t.onError)==null||o.call(t,n.status);return}const a=n.status||I;if(!(a===I&&t.expectedStatus===N)&&a!==t.expectedStatus){(e=t.onError)==null||e.call(t,n.status);return}const b=K(n);if(a===N){const d=n.getResponseHeader("Content-Range"),C=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);t.onDone({begin:parseInt(C[1],10),chunk:b})}else b?t.onDone({begin:0,chunk:b}):(s=t.onError)==null||s.call(t,n.status)}getRequestXhr(v){return this.pendingRequests[v].xhr}isPendingRequest(v){return v in this.pendingRequests}abortRequest(v){const l=this.pendingRequests[v].xhr;delete this.pendingRequests[v],l.abort()}}class m{constructor(v){this._source=v,this._manager=new L(v.url,{httpHeaders:v.httpHeaders,withCredentials:v.withCredentials}),this._rangeChunkSize=v.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(v){const l=this._rangeRequestReaders.indexOf(v);l>=0&&this._rangeRequestReaders.splice(l,1)}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new E(this._manager,this._source),this._fullRequestReader}getRangeReader(v,l){const t=new F(this._manager,v,l);return t.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(t),t}cancelAllRequests(v){var l;(l=this._fullRequestReader)==null||l.cancel(v);for(const t of this._rangeRequestReaders.slice(0))t.cancel(v)}}i.PDFNetworkStream=m;class E{constructor(v,l){this._manager=v;const t={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=l.url,this._fullRequestId=v.requestFull(t),this._headersReceivedCapability=(0,g.createPromiseCapability)(),this._disableRange=l.disableRange||!1,this._contentLength=l.length,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const v=this._fullRequestId,l=this._manager.getRequestXhr(v),t=_=>l.getResponseHeader(_),{allowRangeRequests:n,suggestedLength:a}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(t),this._isRangeSupported&&this._manager.abortRequest(v),this._headersReceivedCapability.resolve()}_onDone(v){if(v&&(this._requests.length>0?this._requests.shift().resolve({value:v.chunk,done:!1}):this._cachedChunks.push(v.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const l of this._requests)l.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(v){this._storedError=(0,p.createResponseStatusError)(v,this._url),this._headersReceivedCapability.reject(this._storedError);for(const l of this._requests)l.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(v){var l;(l=this.onProgress)==null||l.call(this,{loaded:v.loaded,total:v.lengthComputable?v.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const v=(0,g.createPromiseCapability)();return this._requests.push(v),v.promise}cancel(v){this._done=!0,this._headersReceivedCapability.reject(v);for(const l of this._requests)l.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class F{constructor(v,l,t){this._manager=v;const n={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._requestId=v.requestRange(l,t,n),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var v;(v=this.onClosed)==null||v.call(this,this)}_onDone(v){const l=v.chunk;this._requests.length>0?this._requests.shift().resolve({value:l,done:!1}):this._queuedChunk=l,this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(v){this._storedError=(0,p.createResponseStatusError)(v,this._url);for(const l of this._requests)l.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(v){var l;this.isStreamingSupported||(l=this.onProgress)==null||l.call(this,{loaded:v.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const l=this._queuedChunk;return this._queuedChunk=null,{value:l,done:!1}}if(this._done)return{value:void 0,done:!0};const v=(0,g.createPromiseCapability)();return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const l of this._requests)l.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(Y,i,O)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFFetchStream=void 0;var g=O(1),p=O(33);function I(E,F,x){return{method:"GET",headers:E,signal:x.signal,mode:"cors",credentials:F?"include":"same-origin",redirect:"follow"}}function N(E){const F=new Headers;for(const x in E){const v=E[x];typeof v>"u"||F.append(x,v)}return F}class K{constructor(F){this.source=F,this.isHttp=/^https?:/i.test(F.url),this.httpHeaders=this.isHttp&&F.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var F;return((F=this._fullRequestReader)==null?void 0:F._loaded)??0}getFullReader(){return(0,g.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new L(this),this._fullRequestReader}getRangeReader(F,x){if(x<=this._progressiveDataLength)return null;const v=new m(this,F,x);return this._rangeRequestReaders.push(v),v}cancelAllRequests(F){this._fullRequestReader&&this._fullRequestReader.cancel(F);for(const x of this._rangeRequestReaders.slice(0))x.cancel(F)}}i.PDFFetchStream=K;class L{constructor(F){this._stream=F,this._reader=null,this._loaded=0,this._filename=null;const x=F.source;this._withCredentials=x.withCredentials||!1,this._contentLength=x.length,this._headersCapability=(0,g.createPromiseCapability)(),this._disableRange=x.disableRange||!1,this._rangeChunkSize=x.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!x.disableStream,this._isRangeSupported=!x.disableRange,this._headers=N(this._stream.httpHeaders);const v=x.url;fetch(v,I(this._headers,this._withCredentials,this._abortController)).then(l=>{if(!(0,p.validateResponseStatus)(l.status))throw(0,p.createResponseStatusError)(l.status,v);this._reader=l.body.getReader(),this._headersCapability.resolve();const t=_=>l.headers.get(_),{allowRangeRequests:n,suggestedLength:a}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=a||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new g.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:F,done:x}=await this._reader.read();return x?{value:F,done:x}:(this._loaded+=F.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(F).buffer,done:!1})}cancel(F){this._reader&&this._reader.cancel(F),this._abortController.abort()}}class m{constructor(F,x,v){this._stream=F,this._reader=null,this._loaded=0;const l=F.source;this._withCredentials=l.withCredentials||!1,this._readCapability=(0,g.createPromiseCapability)(),this._isStreamingSupported=!l.disableStream,this._abortController=new AbortController,this._headers=N(this._stream.httpHeaders),this._headers.append("Range",`bytes=${x}-${v-1}`);const t=l.url;fetch(t,I(this._headers,this._withCredentials,this._abortController)).then(n=>{if(!(0,p.validateResponseStatus)(n.status))throw(0,p.createResponseStatusError)(n.status,t);this._readCapability.resolve(),this._reader=n.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:F,done:x}=await this._reader.read();return x?{value:F,done:x}:(this._loaded+=F.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(F).buffer,done:!1})}cancel(F){this._reader&&this._reader.cancel(F),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(Y){var i=__webpack_module_cache__[Y];if(i!==void 0)return i.exports;var O=__webpack_module_cache__[Y]={exports:{}};return __webpack_modules__[Y](O,O.exports,__w_pdfjs_require__),O.exports}var __webpack_exports__={};return(()=>{var Y=__webpack_exports__;Object.defineProperty(Y,"__esModule",{value:!0}),Object.defineProperty(Y,"AnnotationEditorLayer",{enumerable:!0,get:function(){return p.AnnotationEditorLayer}}),Object.defineProperty(Y,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return i.AnnotationEditorParamsType}}),Object.defineProperty(Y,"AnnotationEditorType",{enumerable:!0,get:function(){return i.AnnotationEditorType}}),Object.defineProperty(Y,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return I.AnnotationEditorUIManager}}),Object.defineProperty(Y,"AnnotationLayer",{enumerable:!0,get:function(){return N.AnnotationLayer}}),Object.defineProperty(Y,"AnnotationMode",{enumerable:!0,get:function(){return i.AnnotationMode}}),Object.defineProperty(Y,"CMapCompressionType",{enumerable:!0,get:function(){return i.CMapCompressionType}}),Object.defineProperty(Y,"GlobalWorkerOptions",{enumerable:!0,get:function(){return K.GlobalWorkerOptions}}),Object.defineProperty(Y,"InvalidPDFException",{enumerable:!0,get:function(){return i.InvalidPDFException}}),Object.defineProperty(Y,"LoopbackPort",{enumerable:!0,get:function(){return O.LoopbackPort}}),Object.defineProperty(Y,"MissingPDFException",{enumerable:!0,get:function(){return i.MissingPDFException}}),Object.defineProperty(Y,"OPS",{enumerable:!0,get:function(){return i.OPS}}),Object.defineProperty(Y,"PDFDataRangeTransport",{enumerable:!0,get:function(){return O.PDFDataRangeTransport}}),Object.defineProperty(Y,"PDFDateString",{enumerable:!0,get:function(){return g.PDFDateString}}),Object.defineProperty(Y,"PDFWorker",{enumerable:!0,get:function(){return O.PDFWorker}}),Object.defineProperty(Y,"PasswordResponses",{enumerable:!0,get:function(){return i.PasswordResponses}}),Object.defineProperty(Y,"PermissionFlag",{enumerable:!0,get:function(){return i.PermissionFlag}}),Object.defineProperty(Y,"PixelsPerInch",{enumerable:!0,get:function(){return g.PixelsPerInch}}),Object.defineProperty(Y,"RenderingCancelledException",{enumerable:!0,get:function(){return g.RenderingCancelledException}}),Object.defineProperty(Y,"SVGGraphics",{enumerable:!0,get:function(){return E.SVGGraphics}}),Object.defineProperty(Y,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return i.UNSUPPORTED_FEATURES}}),Object.defineProperty(Y,"UnexpectedResponseException",{enumerable:!0,get:function(){return i.UnexpectedResponseException}}),Object.defineProperty(Y,"Util",{enumerable:!0,get:function(){return i.Util}}),Object.defineProperty(Y,"VerbosityLevel",{enumerable:!0,get:function(){return i.VerbosityLevel}}),Object.defineProperty(Y,"XfaLayer",{enumerable:!0,get:function(){return F.XfaLayer}}),Object.defineProperty(Y,"build",{enumerable:!0,get:function(){return O.build}}),Object.defineProperty(Y,"createPromiseCapability",{enumerable:!0,get:function(){return i.createPromiseCapability}}),Object.defineProperty(Y,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return i.createValidAbsoluteUrl}}),Object.defineProperty(Y,"getDocument",{enumerable:!0,get:function(){return O.getDocument}}),Object.defineProperty(Y,"getFilenameFromUrl",{enumerable:!0,get:function(){return g.getFilenameFromUrl}}),Object.defineProperty(Y,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return g.getPdfFilenameFromUrl}}),Object.defineProperty(Y,"getXfaPageViewport",{enumerable:!0,get:function(){return g.getXfaPageViewport}}),Object.defineProperty(Y,"isPdfFile",{enumerable:!0,get:function(){return g.isPdfFile}}),Object.defineProperty(Y,"loadScript",{enumerable:!0,get:function(){return g.loadScript}}),Object.defineProperty(Y,"renderTextLayer",{enumerable:!0,get:function(){return m.renderTextLayer}}),Object.defineProperty(Y,"shadow",{enumerable:!0,get:function(){return i.shadow}}),Object.defineProperty(Y,"version",{enumerable:!0,get:function(){return O.version}});var i=__w_pdfjs_require__(1),O=__w_pdfjs_require__(4),g=__w_pdfjs_require__(8),p=__w_pdfjs_require__(22),I=__w_pdfjs_require__(7),N=__w_pdfjs_require__(27),K=__w_pdfjs_require__(15),L=__w_pdfjs_require__(3),m=__w_pdfjs_require__(30),E=__w_pdfjs_require__(31),F=__w_pdfjs_require__(29);if(L.isNodeJS){const{PDFNodeStream:x}=__w_pdfjs_require__(32);(0,O.setPDFNetworkStreamFactory)(v=>new x(v))}else{const{PDFNetworkStream:x}=__w_pdfjs_require__(35),{PDFFetchStream:v}=__w_pdfjs_require__(36);(0,O.setPDFNetworkStreamFactory)(l=>(0,g.isValidFetchUrl)(l.url)?new v(l):new x(l))}})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;async function process_file(Y,i,O,g,p,I,N){const K=i.name,L=i.size,m=new Date;let E;const F=p,x=I,v=new RecursiveCharacterTextSplitter({chunkSize:F,chunkOverlap:x}),l=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);let n=(await l.auth.getUser()).data.user.id;console.log("userID",n);let a;if(console.log("isUrl",N),N===!0){console.log("isUrl",N);const s=new FileReader;s.onload=async function(d){const C=d.target.result,y={pageContent:C.toString(),metadata:{file_sha1:E,file_size:L,file_name:K,chunk_size:p,chunk_overlap:I,date:m}};a=await v.splitDocuments([y]),console.log("splittedDocuments",a[0].user_id),E=await computeSHA1FromContent(C);const f=[];for(const $ of a){const U={pageContent:$.pageContent,metadata:{file_sha1:E,file_size:L,file_name:K,chunk_size:p,chunk_overlap:I,date:m}};f.push(U)}const T=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),Z=PUBLIC_OPENAI_API_KEY,st=new OpenAIEmbeddings({openAIApiKey:Z});console.log("user_id",n),new SupabaseVectorStore(st,{client:T,queryName:"insert",tableName:"documents"}).addDocuments(f)},await s.readAsText(i)}else if(g===".pdf"){console.log("isPdf");const s=new File([i],K,{type:i.type});E=await computeSHA1FromFile(s);const d=await fetchFileAsArrayBuffer(s),C=await pdfExports.getDocument({data:d}).promise,y=await extractTextFromPDF(C);console.log("pdfText",y);const f={pageContent:y,metadata:{file_sha1:E,file_size:L,file_name:K,chunk_size:p,chunk_overlap:I,date:m}};a=await v.splitDocuments([f]),console.log("splittedDocuments",a);const T=[];for(const U of a){const G={pageContent:U.pageContent,metadata:{file_sha1:E,file_size:L,file_name:K,chunk_size:p,chunk_overlap:I,date:m}};T.push(G)}const Z=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),st=PUBLIC_OPENAI_API_KEY,J=new OpenAIEmbeddings({openAIApiKey:st});console.log("user_id",n);let $=new SupabaseVectorStore(J,{client:Z,queryName:"insert",tableName:"documents"});console.log("docs Metadata",T[0].user_id),$.addDocuments(T)}else{const s=new File([i],K,{type:i.type});E=await computeSHA1FromFile(s);const C=await new O(s).load();a=await v.splitDocuments(C)}const _=[];for(const s of a){const d={pageContent:s.pageContent,metadata:{file_sha1:E,file_size:L,file_name:K,chunk_size:p,chunk_overlap:I,date:m}};_.push(d)}const b=PUBLIC_OPENAI_API_KEY,o=new OpenAIEmbeddings({openAIApiKey:b});console.log("user_id",n);let e=new SupabaseVectorStore(o,{client:l,tableName:"documents",queryName:"insert"});console.log("docsWithMetadata",_);try{e.addDocuments(_)}catch(s){console.log("error",s)}}async function extractTextFromPDF(Y){let i="";for(let O=1;O<=Y.numPages;O++){const I=(await(await Y.getPage(O)).getTextContent()).items.map(N=>N.str).join(" ");i+=I+" "}return i}async function fetchFileAsArrayBuffer(Y){return await(await fetch(URL.createObjectURL(Y))).arrayBuffer()}class BaseDocumentLoader{async loadAndSplit(i=new RecursiveCharacterTextSplitter){const O=await this.load();return i.splitDocuments(O)}}class TextLoader extends BaseDocumentLoader{constructor(i){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:i})}async parse(i){return[i]}async load(){let i,O;if(typeof this.filePathOrBlob=="string"){const{readFile:p}=await TextLoader.imports();i=await p(this.filePathOrBlob,"utf8"),O={source:this.filePathOrBlob}}else i=await this.filePathOrBlob.text(),O={source:"blob",blobType:this.filePathOrBlob.type};const g=await this.parse(i);return g.forEach((p,I)=>{if(typeof p!="string")throw new Error(`Expected string, at position ${I} got ${typeof p}`)}),g.map((p,I)=>new Document({pageContent:p,metadata:g.length===1?O:{...O,line:I+1}}))}static async imports(){try{const{readFile:i}=await __vitePreload(()=>import("../chunks/promises.0ef77ad7.js"),[],import.meta.url);return{readFile:i}}catch(i){throw console.error(i),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv()}'. See https://<link to docs> for alternatives.`)}}}function processTxt(Y,i){return process_file(Y,i,TextLoader,".txt",500,0)}function process_pdf(Y,i){return process_file(Y,i,TextLoader,".pdf",500,0)}class UnstructuredLoader extends BaseDocumentLoader{constructor(i,O={}){super(),Object.defineProperty(this,"filePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:"https://api.unstructured.io/general/v0/general"}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strategy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof O=="string"?(this.filePath=O,this.apiUrl=i):(this.filePath=i,this.apiKey=O.apiKey,this.apiUrl=O.apiUrl??this.apiUrl,this.strategy=O.strategy??"hi_res")}async _partition(){const{readFile:i,basename:O}=await this.imports(),g=await i(this.filePath),p=O(this.filePath),I=new FormData;I.append("files",new Blob([g]),p),I.append("strategy",this.strategy);const N={"UNSTRUCTURED-API-KEY":this.apiKey??""},K=await fetch(this.apiUrl,{method:"POST",body:I,headers:N});if(!K.ok)throw new Error(`Failed to partition file ${this.filePath} with error ${K.status} and message ${await K.text()}`);const L=await K.json();if(!Array.isArray(L))throw new Error(`Expected partitioning request to return an array, but got ${L}`);return L.filter(m=>typeof m.text=="string")}async load(){const i=await this._partition(),O=[];for(const g of i){const{metadata:p,text:I}=g;O.push(new Document({pageContent:I,metadata:{...p,category:g.type}}))}return O}async imports(){try{const{readFile:i}=await __vitePreload(()=>import("../chunks/promises.0ef77ad7.js"),[],import.meta.url),{basename:O}=await __vitePreload(()=>import("../chunks/__vite-browser-external_node_path.042c5bd1.js"),[],import.meta.url);return{readFile:i,basename:O}}catch(i){throw console.error(i),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv()}'. See https://<link to docs> for alternatives.`)}}}async function processHtml(Y,i){return process_file(Y,i,UnstructuredLoader,".html")}async function getHtml(Y){try{const O=`/api?${new URLSearchParams({url:Y}).toString()}`,g=await fetch(O,{method:"GET"});return g.status===200?await g.text():(console.log("error: ",g.status),null)}catch(i){return console.log("error: ",i),null}}class CustomFile extends Blob{constructor(i,O){super(i,O),this.name=O.name,this.lastModifiedDate=new Date}}function createHtmlFile(Y,i){const O=slugify(Y)+".html";return new CustomFile([i],{type:"text/html",name:O})}function slugify(Y){return Y=Y.normalize("NFKD").replace(/[\u0300-\u036f]/g,""),Y=Y.replace(/[^\w\s-]/g,"").trim().toLowerCase(),Y=Y.replace(/[-\s]+/g,"-"),Y}const file_processors={".txt":processTxt,".pdf":process_pdf,".html":processHtml};async function file_uploader(Y,i,O,g){Array.isArray(g)||(g=[g]),console.log(g);for(const p of g)await filter_file(p,Y)}async function file_already_exists(Y,i){const O=computeSHA1FromContent(i);let g=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const{data:p,error:I}=await g.from("documents").select("id").eq("metadata->>file_sha1",O);return I?(console.log(`Error retrieving data: ${I.message}`),!1):p.length>0}async function filter_file(Y,i,O){if(await file_already_exists(i,Y))return console.log(`😎 ${Y.name} is already in the database.`),!1;if(Y.size<1)return console.log(`💨 ${Y.name} is empty.`),!1;{const g=`.${Y.name.split(".").pop()}`;if(console.log(Y.name,g),g in file_processors){const p=PUBLIC_OPENAI_API_KEY;let I=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),N=new OpenAIEmbeddings({openAIApiKey:p}),K=new SupabaseVectorStore(N,{client:I,tableName:"documents"});return await file_processors[g](K,Y),console.log(`✅ ${Y.name}`),!0}else return console.log(`❌ ${Y.name} is not a valid file type.`),!1}}async function url_uploader(Y,i,O,g){const p=await getHtml(g);console.log(p);const I=createHtmlFile(g,p);console.log(I),await process_file(O,I,UnstructuredLoader,".html",500,0,!0)}const file="src/routes/upload/+page.svelte";function create_if_block(Y){let i,O;const g={c:function(){i=element("div"),O=text(Y[1]),this.h()},l:function(I){i=claim_element(I,"DIV",{class:!0});var N=children(i);O=claim_text(N,Y[1]),N.forEach(detach_dev),this.h()},h:function(){attr_dev(i,"class","text-red-500 mb-4"),add_location(i,file,73,10,1616)},m:function(I,N){insert_hydration_dev(I,i,N),append_hydration_dev(i,O)},p:function(I,N){N&2&&set_data_dev(O,I[1])},d:function(I){I&&detach_dev(i)}};return dispatch_dev("SvelteRegisterBlock",{block:g,id:create_if_block.name,type:"if",source:"(51:8) {#if error}",ctx:Y}),g}function create_default_slot(Y){let i,O,g,p,I,N,K="Insert Data Page",L,m,E,F,x="Upload Files",v,l,t,n,a,_="Upload Files",b,o,e,s="Add the URL to the database",d,C,y,f,T,Z="Add URL",st,J,$;g=new NavBar({$$inline:!0});let U=Y[1]&&create_if_block(Y);const G={c:function(){i=element("div"),O=element("div"),create_component(g.$$.fragment),p=space(),I=element("div"),N=element("h1"),N.textContent=K,L=space(),U&&U.c(),m=space(),E=element("div"),F=element("label"),F.textContent=x,v=space(),l=element("div"),t=element("input"),n=space(),a=element("button"),a.textContent=_,b=space(),o=element("div"),e=element("label"),e.textContent=s,d=space(),C=element("div"),y=element("textarea"),f=space(),T=element("button"),T.textContent=Z,this.h()},l:function(et){i=claim_element(et,"DIV",{class:!0});var ot=children(i);O=claim_element(ot,"DIV",{class:!0});var _t=children(O);claim_component(g.$$.fragment,_t),p=claim_space(_t),I=claim_element(_t,"DIV",{class:!0});var B=children(I);N=claim_element(B,"H1",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(N)!=="svelte-1uys3o0"&&(N.textContent=K),L=claim_space(B),U&&U.l(B),m=claim_space(B),E=claim_element(B,"DIV",{class:!0});var h=children(E);F=claim_element(h,"LABEL",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(F)!=="svelte-qb0qet"&&(F.textContent=x),v=claim_space(h),l=claim_element(h,"DIV",{class:!0});var c=children(l);t=claim_element(c,"INPUT",{type:!0,class:!0}),n=claim_space(c),a=claim_element(c,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(a)!=="svelte-lgl95g"&&(a.textContent=_),c.forEach(detach_dev),h.forEach(detach_dev),b=claim_space(B),o=claim_element(B,"DIV",{class:!0});var w=children(o);e=claim_element(w,"LABEL",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-qczuz7"&&(e.textContent=s),d=claim_space(w),C=claim_element(w,"DIV",{class:!0});var R=children(C);y=claim_element(R,"TEXTAREA",{class:!0,rows:!0}),children(y).forEach(detach_dev),f=claim_space(R),T=claim_element(R,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(T)!=="svelte-q899tv"&&(T.textContent=Z),R.forEach(detach_dev),w.forEach(detach_dev),B.forEach(detach_dev),_t.forEach(detach_dev),ot.forEach(detach_dev),this.h()},h:function(){attr_dev(N,"class","text-2xl md:text-4xl font-bold mb-4 md:mb-8"),add_location(N,file,68,8,1457),attr_dev(F,"class","label mb-2 text-lg font-bold"),add_location(F,file,78,10,1759),attr_dev(t,"type","file"),t.multiple=!0,attr_dev(t,"class","input input-accent mr-0 md:mr-4 mb-2 md:mb-0"),add_location(t,file,80,12,1899),attr_dev(a,"class","btn btn-primary text-lg font-bold"),add_location(a,file,86,12,2082),attr_dev(l,"class","flex flex-col md:flex-row items-center"),add_location(l,file,79,10,1834),attr_dev(E,"class","w-full mb-4 md:mb-8"),add_location(E,file,77,8,1715),attr_dev(e,"class","label mb-2 text-lg font-bold"),add_location(e,file,97,10,2361),attr_dev(y,"class","textarea textarea-accent resize-none flex-grow text-lg font-bold mb-2 md:mb-0 md:mr-4"),attr_dev(y,"rows","1"),add_location(y,file,101,12,2540),attr_dev(T,"class","btn btn-primary text-lg font-bold"),add_location(T,file,106,12,2739),attr_dev(C,"class","flex flex-col md:flex-row items-center"),add_location(C,file,100,10,2475),attr_dev(o,"class","w-full"),add_location(o,file,96,8,2330),attr_dev(I,"class","p-4 md:p-8 flex flex-col items-center h-screen"),add_location(I,file,67,6,1388),attr_dev(O,"class","flex flex-col items-center"),add_location(O,file,65,4,1324),attr_dev(i,"class","flex flex-col min-h-screen min-w-full bg-gray-900 text-white p-4"),add_location(i,file,64,2,1241)},m:function(et,ot){insert_hydration_dev(et,i,ot),append_hydration_dev(i,O),mount_component(g,O,null),append_hydration_dev(O,p),append_hydration_dev(O,I),append_hydration_dev(I,N),append_hydration_dev(I,L),U&&U.m(I,null),append_hydration_dev(I,m),append_hydration_dev(I,E),append_hydration_dev(E,F),append_hydration_dev(E,v),append_hydration_dev(E,l),append_hydration_dev(l,t),append_hydration_dev(l,n),append_hydration_dev(l,a),append_hydration_dev(I,b),append_hydration_dev(I,o),append_hydration_dev(o,e),append_hydration_dev(o,d),append_hydration_dev(o,C),append_hydration_dev(C,y),set_input_value(y,Y[0]),append_hydration_dev(C,f),append_hydration_dev(C,T),st=!0,J||($=[listen_dev(t,"change",Y[2],!1,!1,!1,!1),listen_dev(a,"click",Y[5],!1,!1,!1,!1),listen_dev(y,"input",Y[6]),listen_dev(T,"click",Y[7],!1,!1,!1,!1)],J=!0)},p:function(et,ot){et[1]?U?U.p(et,ot):(U=create_if_block(et),U.c(),U.m(I,m)):U&&(U.d(1),U=null),ot&1&&set_input_value(y,et[0])},i:function(et){st||(transition_in(g.$$.fragment,et),st=!0)},o:function(et){transition_out(g.$$.fragment,et),st=!1},d:function(et){et&&detach_dev(i),destroy_component(g),U&&U.d(),J=!1,run_all($)}};return dispatch_dev("SvelteRegisterBlock",{block:G,id:create_default_slot.name,type:"slot",source:"(42:0) <AuthCheck>",ctx:Y}),G}function create_fragment(Y){let i,O;i=new AuthCheck({props:{$$slots:{default:[create_default_slot]},$$scope:{ctx:Y}},$$inline:!0});const g={c:function(){create_component(i.$$.fragment)},l:function(I){claim_component(i.$$.fragment,I)},m:function(I,N){mount_component(i,I,N),O=!0},p:function(I,[N]){const K={};N&4099&&(K.$$scope={dirty:N,ctx:I}),i.$set(K)},i:function(I){O||(transition_in(i.$$.fragment,I),O=!0)},o:function(I){transition_out(i.$$.fragment,I),O=!1},d:function(I){destroy_component(i,I)}};return dispatch_dev("SvelteRegisterBlock",{block:g,id:create_fragment.name,type:"component",source:"",ctx:Y}),g}function instance(Y,i,O){let{$$slots:g={},$$scope:p}=i;validate_slots("Page",g,[]);let I,N,K,L,m,E="";async function F(_){L=_.target.files[0]}onMount(()=>{I=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const _=PUBLIC_OPENAI_API_KEY;let b=new OpenAIEmbeddings({openAIApiKey:_});N=new SupabaseVectorStore(b,{client:I,tableName:"documents"})});async function x(){await file_uploader(I,PUBLIC_HUGGINGFACE_API_KEY,N,L),O(1,E="")}async function v(){await url_uploader(I,PUBLIC_HUGGINGFACE_API_KEY,N,m),O(1,E="")}const l=[];Object.keys(i).forEach(_=>{!~l.indexOf(_)&&_.slice(0,2)!=="$$"&&_!=="slot"&&console.warn(`<Page> was created with unknown prop '${_}'`)});const t=()=>x();function n(){m=this.value,O(0,m)}const a=()=>v();return Y.$capture_state=()=>({file_uploader,url_uploader,OpenAIEmbeddings,createClient,SupabaseVectorStore,onMount,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,PUBLIC_HUGGINGFACE_API_KEY,PUBLIC_OPENAI_API_KEY,AuthCheck,NavBar,supabase:I,vector:N,embeddings:K,files:L,url:m,error:E,upload:F,handleFileUpload:x,handleUrlUpload:v}),Y.$inject_state=_=>{"supabase"in _&&(I=_.supabase),"vector"in _&&(N=_.vector),"embeddings"in _&&(K=_.embeddings),"files"in _&&(L=_.files),"url"in _&&O(0,m=_.url),"error"in _&&O(1,E=_.error)},i&&"$$inject"in i&&Y.$inject_state(i.$$inject),[m,E,F,x,v,t,n,a]}class Page extends SvelteComponentDev{constructor(i){super(i),init(this,i,instance,create_fragment,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"Page",options:i,id:create_fragment.name})}}export{Page as component};
