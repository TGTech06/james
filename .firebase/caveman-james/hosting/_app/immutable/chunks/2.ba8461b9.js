var Dc=Object.defineProperty;var Nc=(n,e,t)=>e in n?Dc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ut=(n,e,t)=>(Nc(n,typeof e!="symbol"?e+"":e,t),t);import{s as Lc,v as un,h as cn,o as Ji,d as W,n as Gi,r as oi,i as $c}from"./scheduler.744affc9.js";import{S as Mc,i as Uc,d as en,A as Fc,v as Bc,j as Q,s as de,k as X,l as be,B as Oe,c as he,g as ce,m as te,C as $e,a as dt,z as q,D as Re,E as us,F as Vc,o as Pn,p as xn,q as Sn,G as Yi}from"./index.f15cdbf8.js";import{_ as _e}from"./preload-helper.cf010ec4.js";import{w as vr}from"./index.43531919.js";function qc(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}class Fr{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var zc=Object.defineProperty,Hc=(n,e,t)=>e in n?zc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Kc=(n,e,t)=>(Hc(n,typeof e!="symbol"?e+"":e,t),t),st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Zc(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){if(this instanceof r){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(e,s);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Rn={};Rn.byteLength=Yc;Rn.toByteArray=Qc;Rn.fromByteArray=tl;var ct=[],Ye=[],Jc=typeof Uint8Array<"u"?Uint8Array:Array,cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ht=0,Gc=cs.length;Ht<Gc;++Ht)ct[Ht]=cs[Ht],Ye[cs.charCodeAt(Ht)]=Ht;Ye["-".charCodeAt(0)]=62;Ye["_".charCodeAt(0)]=63;function xo(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Yc(n){var e=xo(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Wc(n,e,t){return(e+t)*3/4-t}function Qc(n){var e,t=xo(n),r=t[0],s=t[1],i=new Jc(Wc(n,r,s)),a=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=Ye[n.charCodeAt(u)]<<18|Ye[n.charCodeAt(u+1)]<<12|Ye[n.charCodeAt(u+2)]<<6|Ye[n.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Ye[n.charCodeAt(u)]<<2|Ye[n.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=Ye[n.charCodeAt(u)]<<10|Ye[n.charCodeAt(u+1)]<<4|Ye[n.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function Xc(n){return ct[n>>18&63]+ct[n>>12&63]+ct[n>>6&63]+ct[n&63]}function el(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),s.push(Xc(r));return s.join("")}function tl(n){for(var e,t=n.length,r=t%3,s=[],i=16383,a=0,o=t-r;a<o;a+=i)s.push(el(n,a,a+i>o?o:a+i));return r===1?(e=n[t-1],s.push(ct[e>>2]+ct[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(ct[e>>10]+ct[e>>4&63]+ct[e<<2&63]+"=")),s.join("")}function rl(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function nl(n,e){return n.length===1?[e.get(n.join(","))]:rl(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function sl(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var zs=class{constructor(n,e){ut(this,"specialTokens");ut(this,"inverseSpecialTokens");ut(this,"patStr");ut(this,"textEncoder",new TextEncoder);ut(this,"textDecoder",new TextDecoder("utf-8"));ut(this,"rankMap",new Map);ut(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,s]of Object.entries(t)){const i=Rn.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=zs.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=zs.specialTokenRegex([...o]),l=n.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(n),!(c==null||a.has(c[0]));)l=c.index+1;const d=(c==null?void 0:c.index)??n.length;for(const b of n.substring(u,d).matchAll(r)){const m=this.textEncoder.encode(b[0]),_=this.rankMap.get(m.join(","));if(_!=null){i.push(_);continue}i.push(...nl(m,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];i.push(h),u=c.index+c[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},So=zs;Kc(So,"specialTokenRegex",n=>new RegExp(n.map(e=>sl(e)).join("|"),"g"));function il(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var Dn={exports:{}},ko={};function et(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var al=et;et.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};et.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};et.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};et.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};et.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};et.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};et.prototype.start=et.prototype.try;et.prototype.errors=function(){return this._errors};et.prototype.attempts=function(){return this._attempts};et.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(n[i]||0)+1;n[i]=a,a>=t&&(e=s,t=a)}return e};(function(n){var e=al;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],u=t[o];t[o]=(function(l){var d=n.operation(r),h=Array.prototype.slice.call(arguments,1),b=h.pop();h.push(function(m){d.retry(m)||(m&&(arguments[0]=d.mainError()),b.apply(this,arguments))}),d.attempt(function(){l.apply(t,h)})}).bind(t,u),t[o].options=r}}})(ko);var ol=ko;const ul=ol,cl=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class jo extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const ll=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},dl=n=>cl.includes(n),Co=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=ul.operation(e);s.attempt(async i=>{try{t(await n(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof jo)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!dl(a.message))s.stop(),r(a);else{ll(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});Dn.exports=Co;Dn.exports.default=Co;Dn.exports.AbortError=jo;var hl=Dn.exports;const Io=pr(hl);var Ro={},Do={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function i(u,c,l,d,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var b=new s(l,d||u,h),m=t?t+c:c;return u._events[m]?u._events[m].fn?u._events[m]=[u._events[m],b]:u._events[m].push(b):(u._events[m]=b,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,d;if(this._eventsCount===0)return c;for(d in l=this._events)e.call(l,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=t?t+c:c,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,b=d.length,m=new Array(b);h<b;h++)m[h]=d[h].fn;return m},o.prototype.listenerCount=function(c){var l=t?t+c:c,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,l,d,h,b,m){var _=t?t+c:c;if(!this._events[_])return!1;var y=this._events[_],x=arguments.length,C,j;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),x){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,d),!0;case 4:return y.fn.call(y.context,l,d,h),!0;case 5:return y.fn.call(y.context,l,d,h,b),!0;case 6:return y.fn.call(y.context,l,d,h,b,m),!0}for(j=1,C=new Array(x-1);j<x;j++)C[j-1]=arguments[j];y.fn.apply(y.context,C)}else{var P=y.length,D;for(j=0;j<P;j++)switch(y[j].once&&this.removeListener(c,y[j].fn,void 0,!0),x){case 1:y[j].fn.call(y[j].context);break;case 2:y[j].fn.call(y[j].context,l);break;case 3:y[j].fn.call(y[j].context,l,d);break;case 4:y[j].fn.call(y[j].context,l,d,h);break;default:if(!C)for(D=1,C=new Array(x-1);D<x;D++)C[D-1]=arguments[D];y[j].fn.apply(y[j].context,C)}}return!0},o.prototype.on=function(c,l,d){return i(this,c,l,d,!1)},o.prototype.once=function(c,l,d){return i(this,c,l,d,!0)},o.prototype.removeListener=function(c,l,d,h){var b=t?t+c:c;if(!this._events[b])return this;if(!l)return a(this,b),this;var m=this._events[b];if(m.fn)m.fn===l&&(!h||m.once)&&(!d||m.context===d)&&a(this,b);else{for(var _=0,y=[],x=m.length;_<x;_++)(m[_].fn!==l||h&&!m[_].once||d&&m[_].context!==d)&&y.push(m[_]);y.length?this._events[b]=y.length===1?y[0]:y:a(this,b)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Do);var fl=Do.exports,Nn={exports:{}},pl=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const ml=pl;class No extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Lo=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){s(u)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new No(a);typeof n.cancel=="function"&&n.cancel(),s(o)},e);ml(n.then(r,s),()=>{clearTimeout(i)})});Nn.exports=Lo;Nn.exports.default=Lo;Nn.exports.TimeoutError=No;var yl=Nn.exports,ui={},ci={};Object.defineProperty(ci,"__esModule",{value:!0});function gl(n,e,t){let r=0,s=n.length;for(;s>0;){const i=s/2|0;let a=r+i;t(n[a],e)<=0?(r=++a,s-=i+1):s=i}return r}ci.default=gl;Object.defineProperty(ui,"__esModule",{value:!0});const bl=ci;class vl{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const s=bl.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}ui.default=vl;Object.defineProperty(Ro,"__esModule",{value:!0});const _l=fl,$o=yl,wl=ui,ln=()=>{},Ol=new $o.TimeoutError;class El extends _l{constructor(e){var t,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=ln,this._resolveIdle=ln,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:wl.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=ln,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=ln,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():$o.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(Ol)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var vt=Ro.default=El;const Al=[400,401,403,404,405,406,407,408,409];let li=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in vt?vt.default:vt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Io(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var a,o,u,c;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const s=(a=r==null?void 0:r.response)==null?void 0:a.status;if(s&&Al.includes(+s))throw r;const i=(o=r==null?void 0:r.response)==null?void 0:o.data;if(((u=i==null?void 0:i.error)==null?void 0:u.code)==="insufficient_quota"){const l=new Error((c=i==null?void 0:i.error)==null?void 0:c.message);throw l.name="InsufficientQuotaError",l}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const dn={},Tl=new li({});async function Pl(n,e){return n in dn||(dn[n]=Tl.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete dn[n],t})),new So(await dn[n],e==null?void 0:e.extendedSpecialTokens)}async function Mo(n,e){return Pl(il(n),e)}var xl=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const Sl=pr(xl);var Uo={exports:{}};const kl=/[\p{Lu}]/u,jl=/[\p{Ll}]/u,Wi=/^[\p{Lu}](?![\p{Lu}])/gu,Fo=/([\p{Alpha}\p{N}_]|$)/u,Bo=/[_.\- ]+/,Cl=new RegExp("^"+Bo.source),Qi=new RegExp(Bo.source+Fo.source,"gu"),Xi=new RegExp("\\d+"+Fo.source,"gu"),Il=(n,e,t)=>{let r=!1,s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&kl.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,i=s,s=!0,a++):s&&i&&jl.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return n},Rl=(n,e)=>(Wi.lastIndex=0,n.replace(Wi,t=>e(t))),Dl=(n,e)=>(Qi.lastIndex=0,Xi.lastIndex=0,n.replace(Qi,(t,r)=>e(r)).replace(Xi,t=>e(t))),Vo=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Il(n,t,r)),n=n.replace(Cl,""),e.preserveConsecutiveUppercase?n=Rl(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Dl(n,r))};Uo.exports=Vo;Uo.exports.default=Vo;function Nl(n,e){return(e==null?void 0:e[n])||Sl(n)}function Ll(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function ea(n){return Array.isArray(n)?[...n]:{...n}}function $l(n,e){const t=ea(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=ea(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}class it{get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof it||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));for(const s in t)s in this&&this[s]!==void 0&&(r[s]=this[s]||r[s]);return{lc:1,type:"constructor",id:[...this.lc_namespace,this.constructor.name],kwargs:Ll(Object.keys(t).length?$l(r,t):r,Nl,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:[...this.lc_namespace,this.constructor.name]}}}class Ml extends it{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}}class Ul extends Ml{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:t=>t.length}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const s=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${s})`))}else r=e.split(t);else r=e.split("");return r.filter(s=>s!=="")}async createDocuments(e,t=[],r={}){const s=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:i="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,u=new Array;for(let c=0;c<e.length;c+=1){const l=e[c];let d=1,h=null;for(const b of await this.splitText(l)){let m=i,_=0;if(h){const j=l.indexOf(b),P=l.indexOf(h)+this.lengthFunction(h);_=(l.slice(P,j).match(/\n/g)||[]).length,o&&(m+=a)}d+=_;const y=(b.match(/\n/g)||[]).length,x=s[c].loc&&typeof s[c].loc=="object"?{...s[c].loc}:{};x.lines={from:d,to:d+y};const C={...s[c],loc:x};m+=b,u.push(new Fr({pageContent:m,metadata:C})),d+=y,h=b}}return u}async splitDocuments(e,t={}){const r=e.filter(a=>a.pageContent!==void 0),s=r.map(a=>a.pageContent),i=r.map(a=>a.metadata);return this.createDocuments(s,i,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}mergeSplits(e,t){const r=[],s=[];let i=0;for(const o of e){const u=this.lengthFunction(o);if(i+u+(s.length>0?t.length:0)>this.chunkSize&&(i>this.chunkSize&&console.warn(`Created a chunk of size ${i}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const c=this.joinDocs(s,t);for(c!==null&&r.push(c);i>this.chunkOverlap||i+u>this.chunkSize&&i>0;)i-=this.lengthFunction(s[0]),s.shift()}s.push(o),i+=u}const a=this.joinDocs(s,t);return a!==null&&r.push(a),r}}class Br extends Ul{constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let s=t[t.length-1],i;for(let c=0;c<t.length;c+=1){const l=t[c];if(l===""){s=l;break}if(e.includes(l)){s=l,i=t.slice(c+1);break}}const a=this.splitOnSeparator(e,s);let o=[];const u=this.keepSeparator?"":s;for(const c of a)if(this.lengthFunction(c)<this.chunkSize)o.push(c);else{if(o.length){const l=this.mergeSplits(o,u);r.push(...l),o=[]}if(!i)r.push(c);else{const l=await this._splitText(c,i);r.push(...l)}}if(o.length){const c=this.mergeSplits(o,u);r.push(...c)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new Br({...t,separators:Br.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}async function Fl(n){const t=await(await fetch(n)).arrayBuffer(),r=await crypto.subtle.digest("SHA-1",t),i=Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromFile: ",i),i}async function Bl(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-1",t),i=Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromContent: ",i),i}var Vl=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const ql=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Vl(void 0,void 0,void 0,function*(){return yield(yield _e(()=>Promise.resolve().then(()=>Ln),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class di extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class zl extends di{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Hl extends di{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Kl extends di{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Zl=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};class Jl{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=ql(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Zl(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:a}=t;let o={},u;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(o["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(o["Content-Type"]="application/json",u=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:u}).catch(b=>{throw new zl(b)}),l=c.headers.get("x-relay-error");if(l&&l==="true")throw new Hl(c);if(!c.ok)throw new Kl(c);let d=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return d==="application/json"?h=yield c.json():d==="application/octet-stream"?h=yield c.blob():d==="multipart/form-data"?h=yield c.formData():h=yield c.text(),{data:h,error:null}}catch(s){return{data:null,error:s}}})}}var Hs={exports:{}};(function(n,e){var t=typeof self<"u"?self:st,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(a){var o={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function u(O){return O&&DataView.prototype.isPrototypeOf(O)}if(o.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(O){return O&&c.indexOf(Object.prototype.toString.call(O))>-1};function d(O){if(typeof O!="string"&&(O=String(O)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(O))throw new TypeError("Invalid character in header field name");return O.toLowerCase()}function h(O){return typeof O!="string"&&(O=String(O)),O}function b(O){var R={next:function(){var N=O.shift();return{done:N===void 0,value:N}}};return o.iterable&&(R[Symbol.iterator]=function(){return R}),R}function m(O){this.map={},O instanceof m?O.forEach(function(R,N){this.append(N,R)},this):Array.isArray(O)?O.forEach(function(R){this.append(R[0],R[1])},this):O&&Object.getOwnPropertyNames(O).forEach(function(R){this.append(R,O[R])},this)}m.prototype.append=function(O,R){O=d(O),R=h(R);var N=this.map[O];this.map[O]=N?N+", "+R:R},m.prototype.delete=function(O){delete this.map[d(O)]},m.prototype.get=function(O){return O=d(O),this.has(O)?this.map[O]:null},m.prototype.has=function(O){return this.map.hasOwnProperty(d(O))},m.prototype.set=function(O,R){this.map[d(O)]=h(R)},m.prototype.forEach=function(O,R){for(var N in this.map)this.map.hasOwnProperty(N)&&O.call(R,this.map[N],N,this)},m.prototype.keys=function(){var O=[];return this.forEach(function(R,N){O.push(N)}),b(O)},m.prototype.values=function(){var O=[];return this.forEach(function(R){O.push(R)}),b(O)},m.prototype.entries=function(){var O=[];return this.forEach(function(R,N){O.push([N,R])}),b(O)},o.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);function _(O){if(O.bodyUsed)return Promise.reject(new TypeError("Already read"));O.bodyUsed=!0}function y(O){return new Promise(function(R,N){O.onload=function(){R(O.result)},O.onerror=function(){N(O.error)}})}function x(O){var R=new FileReader,N=y(R);return R.readAsArrayBuffer(O),N}function C(O){var R=new FileReader,N=y(R);return R.readAsText(O),N}function j(O){for(var R=new Uint8Array(O),N=new Array(R.length),H=0;H<R.length;H++)N[H]=String.fromCharCode(R[H]);return N.join("")}function P(O){if(O.slice)return O.slice(0);var R=new Uint8Array(O.byteLength);return R.set(new Uint8Array(O)),R.buffer}function D(){return this.bodyUsed=!1,this._initBody=function(O){this._bodyInit=O,O?typeof O=="string"?this._bodyText=O:o.blob&&Blob.prototype.isPrototypeOf(O)?this._bodyBlob=O:o.formData&&FormData.prototype.isPrototypeOf(O)?this._bodyFormData=O:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)?this._bodyText=O.toString():o.arrayBuffer&&o.blob&&u(O)?(this._bodyArrayBuffer=P(O.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(O)||l(O))?this._bodyArrayBuffer=P(O):this._bodyText=O=Object.prototype.toString.call(O):this._bodyText="",this.headers.get("content-type")||(typeof O=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var O=_(this);if(O)return O;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(x)}),this.text=function(){var O=_(this);if(O)return O;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(j(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function I(O){var R=O.toUpperCase();return A.indexOf(R)>-1?R:O}function g(O,R){R=R||{};var N=R.body;if(O instanceof g){if(O.bodyUsed)throw new TypeError("Already read");this.url=O.url,this.credentials=O.credentials,R.headers||(this.headers=new m(O.headers)),this.method=O.method,this.mode=O.mode,this.signal=O.signal,!N&&O._bodyInit!=null&&(N=O._bodyInit,O.bodyUsed=!0)}else this.url=String(O);if(this.credentials=R.credentials||this.credentials||"same-origin",(R.headers||!this.headers)&&(this.headers=new m(R.headers)),this.method=I(R.method||this.method||"GET"),this.mode=R.mode||this.mode||null,this.signal=R.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&N)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(N)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})};function w(O){var R=new FormData;return O.trim().split("&").forEach(function(N){if(N){var H=N.split("="),Z=H.shift().replace(/\+/g," "),S=H.join("=").replace(/\+/g," ");R.append(decodeURIComponent(Z),decodeURIComponent(S))}}),R}function p(O){var R=new m,N=O.replace(/\r?\n[\t ]+/g," ");return N.split(/\r?\n/).forEach(function(H){var Z=H.split(":"),S=Z.shift().trim();if(S){var U=Z.join(":").trim();R.append(S,U)}}),R}D.call(g.prototype);function E(O,R){R||(R={}),this.type="default",this.status=R.status===void 0?200:R.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in R?R.statusText:"OK",this.headers=new m(R.headers),this.url=R.url||"",this._initBody(O)}D.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},E.error=function(){var O=new E(null,{status:0,statusText:""});return O.type="error",O};var k=[301,302,303,307,308];E.redirect=function(O,R){if(k.indexOf(R)===-1)throw new RangeError("Invalid status code");return new E(null,{status:R,headers:{location:O}})},a.DOMException=i.DOMException;try{new a.DOMException}catch{a.DOMException=function(R,N){this.message=R,this.name=N;var H=Error(R);this.stack=H.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function J(O,R){return new Promise(function(N,H){var Z=new g(O,R);if(Z.signal&&Z.signal.aborted)return H(new a.DOMException("Aborted","AbortError"));var S=new XMLHttpRequest;function U(){S.abort()}S.onload=function(){var F={status:S.status,statusText:S.statusText,headers:p(S.getAllResponseHeaders()||"")};F.url="responseURL"in S?S.responseURL:F.headers.get("X-Request-URL");var ie="response"in S?S.response:S.responseText;N(new E(ie,F))},S.onerror=function(){H(new TypeError("Network request failed"))},S.ontimeout=function(){H(new TypeError("Network request failed"))},S.onabort=function(){H(new a.DOMException("Aborted","AbortError"))},S.open(Z.method,Z.url,!0),Z.credentials==="include"?S.withCredentials=!0:Z.credentials==="omit"&&(S.withCredentials=!1),"responseType"in S&&o.blob&&(S.responseType="blob"),Z.headers.forEach(function(F,ie){S.setRequestHeader(ie,F)}),Z.signal&&(Z.signal.addEventListener("abort",U),S.onreadystatechange=function(){S.readyState===4&&Z.signal.removeEventListener("abort",U)}),S.send(typeof Z._bodyInit>"u"?null:Z._bodyInit)})}return J.polyfill=!0,i.fetch||(i.fetch=J,i.Headers=m,i.Request=g,i.Response=E),a.Headers=m,a.Request=g,a.Response=E,a.fetch=J,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(Hs,Hs.exports);var hi=Hs.exports;const fi=pr(hi),Ln=qc({__proto__:null,default:fi},[hi]);class Gl{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=fi:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,u;let c=null,l=null,d=null,h=i.status,b=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=x:l=JSON.parse(x))}const _=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),y=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");_&&y&&y.length>1&&(d=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(c={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,d=null,h=406,b="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const _=await i.text();try{c=JSON.parse(_),Array.isArray(c)&&i.status===404&&(l=[],c=null,h=200,b="OK")}catch{i.status===404&&_===""?(h=204,b="No Content"):c={message:_}}if(c&&this.isMaybeSingle&&(!((u=c==null?void 0:c.details)===null||u===void 0)&&u.includes("Results contain 0 rows"))&&(c=null,h=200,b="OK"),c&&this.shouldThrowOnError)throw c}return{error:c,data:l,count:d,status:h,statusText:b}});return this.shouldThrowOnError||(s=s.catch(i=>{var a,o,u;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(u=i==null?void 0:i.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Yl extends Gl{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${u}"; options=${o};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Qt extends Yl{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Wl{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new Qt({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,u)=>o.concat(Object.keys(u)),[]);if(a.length>0){const o=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",o.join(","))}}return new Qt({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const u=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(u.length>0){const c=[...new Set(u)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new Qt({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Qt({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Qt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Ql="1.7.2",Xl={"X-Client-Info":`postgrest-js/${Ql}`};class ed{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Xl),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Wl(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let o;r?(i="HEAD",Object.entries(t).forEach(([c,l])=>{a.searchParams.append(c,`${l}`)})):(i="POST",o=t);const u=Object.assign({},this.headers);return s&&(u.Prefer=`count=${s}`),new Qt({method:i,url:a,headers:u,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}}var ls,ta;function td(){if(ta)return ls;ta=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return ls=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),ls}const rd="websocket",nd="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",sd=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],id="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",ad=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],od="1.0.34",ud={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},cd="https://github.com/theturtle32/WebSocket-Node",ld={node:">=4.0.0"},dd={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},hd={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},fd={verbose:!1},pd={test:"tape test/unit/*.js",gulp:"gulp"},md="index",yd={lib:"./lib"},gd="lib/browser.js",bd="Apache-2.0",vd={name:rd,description:nd,keywords:sd,author:id,contributors:ad,version:od,repository:ud,homepage:cd,engines:ld,dependencies:dd,devDependencies:hd,config:fd,scripts:pd,main:md,directories:yd,browser:gd,license:bd};var _d=vd.version,Lt;if(typeof globalThis=="object")Lt=globalThis;else try{Lt=td()}catch{}finally{if(!Lt&&typeof window<"u"&&(Lt=window),!Lt)throw new Error("Could not determine global this")}var Vr=Lt.WebSocket||Lt.MozWebSocket,wd=_d;function qo(n,e){var t;return e?t=new Vr(n,e):t=new Vr(n),t}Vr&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(qo,n,{get:function(){return Vr[n]}})});var Od={w3cwebsocket:Vr?qo:null,version:wd};const Ed="2.7.3",Ad={"X-Client-Info":`realtime-js/${Ed}`},Td="1.0.0",zo=1e4,Pd=1e3;var Mr;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Mr||(Mr={}));var He;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(He||(He={}));var nt;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(nt||(nt={}));var Ks;(function(n){n.websocket="websocket"})(Ks||(Ks={}));var $t;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})($t||($t={}));class Ho{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class xd{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const u=r.decode(e.slice(a,a+i));a=a+i;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:u,payload:c}}}class ds{constructor(e,t,r={},s=zo){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ra;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ra||(ra={}));class Ur{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ur.syncState(this.state,s,i,a),this.pendingDiffs.forEach(u=>{this.state=Ur.syncDiff(this.state,u,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ur.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},u={};return this.map(i,(c,l)=>{a[c]||(u[c]=l)}),this.map(a,(c,l)=>{const d=i[c];if(d){const h=l.map(y=>y.presence_ref),b=d.map(y=>y.presence_ref),m=l.filter(y=>b.indexOf(y.presence_ref)<0),_=d.filter(y=>h.indexOf(y.presence_ref)<0);m.length>0&&(o[c]=m),_.length>0&&(u[c]=_)}else o[c]=l}),this.syncDiff(i,{joins:o,leaves:u},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(o,u)=>{var c;const l=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(u),l.length>0){const d=e[o].map(b=>b.presence_ref),h=l.filter(b=>d.indexOf(b.presence_ref)<0);e[o].unshift(...h)}r(o,l,u)}),this.map(a,(o,u)=>{let c=e[o];if(!c)return;const l=u.map(d=>d.presence_ref);c=c.filter(d=>l.indexOf(d.presence_ref)<0),e[o]=c,s(o,c,u),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fe;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(fe||(fe={}));const na=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=Sd(a,n,e,s),i),{})},Sd=(n,e,t,r)=>{const s=e.find(o=>o.name===n),i=s==null?void 0:s.type,a=t[n];return i&&!r.includes(i)?Ko(i,a):Zs(a)},Ko=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Id(e,t)}switch(n){case fe.bool:return kd(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return jd(e);case fe.json:case fe.jsonb:return Cd(e);case fe.timestamp:return Rd(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return Zs(e);default:return Zs(e)}},Zs=n=>n,kd=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},jd=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Cd=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Id=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Ko(e,o))}return n},Rd=n=>typeof n=="string"?n.replace(" ","T"):n;var sa=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})},ia;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ia||(ia={}));var aa;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(aa||(aa={}));var oa;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(oa||(oa={}));class pi{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=He.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new ds(this,nt.join,this.params,this.timeout),this.rejoinTimer=new Ho(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=He.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=He.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=He.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=He.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ur(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const o={},u={broadcast:i,presence:a,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:u},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const d=this.bindings.postgres_changes,h=(l=d==null?void 0:d.length)!==null&&l!==void 0?l:0,b=[];for(let m=0;m<h;m++){const _=d[m],{filter:{event:y,schema:x,table:C,filter:j}}=_,P=c&&c[m];if(P&&P.event===y&&P.schema===x&&P.table===C&&P.filter===j)b.push(Object.assign(Object.assign({},_),{id:P.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return sa(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return sa(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,a;const o=this._push(e.type,e,t.timeout||this.timeout);o.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((a=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.ack)&&r("ok"),o.receive("ok",()=>r("ok")),o.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=He.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new ds(this,nt.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ds(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:u,leave:c,join:l}=nt;if(r&&[o,u,c,l].indexOf(a)>=0&&r!==this._joinRef())return;let h=this._onMessage(a,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(b=>{var m,_,y;return((m=b.filter)===null||m===void 0?void 0:m.event)==="*"||((y=(_=b.filter)===null||_===void 0?void 0:_.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===a}).map(b=>b.callback(h,r)):(i=this.bindings[a])===null||i===void 0||i.filter(b=>{var m,_,y,x,C,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in b){const P=b.id,D=(m=b.filter)===null||m===void 0?void 0:m.event;return P&&((_=t.ids)===null||_===void 0?void 0:_.includes(P))&&(D==="*"||(D==null?void 0:D.toLocaleLowerCase())===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const P=(C=(x=b==null?void 0:b.filter)===null||x===void 0?void 0:x.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return P==="*"||P===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===a}).map(b=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:_,table:y,commit_timestamp:x,type:C,errors:j}=m;h=Object.assign(Object.assign({},{schema:_,table:y,commit_timestamp:x,eventType:C,new:{},old:{},errors:j}),this._getPayloadRecords(m))}b.callback(h,r)})}_isClosed(){return this.state===He.closed}_isJoined(){return this.state===He.joined}_isJoining(){return this.state===He.joining}_isLeaving(){return this.state===He.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&pi.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(nt.close,{},e)}_onError(e){this._on(nt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=He.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=na(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=na(e.columns,e.old_record)),t}}var hs=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Dd=()=>{};class Nd{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Ad,this.params={},this.timeout=zo,this.transport=Od.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Dd,this.conn=null,this.sendBuffer=[],this.serializer=new xd,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Ks.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ho(()=>hs(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return hs(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return hs(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Mr.connecting:return $t.Connecting;case Mr.open:return $t.Open;case Mr.closing:return $t.Closing;default:return $t.Closed}}isConnected(){return this.connectionState()===$t.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new pi(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let a=()=>{this.encode(e,o=>{var u;(u=this.conn)===null||u===void 0||u.send(o)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(a)())return"rate limited"}else a();else this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(nt.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Td}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(s,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(nt.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Pd,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class mi extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ie(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ld extends mi{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ua extends mi{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Zo=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Jo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Zo(void 0,void 0,void 0,function*(){return yield(yield _e(()=>Promise.resolve().then(()=>Ln),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},$d=()=>Zo(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield _e(()=>Promise.resolve().then(()=>Ln),void 0)).Response:Response});var mr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const fs=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Md=(n,e)=>mr(void 0,void 0,void 0,function*(){const t=yield $d();n instanceof t?n.json().then(r=>{e(new Ld(fs(r),n.status||500))}).catch(r=>{e(new ua(fs(r),r))}):e(new ua(fs(n),n))}),Ud=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function $n(n,e,t,r,s,i){return mr(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Ud(e,r,s,i)).then(u=>{if(!u.ok)throw u;return r!=null&&r.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>Md(u,o))})})}function Js(n,e,t,r){return mr(this,void 0,void 0,function*(){return $n(n,"GET",e,t,r)})}function Pt(n,e,t,r,s){return mr(this,void 0,void 0,function*(){return $n(n,"POST",e,r,s,t)})}function Fd(n,e,t,r,s){return mr(this,void 0,void 0,function*(){return $n(n,"PUT",e,r,s,t)})}function Go(n,e,t,r,s){return mr(this,void 0,void 0,function*(){return $n(n,"DELETE",e,r,s,t)})}var Je=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Bd={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ca={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Vd{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Jo(s)}uploadOrUpdate(e,t,r,s){return Je(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},ca),s),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl)):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),l=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return l.ok?{data:{path:u},error:null}:{data:null,error:yield l.json()}}catch(i){if(Ie(i))return{data:null,error:i};throw i}})}upload(e,t,r){return Je(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Je(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let u;const c=Object.assign({upsert:ca.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",c.cacheControl),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.append("cacheControl",c.cacheControl)):(u=r,l["cache-control"]=`max-age=${c.cacheControl}`,l["content-type"]=c.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:u,headers:l});return d.ok?{data:{path:i},error:null}:{data:null,error:yield d.json()}}catch(u){if(Ie(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e){return Je(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield Pt(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new mi("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}update(e,t,r){return Je(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return Je(this,void 0,void 0,function*(){try{return{data:yield Pt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(Ie(r))return{data:null,error:r};throw r}})}copy(e,t){return Je(this,void 0,void 0,function*(){try{return{data:{path:(yield Pt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(Ie(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return Je(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Pt(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(Ie(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Je(this,void 0,void 0,function*(){try{const s=yield Pt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(Ie(s))return{data:null,error:s};throw s}})}download(e,t){return Je(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Js(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(Ie(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",u=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});u!==""&&s.push(u);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${c}`)}}}remove(e){return Je(this,void 0,void 0,function*(){try{return{data:yield Go(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}list(e,t,r){return Je(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Bd),t),{prefix:e||""});return{data:yield Pt(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Ie(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const qd="2.5.1",zd={"X-Client-Info":`storage-js/${qd}`};var Kt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};class Hd{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},zd),t),this.fetch=Jo(r)}listBuckets(){return Kt(this,void 0,void 0,function*(){try{return{data:yield Js(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ie(e))return{data:null,error:e};throw e}})}getBucket(e){return Kt(this,void 0,void 0,function*(){try{return{data:yield Js(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Kt(this,void 0,void 0,function*(){try{return{data:yield Pt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ie(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Kt(this,void 0,void 0,function*(){try{return{data:yield Fd(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ie(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Kt(this,void 0,void 0,function*(){try{return{data:yield Pt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Kt(this,void 0,void 0,function*(){try{return{data:yield Go(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ie(t))return{data:null,error:t};throw t}})}}class Kd extends Hd{constructor(e,t={},r){super(e,t,r)}from(e){return new Vd(this.url,this.headers,e,this.fetch)}}const Zd="2.26.0",Jd={"X-Client-Info":`supabase-js/${Zd}`};var Gd=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Yd=n=>{let e;return n?e=n:typeof fetch>"u"?e=fi:e=fetch,(...t)=>e(...t)},Wd=()=>typeof Headers>"u"?hi.Headers:Headers,Qd=(n,e,t)=>{const r=Yd(t),s=Wd();return(i,a)=>Gd(void 0,void 0,void 0,function*(){var o;const u=(o=yield e())!==null&&o!==void 0?o:n;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${u}`),r(i,Object.assign(Object.assign({},a),{headers:c}))})};function Xd(n){return n.replace(/\/$/,"")}function eh(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:a,auth:o,realtime:u,global:c}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},u),s),global:Object.assign(Object.assign({},c),i)}}function th(n){return Math.round(Date.now()/1e3)+n}function rh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const gt=()=>typeof document<"u",Rt={tested:!1,writable:!1},_n=()=>{if(!gt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rt.tested)return Rt.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Rt.tested=!0,Rt.writable=!0}catch{Rt.tested=!0,Rt.writable=!1}return Rt.writable};function Be(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Yo=n=>{let e;return n?e=n:typeof fetch>"u"?e=async(...t)=>await(await _e(()=>Promise.resolve().then(()=>Ln),void 0)).fetch(...t):e=fetch,(...t)=>e(...t)},nh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",_r=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},hn=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ps=async(n,e)=>{await n.removeItem(e)};function sh(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,a,o,u,c,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)a=e.indexOf(n.charAt(l++)),o=e.indexOf(n.charAt(l++)),u=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),r=a<<2|o>>4,s=(o&15)<<4|u>>2,i=(u&3)<<6|c,t=t+String.fromCharCode(r),u!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Mn{constructor(){this.promise=new Mn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Mn.promiseConstructor=Promise;function la(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(sh(r))}function ih(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function ah(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function oh(n){return("0"+n.toString(16)).substr(-2)}function fn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,oh).join("")}async function uh(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}function ch(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pn(n){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=await uh(n);return ch(e)}class yi extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function oe(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class lh extends yi{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function dh(n){return oe(n)&&n.name==="AuthApiError"}class Wo extends yi{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class yr extends yi{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Zt extends yr{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class ms extends yr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class mn extends yr{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class yt extends yr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ys extends yr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Gs extends yr{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function da(n){return oe(n)&&n.name==="AuthRetryableFetchError"}var hh=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Lr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),fh=[502,503,504];async function ha(n){if(!nh(n))throw new Gs(Lr(n),0);if(fh.includes(n.status))throw new Gs(Lr(n),n.status);let e;try{e=await n.json()}catch(t){throw new Wo(Lr(t),t)}throw new lh(Lr(e),n.status||500)}const ph=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function le(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=await mh(n,e,t+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(u):{data:Object.assign({},u),error:null}}async function mh(n,e,t,r,s,i){const a=ph(e,r,s,i);let o;try{o=await n(t,a)}catch(u){throw console.error(u),new Gs(Lr(u),0)}if(o.ok||await ha(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(u){await ha(u)}}function Et(n){var e;let t=null;vh(n)&&(t=Object.assign({},n),t.expires_at=th(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Mt(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function yh(n){return{data:n,error:null}}function gh(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=hh(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},u=Object.assign({},a);return{data:{properties:o,user:u},error:null}}function bh(n){return n}function vh(n){return n.access_token&&n.refresh_token&&n.expires_in}var _h=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class wh{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Yo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await le(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(oe(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await le(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Mt})}catch(r){if(oe(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=_h(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:gh,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(oe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await le(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Mt})}catch(t){if(oe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,a,o,u;try{const c={nextPage:null,lastPage:0,total:0},l=await le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:bh});if(l.error)throw l.error;const d=await l.json(),h=(a=l.headers.get("x-total-count"))!==null&&a!==void 0?a:0,b=(u=(o=l.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&u!==void 0?u:[];return b.length>0&&(b.forEach(m=>{const _=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(m.split(";")[1].split("=")[1]);c[`${y}Page`]=_}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(oe(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await le(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Mt})}catch(t){if(oe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await le(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Mt})}catch(r){if(oe(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await le(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Mt})}catch(r){if(oe(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await le(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(oe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await le(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(oe(t))return{data:null,error:t};throw t}}}const Oh="2.42.0",Eh="http://localhost:9999",Ah="supabase.auth.token",Th={"X-Client-Info":`gotrue-js/${Oh}`},fa=10,pa={getItem:n=>_n()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{_n()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{_n()&&globalThis.localStorage.removeItem(n)}};function Ph(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}Ph();const xh={url:Eh,storageKey:Ah,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Th,flowType:"implicit",debug:!1},yn=30*1e3,ma=3;class qr{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=qr.nextInstanceID,qr.nextInstanceID+=1,this.instanceID>0&&gt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},xh),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||pa,this.admin=new wh({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Yo(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===pa&&!_n()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),gt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}async _initialize(){if(this.initializePromise)return this.initializePromise;try{const e=gt()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return oe(e)?{error:e}:{error:new Wo("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,r,s;try{await this._removeSession();let i;if("email"in e){const{email:l,password:d,options:h}=e;let b=null,m=null;if(this.flowType==="pkce"){const _=fn();await _r(this.storage,`${this.storageKey}-code-verifier`,_),b=await pn(_),m=_===b?"plain":"s256"}i=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:l,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:b,code_challenge_method:m},xform:Et})}else if("phone"in e){const{phone:l,password:d,options:h}=e;i=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:d,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Et})}else throw new mn("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const u=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:c,session:u},error:null}}catch(i){if(oe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Et})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Et})}else throw new mn("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ms}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){const t=await hn(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=await le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:Et});return await ps(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ms}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:a}=e,o=await le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Et}),{data:u,error:c}=o;return c?{data:{user:null,session:null},error:c}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new ms}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:c})}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:u}=e;let c=null,l=null;if(this.flowType==="pkce"){const h=fn();await _r(this.storage,`${this.storageKey}-code-verifier`,h),c=await pn(h),l=h===c?"plain":"s256"}const{error:d}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},create_user:(r=u==null?void 0:u.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:c,code_challenge_method:l},redirectTo:u==null?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:o,options:u}=e,{data:c,error:l}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},create_user:(i=u==null?void 0:u.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(a=u==null?void 0:u.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:l}}throw new mn("You must provide either an email or phone number.")}catch(o){if(oe(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();const{data:s,error:i}=await le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:Et});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const a=s.session,o=s.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:o,session:a},error:null}}catch(s){if(oe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{return await this._removeSession(),await le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:yh})}catch(i){if(oe(i))return{data:null,error:i};throw i}}async reauthenticate(){try{const{data:{session:e},error:t}=await this.getSession();if(t)throw t;if(!e)throw new Zt;const{error:r}=await le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(oe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await le(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:o}=await le(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new mn("You must provide either an email or phone number and a type")}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise,this._debug("#getSession()","begin");try{let e=null;if(this.persistSession){const i=await hn(this.storage,this.storageKey);this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#getSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#getSession()","end")}}async getUser(e){var t,r;try{if(!e){const{data:s,error:i}=await this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return await le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Mt})}catch(s){if(oe(s))return{data:{user:null},error:s};throw s}}async updateUser(e,t={}){try{const{data:r,error:s}=await this.getSession();if(s)throw s;if(!r.session)throw new Zt;const i=r.session,{data:a,error:o}=await le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:Mt});if(o)throw o;return i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(oe(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return la(e)}async setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Zt;const t=Date.now()/1e3;let r=t,s=!0,i=null;const a=la(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:u}=await this.getUser(e.access_token);if(u)throw u;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(oe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){var t;try{if(!e){const{data:i,error:a}=await this.getSession();if(a)throw a;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new Zt;const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(oe(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromUrl(e){try{if(!gt())throw new yt("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new yt("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new ys("Not a valid PKCE flow url.");if(e){const y=Be("code");if(!y)throw new ys("No code detected.");const{data:x,error:C}=await this.exchangeCodeForSession(y);if(C)throw C;if(!x.session)throw new ys("No session detected.");let j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:x.session,redirectType:null},error:null}}const t=Be("error_description");if(t){const y=Be("error_code");if(!y)throw new yt("No error_code detected.");const x=Be("error");throw x?new yt(t,{error:x,code:y}):new yt("No error detected.")}const r=Be("provider_token"),s=Be("provider_refresh_token"),i=Be("access_token");if(!i)throw new yt("No access_token detected.");const a=Be("expires_in");if(!a)throw new yt("No expires_in detected.");const o=Be("refresh_token");if(!o)throw new yt("No refresh_token detected.");const u=Be("token_type");if(!u)throw new yt("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(a),{data:d,error:h}=await this.getUser(i);if(h)throw h;const b=d.user,m={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(a),expires_at:l,refresh_token:o,token_type:u,user:b},_=Be("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:m,redirectType:_},error:null}}catch(t){if(oe(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){return gt()&&(!!Be("access_token")||!!Be("error_description"))}async _isPKCEFlow(){const e=await hn(this.storage,`${this.storageKey}-code-verifier`);return!!Be("code")&&!!e}async signOut({scope:e}={scope:"global"}){var t;const{data:r,error:s}=await this.getSession();if(s)return{error:s};const i=(t=r.session)===null||t===void 0?void 0:t.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(dh(a)&&(a.status===404||a.status===401)))return{error:a}}return e!=="others"&&(await this._removeSession(),await ps(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}onAuthStateChange(e){const t=rh(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}async _emitInitialSession(e){var t,r;try{const{data:{session:s},error:i}=await this.getSession();if(i)throw i;await((t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}}async resetPasswordForEmail(e,t={}){let r=null,s=null;if(this.flowType==="pkce"){const i=fn();await _r(this.storage,`${this.storageKey}-code-verifier`,i),r=await pn(i),s=i===r?"plain":"s256"}try{return await le(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(oe(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ah(async s=>(await ih(s*200),this._debug(t,"refreshing attempt",s),await le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Et})),(s,i,a)=>a&&a.error&&da(a.error)&&Date.now()+(s+1)*200-r<yn)}catch(r){if(this._debug(t,"error",r),oe(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),gt()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await hn(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+fa;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${fa}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),da(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Zt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Mn;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Zt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),oe(i)){const a={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(u){i.push(u)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),_r(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),this.persistSession?await ps(this.storage,this.storageKey):this.inMemorySession=null}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&gt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),yn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),await this._autoRefreshTokenTick()}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{const{data:{session:t}}=await this.getSession();if(!t||!t.refresh_token||!t.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((t.expires_at*1e3-e)/yn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${yn}ms, refresh threshold is ${ma} ticks`),r<=ma&&await this._callRefreshToken(t.refresh_token)}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!gt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(await this.initializePromise,await this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=fn();await _r(this.storage,`${this.storageKey}-code-verifier`,s);const i=await pn(s),a=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",a);const o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){var t;try{const{data:r,error:s}=await this.getSession();return s?{data:null,error:s}:await le(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(oe(r))return{data:null,error:r};throw r}}async _enroll(e){var t,r;try{const{data:s,error:i}=await this.getSession();if(i)return{data:null,error:i};const{data:a,error:o}=await le(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(!((r=a==null?void 0:a.totp)===null||r===void 0)&&r.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}catch(s){if(oe(s))return{data:null,error:s};throw s}}async _verify(e){var t;try{const{data:r,error:s}=await this.getSession();if(s)return{data:null,error:s};const{data:i,error:a}=await le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})}catch(r){if(oe(r))return{data:null,error:r};throw r}}async _challenge(e){var t;try{const{data:r,error:s}=await this.getSession();return s?{data:null,error:s}:await le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(oe(r))return{data:null,error:r};throw r}}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:s}=await this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let a=null;i.aal&&(a=i.aal);let o=a;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(o="aal2");const c=i.amr||[];return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:c},error:null}}}qr.nextInstanceID=0;class Sh extends qr{constructor(e){super(e)}}var kh=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const jh={headers:Jd},Ch={schema:"public"},Ih={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Rh={};class Dh{constructor(e,t,r){var s,i,a,o,u,c,l,d;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Xd(e);this.realtimeUrl=`${h}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${h}/auth/v1`,this.storageUrl=`${h}/storage/v1`,this.functionsUrl=`${h}/functions/v1`;const b=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:Ch,realtime:Rh,auth:Object.assign(Object.assign({},Ih),{storageKey:b}),global:jh},_=eh(r??{},m);this.storageKey=(i=(s=_.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=(a=_.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((u=_.auth)!==null&&u!==void 0?u:{},this.headers,(c=_.global)===null||c===void 0?void 0:c.fetch),this.fetch=Qd(t,this._getAccessToken.bind(this),(l=_.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new ed(`${h}/rest/v1`,{headers:this.headers,schema:(d=_.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Jl(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Kd(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return kh(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:a},o,u){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Sh({url:this.authUrl,headers:Object.assign(Object.assign({},c),o),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,fetch:u})}_initRealtimeClient(e){return new Nd(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const er=(n,e,t)=>new Dh(n,e,t);function ya(n){return Array.isArray(n)?n:[n]}function Nh(n){let e,t,r,s=!1;return function(a){e===void 0?(e=a,t=0,r=-1):e=$h(e,a);const o=e.length;let u=0;for(;t<o;){s&&(e[t]===10&&(u=++t),s=!1);let c=-1;for(;t<o&&c===-1;++t)switch(e[t]){case 58:r===-1&&(r=t-u);break;case 13:s=!0;case 10:c=t;break}if(c===-1)break;n(e.subarray(u,c),r),u=t,r=-1}u===o?e=void 0:u!==0&&(e=e.subarray(u),t-=u)}}function Lh(n,e,t){let r=ga();const s=new TextDecoder;return function(a,o){if(a.length===0)t==null||t(r),r=ga();else if(o>0){const u=s.decode(a.subarray(0,o)),c=o+(a[o+1]===32?2:1),l=s.decode(a.subarray(c));switch(u){case"data":r.data=r.data?r.data+`
`+l:l;break;case"event":r.event=l;break;case"id":n(r.id=l);break;case"retry":const d=parseInt(l,10);isNaN(d)||e(r.retry=d);break}}}}function $h(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function ga(){return{data:"",event:"",id:"",retry:void 0}}var Mh="https://api-inference.huggingface.co/models/",Qo=(n=>(n.Length="length",n.EndOfSequenceToken="eos_token",n.StopSequence="stop_sequence",n))(Qo||{}),Xo=class{constructor(n="",e={}){ut(this,"apiKey");ut(this,"defaultOptions");this.apiKey=n,this.defaultOptions=e}async fillMask(n,e){const t=await this.request(n,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.score=="number"&&typeof s.sequence=="string"&&typeof s.token=="number"&&typeof s.token_str=="string")))throw new TypeError("Invalid inference output: output must be of type Array<score: number, sequence:string, token:number, token_str:string>");return t}async summarization(n,e){const t=await this.request(n,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.summary_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<summary_text: string>");return t==null?void 0:t[0]}async questionAnswer(n,e){const t=await this.request(n,e);if(!(typeof t.answer=="string"&&typeof t.end=="number"&&typeof t.score=="number"&&typeof t.start=="number"))throw new TypeError("Invalid inference output: output must be of type <answer: string, end: number, score: number, start: number>");return t}async tableQuestionAnswer(n,e){const t=await this.request(n,e);if(!(typeof t.aggregator=="string"&&typeof t.answer=="string"&&Array.isArray(t.cells)&&t.cells.every(s=>typeof s=="string")&&Array.isArray(t.coordinates)&&t.coordinates.every(s=>Array.isArray(s)&&s.every(i=>typeof i=="number"))))throw new TypeError("Invalid inference output: output must be of type <aggregator: string, answer: string, cells: string[], coordinates: number[][]>");return t}async textClassification(n,e){var s;const t=(s=await this.request(n,e))==null?void 0:s[0];if(!(Array.isArray(t)&&t.every(i=>typeof i.label=="string"&&typeof i.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async textGeneration(n,e){const t=await this.request(n,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.generated_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<generated_text: string>");return t==null?void 0:t[0]}async*textGenerationStream(n,e){yield*this.streamingRequest(n,e)}async tokenClassification(n,e){const t=ya(await this.request(n,e));if(!(Array.isArray(t)&&t.every(s=>typeof s.end=="number"&&typeof s.entity_group=="string"&&typeof s.score=="number"&&typeof s.start=="number"&&typeof s.word=="string")))throw new TypeError("Invalid inference output: output must be of type Array<end: number, entity_group: string, score: number, start: number, word: string>");return t}async translation(n,e){const t=await this.request(n,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.translation_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<translation_text: string>");return t==null?void 0:t[0]}async zeroShotClassification(n,e){const t=ya(await this.request(n,e));if(!(Array.isArray(t)&&t.every(s=>Array.isArray(s.labels)&&s.labels.every(i=>typeof i=="string")&&Array.isArray(s.scores)&&s.scores.every(i=>typeof i=="number")&&typeof s.sequence=="string")))throw new TypeError("Invalid inference output: output must be of type Array<labels: string[], scores: number[], sequence: string>");return t}async conversational(n,e){const t=await this.request(n,e);if(!(Array.isArray(t.conversation.generated_responses)&&t.conversation.generated_responses.every(s=>typeof s=="string")&&Array.isArray(t.conversation.past_user_inputs)&&t.conversation.past_user_inputs.every(s=>typeof s=="string")&&typeof t.generated_text=="string"&&Array.isArray(t.warnings)&&t.warnings.every(s=>typeof s=="string")))throw new TypeError("Invalid inference output: output must be of type <conversation: {generated_responses: string[], past_user_inputs: string[]}, generated_text: string, warnings: string[]>");return t}async featureExtraction(n,e){return await this.request(n,e)}async automaticSpeechRecognition(n,e){const t=await this.request(n,{...e,binary:!0});if(!(typeof t.text=="string"))throw new TypeError("Invalid inference output: output must be of type <text: string>");return t}async audioClassification(n,e){const t=await this.request(n,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async imageClassification(n,e){const t=await this.request(n,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async objectDetection(n,e){const t=await this.request(n,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number"&&typeof s.box.xmin=="number"&&typeof s.box.ymin=="number"&&typeof s.box.xmax=="number"&&typeof s.box.ymax=="number")))throw new TypeError("Invalid inference output: output must be of type Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return t}async imageSegmentation(n,e){const t=await this.request(n,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.mask=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, mask: string, score: number>");return t}async textToImage(n,e){const t=await this.request(n,{...e,blob:!0});if(!(t&&t instanceof Blob))throw new TypeError("Invalid inference output: output must be of type object & of instance Blob");return t}async imageToText(n,e){var t;return(t=await this.request(n,{...e,binary:!0}))==null?void 0:t[0]}makeRequestOptions(n,e){const t={...this.defaultOptions,...e},{model:r,...s}=n,i={};this.apiKey&&(i.Authorization=`Bearer ${this.apiKey}`),e!=null&&e.binary||(i["Content-Type"]="application/json"),e!=null&&e.binary&&(t.wait_for_model&&(i["X-Wait-For-Model"]="true"),t.use_cache===!1&&(i["X-Use-Cache"]="false"),t.dont_load_model&&(i["X-Load-Model"]="0"));const a=`${Mh}${r}`,o={headers:i,method:"POST",body:e!=null&&e.binary?n.data:JSON.stringify({...s,options:t}),credentials:e!=null&&e.includeCredentials?"include":"same-origin"};return{url:a,info:o,mergedOptions:t}}async request(n,e){const{url:t,info:r,mergedOptions:s}=this.makeRequestOptions(n,e),i=await fetch(t,r);if(s.retry_on_error!==!1&&i.status===503&&!s.wait_for_model)return this.request(n,{...s,wait_for_model:!0});if(e!=null&&e.blob){if(!i.ok)throw new Error("An error occurred while fetching the blob");return await i.blob()}const a=await i.json();if(a.error)throw new Error(a.error);return a}async*streamingRequest(n,e){var l;const{url:t,info:r,mergedOptions:s}=this.makeRequestOptions({...n,stream:!0},e),i=await fetch(t,r);if(s.retry_on_error!==!1&&i.status===503&&!s.wait_for_model)return this.streamingRequest(n,{...s,wait_for_model:!0});if(!i.ok){if((l=i.headers.get("Content-Type"))!=null&&l.startsWith("application/json")){const d=await i.json();if(d.error)throw new Error(d.error)}throw new Error(`Server response contains error: ${i.status}`)}if(i.headers.get("content-type")!=="text/event-stream")throw new Error("Server does not support event stream content type, it returned "+i.headers.get("content-type"));if(!i.body)return;const a=i.body.getReader();let o=[];const c=Nh(Lh(()=>{},()=>{},d=>{o.push(d)}));try{for(;;){const{done:d,value:h}=await a.read();if(d)return;c(h);for(const b of o)b.data.length>0&&(yield JSON.parse(b.data));o=[]}}finally{a.releaseLock()}}};const Uh=Object.freeze(Object.defineProperty({__proto__:null,HfInference:Xo,TextGenerationStreamFinishReason:Qo},Symbol.toStringTag,{value:"Module"}));class eu{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new li(e??{})}}const Fh=()=>typeof window<"u"&&typeof window.document<"u",Bh=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Vh=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),tu=()=>typeof Deno<"u",ru=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!tu(),gi=()=>{let n;return Fh()?n="browser":ru()?n="node":Bh()?n="webworker":Vh()?n="jsdom":tu()?n="deno":n="other",n};let gs;async function qh(){return gs===void 0&&(gs={library:"langchain-js",runtime:gi()}),gs}function Te(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}class Ys extends eu{constructor(e){super(e??{}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=(e==null?void 0:e.model)??"sentence-transformers/distilbert-base-nli-mean-tokens",this.apiKey=(e==null?void 0:e.apiKey)??Te("HUGGINGFACEHUB_API_KEY"),this.client=new Xo(this.apiKey)}async _embed(e){const t=e.map(r=>r.replace(/\n/g," "));return this.caller.call(()=>this.client.featureExtraction({model:this.model,inputs:t}))}embedQuery(e){return this._embed([e]).then(t=>t[0])}embedDocuments(e){return this._embed(e)}}const nu="__run";class Un extends it{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class su extends Un{_getType(){return"human"}}class iu extends Un{_getType(){return"ai"}}class zh extends Un{_getType(){return"system"}}class Sb extends Un{constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}}class au extends it{}class Hh{}class Kh{}class Zh extends Hh{constructor(e){super(),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.filter=e.filter}async getRelevantDocuments(e){return await this.vectorStore.similaritySearch(e,this.k,this.filter)}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class Jh{constructor(e,t){Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(i=>i[0])}async similaritySearchWithScore(e,t=4,r=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t){return new Zh({vectorStore:this,k:e,filter:t})}}class tr extends Jh{constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter}async addDocuments(e,t){const r=e.map(({pageContent:s})=>s);return this.addVectors(await this.embeddings.embedDocuments(r),e,t)}async addVectors(e,t,r){const s=e.map((o,u)=>({content:t[u].pageContent,embedding:o,metadata:t[u].metadata})),i=500;let a=[];for(let o=0;o<s.length;o+=i){const u=s.slice(o,o+i).map(l=>r!=null&&r.ids?{id:r.ids[o],...l}:l),c=await this.client.from(this.tableName).upsert(u).select();if(c.error)throw new Error(`Error inserting: ${c.error.message} ${c.status} ${c.statusText}`);c.data&&(a=a.concat(c.data.map(l=>l.id)))}return a}async delete(e){const{ids:t}=e;for(const r of t)await this.client.from(this.tableName).delete().eq("id",r)}async similaritySearchVectorWithScore(e,t,r){if(r&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=r??this.filter??{},i={query_embedding:e};let a;if(typeof s=="function")a=d=>s(d).limit(t);else if(typeof s=="object")i.filter=s,i.match_count=t,a=d=>d;else throw new Error("invalid filter type");const o=this.client.rpc(this.queryName,i),{data:u,error:c}=await a(o);if(c)throw new Error(`Error searching for documents: ${c.code} ${c.message} ${c.details}`);return u.map(d=>[new Fr({metadata:d.metadata,pageContent:d.content}),d.similarity])}static async fromTexts(e,t,r,s){const i=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(t)?t[a]:t,u=new Fr({pageContent:e[a],metadata:o});i.push(u)}return tr.fromDocuments(i,r,s)}static async fromDocuments(e,t,r){const s=new this(t,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,t){return new this(e,t)}}var Ws={},ou={},bi={exports:{}},uu=function(e,t){return function(){for(var s=new Array(arguments.length),i=0;i<s.length;i++)s[i]=arguments[i];return e.apply(t,s)}},Gh=uu,It=Object.prototype.toString;function vi(n){return Array.isArray(n)}function Qs(n){return typeof n>"u"}function Yh(n){return n!==null&&!Qs(n)&&n.constructor!==null&&!Qs(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function cu(n){return It.call(n)==="[object ArrayBuffer]"}function Wh(n){return It.call(n)==="[object FormData]"}function Qh(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&cu(n.buffer),e}function Xh(n){return typeof n=="string"}function ef(n){return typeof n=="number"}function lu(n){return n!==null&&typeof n=="object"}function wn(n){if(It.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function tf(n){return It.call(n)==="[object Date]"}function rf(n){return It.call(n)==="[object File]"}function nf(n){return It.call(n)==="[object Blob]"}function du(n){return It.call(n)==="[object Function]"}function sf(n){return lu(n)&&du(n.pipe)}function af(n){return It.call(n)==="[object URLSearchParams]"}function of(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function uf(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function _i(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),vi(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.call(null,n[s],s,n)}function Xs(){var n={};function e(s,i){wn(n[i])&&wn(s)?n[i]=Xs(n[i],s):wn(s)?n[i]=Xs({},s):vi(s)?n[i]=s.slice():n[i]=s}for(var t=0,r=arguments.length;t<r;t++)_i(arguments[t],e);return n}function cf(n,e,t){return _i(e,function(s,i){t&&typeof s=="function"?n[i]=Gh(s,t):n[i]=s}),n}function lf(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}var qe={isArray:vi,isArrayBuffer:cu,isBuffer:Yh,isFormData:Wh,isArrayBufferView:Qh,isString:Xh,isNumber:ef,isObject:lu,isPlainObject:wn,isUndefined:Qs,isDate:tf,isFile:rf,isBlob:nf,isFunction:du,isStream:sf,isURLSearchParams:af,isStandardBrowserEnv:uf,forEach:_i,merge:Xs,extend:cf,trim:of,stripBOM:lf},Jt=qe;function ba(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var hu=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(Jt.isURLSearchParams(t))s=t.toString();else{var i=[];Jt.forEach(t,function(u,c){u===null||typeof u>"u"||(Jt.isArray(u)?c=c+"[]":u=[u],Jt.forEach(u,function(d){Jt.isDate(d)?d=d.toISOString():Jt.isObject(d)&&(d=JSON.stringify(d)),i.push(ba(c)+"="+ba(d))}))}),s=i.join("&")}if(s){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e},df=qe;function Fn(){this.handlers=[]}Fn.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Fn.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Fn.prototype.forEach=function(e){df.forEach(this.handlers,function(r){r!==null&&e(r)})};var hf=Fn,ff=qe,pf=function(e,t){ff.forEach(e,function(s,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[i])})},fu=function(e,t,r,s,i){return e.config=t,r&&(e.code=r),e.request=s,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},pu={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bs,va;function mu(){if(va)return bs;va=1;var n=fu;return bs=function(t,r,s,i,a){var o=new Error(t);return n(o,r,s,i,a)},bs}var vs,_a;function mf(){if(_a)return vs;_a=1;var n=mu();return vs=function(t,r,s){var i=s.config.validateStatus;!s.status||!i||i(s.status)?t(s):r(n("Request failed with status code "+s.status,s.config,null,s.request,s))},vs}var _s,wa;function yf(){if(wa)return _s;wa=1;var n=qe;return _s=n.isStandardBrowserEnv()?function(){return{write:function(r,s,i,a,o,u){var c=[];c.push(r+"="+encodeURIComponent(s)),n.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),n.isString(a)&&c.push("path="+a),n.isString(o)&&c.push("domain="+o),u===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var s=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),_s}var ws,Oa;function gf(){return Oa||(Oa=1,ws=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),ws}var Os,Ea;function bf(){return Ea||(Ea=1,Os=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),Os}var Es,Aa;function vf(){if(Aa)return Es;Aa=1;var n=gf(),e=bf();return Es=function(r,s){return r&&!n(s)?e(r,s):s},Es}var As,Ta;function _f(){if(Ta)return As;Ta=1;var n=qe,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return As=function(r){var s={},i,a,o;return r&&n.forEach(r.split(`
`),function(c){if(o=c.indexOf(":"),i=n.trim(c.substr(0,o)).toLowerCase(),a=n.trim(c.substr(o+1)),i){if(s[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?s[i]=(s[i]?s[i]:[]).concat([a]):s[i]=s[i]?s[i]+", "+a:a}}),s},As}var Ts,Pa;function wf(){if(Pa)return Ts;Pa=1;var n=qe;return Ts=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),s;function i(a){var o=a;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return s=i(window.location.href),function(o){var u=n.isString(o)?i(o):o;return u.protocol===s.protocol&&u.host===s.host}}():function(){return function(){return!0}}(),Ts}var Ps,xa;function Bn(){if(xa)return Ps;xa=1;function n(e){this.message=e}return n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,Ps=n,Ps}var xs,Sa;function ka(){if(Sa)return xs;Sa=1;var n=qe,e=mf(),t=yf(),r=hu,s=vf(),i=_f(),a=wf(),o=mu(),u=pu,c=Bn();return xs=function(d){return new Promise(function(b,m){var _=d.data,y=d.headers,x=d.responseType,C;function j(){d.cancelToken&&d.cancelToken.unsubscribe(C),d.signal&&d.signal.removeEventListener("abort",C)}n.isFormData(_)&&delete y["Content-Type"];var P=new XMLHttpRequest;if(d.auth){var D=d.auth.username||"",A=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";y.Authorization="Basic "+btoa(D+":"+A)}var I=s(d.baseURL,d.url);P.open(d.method.toUpperCase(),r(I,d.params,d.paramsSerializer),!0),P.timeout=d.timeout;function g(){if(P){var p="getAllResponseHeaders"in P?i(P.getAllResponseHeaders()):null,E=!x||x==="text"||x==="json"?P.responseText:P.response,k={data:E,status:P.status,statusText:P.statusText,headers:p,config:d,request:P};e(function(O){b(O),j()},function(O){m(O),j()},k),P=null}}if("onloadend"in P?P.onloadend=g:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(g)},P.onabort=function(){P&&(m(o("Request aborted",d,"ECONNABORTED",P)),P=null)},P.onerror=function(){m(o("Network Error",d,null,P)),P=null},P.ontimeout=function(){var E=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",k=d.transitional||u;d.timeoutErrorMessage&&(E=d.timeoutErrorMessage),m(o(E,d,k.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",P)),P=null},n.isStandardBrowserEnv()){var w=(d.withCredentials||a(I))&&d.xsrfCookieName?t.read(d.xsrfCookieName):void 0;w&&(y[d.xsrfHeaderName]=w)}"setRequestHeader"in P&&n.forEach(y,function(E,k){typeof _>"u"&&k.toLowerCase()==="content-type"?delete y[k]:P.setRequestHeader(k,E)}),n.isUndefined(d.withCredentials)||(P.withCredentials=!!d.withCredentials),x&&x!=="json"&&(P.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&P.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(C=function(p){P&&(m(!p||p&&p.type?new c("canceled"):p),P.abort(),P=null)},d.cancelToken&&d.cancelToken.subscribe(C),d.signal&&(d.signal.aborted?C():d.signal.addEventListener("abort",C))),_||(_=null),P.send(_)})},xs}var Se=qe,ja=pf,Of=fu,Ef=pu,Af={"Content-Type":"application/x-www-form-urlencoded"};function Ca(n,e){!Se.isUndefined(n)&&Se.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function Tf(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=ka()),n}function Pf(n,e,t){if(Se.isString(n))try{return(e||JSON.parse)(n),Se.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Vn={transitional:Ef,adapter:Tf(),transformRequest:[function(e,t){return ja(t,"Accept"),ja(t,"Content-Type"),Se.isFormData(e)||Se.isArrayBuffer(e)||Se.isBuffer(e)||Se.isStream(e)||Se.isFile(e)||Se.isBlob(e)?e:Se.isArrayBufferView(e)?e.buffer:Se.isURLSearchParams(e)?(Ca(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Se.isObject(e)||t&&t["Content-Type"]==="application/json"?(Ca(t,"application/json"),Pf(e)):e}],transformResponse:[function(e){var t=this.transitional||Vn.transitional,r=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,i=!r&&this.responseType==="json";if(i||s&&Se.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?Of(a,this,"E_JSON_PARSE"):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Se.forEach(["delete","get","head"],function(e){Vn.headers[e]={}});Se.forEach(["post","put","patch"],function(e){Vn.headers[e]=Se.merge(Af)});var wi=Vn,xf=qe,Sf=wi,kf=function(e,t,r){var s=this||Sf;return xf.forEach(r,function(a){e=a.call(s,e,t)}),e},Ss,Ia;function yu(){return Ia||(Ia=1,Ss=function(e){return!!(e&&e.__CANCEL__)}),Ss}var Ra=qe,ks=kf,jf=yu(),Cf=wi,If=Bn();function js(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new If("canceled")}var Rf=function(e){js(e),e.headers=e.headers||{},e.data=ks.call(e,e.data,e.headers,e.transformRequest),e.headers=Ra.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Ra.forEach(["delete","get","head","post","put","patch","common"],function(s){delete e.headers[s]});var t=e.adapter||Cf.adapter;return t(e).then(function(s){return js(e),s.data=ks.call(e,s.data,s.headers,e.transformResponse),s},function(s){return jf(s)||(js(e),s&&s.response&&(s.response.data=ks.call(e,s.response.data,s.response.headers,e.transformResponse))),Promise.reject(s)})},ze=qe,gu=function(e,t){t=t||{};var r={};function s(l,d){return ze.isPlainObject(l)&&ze.isPlainObject(d)?ze.merge(l,d):ze.isPlainObject(d)?ze.merge({},d):ze.isArray(d)?d.slice():d}function i(l){if(ze.isUndefined(t[l])){if(!ze.isUndefined(e[l]))return s(void 0,e[l])}else return s(e[l],t[l])}function a(l){if(!ze.isUndefined(t[l]))return s(void 0,t[l])}function o(l){if(ze.isUndefined(t[l])){if(!ze.isUndefined(e[l]))return s(void 0,e[l])}else return s(void 0,t[l])}function u(l){if(l in t)return s(e[l],t[l]);if(l in e)return s(void 0,e[l])}var c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u};return ze.forEach(Object.keys(e).concat(Object.keys(t)),function(d){var h=c[d]||i,b=h(d);ze.isUndefined(b)&&h!==u||(r[d]=b)}),r},Cs,Da;function bu(){return Da||(Da=1,Cs={version:"0.26.1"}),Cs}var Df=bu().version,Oi={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){Oi[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var Na={};Oi.transitional=function(e,t,r){function s(i,a){return"[Axios v"+Df+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return function(i,a,o){if(e===!1)throw new Error(s(a," has been removed"+(t?" in "+t:"")));return t&&!Na[a]&&(Na[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function Nf(n,e,t){if(typeof n!="object")throw new TypeError("options must be an object");for(var r=Object.keys(n),s=r.length;s-- >0;){var i=r[s],a=e[i];if(a){var o=n[i],u=o===void 0||a(o,i,n);if(u!==!0)throw new TypeError("option "+i+" must be "+u);continue}if(t!==!0)throw Error("Unknown option "+i)}}var Lf={assertOptions:Nf,validators:Oi},vu=qe,$f=hu,La=hf,$a=Rf,qn=gu,_u=Lf,Gt=_u.validators;function tn(n){this.defaults=n,this.interceptors={request:new La,response:new La}}tn.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=qn(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&_u.assertOptions(r,{silentJSONParsing:Gt.transitional(Gt.boolean),forcedJSONParsing:Gt.transitional(Gt.boolean),clarifyTimeoutError:Gt.transitional(Gt.boolean)},!1);var s=[],i=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(i=i&&b.synchronous,s.unshift(b.fulfilled,b.rejected))});var a=[];this.interceptors.response.forEach(function(b){a.push(b.fulfilled,b.rejected)});var o;if(!i){var u=[$a,void 0];for(Array.prototype.unshift.apply(u,s),u=u.concat(a),o=Promise.resolve(t);u.length;)o=o.then(u.shift(),u.shift());return o}for(var c=t;s.length;){var l=s.shift(),d=s.shift();try{c=l(c)}catch(h){d(h);break}}try{o=$a(c)}catch(h){return Promise.reject(h)}for(;a.length;)o=o.then(a.shift(),a.shift());return o};tn.prototype.getUri=function(e){return e=qn(this.defaults,e),$f(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};vu.forEach(["delete","get","head","options"],function(e){tn.prototype[e]=function(t,r){return this.request(qn(r||{},{method:e,url:t,data:(r||{}).data}))}});vu.forEach(["post","put","patch"],function(e){tn.prototype[e]=function(t,r,s){return this.request(qn(s||{},{method:e,url:t,data:r}))}});var Mf=tn,Is,Ma;function Uf(){if(Ma)return Is;Ma=1;var n=Bn();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(a){r=a});var s=this;this.promise.then(function(i){if(s._listeners){var a,o=s._listeners.length;for(a=0;a<o;a++)s._listeners[a](i);s._listeners=null}}),this.promise.then=function(i){var a,o=new Promise(function(u){s.subscribe(u),a=u}).then(i);return o.cancel=function(){s.unsubscribe(a)},o},t(function(a){s.reason||(s.reason=new n(a),r(s.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}},e.source=function(){var r,s=new e(function(a){r=a});return{token:s,cancel:r}},Is=e,Is}var Rs,Ua;function Ff(){return Ua||(Ua=1,Rs=function(e){return function(r){return e.apply(null,r)}}),Rs}var Ds,Fa;function Bf(){if(Fa)return Ds;Fa=1;var n=qe;return Ds=function(t){return n.isObject(t)&&t.isAxiosError===!0},Ds}var Ba=qe,Vf=uu,On=Mf,qf=gu,zf=wi;function wu(n){var e=new On(n),t=Vf(On.prototype.request,e);return Ba.extend(t,On.prototype,e),Ba.extend(t,e),t.create=function(s){return wu(qf(n,s))},t}var mt=wu(zf);mt.Axios=On;mt.Cancel=Bn();mt.CancelToken=Uf();mt.isCancel=yu();mt.VERSION=bu().version;mt.all=function(e){return Promise.all(e)};mt.spread=Ff();mt.isAxiosError=Bf();bi.exports=mt;bi.exports.default=mt;var Hf=bi.exports,Ei=Hf;const $r=pr(Ei);var ge={},Ai={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.RequiredError=n.BaseAPI=n.COLLECTION_FORMATS=n.BASE_PATH=void 0;const e=Ei;n.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),n.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"	",pipes:"|"};class t{constructor(i,a=n.BASE_PATH,o=e.default){this.basePath=a,this.axios=o,i&&(this.configuration=i,this.basePath=i.basePath||this.basePath)}}n.BaseAPI=t;class r extends Error{constructor(i,a){super(a),this.field=i,this.name="RequiredError"}}n.RequiredError=r})(Ai);var Ti=st&&st.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(ge,"__esModule",{value:!0});ge.createRequestFunction=ge.toPathString=ge.serializeDataIfNeeded=ge.setSearchParams=ge.setOAuthToObject=ge.setBearerAuthToObject=ge.setBasicAuthToObject=ge.setApiKeyToObject=ge.assertParamExists=ge.DUMMY_BASE_URL=void 0;const Kf=Ai;ge.DUMMY_BASE_URL="https://example.com";ge.assertParamExists=function(n,e,t){if(t==null)throw new Kf.RequiredError(e,`Required parameter ${e} was null or undefined when calling ${n}.`)};ge.setApiKeyToObject=function(n,e,t){return Ti(this,void 0,void 0,function*(){if(t&&t.apiKey){const r=typeof t.apiKey=="function"?yield t.apiKey(e):yield t.apiKey;n[e]=r}})};ge.setBasicAuthToObject=function(n,e){e&&(e.username||e.password)&&(n.auth={username:e.username,password:e.password})};ge.setBearerAuthToObject=function(n,e){return Ti(this,void 0,void 0,function*(){if(e&&e.accessToken){const t=typeof e.accessToken=="function"?yield e.accessToken():yield e.accessToken;n.Authorization="Bearer "+t}})};ge.setOAuthToObject=function(n,e,t,r){return Ti(this,void 0,void 0,function*(){if(r&&r.accessToken){const s=typeof r.accessToken=="function"?yield r.accessToken(e,t):yield r.accessToken;n.Authorization="Bearer "+s}})};function ei(n,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(r=>ei(n,r,t)):Object.keys(e).forEach(r=>ei(n,e[r],`${t}${t!==""?".":""}${r}`)):n.has(t)?n.append(t,e):n.set(t,e))}ge.setSearchParams=function(n,...e){const t=new URLSearchParams(n.search);ei(t,e),n.search=t.toString()};ge.serializeDataIfNeeded=function(n,e,t){const r=typeof n!="string";return(r&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):r)?JSON.stringify(n!==void 0?n:{}):n||""};ge.toPathString=function(n){return n.pathname+n.search+n.hash};ge.createRequestFunction=function(n,e,t,r){return(s=e,i=t)=>{const a=Object.assign(Object.assign({},n.options),{url:((r==null?void 0:r.basePath)||i)+n.url});return s.request(a)}};(function(n){var e=st&&st.__awaiter||function(a,o,u,c){function l(d){return d instanceof u?d:new u(function(h){h(d)})}return new(u||(u=Promise))(function(d,h){function b(y){try{_(c.next(y))}catch(x){h(x)}}function m(y){try{_(c.throw(y))}catch(x){h(x)}}function _(y){y.done?d(y.value):l(y.value).then(b,m)}_((c=c.apply(a,o||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenAIApi=n.OpenAIApiFactory=n.OpenAIApiFp=n.OpenAIApiAxiosParamCreator=n.CreateImageRequestResponseFormatEnum=n.CreateImageRequestSizeEnum=n.ChatCompletionResponseMessageRoleEnum=n.ChatCompletionRequestMessageRoleEnum=void 0;const t=Ei,r=ge,s=Ai;n.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},n.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},n.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},n.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},n.OpenAIApiAxiosParamCreator=function(a){return{cancelFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("cancelFineTune","fineTuneId",o);const c="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),createAnswer:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createAnswer","createAnswerRequest",o);const c="/answers",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createChatCompletion:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createChatCompletion","createChatCompletionRequest",o);const c="/chat/completions",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createClassification:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createClassification","createClassificationRequest",o);const c="/classifications",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createCompletion:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createCompletion","createCompletionRequest",o);const c="/completions",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createEdit:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createEdit","createEditRequest",o);const c="/edits",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createEmbedding:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createEmbedding","createEmbeddingRequest",o);const c="/embeddings",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createFile:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createFile","file",o),r.assertParamExists("createFile","purpose",u);const l="/files",d=new URL(l,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),c),m={},_={},y=new(a&&a.formDataCtor||FormData);o!==void 0&&y.append("file",o),u!==void 0&&y.append("purpose",u),m["Content-Type"]="multipart/form-data",r.setSearchParams(d,_);let x=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign(Object.assign({},m),y.getHeaders()),x),c.headers),b.data=y,{url:r.toPathString(d),options:b}}),createFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createFineTune","createFineTuneRequest",o);const c="/fine-tunes",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createImage:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImage","createImageRequest",o);const c="/images/generations",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createImageEdit:(o,u,c,l,d,h,b,m={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImageEdit","image",o),r.assertParamExists("createImageEdit","prompt",u);const _="/images/edits",y=new URL(_,r.DUMMY_BASE_URL);let x;a&&(x=a.baseOptions);const C=Object.assign(Object.assign({method:"POST"},x),m),j={},P={},D=new(a&&a.formDataCtor||FormData);o!==void 0&&D.append("image",o),c!==void 0&&D.append("mask",c),u!==void 0&&D.append("prompt",u),l!==void 0&&D.append("n",l),d!==void 0&&D.append("size",d),h!==void 0&&D.append("response_format",h),b!==void 0&&D.append("user",b),j["Content-Type"]="multipart/form-data",r.setSearchParams(y,P);let A=x&&x.headers?x.headers:{};return C.headers=Object.assign(Object.assign(Object.assign(Object.assign({},j),D.getHeaders()),A),m.headers),C.data=D,{url:r.toPathString(y),options:C}}),createImageVariation:(o,u,c,l,d,h={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImageVariation","image",o);const b="/images/variations",m=new URL(b,r.DUMMY_BASE_URL);let _;a&&(_=a.baseOptions);const y=Object.assign(Object.assign({method:"POST"},_),h),x={},C={},j=new(a&&a.formDataCtor||FormData);o!==void 0&&j.append("image",o),u!==void 0&&j.append("n",u),c!==void 0&&j.append("size",c),l!==void 0&&j.append("response_format",l),d!==void 0&&j.append("user",d),x["Content-Type"]="multipart/form-data",r.setSearchParams(m,C);let P=_&&_.headers?_.headers:{};return y.headers=Object.assign(Object.assign(Object.assign(Object.assign({},x),j.getHeaders()),P),h.headers),y.data=j,{url:r.toPathString(m),options:y}}),createModeration:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createModeration","createModerationRequest",o);const c="/moderations",l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"POST"},d),u),b={},m={};b["Content-Type"]="application/json",r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),h.data=r.serializeDataIfNeeded(o,h,a),{url:r.toPathString(l),options:h}}),createSearch:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createSearch","engineId",o),r.assertParamExists("createSearch","createSearchRequest",u);const l="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(o))),d=new URL(l,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),c),m={},_={};m["Content-Type"]="application/json",r.setSearchParams(d,_);let y=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},m),y),c.headers),b.data=r.serializeDataIfNeeded(u,b,a),{url:r.toPathString(d),options:b}}),createTranscription:(o,u,c,l,d,h,b={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createTranscription","file",o),r.assertParamExists("createTranscription","model",u);const m="/audio/transcriptions",_=new URL(m,r.DUMMY_BASE_URL);let y;a&&(y=a.baseOptions);const x=Object.assign(Object.assign({method:"POST"},y),b),C={},j={},P=new(a&&a.formDataCtor||FormData);o!==void 0&&P.append("file",o),u!==void 0&&P.append("model",u),c!==void 0&&P.append("prompt",c),l!==void 0&&P.append("response_format",l),d!==void 0&&P.append("temperature",d),h!==void 0&&P.append("language",h),C["Content-Type"]="multipart/form-data",r.setSearchParams(_,j);let D=y&&y.headers?y.headers:{};return x.headers=Object.assign(Object.assign(Object.assign(Object.assign({},C),P.getHeaders()),D),b.headers),x.data=P,{url:r.toPathString(_),options:x}}),createTranslation:(o,u,c,l,d,h={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createTranslation","file",o),r.assertParamExists("createTranslation","model",u);const b="/audio/translations",m=new URL(b,r.DUMMY_BASE_URL);let _;a&&(_=a.baseOptions);const y=Object.assign(Object.assign({method:"POST"},_),h),x={},C={},j=new(a&&a.formDataCtor||FormData);o!==void 0&&j.append("file",o),u!==void 0&&j.append("model",u),c!==void 0&&j.append("prompt",c),l!==void 0&&j.append("response_format",l),d!==void 0&&j.append("temperature",d),x["Content-Type"]="multipart/form-data",r.setSearchParams(m,C);let P=_&&_.headers?_.headers:{};return y.headers=Object.assign(Object.assign(Object.assign(Object.assign({},x),j.getHeaders()),P),h.headers),y.data=j,{url:r.toPathString(m),options:y}}),deleteFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("deleteFile","fileId",o);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"DELETE"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),deleteModel:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("deleteModel","model",o);const c="/models/{model}".replace("{model}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"DELETE"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),downloadFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("downloadFile","fileId",o);const c="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),listEngines:(o={})=>e(this,void 0,void 0,function*(){const u="/engines",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const d=Object.assign(Object.assign({method:"GET"},l),o),h={},b={};r.setSearchParams(c,b);let m=l&&l.headers?l.headers:{};return d.headers=Object.assign(Object.assign(Object.assign({},h),m),o.headers),{url:r.toPathString(c),options:d}}),listFiles:(o={})=>e(this,void 0,void 0,function*(){const u="/files",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const d=Object.assign(Object.assign({method:"GET"},l),o),h={},b={};r.setSearchParams(c,b);let m=l&&l.headers?l.headers:{};return d.headers=Object.assign(Object.assign(Object.assign({},h),m),o.headers),{url:r.toPathString(c),options:d}}),listFineTuneEvents:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("listFineTuneEvents","fineTuneId",o);const l="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(o))),d=new URL(l,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),c),m={},_={};u!==void 0&&(_.stream=u),r.setSearchParams(d,_);let y=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},m),y),c.headers),{url:r.toPathString(d),options:b}}),listFineTunes:(o={})=>e(this,void 0,void 0,function*(){const u="/fine-tunes",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const d=Object.assign(Object.assign({method:"GET"},l),o),h={},b={};r.setSearchParams(c,b);let m=l&&l.headers?l.headers:{};return d.headers=Object.assign(Object.assign(Object.assign({},h),m),o.headers),{url:r.toPathString(c),options:d}}),listModels:(o={})=>e(this,void 0,void 0,function*(){const u="/models",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const d=Object.assign(Object.assign({method:"GET"},l),o),h={},b={};r.setSearchParams(c,b);let m=l&&l.headers?l.headers:{};return d.headers=Object.assign(Object.assign(Object.assign({},h),m),o.headers),{url:r.toPathString(c),options:d}}),retrieveEngine:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveEngine","engineId",o);const c="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),retrieveFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveFile","fileId",o);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),retrieveFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveFineTune","fineTuneId",o);const c="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}}),retrieveModel:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveModel","model",o);const c="/models/{model}".replace("{model}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let d;a&&(d=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},d),u),b={},m={};r.setSearchParams(l,m);let _=d&&d.headers?d.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),_),u.headers),{url:r.toPathString(l),options:h}})}},n.OpenAIApiFp=function(a){const o=n.OpenAIApiAxiosParamCreator(a);return{cancelFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.cancelFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createAnswer(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createAnswer(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createChatCompletion(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createChatCompletion(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createClassification(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createClassification(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createCompletion(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createCompletion(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createEdit(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createEdit(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createEmbedding(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createEmbedding(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createFile(u,c,l){return e(this,void 0,void 0,function*(){const d=yield o.createFile(u,c,l);return r.createRequestFunction(d,t.default,s.BASE_PATH,a)})},createFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createImage(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createImage(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createImageEdit(u,c,l,d,h,b,m,_){return e(this,void 0,void 0,function*(){const y=yield o.createImageEdit(u,c,l,d,h,b,m,_);return r.createRequestFunction(y,t.default,s.BASE_PATH,a)})},createImageVariation(u,c,l,d,h,b){return e(this,void 0,void 0,function*(){const m=yield o.createImageVariation(u,c,l,d,h,b);return r.createRequestFunction(m,t.default,s.BASE_PATH,a)})},createModeration(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createModeration(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createSearch(u,c,l){return e(this,void 0,void 0,function*(){const d=yield o.createSearch(u,c,l);return r.createRequestFunction(d,t.default,s.BASE_PATH,a)})},createTranscription(u,c,l,d,h,b,m){return e(this,void 0,void 0,function*(){const _=yield o.createTranscription(u,c,l,d,h,b,m);return r.createRequestFunction(_,t.default,s.BASE_PATH,a)})},createTranslation(u,c,l,d,h,b){return e(this,void 0,void 0,function*(){const m=yield o.createTranslation(u,c,l,d,h,b);return r.createRequestFunction(m,t.default,s.BASE_PATH,a)})},deleteFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.deleteFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},deleteModel(u,c){return e(this,void 0,void 0,function*(){const l=yield o.deleteModel(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},downloadFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.downloadFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},listEngines(u){return e(this,void 0,void 0,function*(){const c=yield o.listEngines(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listFiles(u){return e(this,void 0,void 0,function*(){const c=yield o.listFiles(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listFineTuneEvents(u,c,l){return e(this,void 0,void 0,function*(){const d=yield o.listFineTuneEvents(u,c,l);return r.createRequestFunction(d,t.default,s.BASE_PATH,a)})},listFineTunes(u){return e(this,void 0,void 0,function*(){const c=yield o.listFineTunes(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listModels(u){return e(this,void 0,void 0,function*(){const c=yield o.listModels(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},retrieveEngine(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveEngine(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveModel(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveModel(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})}}},n.OpenAIApiFactory=function(a,o,u){const c=n.OpenAIApiFp(a);return{cancelFineTune(l,d){return c.cancelFineTune(l,d).then(h=>h(u,o))},createAnswer(l,d){return c.createAnswer(l,d).then(h=>h(u,o))},createChatCompletion(l,d){return c.createChatCompletion(l,d).then(h=>h(u,o))},createClassification(l,d){return c.createClassification(l,d).then(h=>h(u,o))},createCompletion(l,d){return c.createCompletion(l,d).then(h=>h(u,o))},createEdit(l,d){return c.createEdit(l,d).then(h=>h(u,o))},createEmbedding(l,d){return c.createEmbedding(l,d).then(h=>h(u,o))},createFile(l,d,h){return c.createFile(l,d,h).then(b=>b(u,o))},createFineTune(l,d){return c.createFineTune(l,d).then(h=>h(u,o))},createImage(l,d){return c.createImage(l,d).then(h=>h(u,o))},createImageEdit(l,d,h,b,m,_,y,x){return c.createImageEdit(l,d,h,b,m,_,y,x).then(C=>C(u,o))},createImageVariation(l,d,h,b,m,_){return c.createImageVariation(l,d,h,b,m,_).then(y=>y(u,o))},createModeration(l,d){return c.createModeration(l,d).then(h=>h(u,o))},createSearch(l,d,h){return c.createSearch(l,d,h).then(b=>b(u,o))},createTranscription(l,d,h,b,m,_,y){return c.createTranscription(l,d,h,b,m,_,y).then(x=>x(u,o))},createTranslation(l,d,h,b,m,_){return c.createTranslation(l,d,h,b,m,_).then(y=>y(u,o))},deleteFile(l,d){return c.deleteFile(l,d).then(h=>h(u,o))},deleteModel(l,d){return c.deleteModel(l,d).then(h=>h(u,o))},downloadFile(l,d){return c.downloadFile(l,d).then(h=>h(u,o))},listEngines(l){return c.listEngines(l).then(d=>d(u,o))},listFiles(l){return c.listFiles(l).then(d=>d(u,o))},listFineTuneEvents(l,d,h){return c.listFineTuneEvents(l,d,h).then(b=>b(u,o))},listFineTunes(l){return c.listFineTunes(l).then(d=>d(u,o))},listModels(l){return c.listModels(l).then(d=>d(u,o))},retrieveEngine(l,d){return c.retrieveEngine(l,d).then(h=>h(u,o))},retrieveFile(l,d){return c.retrieveFile(l,d).then(h=>h(u,o))},retrieveFineTune(l,d){return c.retrieveFineTune(l,d).then(h=>h(u,o))},retrieveModel(l,d){return c.retrieveModel(l,d).then(h=>h(u,o))}}};class i extends s.BaseAPI{cancelFineTune(o,u){return n.OpenAIApiFp(this.configuration).cancelFineTune(o,u).then(c=>c(this.axios,this.basePath))}createAnswer(o,u){return n.OpenAIApiFp(this.configuration).createAnswer(o,u).then(c=>c(this.axios,this.basePath))}createChatCompletion(o,u){return n.OpenAIApiFp(this.configuration).createChatCompletion(o,u).then(c=>c(this.axios,this.basePath))}createClassification(o,u){return n.OpenAIApiFp(this.configuration).createClassification(o,u).then(c=>c(this.axios,this.basePath))}createCompletion(o,u){return n.OpenAIApiFp(this.configuration).createCompletion(o,u).then(c=>c(this.axios,this.basePath))}createEdit(o,u){return n.OpenAIApiFp(this.configuration).createEdit(o,u).then(c=>c(this.axios,this.basePath))}createEmbedding(o,u){return n.OpenAIApiFp(this.configuration).createEmbedding(o,u).then(c=>c(this.axios,this.basePath))}createFile(o,u,c){return n.OpenAIApiFp(this.configuration).createFile(o,u,c).then(l=>l(this.axios,this.basePath))}createFineTune(o,u){return n.OpenAIApiFp(this.configuration).createFineTune(o,u).then(c=>c(this.axios,this.basePath))}createImage(o,u){return n.OpenAIApiFp(this.configuration).createImage(o,u).then(c=>c(this.axios,this.basePath))}createImageEdit(o,u,c,l,d,h,b,m){return n.OpenAIApiFp(this.configuration).createImageEdit(o,u,c,l,d,h,b,m).then(_=>_(this.axios,this.basePath))}createImageVariation(o,u,c,l,d,h){return n.OpenAIApiFp(this.configuration).createImageVariation(o,u,c,l,d,h).then(b=>b(this.axios,this.basePath))}createModeration(o,u){return n.OpenAIApiFp(this.configuration).createModeration(o,u).then(c=>c(this.axios,this.basePath))}createSearch(o,u,c){return n.OpenAIApiFp(this.configuration).createSearch(o,u,c).then(l=>l(this.axios,this.basePath))}createTranscription(o,u,c,l,d,h,b){return n.OpenAIApiFp(this.configuration).createTranscription(o,u,c,l,d,h,b).then(m=>m(this.axios,this.basePath))}createTranslation(o,u,c,l,d,h){return n.OpenAIApiFp(this.configuration).createTranslation(o,u,c,l,d,h).then(b=>b(this.axios,this.basePath))}deleteFile(o,u){return n.OpenAIApiFp(this.configuration).deleteFile(o,u).then(c=>c(this.axios,this.basePath))}deleteModel(o,u){return n.OpenAIApiFp(this.configuration).deleteModel(o,u).then(c=>c(this.axios,this.basePath))}downloadFile(o,u){return n.OpenAIApiFp(this.configuration).downloadFile(o,u).then(c=>c(this.axios,this.basePath))}listEngines(o){return n.OpenAIApiFp(this.configuration).listEngines(o).then(u=>u(this.axios,this.basePath))}listFiles(o){return n.OpenAIApiFp(this.configuration).listFiles(o).then(u=>u(this.axios,this.basePath))}listFineTuneEvents(o,u,c){return n.OpenAIApiFp(this.configuration).listFineTuneEvents(o,u,c).then(l=>l(this.axios,this.basePath))}listFineTunes(o){return n.OpenAIApiFp(this.configuration).listFineTunes(o).then(u=>u(this.axios,this.basePath))}listModels(o){return n.OpenAIApiFp(this.configuration).listModels(o).then(u=>u(this.axios,this.basePath))}retrieveEngine(o,u){return n.OpenAIApiFp(this.configuration).retrieveEngine(o,u).then(c=>c(this.axios,this.basePath))}retrieveFile(o,u){return n.OpenAIApiFp(this.configuration).retrieveFile(o,u).then(c=>c(this.axios,this.basePath))}retrieveFineTune(o,u){return n.OpenAIApiFp(this.configuration).retrieveFineTune(o,u).then(c=>c(this.axios,this.basePath))}retrieveModel(o,u){return n.OpenAIApiFp(this.configuration).retrieveModel(o,u).then(c=>c(this.axios,this.basePath))}}n.OpenAIApi=i})(ou);var zn={};const Zf="openai",Jf="3.3.0",Gf="Node.js library for the OpenAI API",Yf={type:"git",url:"git@github.com:openai/openai-node.git"},Wf=["openai","open","ai","gpt-3","gpt3"],Qf="OpenAI",Xf="MIT",ep="./dist/index.js",tp="./dist/index.d.ts",rp={build:"tsc --outDir dist/"},np={axios:"^0.26.0","form-data":"^4.0.0"},sp={"@types/node":"^12.11.5",typescript:"^3.6.4"},ip={name:Zf,version:Jf,description:Gf,repository:Yf,keywords:Wf,author:Qf,license:Xf,main:ep,types:tp,scripts:rp,dependencies:np,devDependencies:sp};var Ns,Va;function ap(){return Va||(Va=1,Ns=typeof self=="object"?self.FormData:window.FormData),Ns}Object.defineProperty(zn,"__esModule",{value:!0});zn.Configuration=void 0;const op=ip;class up{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${op.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=ap())}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}zn.Configuration=up;(function(n){var e=st&&st.__createBinding||(Object.create?function(r,s,i,a){a===void 0&&(a=i),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,a){a===void 0&&(a=i),r[a]=s[i]}),t=st&&st.__exportStar||function(r,s){for(var i in r)i!=="default"&&!s.hasOwnProperty(i)&&e(s,r,i)};Object.defineProperty(n,"__esModule",{value:!0}),t(ou,n),t(zn,n)})(Ws);const ti="text/event-stream";async function cp(n,e){const t=n.getReader();for(;;){const r=await t.read();if(r.done){e(new Uint8Array,!0);break}e(r.value)}}function lp(n){let e,t,r,s=!1;return function(a,o){if(o){n(a,0,!0);return}e===void 0?(e=a,t=0,r=-1):e=hp(e,a);const u=e.length;let c=0;for(;t<u;){s&&(e[t]===10&&(c=++t),s=!1);let l=-1;for(;t<u&&l===-1;++t)switch(e[t]){case 58:r===-1&&(r=t-c);break;case 13:s=!0;case 10:l=t;break}if(l===-1)break;n(e.subarray(c,l),r),c=t,r=-1}c===u?e=void 0:c!==0&&(e=e.subarray(c),t-=c)}}function dp(n,e,t){let r=Ls();const s=new TextDecoder;return function(a,o,u){if(u){fp(r)||(n==null||n(r),r=Ls());return}if(a.length===0)n==null||n(r),r=Ls();else if(o>0){const c=s.decode(a.subarray(0,o)),l=o+(a[o+1]===32?2:1),d=s.decode(a.subarray(l));switch(c){case"data":r.data=r.data?r.data+`
`+d:d;break;case"event":r.event=d;break;case"id":e==null||e(r.id=d);break;case"retry":{const h=parseInt(d,10);Number.isNaN(h)||t==null||t(r.retry=h);break}}}}}function hp(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Ls(){return{data:"",event:"",id:"",retry:void 0}}function fp(n){return n.data===""&&n.event===""&&n.id===""&&n.retry===void 0}function pp(n){try{return JSON.stringify(n)}catch{return n}}function mp(n,e,t){const{validateStatus:r}=t.config;!t.status||!r||r(t.status)?n(t):e(En(`Request failed with status code ${t.status} and body ${typeof t.data=="string"?t.data:pp(t.data)}`,t.config,null,t.request,t))}function yp(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function gp(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function qa(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bp(n,e,t){if(!e)return n;var r;if(t)r=t(e);else if(Ep(e))r=e.toString();else{var s=[];za(e,function(o,u){o===null||typeof o>"u"||(Ou(o)?u=`${u}[]`:o=[o],za(o,function(l){Op(l)?l=l.toISOString():wp(l)&&(l=JSON.stringify(l)),s.push(`${qa(u)}=${qa(l)}`)}))}),r=s.join("&")}if(r){var i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}function vp(n,e){return n&&!yp(e)?gp(n,e):e}function _p(n){return typeof n>"u"}function wp(n){return n!==null&&typeof n=="object"}function Op(n){return toString.call(n)==="[object Date]"}function Ep(n){return toString.call(n)==="[object URLSearchParams]"}function Ou(n){return Array.isArray(n)}function za(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),Ou(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.call(null,n[s],s,n)}function Ap(n){return toString.call(n)==="[object FormData]"}function Tp(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}async function Pp(n){const e=Sp(n),t=await xp(e,n);return new Promise((r,s)=>{t instanceof Error?s(t):Object.prototype.toString.call(n.settle)==="[object Function]"?n.settle(r,s,t):mp(r,s,t)})}async function xp(n,e){let t;try{t=await fetch(n)}catch(i){return i&&i.name==="AbortError"?En("Request aborted",e,"ECONNABORTED",n):i&&i.name==="TimeoutError"?En("Request timeout",e,"ECONNABORTED",n):En("Network Error",e,"ERR_NETWORK",n)}const r={};t.headers.forEach((i,a)=>{r[a]=i});const s={ok:t.ok,status:t.status,statusText:t.statusText,headers:r,config:e,request:n};if(t.status>=200&&t.status!==204)if(e.responseType==="stream"){const i=t.headers.get("content-type");if(!(i!=null&&i.startsWith(ti))){if(t.status>=400)return i!=null&&i.startsWith("application/json")?(s.data=await t.json(),s):(s.data=await t.text(),s);throw new Error(`Expected content-type to be ${ti}, Actual: ${i}`)}await cp(t.body,lp(dp(e.onmessage)))}else switch(e.responseType){case"arraybuffer":s.data=await t.arrayBuffer();break;case"blob":s.data=await t.blob();break;case"json":s.data=await t.json();break;case"formData":s.data=await t.formData();break;default:s.data=await t.text();break}return s}function Sp(n){const e=new Headers(n.headers);if(n.auth){const a=n.auth.username||"",o=n.auth.password?decodeURI(encodeURIComponent(n.auth.password)):"";e.set("Authorization",`Basic ${btoa(`${a}:${o}`)}`)}const t=n.method.toUpperCase(),r={headers:e,method:t};t!=="GET"&&t!=="HEAD"&&(r.body=n.data,Ap(r.body)&&Tp()&&e.delete("Content-Type")),typeof r.body=="string"&&(r.body=new TextEncoder().encode(r.body)),n.mode&&(r.mode=n.mode),n.cache&&(r.cache=n.cache),n.integrity&&(r.integrity=n.integrity),n.redirect&&(r.redirect=n.redirect),n.referrer&&(r.referrer=n.referrer),n.timeout&&n.timeout>0&&(r.signal=AbortSignal.timeout(n.timeout)),n.signal&&(r.signal=n.signal),_p(n.withCredentials)||(r.credentials=n.withCredentials?"include":"omit"),n.responseType==="stream"&&r.headers.set("Accept",ti);const s=vp(n.baseURL,n.url),i=bp(s,n.params,n.paramsSerializer);return new Request(i,r)}function En(n,e,t,r,s){if($r.AxiosError&&typeof $r.AxiosError=="function")return new $r.AxiosError(n,$r.AxiosError[t],e,r,s);const i=new Error(n);return kp(i,e,t,r,s)}function kp(n,e,t,r,s){return n.config=e,t&&(n.code=t),n.request=r,n.response=s,n.isAxiosError=!0,n.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},n}const jp=(n,e)=>n.reduce((t,r,s)=>{const i=Math.floor(s/e),a=t[i]||[];return t[i]=a.concat([r]),t},[]);function Cp(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,basePath:i}=n;if(r&&s&&e)return`${s}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}class Eu extends eu{constructor(e,t){super(e??{}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=(e==null?void 0:e.openAIApiKey)??Te("OPENAI_API_KEY"),s=(e==null?void 0:e.azureOpenAIApiKey)??Te("AZURE_OPENAI_API_KEY");if(!s&&!r)throw new Error("OpenAI or Azure OpenAI API key not found");const i=(e==null?void 0:e.azureOpenAIApiInstanceName)??Te("AZURE_OPENAI_API_INSTANCE_NAME"),a=((e==null?void 0:e.azureOpenAIApiEmbeddingsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(Te("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||Te("AZURE_OPENAI_API_DEPLOYMENT_NAME")),o=(e==null?void 0:e.azureOpenAIApiVersion)??Te("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??Te("AZURE_OPENAI_BASE_PATH"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.batchSize=(e==null?void 0:e.batchSize)??(s?1:this.batchSize),this.stripNewLines=(e==null?void 0:e.stripNewLines)??this.stripNewLines,this.timeout=e==null?void 0:e.timeout,this.azureOpenAIApiVersion=o,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=i,this.azureOpenAIApiDeploymentName=a,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:r,...t}}async embedDocuments(e){const t=jp(this.stripNewLines?e.map(s=>s.replace(/\n/g," ")):e,this.batchSize),r=[];for(let s=0;s<t.length;s+=1){const i=t[s],{data:a}=await this.embeddingWithRetry({model:this.modelName,input:i});for(let o=0;o<i.length;o+=1)r.push(a.data[o].embedding)}return r}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t.data[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,basePath:this.clientConfig.basePath},s=Cp(r),i=new Ws.Configuration({...this.clientConfig,basePath:s,baseOptions:{timeout:this.timeout,adapter:ru()?void 0:Pp,...this.clientConfig.baseOptions}});this.client=new Ws.OpenAIApi(i)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.params={"api-version":this.azureOpenAIApiVersion,...t.params}),this.caller.call(this.client.createEmbedding.bind(this.client),e,t)}}let gn;const Ip=new Uint8Array(16);function Rp(){if(!gn&&(gn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!gn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gn(Ip)}const xe=[];for(let n=0;n<256;++n)xe.push((n+256).toString(16).slice(1));function Dp(n,e=0){return(xe[n[e+0]]+xe[n[e+1]]+xe[n[e+2]]+xe[n[e+3]]+"-"+xe[n[e+4]]+xe[n[e+5]]+"-"+xe[n[e+6]]+xe[n[e+7]]+"-"+xe[n[e+8]]+xe[n[e+9]]+"-"+xe[n[e+10]]+xe[n[e+11]]+xe[n[e+12]]+xe[n[e+13]]+xe[n[e+14]]+xe[n[e+15]]).toLowerCase()}const Np=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ha={randomUUID:Np};function Ut(n,e,t){if(Ha.randomUUID&&!e&&!n)return Ha.randomUUID();n=n||{};const r=n.random||(n.rng||Rp)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Dp(r)}async function Au(n,e,t,r,s,i){const a=e.name,o=e.size,u=new Date,c=new File([e],a,{type:e.type}),l=await Fl(c),h=await new t(c).load(),b=s,m=i,y=await new Br({chunkSize:b,chunkOverlap:m}).splitDocuments(h),x=[];for(const I of y){const g={pageContent:I.pageContent,metadata:{file_sha1:l,file_size:o,file_name:a,chunk_size:s,chunk_overlap:i,date:u}};x.push(g)}const P=er("https://jqfandcxceztebtpwzxd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpxZmFuZGN4Y2V6dGVidHB3enhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODkzNzI0NzUsImV4cCI6MjAwNDk0ODQ3NX0.MXs4u_1XMM-foNe08LLYHQLENjmwTF3jqUmNXCSbOU4"),D=new Ys({apiKey:"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"});let A=new tr(D,{client:P,tableName:"documents"});console.log(x),A.addDocuments(x)}class Tu{async loadAndSplit(e=new Br){const t=await this.load();return e.splitDocuments(t)}}class Pi extends Tu{constructor(e){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:e})}async parse(e){return[e]}async load(){let e,t;if(typeof this.filePathOrBlob=="string"){const{readFile:s}=await Pi.imports();e=await s(this.filePathOrBlob,"utf8"),t={source:this.filePathOrBlob}}else e=await this.filePathOrBlob.text(),t={source:"blob",blobType:this.filePathOrBlob.type};const r=await this.parse(e);return r.forEach((s,i)=>{if(typeof s!="string")throw new Error(`Expected string, at position ${i} got ${typeof s}`)}),r.map((s,i)=>new Fr({pageContent:s,metadata:r.length===1?t:{...t,line:i+1}}))}static async imports(){try{const{readFile:e}=await _e(()=>import("./promises.0ef77ad7.js"),[]);return{readFile:e}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${gi()}'. See https://<link to docs> for alternatives.`)}}}function Lp(n,e){return Au(n,e,Pi,".txt",500,0)}class $p extends Tu{constructor(e,t={}){super(),Object.defineProperty(this,"filePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:"https://api.unstructured.io/general/v0/general"}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strategy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof t=="string"?(this.filePath=t,this.apiUrl=e):(this.filePath=e,this.apiKey=t.apiKey,this.apiUrl=t.apiUrl??this.apiUrl,this.strategy=t.strategy??"hi_res")}async _partition(){const{readFile:e,basename:t}=await this.imports(),r=await e(this.filePath),s=t(this.filePath),i=new FormData;i.append("files",new Blob([r]),s),i.append("strategy",this.strategy);const a={"UNSTRUCTURED-API-KEY":this.apiKey??""},o=await fetch(this.apiUrl,{method:"POST",body:i,headers:a});if(!o.ok)throw new Error(`Failed to partition file ${this.filePath} with error ${o.status} and message ${await o.text()}`);const u=await o.json();if(!Array.isArray(u))throw new Error(`Expected partitioning request to return an array, but got ${u}`);return u.filter(c=>typeof c.text=="string")}async load(){const e=await this._partition(),t=[];for(const r of e){const{metadata:s,text:i}=r;t.push(new Fr({pageContent:i,metadata:{...s,category:r.type}}))}return t}async imports(){try{const{readFile:e}=await _e(()=>import("./promises.0ef77ad7.js"),[]),{basename:t}=await _e(()=>import("./__vite-browser-external_node_path.042c5bd1.js"),[]);return{readFile:e,basename:t}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${gi()}'. See https://<link to docs> for alternatives.`)}}}const An=new Proxy({},{get(n,e){throw new Error(`Module "fs" has been externalized for browser compatibility. Cannot access "fs.${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}});async function Mp(n,e){return Au(n,e,$p)}function Up(n,e){const t=Bp(n)+".html",r=An.mkdtempSync("/tmp/")+t;return An.writeFileSync(r,e),{uploaded_file:{id:null,name:t,type:"text/html",data:An.readFileSync(r)},temp_file_path:r}}function Fp(n,e,t){try{An.unlinkSync(n),t&&console.log(`✅ Content saved... ${e}`)}catch{console.log(`❌ Error while saving content... ${e}`)}}function Bp(n){return n=n.normalize("NFKD").replace(/[\u0300-\u036f]/g,""),n=n.replace(/[^\w\s-]/g,"").trim().toLowerCase(),n=n.replace(/[-\s]+/g,"-"),n}const Ka={".txt":Lp,".html":Mp};async function Za(n,e,t,r){Array.isArray(r)||(r=[r]),console.log(r);for(const s of r)await Pu(s,n)}async function Vp(n,e){const t=Bl(e);let r=er("https://jqfandcxceztebtpwzxd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpxZmFuZGN4Y2V6dGVidHB3enhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODkzNzI0NzUsImV4cCI6MjAwNDk0ODQ3NX0.MXs4u_1XMM-foNe08LLYHQLENjmwTF3jqUmNXCSbOU4");const{data:s,error:i}=await r.from("documents").select("id").eq("metadata->>file_sha1",t);return i?(console.log(`Error retrieving data: ${i.message}`),!1):s.length>0}async function Pu(n,e,t){if(await Vp(e,n))return console.log(`😎 ${n.name} is already in the database.`),!1;if(n.size<1)return console.log(`💨 ${n.name} is empty.`),!1;{const r=`.${n.name.split(".").pop()}`;if(console.log(n.name,r),r in Ka){const s="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";let i=er("https://jqfandcxceztebtpwzxd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpxZmFuZGN4Y2V6dGVidHB3enhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODkzNzI0NzUsImV4cCI6MjAwNDk0ODQ3NX0.MXs4u_1XMM-foNe08LLYHQLENjmwTF3jqUmNXCSbOU4"),a=new Eu({openAIApiKey:s}),o=new tr(a,{client:i,tableName:"documents"});return await Ka[r](o,n),console.log(`✅ ${n.name}`),!0}else return console.log(`❌ ${n.name} is not a valid file type.`),!1}}async function Ja(n,e,t,r){const s=await $r.get(r);if(s.status===200){console.log(`Getting content... ${r}`);const i=s.data,{uploaded_file:a,temp_file_path:o}=Up(r,i),u=await Pu(a,n);Fp(o,r,u)}else console.log(`❌ Failed to access ${r}.`)}class qp{}class rn extends qp{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent)}copy(){return new this.constructor(this)}toJSON(){return it.prototype.toJSON.call(this)}toJSONNotImplemented(){return it.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends rn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ut()}),Object.assign(this,e)}}return new t}}var xi={exports:{}};xi.exports;(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,u)=>`\x1B[${38+i};2;${a};${o};${u}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[c,l]of Object.entries(u))a[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=a[c],i.set(l[0],l[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})})(xi);var zp=xi.exports;const xu=pr(zp);class Si extends rn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,s,i,a,o){var h;const u=this._getExecutionOrder(s),c=Date.now(),l=o?{...i,metadata:o}:i,d={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:c}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:l??{},tags:a||[]};this._startTrace(d),await((h=this.onLLMStart)==null?void 0:h.call(this,d))}async handleChatModelStart(e,t,r,s,i,a,o){var h;const u=this._getExecutionOrder(s),c=Date.now(),l=o?{...i,metadata:o}:i,d={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:c}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:l??{},tags:a||[]};this._startTrace(d),await((h=this.onLLMStart)==null?void 0:h.call(this,d))}async handleLLMEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:u}],inputs:t,execution_order:o,child_execution_order:o,run_type:"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};this._startTrace(c),await((l=this.onChainStart)==null?void 0:l.call(this,c))}async handleChainEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await((s=this.onChainEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleChainError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onChainError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleToolStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:u}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};this._startTrace(c),await((l=this.onToolStart)==null?void 0:l.call(this,c))}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:r.end_time}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:Date.now(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:Date.now(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:Date.now(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r){var i;const s=this.runMap.get(r);!s||(s==null?void 0:s.run_type)!=="llm"||(s.events.push({name:"new_token",time:Date.now(),kwargs:{token:e,idx:t}}),await((i=this.onLLMNewToken)==null?void 0:i.call(this,s)))}}function Ge(n,e){return`${n.open}${e}${n.close}`}function At(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Yt(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:rt}=xu;class Ga extends Si{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?Ge(xu.bold,o):o}).join(" > ");return Ge(rt.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${At(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.cyan,"[chain/end]")} [${t}] [${Yt(e)}] Exiting Chain run with output: ${At(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.red,"[chain/error]")} [${t}] [${Yt(e)}] Chain run errored with error: ${At(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ge(rt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${At(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.cyan,"[llm/end]")} [${t}] [${Yt(e)}] Exiting LLM run with output: ${At(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.red,"[llm/error]")} [${t}] [${Yt(e)}] LLM run errored with error: ${At(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.cyan,"[tool/end]")} [${t}] [${Yt(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ge(rt.red,"[tool/error]")} [${t}] [${Yt(e)}] Tool run errored with error: ${At(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ge(rt.blue,"[agent/action]")} [${r}] Agent selected action: ${At(t.actions[t.actions.length-1],"[action]")}`)}}const Hp=[400,401,403,404,405,406,407,408,409];class Kp{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in vt?vt.default:vt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Io(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const s=(i=r==null?void 0:r.response)==null?void 0:i.status;if(s&&Hp.includes(+s))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}const Zp=()=>typeof window<"u"&&typeof window.document<"u",Jp=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Gp=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Su=()=>typeof Deno<"u",Yp=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Su(),Wp=()=>{let n;return Zp()?n="browser":Yp()?n="node":Jp()?n="webworker":Gp()?n="jsdom":Su()?n="deno":n="other",n};let $s;async function Qp(){return $s===void 0&&($s={library:"langsmith",runtime:Wp()}),$s}function Ya(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}const Xp=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},bn=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};class ki{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=ki.getDefaultClientConfig();this.apiUrl=e.apiUrl??t.apiUrl,this.apiKey=e.apiKey??t.apiKey,this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new Kp(e.callerOptions??{})}static getDefaultClientConfig(){return{apiUrl:Ya("LANGCHAIN_ENDPOINT")??"http://localhost:1984",apiKey:Ya("LANGCHAIN_API_KEY")}}validateApiKeyIfHosted(){if(!Xp(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i.json()}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},s=await Qp(),i=e.project_name;delete e.project_name;const a={session_name:i,...e,extra:{...e.extra,runtime:{...s,...r.runtime}}},o=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await bn(o,"create run")}async updateRun(e,t){const r={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await bn(s,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async _loadChildRuns(e){const t=await this.listRuns({id:e.child_run_ids}),r={},s={};t.sort((i,a)=>i.execution_order-a.execution_order);for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async listRuns({projectId:e,projectName:t,executionOrder:r,runType:s,error:i,id:a,limit:o,offset:u}){const c=new URLSearchParams;let l=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");l=(await this.readProject({projectName:t})).id}if(l&&c.append("session",l),r&&c.append("execution_order",r.toString()),s&&c.append("run_type",s),i!==void 0&&c.append("error",i.toString()),a!==void 0)for(const d of a)c.append("id",d);return o!==void 0&&c.append("limit",o.toString()),u!==void 0&&c.append("offset",u.toString()),this._get("/runs",c)}async deleteRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await bn(t,"delete run")}async createProject({projectName:e,projectExtra:t,upsert:r}){const s=r?"?upsert=true":"",i=`${this.apiUrl}/sessions${s}`,a={name:e};t!==void 0&&(a.extra=t);const o=await this.caller.call(fetch,i,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)}),u=await o.json();if(!o.ok)throw new Error(`Failed to create session ${e}: ${o.status} ${o.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async listProjects(){return this._get("/sessions")}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e;const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await bn(s,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(h=>{c.append("input_keys",h)}),s.forEach(h=>{c.append("output_keys",h)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);const l=await this.caller.call(fetch,u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const h=await l.json();throw h.detail&&h.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const s={name:e,description:t};r&&(s.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async listDatasets({limit:e=100,offset:t=0}={}){const r="/datasets",s=new URLSearchParams({limit:e.toString(),offset:t.toString()}),i=await this._get(r,s);if(!Array.isArray(i))throw new Error(`Expected ${r} to return an array, but got ${i}`);return i}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i}){let a=r;if(a===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:s})).id);const u={dataset_id:a,inputs:e,outputs:t,created_at:(i||new Date).toISOString()},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async listExamples({datasetId:e,datasetName:t,limit:r,offset:s}={}){let i;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)i=e;else if(t!==void 0)i=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const a=await this._get("/examples",new URLSearchParams({dataset:i,limit:(r==null?void 0:r.toString())??"100",offset:(s==null?void 0:s.toString())??"0"}));if(!Array.isArray(a))throw new Error(`Expected /examples to return an array, but got ${a}`);return a}async deleteExample(e){const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s}={loadChildRuns:!1}){let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);let a;i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a);let u=r??{};return o.evaluatorInfo&&(u={...u,...o.evaluatorInfo}),await this.createFeedback(i.id,o.key,{score:o.score,value:o.value,comment:o.comment,correction:o.correction,sourceInfo:u,feedbackSourceType:"MODEL"})}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="API"}){let c;if(u==="API")c={type:"api",metadata:o??{}};else if(u==="MODEL")c={type:"model",metadata:o??{}};else throw new Error(`Unknown feedback source type ${u}`);const l={id:Ut(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:c},d=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!d.ok)throw new Error(`Failed to create feedback for run ${e}: ${d.status} ${d.statusText}`);return await d.json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async listFeedback({runIds:e,limit:t,offset:r}={}){const s=new URLSearchParams;return e&&s.append("run",e.join(",")),t!==void 0&&s.append("limit",t.toString()),r!==void 0&&s.append("offset",r.toString()),await this._get("/feedback",s)}}class em extends Si{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??Te("LANGCHAIN_PROJECT")??Te("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new ki({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await qh()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events};await this.client.updateRun(e.id,t)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}function ji(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s}`);const a=s.name?`${s.name}, `:"";r.push(`${i}: ${a}${s.content}`)}return r.join(`
`)}class tm extends Si{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:Te("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=Te("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var i;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let s;if(e.run_type==="llm"){const a=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>ji(u));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:a,response:e.outputs}}else if(e.run_type==="chain"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(i=e.outputs)==null?void 0:i.output,action:JSON.stringify(r),child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return s}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const s=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});s.ok||console.error(`Failed to persist run: ${s.status} ${s.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const s=await t.json();return s.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=s,this.session=r,r)}}async function rm(n){const e=new tm;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function nm(){return new em}let Ms;function sm(){const n="default"in vt?vt.default:vt;return new n({autoStart:!0,concurrency:1})}async function Ve(n,e){e===!0?await n():(typeof Ms>"u"&&(Ms=sm()),Ms.add(n))}function im(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class am{setHandler(e){return this.setHandlers([e])}}class Ci{constructor(e,t,r,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}async handleText(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}}class Wa extends Ci{async handleLLMNewToken(e,t={prompt:0,completion:0}){await Promise.all(this.handlers.map(r=>Ve(async()=>{var s;if(!r.ignoreLLM)try{await((s=r.handleLLMNewToken)==null?void 0:s.call(r,e,t,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${i}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}}class om extends Ci{getChild(e){const t=new xt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreChain)try{await((r=t.handleChainError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${s}`)}},t.awaitHandlers)))}async handleChainEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreChain)try{await((r=t.handleChainEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${s}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}}class um extends Ci{getChild(e){const t=new xt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}}class xt extends am{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0){return Promise.all(t.map(async a=>{const o=Ut();return await Promise.all(this.handlers.map(u=>Ve(async()=>{var c;if(!u.ignoreLLM)try{await((c=u.handleLLMStart)==null?void 0:c.call(u,e,[a],o,this._parentRunId,i,this.tags,this.metadata))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleLLMStart: ${l}`)}},u.awaitHandlers))),new Wa(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0){return Promise.all(t.map(async a=>{const o=Ut();return await Promise.all(this.handlers.map(u=>Ve(async()=>{var c,l;if(!u.ignoreLLM)try{if(u.handleChatModelStart)await((c=u.handleChatModelStart)==null?void 0:c.call(u,e,[a],o,this._parentRunId,i,this.tags,this.metadata));else if(u.handleLLMStart){const d=ji(a);await((l=u.handleLLMStart)==null?void 0:l.call(u,e,[d],o,this._parentRunId,i,this.tags,this.metadata))}}catch(d){console.error(`Error in handler ${u.constructor.name}, handleLLMStart: ${d}`)}},u.awaitHandlers))),new Wa(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Ut()){return await Promise.all(this.handlers.map(s=>Ve(async()=>{var i;if(!s.ignoreChain)try{await((i=s.handleChainStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(a){console.error(`Error in handler ${s.constructor.name}, handleChainStart: ${a}`)}},s.awaitHandlers))),new om(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Ut()){return await Promise.all(this.handlers.map(s=>Ve(async()=>{var i;if(!s.ignoreAgent)try{await((i=s.handleToolStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(a){console.error(`Error in handler ${s.constructor.name}, handleToolStart: ${a}`)}},s.awaitHandlers))),new um(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new xt(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends rn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ut()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,i,a,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new xt,u.setHandlers((e==null?void 0:e.map(Qa))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Qa):t==null?void 0:t.handlers,!1));const c=Te("LANGCHAIN_VERBOSE")||(o==null?void 0:o.verbose),l=Te("LANGCHAIN_TRACING_V2")??!1,d=l||(Te("LANGCHAIN_TRACING")??!1);if(c||d){if(u||(u=new xt),c&&!u.handlers.some(h=>h.name===Ga.prototype.name)){const h=new Ga;u.addHandler(h,!0)}if(d&&!u.handlers.some(h=>h.name==="langchain_tracer"))if(l)u.addHandler(await nm(),!0);else{const h=Te("LANGCHAIN_PROJECT")&&Te("LANGCHAIN_SESSION");u.addHandler(await rm(h),!0)}}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}}function Qa(n){return"name"in n?n:rn.fromMethods(n)}const ku=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n,cm=n=>{switch(ku(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},kb=async({prompt:n,modelName:e})=>{let t;try{t=(await Mo(e)).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return cm(e)-t},lm=()=>!1;class ju extends it{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??lm(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Cu extends ju{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new li(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await Mo("modelName"in this?ku(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...s}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await _e(()=>import("./openai.a32bbb49.js"),["_app/immutable/chunks/openai.a32bbb49.js","_app/immutable/chunks/prompt-layer.00daf386.js"])).ChatOpenAI}[t];if(i===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new i(s)}}class nn extends ju{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:s,callbackManager:i,...a}=e;super({...a,callbacks:i??a.callbacks}),this.memory=s}else super({verbose:t,callbacks:r}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}serialize(){throw new Error("Method not implemented.")}async run(e,t){const r=this.inputKeys.filter(u=>{var c;return!((c=this.memory)!=null&&c.memoryKeys.includes(u))});if(!(r.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const i=r.length?{[r[0]]:e}:{},a=await this.call(i,t),o=Object.keys(a);if(o.length===1)return a[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async call(e,t,r){const s={...e};if(s.timeout&&!s.signal&&(s.signal=AbortSignal.timeout(s.timeout),delete s.timeout),this.memory!=null){const c=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[l,d]of Object.entries(c))s[l]=d}const i=im(t),a=await xt.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),s));let u;try{u=await(e.signal?Promise.race([this._call(s,o),new Promise((c,l)=>{var d;(d=e.signal)==null||d.addEventListener("abort",()=>{l(new Error("AbortError"))})})]):this._call(s,o))}catch(c){throw await(o==null?void 0:o.handleChainError(c)),c}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),u),await(o==null?void 0:o.handleChainEnd(u)),Object.defineProperty(u,nu,{value:o?{runId:o==null?void 0:o.runId}:void 0,configurable:!0}),u}async apply(e,t){return Promise.all(e.map(async(r,s)=>this.call(r,t==null?void 0:t[s])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:r}=await _e(()=>Promise.resolve().then(()=>ym),void 0);return r.deserialize(e)}case"sequential_chain":{const{SequentialChain:r}=await _e(()=>import("./sequential_chain.85a51693.js"),[]);return r.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:r}=await _e(()=>import("./sequential_chain.85a51693.js"),[]);return r.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:r}=await _e(()=>Promise.resolve().then(()=>Us),void 0);return r.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:r}=await _e(()=>Promise.resolve().then(()=>Us),void 0);return r.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:r}=await _e(()=>Promise.resolve().then(()=>Us),void 0);return r.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await _e(()=>import("./vector_db_qa.8dafcb3f.js"),[]);return r.deserialize(e,t)}case"api_chain":{const{APIChain:r}=await _e(()=>import("./api_chain.7356a5eb.js"),[]);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class dm extends au{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new su(this.value)]}}class Ii extends it{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:{}});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,a]of Object.entries(t))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await _e(()=>Promise.resolve().then(()=>Xa),void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await _e(()=>Promise.resolve().then(()=>Xa),void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await _e(()=>import("./few_shot.3b2c088d.js"),[]);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class hm extends Ii{async formatPromptValue(e){const t=await this.format(e);return new dm(t)}}class fm extends it{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}}class pm extends fm{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class mm extends pm{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class Ke extends nn{get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new mm,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const r of this.llm.callKeys)r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){let s;return this.outputParser?s=await this.outputParser.parseResultWithPrompt(e,t,r==null?void 0:r.getChild()):s=e[0].text,s}call(e,t){return super.call(e,t)}async _call(e,t){const r={...e},s={...this.llmKwargs};for(const o of this.llm.callKeys)o in e&&(s[o]=e[o],delete r[o]);const i=await this.prompt.formatPromptValue(r),{generations:a}=await this.llm.generatePrompt([i],s,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(a[0],i,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:r}=e;if(!t)throw new Error("LLMChain must have llm");if(!r)throw new Error("LLMChain must have prompt");return new Ke({llm:await Cu.deserialize(t),prompt:await Ii.deserialize(r)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}const ym=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:Ke},Symbol.toStringTag,{value:"Module"})),Iu=n=>{const e=n.split(""),t=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");t.push({type:"literal",text:a}),s=i<0?e.length:i}}return t},gm=(n,e)=>Iu(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`Missing value for input ${r.name}`)}return t+r.text},""),ri={"f-string":gm,jinja2:(n,e)=>""},bm={"f-string":Iu,jinja2:n=>[]},Ru=(n,e,t)=>ri[e](n,t),vm=(n,e)=>bm[e](n),_m=(n,e,t)=>{if(!(e in ri)){const r=Object.keys(ri);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((s,i)=>(s[i]="foo",s),{});Ru(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class ke extends hm{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),_m(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Ru(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,i=""){const a=[i,...e,t].join(s);return new ke({inputVariables:r,template:a})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){const s=new Set;return vm(e,t).forEach(i=>{i.type==="variable"&&s.add(i.name)}),new ke({inputVariables:[...s],templateFormat:t,template:e,...r})}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(r=>!(r in e)),t.partialVariables={...this.partialVariables??{},...e},new ke(t)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new ke({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const Xa=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:ke},Symbol.toStringTag,{value:"Module"}));class gr extends nn{get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...r}=e,i=t.map(({pageContent:a})=>a).join(`

`);return{...r,[this.documentVariableName]:i}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new gr({llmChain:await Ke.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class Hn extends nn{get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...s}=e;let i=r,a=[];for(let c=0;c<this.maxIterations;c+=1){const l=i.map(m=>({[this.documentVariableName]:m.pageContent,...s}));if(c!==0||!this.ensureMapStep){const m=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:i,...s}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(m)<this.maxTokens)break}const h=await this.llmChain.apply(l,t?Array.from({length:l.length},(m,_)=>t.getChild(`map_${_+1}`)):void 0),{outputKey:b}=this.llmChain;this.returnIntermediateSteps&&(a=a.concat(h.map(m=>m[b]))),i=h.map(m=>({pageContent:m[b],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:i,...s},u=await this.combineDocumentChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...u,intermediateSteps:a}:u}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new Hn({llmChain:await Ke.deserialize(e.llm_chain),combineDocumentChain:await gr.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class Kn extends nn{get defaultDocumentPrompt(){return new ke({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const r={page_content:e.pageContent,...e.metadata},s={};return this.documentPrompt.inputVariables.forEach(o=>{s[o]=r[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...s})},...t}}async _constructRefineInputs(e,t){const r={page_content:e.pageContent,...e.metadata},s={};this.documentPrompt.inputVariables.forEach(o=>{s[o]=r[o]});const i={[this.documentVariableName]:await this.documentPrompt.format({...s})};return{[this.initialResponseName]:t,...i}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...s}=e,i=r,a=await this._constructInitialInputs(i[0],s);let o=await this.llmChain.predict({...a},t==null?void 0:t.getChild("answer"));for(let u=1;u<i.length;u+=1){const l={...await this._constructRefineInputs(i[u],o),...s};o=await this.refineLLMChain.predict({...l},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const r=e.refine_llm_chain;if(!r)throw new Error("Missing refine_llm_chain");return new Kn({llmChain:await Ke.deserialize(t),refineLLMChain:await Ke.deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const Us=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:Hn,RefineDocumentsChain:Kn,StuffDocumentsChain:gr},Symbol.toStringTag,{value:"Module"}));class wm extends it{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}}class Om extends au{constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class Ri extends wm{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class Em extends Ii{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new Om(t)}}class rr extends Ri{async format(e){return new su(await this.prompt.format(e))}static fromTemplate(e){return new this(ke.fromTemplate(e))}}class Am extends Ri{async format(e){return new iu(await this.prompt.format(e))}static fromTemplate(e){return new this(ke.fromTemplate(e))}}class Zn extends Ri{async format(e){return new zh(await this.prompt.format(e))}static fromTemplate(e){return new this(ke.fromTemplate(e))}}class lt extends Em{get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const a of this.promptMessages)for(const o of a.inputVariables)t.add(o);const r=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),s=new Set([...r].filter(a=>!t.has(a)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const i=new Set([...t].filter(a=>!r.has(a)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const s of this.promptMessages){const i=s.inputVariables.reduce((o,u)=>{if(!(u in t))throw new Error(`Missing value for input variable \`${u}\``);return o[u]=t[u],o},{}),a=await s.formatMessages(i);r=r.concat(a)}return r}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(r=>!(r in e)),t.partialVariables={...this.partialVariables??{},...e},new lt(t)}static fromPromptMessages(e){const t=e.reduce((i,a)=>i.concat(a instanceof lt?a.promptMessages:[a]),[]),r=e.reduce((i,a)=>a instanceof lt?Object.assign(i,a.partialVariables):i,Object.create(null)),s=new Set;for(const i of t)for(const a of i.inputVariables)a in r||s.add(a);return new lt({inputVariables:[...s],promptMessages:t,partialVariables:r})}}class Tm{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class sn extends Tm{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function an(n){return n._modelType()==="base_chat_model"}const Pm=new ke({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),xm=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,Sm=[Zn.fromTemplate(xm),rr.fromTemplate("{question}")],km=lt.fromPromptMessages(Sm),jm=new sn(Pm,[[an,km]]),Cm=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
{context}
Question: {question}
Relevant text, if any:`,Im=ke.fromTemplate(Cm),Rm=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
----------------
{context}`,Dm=[Zn.fromTemplate(Rm),rr.fromTemplate("{question}")],Nm=lt.fromPromptMessages(Dm),Lm=new sn(Im,[[an,Nm]]),$m=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.

QUESTION: Which state/country's law governs the interpretation of the contract?
=========
Content: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.

Content: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.

11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.

11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.

11.9 No Third-Party Beneficiaries.

Content: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,
=========
FINAL ANSWER: This Agreement is governed by English law.

QUESTION: What did the president say about Michael Jackson?
=========
Content: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  

Last year COVID-19 kept us apart. This year we are finally together again. 

Tonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. 

With a duty to one another to the American people to the Constitution. 

And with an unwavering resolve that freedom will always triumph over tyranny. 

Six days ago, Russia’s Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. 

He thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. 

He met the Ukrainian people. 

From President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. 

Groups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.

Content: And we won’t stop. 

We have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. 

Let’s use this moment to reset. Let’s stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  

Let’s stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  

We can’t change how divided we’ve been. But we can change how we move forward—on COVID-19 and other issues we must face together. 

I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. 

They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. 

Officer Mora was 27 years old. 

Officer Rivera was 22. 

Both Dominican Americans who’d grown up on the same streets they later chose to patrol as police officers. 

I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.

Content: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  

To all Americans, I will be honest with you, as I’ve always promised. A Russian dictator, invading a foreign country, has costs around the world. 

And I’m taking robust action to make sure the pain of our sanctions  is targeted at Russia’s economy. And I will use every tool at our disposal to protect American businesses and consumers. 

Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  

America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  

These steps will help blunt gas prices here at home. And I know the news about what’s happening can seem alarming. 

But I want you to know that we are going to be okay.

Content: More support for patients and families. 

To get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. 

It’s based on DARPA—the Defense Department project that led to the Internet, GPS, and so much more.  

ARPA-H will have a singular purpose—to drive breakthroughs in cancer, Alzheimer’s, diabetes, and more. 

A unity agenda for the nation. 

We can do this. 

My fellow Americans—tonight , we have gathered in a sacred space—the citadel of our democracy. 

In this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. 

We have fought for freedom, expanded liberty, defeated totalitarianism and terror. 

And built the strongest, freest, and most prosperous nation the world has ever known. 

Now is the hour. 

Our moment of responsibility. 

Our test of resolve and conscience, of history itself. 

It is in this moment that our character is formed. Our purpose is found. Our future is forged. 

Well I know this nation.
=========
FINAL ANSWER: The president did not mention Michael Jackson.

QUESTION: {question}
=========
{summaries}
=========
FINAL ANSWER:`,Mm=ke.fromTemplate($m),Um=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.
----------------
{summaries}`,Fm=[Zn.fromTemplate(Um),rr.fromTemplate("{question}")],Bm=lt.fromPromptMessages(Fm),Vm=new sn(Mm,[[an,Bm]]),qm=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,zm=new ke({inputVariables:["question","existing_answer","context"],template:qm}),Hm=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,Km=[rr.fromTemplate("{question}"),Am.fromTemplate("{existing_answer}"),rr.fromTemplate(Hm)],Zm=lt.fromPromptMessages(Km),Jm=new sn(zm,[[an,Zm]]),Gm=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and not prior knowledge, answer the question: {question}`,Ym=new ke({inputVariables:["context","question"],template:Gm}),Wm=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and not prior knowledge, answer any questions`,Qm=[Zn.fromTemplate(Wm),rr.fromTemplate("{question}")],Xm=lt.fromPromptMessages(Qm),ey=new sn(Ym,[[an,Xm]]),ty=(n,e={type:"stuff"})=>{const{type:t}=e;if(t==="stuff")return ry(n,e);if(t==="map_reduce")return ny(n,e);if(t==="refine")return sy(n,e);throw new Error(`Invalid _type: ${t}`)};function ry(n,e={}){const{prompt:t=jm.getPrompt(n),verbose:r}=e,s=new Ke({prompt:t,llm:n,verbose:r});return new gr({llmChain:s,verbose:r})}function ny(n,e={}){const{combineMapPrompt:t=Lm.getPrompt(n),combinePrompt:r=Vm.getPrompt(n),verbose:s,returnIntermediateSteps:i}=e,a=new Ke({prompt:t,llm:n,verbose:s}),o=new Ke({prompt:r,llm:n,verbose:s}),u=new gr({llmChain:o,documentVariableName:"summaries",verbose:s});return new Hn({llmChain:a,combineDocumentChain:u,returnIntermediateSteps:i,verbose:s})}function sy(n,e={}){const{questionPrompt:t=ey.getPrompt(n),refinePrompt:r=Jm.getPrompt(n),verbose:s}=e,i=new Ke({prompt:t,llm:n,verbose:s}),a=new Ke({prompt:r,llm:n,verbose:s});return new Kn({llmChain:i,refineLLMChain:a,verbose:s})}const iy=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`;class Di extends nn{get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}static getChatHistoryString(e){return Array.isArray(e)?e.map(t=>t._getType()==="human"?`Human: ${t.content}`:t._getType()==="ai"?`Assistant: ${t.content}`:`${t.content}`).join(`
`):e}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const r=e[this.inputKey],s=Di.getChatHistoryString(e[this.chatHistoryKey]);let i=r;if(s.length>0){const c=await this.questionGeneratorChain.call({question:r,chat_history:s},t==null?void 0:t.getChild("question_generator")),l=Object.keys(c);if(l.length===1)i=c[l[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const a=await this.retriever.getRelevantDocuments(i),o={question:i,input_documents:a,chat_history:s},u=await this.combineDocumentsChain.call(o,t==null?void 0:t.getChild("combine_documents"));return this.returnSourceDocuments?{...u,sourceDocuments:a}:u}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,t){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,t,r={}){const{questionGeneratorTemplate:s,qaTemplate:i,qaChainOptions:a={type:"stuff",prompt:i?ke.fromTemplate(i):void 0},questionGeneratorChainOptions:o,verbose:u,...c}=r,l=ty(e,a),d=ke.fromTemplate((o==null?void 0:o.template)??s??iy),h=new Ke({prompt:d,llm:(o==null?void 0:o.llm)??e,verbose:u});return new this({retriever:t,combineDocumentsChain:l,questionGeneratorChain:h,verbose:u,...c})}}var ue;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(ue||(ue={}));var kn;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(kn||(kn={}));const z=ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bt=n=>{switch(typeof n){case"undefined":return z.undefined;case"string":return z.string;case"number":return isNaN(n)?z.nan:z.number;case"boolean":return z.boolean;case"function":return z.function;case"bigint":return z.bigint;case"symbol":return z.symbol;case"object":return Array.isArray(n)?z.array:n===null?z.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?z.promise:typeof Map<"u"&&n instanceof Map?z.map:typeof Set<"u"&&n instanceof Set?z.set:typeof Date<"u"&&n instanceof Date?z.date:z.object;default:return z.unknown}},M=ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Du=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Qe extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Qe.create=n=>new Qe(n);const nr=(n,e)=>{let t;switch(n.code){case M.invalid_type:n.received===z.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case M.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ue.jsonStringifyReplacer)}`;break;case M.unrecognized_keys:t=`Unrecognized key(s) in object: ${ue.joinValues(n.keys,", ")}`;break;case M.invalid_union:t="Invalid input";break;case M.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ue.joinValues(n.options)}`;break;case M.invalid_enum_value:t=`Invalid enum value. Expected ${ue.joinValues(n.options)}, received '${n.received}'`;break;case M.invalid_arguments:t="Invalid function arguments";break;case M.invalid_return_type:t="Invalid function return type";break;case M.invalid_date:t="Invalid date";break;case M.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ue.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case M.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case M.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case M.custom:t="Invalid input";break;case M.invalid_intersection_types:t="Intersection results could not be merged";break;case M.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case M.not_finite:t="Number must be finite";break;default:t=e.defaultError,ue.assertNever(n)}return{message:t}};let Nu=nr;function Lu(n){Nu=n}function zr(){return Nu}const Hr=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}},$u=[];function K(n,e){const t=Hr({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,zr(),nr].filter(r=>!!r)});n.common.issues.push(t)}class je{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return re;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t)r.push({key:await s.key,value:await s.value});return je.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return re;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const re=Object.freeze({status:"aborted"}),Ni=n=>({status:"dirty",value:n}),Ne=n=>({status:"valid",value:n}),jn=n=>n.status==="aborted",Cn=n=>n.status==="dirty",Kr=n=>n.status==="valid",Zr=n=>typeof Promise<"u"&&n instanceof Promise;var G;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(G||(G={}));class ft{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const eo=(n,e)=>{if(Kr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Qe(n.common.issues);return this._error=t,this._error}}};function se(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:r??o.defaultError}:{message:t??o.defaultError},description:s}}class ne{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return bt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:bt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new je,ctx:{common:e.parent.common,data:e.data,parsedType:bt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Zr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bt(e)},i=this._parseSync({data:e,path:s.path,parent:s});return eo(s,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bt(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Zr(s)?s:Promise.resolve(s));return eo(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:M.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Ze({schema:this,typeName:Y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ht.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Xe.create(this,this._def)}promise(){return qt.create(this,this._def)}or(e){return or.create([this,e],this._def)}and(e){return ur.create(this,e,this._def)}transform(e){return new Ze({...se(this._def),schema:this,typeName:Y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new fr({...se(this._def),innerType:this,defaultValue:t,typeName:Y.ZodDefault})}brand(){return new Li({typeName:Y.ZodBranded,type:this,...se(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Wr({...se(this._def),innerType:this,catchValue:t,typeName:Y.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return br.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ay=/^c[^\s-]{8,}$/i,oy=/^[a-z][a-z0-9]*$/,uy=/[0-9A-HJKMNP-TV-Z]{26}/,cy=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,ly=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,dy=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,hy=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,fy=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,py=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function my(n,e){return!!((e==="v4"||!e)&&hy.test(n)||(e==="v6"||!e)&&fy.test(n))}class We extends ne{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(s=>e.test(s),{validation:t,code:M.invalid_string,...G.errToObj(r)}),this.nonempty=e=>this.min(1,G.errToObj(e)),this.trim=()=>new We({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new We({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new We({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==z.string){const i=this._getOrReturnCtx(e);return K(i,{code:M.invalid_type,expected:z.string,received:i.parsedType}),re}const r=new je;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:M.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:M.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?K(s,{code:M.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&K(s,{code:M.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")ly.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"email",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")dy.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"emoji",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")cy.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"uuid",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")ay.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")oy.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid2",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")uy.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ulid",code:M.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),K(s,{validation:"url",code:M.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"regex",code:M.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),K(s,{code:M.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:M.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:M.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?py(i).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:M.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="ip"?my(e.data,i.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ip",code:M.invalid_string,message:i.message}),r.dirty()):ue.assertNever(i);return{status:r.value,value:e.data}}_addCheck(e){return new We({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...G.errToObj(e)})}url(e){return this._addCheck({kind:"url",...G.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...G.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...G.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...G.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...G.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...G.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...G.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...G.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...G.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...G.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...G.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...G.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...G.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...G.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...G.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}We.create=n=>{var e;return new We({checks:[],typeName:Y.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...se(n)})};function yy(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class _t extends ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==z.number){const i=this._getOrReturnCtx(e);return K(i,{code:M.invalid_type,expected:z.number,received:i.parsedType}),re}let r;const s=new je;for(const i of this._def.checks)i.kind==="int"?ue.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{code:M.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?yy(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{code:M.not_finite,message:i.message}),s.dirty()):ue.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,r,s){return new _t({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:G.toString(s)}]})}_addCheck(e){return new _t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:G.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:G.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:G.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:G.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ue.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}_t.create=n=>new _t({checks:[],typeName:Y.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...se(n)});class wt extends ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==z.bigint){const i=this._getOrReturnCtx(e);return K(i,{code:M.invalid_type,expected:z.bigint,received:i.parsedType}),re}let r;const s=new je;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),K(r,{code:M.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):ue.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,G.toString(t))}gt(e,t){return this.setLimit("min",e,!1,G.toString(t))}lte(e,t){return this.setLimit("max",e,!0,G.toString(t))}lt(e,t){return this.setLimit("max",e,!1,G.toString(t))}setLimit(e,t,r,s){return new wt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:G.toString(s)}]})}_addCheck(e){return new wt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:G.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}wt.create=n=>{var e;return new wt({checks:[],typeName:Y.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...se(n)})};class sr extends ne{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==z.boolean){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.boolean,received:r.parsedType}),re}return Ne(e.data)}}sr.create=n=>new sr({typeName:Y.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...se(n)});class kt extends ne{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==z.date){const i=this._getOrReturnCtx(e);return K(i,{code:M.invalid_type,expected:z.date,received:i.parsedType}),re}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return K(i,{code:M.invalid_date}),re}const r=new je;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:M.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:M.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):ue.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new kt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:G.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:G.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}kt.create=n=>new kt({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Y.ZodDate,...se(n)});class Jr extends ne{_parse(e){if(this._getType(e)!==z.symbol){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.symbol,received:r.parsedType}),re}return Ne(e.data)}}Jr.create=n=>new Jr({typeName:Y.ZodSymbol,...se(n)});class ir extends ne{_parse(e){if(this._getType(e)!==z.undefined){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.undefined,received:r.parsedType}),re}return Ne(e.data)}}ir.create=n=>new ir({typeName:Y.ZodUndefined,...se(n)});class ar extends ne{_parse(e){if(this._getType(e)!==z.null){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.null,received:r.parsedType}),re}return Ne(e.data)}}ar.create=n=>new ar({typeName:Y.ZodNull,...se(n)});class Vt extends ne{constructor(){super(...arguments),this._any=!0}_parse(e){return Ne(e.data)}}Vt.create=n=>new Vt({typeName:Y.ZodAny,...se(n)});class St extends ne{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ne(e.data)}}St.create=n=>new St({typeName:Y.ZodUnknown,...se(n)});class pt extends ne{_parse(e){const t=this._getOrReturnCtx(e);return K(t,{code:M.invalid_type,expected:z.never,received:t.parsedType}),re}}pt.create=n=>new pt({typeName:Y.ZodNever,...se(n)});class Gr extends ne{_parse(e){if(this._getType(e)!==z.undefined){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.void,received:r.parsedType}),re}return Ne(e.data)}}Gr.create=n=>new Gr({typeName:Y.ZodVoid,...se(n)});class Xe extends ne{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==z.array)return K(t,{code:M.invalid_type,expected:z.array,received:t.parsedType}),re;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(K(t,{code:a?M.too_big:M.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(K(t,{code:M.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(K(t,{code:M.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ft(t,a,t.path,o)))).then(a=>je.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new ft(t,a,t.path,o)));return je.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Xe({...this._def,minLength:{value:e,message:G.toString(t)}})}max(e,t){return new Xe({...this._def,maxLength:{value:e,message:G.toString(t)}})}length(e,t){return new Xe({...this._def,exactLength:{value:e,message:G.toString(t)}})}nonempty(e){return this.min(1,e)}}Xe.create=(n,e)=>new Xe({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Y.ZodArray,...se(e)});function Xt(n){if(n instanceof me){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=ht.create(Xt(r))}return new me({...n._def,shape:()=>e})}else return n instanceof Xe?new Xe({...n._def,type:Xt(n.element)}):n instanceof ht?ht.create(Xt(n.unwrap())):n instanceof Ct?Ct.create(Xt(n.unwrap())):n instanceof at?at.create(n.items.map(e=>Xt(e))):n}class me extends ne{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ue.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==z.object){const c=this._getOrReturnCtx(e);return K(c,{code:M.invalid_type,expected:z.object,received:c.parsedType}),re}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof pt&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const u=[];for(const c of a){const l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ft(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof pt){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(K(s,{code:M.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ft(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>je.mergeObjectSync(r,c)):je.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return G.errToObj,new me({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=G.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new me({...this._def,unknownKeys:"strip"})}passthrough(){return new me({...this._def,unknownKeys:"passthrough"})}extend(e){return new me({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new me({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new me({...this._def,catchall:e})}pick(e){const t={};return ue.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new me({...this._def,shape:()=>t})}omit(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new me({...this._def,shape:()=>t})}deepPartial(){return Xt(this)}partial(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new me({...this._def,shape:()=>t})}required(e){const t={};return ue.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof ht;)i=i._def.innerType;t[r]=i}}),new me({...this._def,shape:()=>t})}keyof(){return Mu(ue.objectKeys(this.shape))}}me.create=(n,e)=>new me({shape:()=>n,unknownKeys:"strip",catchall:pt.create(),typeName:Y.ZodObject,...se(e)});me.strictCreate=(n,e)=>new me({shape:()=>n,unknownKeys:"strict",catchall:pt.create(),typeName:Y.ZodObject,...se(e)});me.lazycreate=(n,e)=>new me({shape:n,unknownKeys:"strip",catchall:pt.create(),typeName:Y.ZodObject,...se(e)});class or extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Qe(o.ctx.common.issues));return K(t,{code:M.invalid_union,unionErrors:a}),re}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new Qe(u));return K(t,{code:M.invalid_union,unionErrors:o}),re}}get options(){return this._def.options}}or.create=(n,e)=>new or({options:n,typeName:Y.ZodUnion,...se(e)});const Tn=n=>n instanceof lr?Tn(n.schema):n instanceof Ze?Tn(n.innerType()):n instanceof dr?[n.value]:n instanceof Ot?n.options:n instanceof hr?Object.keys(n.enum):n instanceof fr?Tn(n._def.innerType):n instanceof ir?[void 0]:n instanceof ar?[null]:null;class on extends ne{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==z.object)return K(t,{code:M.invalid_type,expected:z.object,received:t.parsedType}),re;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(K(t,{code:M.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),re)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=Tn(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new on({typeName:Y.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...se(r)})}}function ni(n,e){const t=bt(n),r=bt(e);if(n===e)return{valid:!0,data:n};if(t===z.object&&r===z.object){const s=ue.objectKeys(e),i=ue.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=ni(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===z.array&&r===z.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=ni(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===z.date&&r===z.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class ur extends ne{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(jn(i)||jn(a))return re;const o=ni(i.value,a.value);return o.valid?((Cn(i)||Cn(a))&&t.dirty(),{status:t.value,value:o.data}):(K(r,{code:M.invalid_intersection_types}),re)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ur.create=(n,e,t)=>new ur({left:n,right:e,typeName:Y.ZodIntersection,...se(t)});class at extends ne{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==z.array)return K(r,{code:M.invalid_type,expected:z.array,received:r.parsedType}),re;if(r.data.length<this._def.items.length)return K(r,{code:M.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),re;!this._def.rest&&r.data.length>this._def.items.length&&(K(r,{code:M.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new ft(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>je.mergeArray(t,a)):je.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new at({...this._def,rest:e})}}at.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new at({items:n,typeName:Y.ZodTuple,rest:null,...se(e)})};class cr extends ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==z.object)return K(r,{code:M.invalid_type,expected:z.object,received:r.parsedType}),re;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new ft(r,o,r.path,o)),value:a._parse(new ft(r,r.data[o],r.path,o))});return r.common.async?je.mergeObjectAsync(t,s):je.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof ne?new cr({keyType:e,valueType:t,typeName:Y.ZodRecord,...se(r)}):new cr({keyType:We.create(),valueType:e,typeName:Y.ZodRecord,...se(t)})}}class Yr extends ne{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==z.map)return K(r,{code:M.invalid_type,expected:z.map,received:r.parsedType}),re;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],c)=>({key:s._parse(new ft(r,o,r.path,[c,"key"])),value:i._parse(new ft(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return re;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return re;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}}Yr.create=(n,e,t)=>new Yr({valueType:e,keyType:n,typeName:Y.ZodMap,...se(t)});class jt extends ne{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==z.set)return K(r,{code:M.invalid_type,expected:z.set,received:r.parsedType}),re;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(K(r,{code:M.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(K(r,{code:M.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const c=new Set;for(const l of u){if(l.status==="aborted")return re;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>i._parse(new ft(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new jt({...this._def,minSize:{value:e,message:G.toString(t)}})}max(e,t){return new jt({...this._def,maxSize:{value:e,message:G.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}jt.create=(n,e)=>new jt({valueType:n,minSize:null,maxSize:null,typeName:Y.ZodSet,...se(e)});class Bt extends ne{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==z.function)return K(t,{code:M.invalid_type,expected:z.function,received:t.parsedType}),re;function r(o,u){return Hr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,zr(),nr].filter(c=>!!c),issueData:{code:M.invalid_arguments,argumentsError:u}})}function s(o,u){return Hr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,zr(),nr].filter(c=>!!c),issueData:{code:M.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;return this._def.returns instanceof qt?Ne(async(...o)=>{const u=new Qe([]),c=await this._def.args.parseAsync(o,i).catch(h=>{throw u.addIssue(r(o,h)),u}),l=await a(...c);return await this._def.returns._def.type.parseAsync(l,i).catch(h=>{throw u.addIssue(s(l,h)),u})}):Ne((...o)=>{const u=this._def.args.safeParse(o,i);if(!u.success)throw new Qe([r(o,u.error)]);const c=a(...u.data),l=this._def.returns.safeParse(c,i);if(!l.success)throw new Qe([s(c,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Bt({...this._def,args:at.create(e).rest(St.create())})}returns(e){return new Bt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Bt({args:e||at.create([]).rest(St.create()),returns:t||St.create(),typeName:Y.ZodFunction,...se(r)})}}class lr extends ne{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}lr.create=(n,e)=>new lr({getter:n,typeName:Y.ZodLazy,...se(e)});class dr extends ne{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return K(t,{received:t.data,code:M.invalid_literal,expected:this._def.value}),re}return{status:"valid",value:e.data}}get value(){return this._def.value}}dr.create=(n,e)=>new dr({value:n,typeName:Y.ZodLiteral,...se(e)});function Mu(n,e){return new Ot({values:n,typeName:Y.ZodEnum,...se(e)})}class Ot extends ne{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return K(t,{expected:ue.joinValues(r),received:t.parsedType,code:M.invalid_type}),re}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return K(t,{received:t.data,code:M.invalid_enum_value,options:r}),re}return Ne(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Ot.create(e)}exclude(e){return Ot.create(this.options.filter(t=>!e.includes(t)))}}Ot.create=Mu;class hr extends ne{_parse(e){const t=ue.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==z.string&&r.parsedType!==z.number){const s=ue.objectValues(t);return K(r,{expected:ue.joinValues(s),received:r.parsedType,code:M.invalid_type}),re}if(t.indexOf(e.data)===-1){const s=ue.objectValues(t);return K(r,{received:r.data,code:M.invalid_enum_value,options:s}),re}return Ne(e.data)}get enum(){return this._def.values}}hr.create=(n,e)=>new hr({values:n,typeName:Y.ZodNativeEnum,...se(e)});class qt extends ne{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==z.promise&&t.common.async===!1)return K(t,{code:M.invalid_type,expected:z.promise,received:t.parsedType}),re;const r=t.parsedType===z.promise?t.data:Promise.resolve(t.data);return Ne(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}qt.create=(n,e)=>new qt({type:n,typeName:Y.ZodPromise,...se(e)});class Ze extends ne{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null;if(s.type==="preprocess"){const a=s.transform(r.data);return r.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:r.path,parent:r})):this._def.schema._parseSync({data:a,path:r.path,parent:r})}const i={addIssue:a=>{K(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?re:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Kr(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>Kr(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);ue.assertNever(s)}}Ze.create=(n,e,t)=>new Ze({schema:n,typeName:Y.ZodEffects,effect:e,...se(t)});Ze.createWithPreprocess=(n,e,t)=>new Ze({schema:e,effect:{type:"preprocess",transform:n},typeName:Y.ZodEffects,...se(t)});class ht extends ne{_parse(e){return this._getType(e)===z.undefined?Ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ht.create=(n,e)=>new ht({innerType:n,typeName:Y.ZodOptional,...se(e)});class Ct extends ne{_parse(e){return this._getType(e)===z.null?Ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ct.create=(n,e)=>new Ct({innerType:n,typeName:Y.ZodNullable,...se(e)});class fr extends ne{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===z.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}fr.create=(n,e)=>new fr({innerType:n,typeName:Y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...se(e)});class Wr extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Zr(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Qe(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Qe(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Wr.create=(n,e)=>new Wr({innerType:n,typeName:Y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...se(e)});class Qr extends ne{_parse(e){if(this._getType(e)!==z.nan){const r=this._getOrReturnCtx(e);return K(r,{code:M.invalid_type,expected:z.nan,received:r.parsedType}),re}return{status:"valid",value:e.data}}}Qr.create=n=>new Qr({typeName:Y.ZodNaN,...se(n)});const Uu=Symbol("zod_brand");class Li extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class br extends ne{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?re:i.status==="dirty"?(t.dirty(),Ni(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?re:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new br({in:e,out:t,typeName:Y.ZodPipeline})}}const $i=(n,e={},t)=>n?Vt.create().superRefine((r,s)=>{var i,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):Vt.create(),Fu={object:me.lazycreate};var Y;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline"})(Y||(Y={}));const Bu=(n,e={message:`Input not instance of ${n.name}`})=>$i(t=>t instanceof n,e),Mi=We.create,Ui=_t.create,Vu=Qr.create,qu=wt.create,Fi=sr.create,zu=kt.create,Hu=Jr.create,Ku=ir.create,Zu=ar.create,Ju=Vt.create,Gu=St.create,Yu=pt.create,Wu=Gr.create,Qu=Xe.create,Xu=me.create,ec=me.strictCreate,tc=or.create,rc=on.create,nc=ur.create,sc=at.create,ic=cr.create,ac=Yr.create,oc=jt.create,uc=Bt.create,cc=lr.create,lc=dr.create,dc=Ot.create,hc=hr.create,fc=qt.create,In=Ze.create,pc=ht.create,mc=Ct.create,yc=Ze.createWithPreprocess,gc=br.create,bc=()=>Mi().optional(),vc=()=>Ui().optional(),_c=()=>Fi().optional(),wc={string:n=>We.create({...n,coerce:!0}),number:n=>_t.create({...n,coerce:!0}),boolean:n=>sr.create({...n,coerce:!0}),bigint:n=>wt.create({...n,coerce:!0}),date:n=>kt.create({...n,coerce:!0})},Oc=re;var to=Object.freeze({__proto__:null,defaultErrorMap:nr,setErrorMap:Lu,getErrorMap:zr,makeIssue:Hr,EMPTY_PATH:$u,addIssueToContext:K,ParseStatus:je,INVALID:re,DIRTY:Ni,OK:Ne,isAborted:jn,isDirty:Cn,isValid:Kr,isAsync:Zr,get util(){return ue},get objectUtil(){return kn},ZodParsedType:z,getParsedType:bt,ZodType:ne,ZodString:We,ZodNumber:_t,ZodBigInt:wt,ZodBoolean:sr,ZodDate:kt,ZodSymbol:Jr,ZodUndefined:ir,ZodNull:ar,ZodAny:Vt,ZodUnknown:St,ZodNever:pt,ZodVoid:Gr,ZodArray:Xe,ZodObject:me,ZodUnion:or,ZodDiscriminatedUnion:on,ZodIntersection:ur,ZodTuple:at,ZodRecord:cr,ZodMap:Yr,ZodSet:jt,ZodFunction:Bt,ZodLazy:lr,ZodLiteral:dr,ZodEnum:Ot,ZodNativeEnum:hr,ZodPromise:qt,ZodEffects:Ze,ZodTransformer:Ze,ZodOptional:ht,ZodNullable:Ct,ZodDefault:fr,ZodCatch:Wr,ZodNaN:Qr,BRAND:Uu,ZodBranded:Li,ZodPipeline:br,custom:$i,Schema:ne,ZodSchema:ne,late:Fu,get ZodFirstPartyTypeKind(){return Y},coerce:wc,any:Ju,array:Qu,bigint:qu,boolean:Fi,date:zu,discriminatedUnion:rc,effect:In,enum:dc,function:uc,instanceof:Bu,intersection:nc,lazy:cc,literal:lc,map:ac,nan:Vu,nativeEnum:hc,never:Yu,null:Zu,nullable:mc,number:Ui,object:Xu,oboolean:_c,onumber:vc,optional:pc,ostring:bc,pipeline:gc,preprocess:yc,promise:fc,record:ic,set:oc,strictObject:ec,string:Mi,symbol:Hu,transformer:In,tuple:sc,undefined:Ku,union:tc,unknown:Gu,void:Wu,NEVER:Oc,ZodIssueCode:M,quotelessJson:Du,ZodError:Qe});const gy=Object.freeze(Object.defineProperty({__proto__:null,BRAND:Uu,DIRTY:Ni,EMPTY_PATH:$u,INVALID:re,NEVER:Oc,OK:Ne,ParseStatus:je,Schema:ne,ZodAny:Vt,ZodArray:Xe,ZodBigInt:wt,ZodBoolean:sr,ZodBranded:Li,ZodCatch:Wr,ZodDate:kt,ZodDefault:fr,ZodDiscriminatedUnion:on,ZodEffects:Ze,ZodEnum:Ot,ZodError:Qe,get ZodFirstPartyTypeKind(){return Y},ZodFunction:Bt,ZodIntersection:ur,ZodIssueCode:M,ZodLazy:lr,ZodLiteral:dr,ZodMap:Yr,ZodNaN:Qr,ZodNativeEnum:hr,ZodNever:pt,ZodNull:ar,ZodNullable:Ct,ZodNumber:_t,ZodObject:me,ZodOptional:ht,ZodParsedType:z,ZodPipeline:br,ZodPromise:qt,ZodRecord:cr,ZodSchema:ne,ZodSet:jt,ZodString:We,ZodSymbol:Jr,ZodTransformer:Ze,ZodTuple:at,ZodType:ne,ZodUndefined:ir,ZodUnion:or,ZodUnknown:St,ZodVoid:Gr,addIssueToContext:K,any:Ju,array:Qu,bigint:qu,boolean:Fi,coerce:wc,custom:$i,date:zu,default:to,defaultErrorMap:nr,discriminatedUnion:rc,effect:In,enum:dc,function:uc,getErrorMap:zr,getParsedType:bt,instanceof:Bu,intersection:nc,isAborted:jn,isAsync:Zr,isDirty:Cn,isValid:Kr,late:Fu,lazy:cc,literal:lc,makeIssue:Hr,map:ac,nan:Vu,nativeEnum:hc,never:Yu,null:Zu,nullable:mc,number:Ui,object:Xu,get objectUtil(){return kn},oboolean:_c,onumber:vc,optional:pc,ostring:bc,pipeline:gc,preprocess:yc,promise:fc,quotelessJson:Du,record:ic,set:oc,setErrorMap:Lu,strictObject:ec,string:Mi,symbol:Hu,transformer:In,tuple:sc,undefined:Ku,union:tc,unknown:Gu,get util(){return ue},void:Wu,z:to},Symbol.toStringTag,{value:"Module"}));var by={},Jn={},wr={};const Bi=Zc(gy);var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0});Gn.parseAnyDef=void 0;function vy(){return{}}Gn.parseAnyDef=vy;var Or={},ot={};Object.defineProperty(ot,"__esModule",{value:!0});ot.setResponseValueAndErrors=ot.addErrorMessage=void 0;function Ec(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage=Object.assign(Object.assign({},n.errorMessage),{[e]:t}))}ot.addErrorMessage=Ec;function _y(n,e,t,r,s){n[e]=t,Ec(n,e,r,s)}ot.setResponseValueAndErrors=_y;var ro;function wy(){if(ro)return Or;ro=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.parseArrayDef=void 0;const n=Bi,e=ot,t=Ce();function r(s,i){var a,o;const u={type:"array"};return((o=(a=s.type)===null||a===void 0?void 0:a._def)===null||o===void 0?void 0:o.typeName)!==n.ZodFirstPartyTypeKind.ZodAny&&(u.items=(0,t.parseDef)(s.type._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"items"]}))),s.minLength&&(0,e.setResponseValueAndErrors)(u,"minItems",s.minLength.value,s.minLength.message,i),s.maxLength&&(0,e.setResponseValueAndErrors)(u,"maxItems",s.maxLength.value,s.maxLength.message,i),s.exactLength&&((0,e.setResponseValueAndErrors)(u,"minItems",s.exactLength.value,s.exactLength.message,i),(0,e.setResponseValueAndErrors)(u,"maxItems",s.exactLength.value,s.exactLength.message,i)),u}return Or.parseArrayDef=r,Or}var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});Yn.parseBigintDef=void 0;const Dt=ot;function Oy(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?(0,Dt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,Dt.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,Dt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,Dt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,Dt.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,Dt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,Dt.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}Yn.parseBigintDef=Oy;var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});Wn.parseBooleanDef=void 0;function Ey(){return{type:"boolean"}}Wn.parseBooleanDef=Ey;var Er={},no;function Ay(){if(no)return Er;no=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.parseBrandedDef=void 0;const n=Ce();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return Er.parseBrandedDef=e,Er}var Ar={},so;function Ty(){if(so)return Ar;so=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.parseCatchDef=void 0;const n=Ce(),e=(t,r)=>(0,n.parseDef)(t.innerType._def,r);return Ar.parseCatchDef=e,Ar}var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.parseDateDef=void 0;const io=ot;function Py(n,e){return e.dateStrategy=="integer"?xy(n,e):{type:"string",format:"date-time"}}Qn.parseDateDef=Py;const xy=(n,e)=>{const t={type:"integer",format:"unix-time"};for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"&&(0,io.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e);break;case"max":e.target==="jsonSchema7"&&(0,io.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e);break}return t};var Tr={},ao;function Sy(){if(ao)return Tr;ao=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.parseDefaultDef=void 0;const n=Ce();function e(t,r){return Object.assign(Object.assign({},(0,n.parseDef)(t.innerType._def,r)),{default:t.defaultValue()})}return Tr.parseDefaultDef=e,Tr}var Pr={},oo;function ky(){if(oo)return Pr;oo=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.parseEffectsDef=void 0;const n=Ce();function e(t,r){return r.effectStrategy==="input"?(0,n.parseDef)(t.schema._def,r):{}}return Pr.parseEffectsDef=e,Pr}var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.parseEnumDef=void 0;function jy(n){return{type:"string",enum:n.values}}Xn.parseEnumDef=jy;var xr={},uo;function Cy(){if(uo)return xr;uo=1;var n=st&&st.__rest||function(s,i){var a={};for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.indexOf(o)<0&&(a[o]=s[o]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(s);u<o.length;u++)i.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(s,o[u])&&(a[o[u]]=s[o[u]]);return a};Object.defineProperty(xr,"__esModule",{value:!0}),xr.parseIntersectionDef=void 0;const e=Ce(),t=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function r(s,i){const a=[(0,e.parseDef)(s.left._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","0"]})),(0,e.parseDef)(s.right._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","1"]}))].filter(c=>!!c);let o=i.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const u=[];return a.forEach(c=>{if(t(c))u.push(...c.allOf),c.unevaluatedProperties===void 0&&(o=void 0);else{let l=c;"additionalProperties"in c&&c.additionalProperties===!1?l=n(c,["additionalProperties"]):o=void 0,u.push(l)}}),u.length?Object.assign({allOf:u},o):void 0}return xr.parseIntersectionDef=r,xr}var es={};Object.defineProperty(es,"__esModule",{value:!0});es.parseLiteralDef=void 0;function Iy(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}es.parseLiteralDef=Iy;var Sr={},co;function Ry(){if(co)return Sr;co=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.parseMapDef=void 0;const n=Ce();function e(t,r){const s=(0,n.parseDef)(t.keyType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","0"]}))||{},i=(0,n.parseDef)(t.valueType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[s,i],minItems:2,maxItems:2}}}return Sr.parseMapDef=e,Sr}var ts={};Object.defineProperty(ts,"__esModule",{value:!0});ts.parseNativeEnumDef=void 0;function Dy(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}ts.parseNativeEnumDef=Dy;var rs={};Object.defineProperty(rs,"__esModule",{value:!0});rs.parseNeverDef=void 0;function Ny(){return{not:{}}}rs.parseNeverDef=Ny;var ns={};Object.defineProperty(ns,"__esModule",{value:!0});ns.parseNullDef=void 0;function Ly(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}ns.parseNullDef=Ly;var kr={},Fs={},lo;function Ac(){return lo||(lo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseUnionDef=n.primitiveMappings=void 0;const e=Ce();n.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function t(s,i){if(i.target==="openApi3")return r(s,i);const a=s.options instanceof Map?Array.from(s.options.values()):s.options;if(a.every(o=>o._def.typeName in n.primitiveMappings&&(!o._def.checks||!o._def.checks.length))){const o=a.reduce((u,c)=>{const l=n.primitiveMappings[c._def.typeName];return l&&!u.includes(l)?[...u,l]:u},[]);return{type:o.length>1?o:o[0]}}else if(a.every(o=>o._def.typeName==="ZodLiteral"&&!o.description)){const o=a.reduce((u,c)=>{const l=typeof c._def.value;switch(l){case"string":case"number":case"boolean":return[...u,l];case"bigint":return[...u,"integer"];case"object":if(c._def.value===null)return[...u,"null"];case"symbol":case"undefined":case"function":default:return u}},[]);if(o.length===a.length){const u=o.filter((c,l,d)=>d.indexOf(c)===l);return{type:u.length>1?u:u[0],enum:a.reduce((c,l)=>c.includes(l._def.value)?c:[...c,l._def.value],[])}}}else if(a.every(o=>o._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((o,u)=>[...o,...u._def.values.filter(c=>!o.includes(c))],[])};return r(s,i)}n.parseUnionDef=t;const r=(s,i)=>{const a=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((o,u)=>(0,e.parseDef)(o._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"anyOf",`${u}`]}))).filter(o=>!!o&&(!i.strictUnions||typeof o=="object"&&Object.keys(o).length>0));return a.length?{anyOf:a}:void 0}}(Fs)),Fs}var ho;function $y(){if(ho)return kr;ho=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.parseNullableDef=void 0;const n=Ce(),e=Ac();function t(r,s){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return s.target==="openApi3"?{type:e.primitiveMappings[r.innerType._def.typeName],nullable:!0}:{type:[e.primitiveMappings[r.innerType._def.typeName],"null"]};if(s.target==="openApi3"){const a=(0,n.parseDef)(r.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath]}));return a&&Object.assign(Object.assign({},a),{nullable:!0})}const i=(0,n.parseDef)(r.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"anyOf","0"]}));return i&&{anyOf:[i,{type:"null"}]}}return kr.parseNullableDef=t,kr}var ss={};Object.defineProperty(ss,"__esModule",{value:!0});ss.parseNumberDef=void 0;const Tt=ot;function My(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",(0,Tt.addErrorMessage)(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?(0,Tt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,Tt.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,Tt.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,Tt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,Tt.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,Tt.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,Tt.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}ss.parseNumberDef=My;var Nt={},fo;function Uy(){if(fo)return Nt;fo=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.parseObjectDef=Nt.parseObjectDefX=void 0;const n=Ce();function e(r,s){var i,a;Object.keys(r.shape()).reduce((u,c)=>{let l=r.shape()[c];const d=l.isOptional();d||(l=Object.assign({},l._def.innerSchema));const h=(0,n.parseDef)(l._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return h!==void 0&&(u.properties[c]=h,d||(u.required||(u.required=[]),u.required.push(c))),u},{type:"object",properties:{},additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});const o=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((u,[c,l])=>{if(l===void 0||l._def===void 0)return u;const d=(0,n.parseDef)(l._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return d===void 0?u:{properties:Object.assign(Object.assign({},u.properties),{[c]:d}),required:l.isOptional()?u.required:[...u.required,c]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(a=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&a!==void 0?a:!0});return o.required.length||delete o.required,o}Nt.parseObjectDefX=e;function t(r,s){var i;const a=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((o,[u,c])=>{if(c===void 0||c._def===void 0)return o;const l=(0,n.parseDef)(c._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",u],propertyPath:[...s.currentPath,"properties",u]}));return l===void 0?o:{properties:Object.assign(Object.assign({},o.properties),{[u]:l}),required:c.isOptional()?o.required:[...o.required,u]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});return a.required.length||delete a.required,a}return Nt.parseObjectDef=t,Nt}var jr={},po;function Fy(){if(po)return jr;po=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.parseOptionalDef=void 0;const n=Ce(),e=(t,r)=>{var s;if(r.currentPath.toString()===((s=r.propertyPath)===null||s===void 0?void 0:s.toString()))return(0,n.parseDef)(t.innerType._def,r);const i=(0,n.parseDef)(t.innerType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"anyOf","1"]}));return i?{anyOf:[{not:{}},i]}:{}};return jr.parseOptionalDef=e,jr}var Cr={},mo;function By(){if(mo)return Cr;mo=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.parsePipelineDef=void 0;const n=Ce(),e=(t,r)=>{if(r.pipeStrategy==="input")return(0,n.parseDef)(t.in._def,r);const s=(0,n.parseDef)(t.in._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","0"]})),i=(0,n.parseDef)(t.out._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf",s?"1":"0"]}));return{allOf:[s,i].filter(a=>a!==void 0)}};return Cr.parsePipelineDef=e,Cr}var Ir={},yo;function Vy(){if(yo)return Ir;yo=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.parsePromiseDef=void 0;const n=Ce();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return Ir.parsePromiseDef=e,Ir}var Rr={},Vi={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseStringDef=n.emojiPattern=n.ulidPattern=n.cuid2Pattern=n.cuidPattern=n.emailPattern=void 0;const e=ot;n.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',n.cuidPattern="^c[^\\s-]{8,}$",n.cuid2Pattern="^[a-z][a-z0-9]*$",n.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",n.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u";function t(a,o){const u={type:"string"};if(a.checks)for(const c of a.checks)switch(c.kind){case"min":(0,e.setResponseValueAndErrors)(u,"minLength",typeof u.minLength=="number"?Math.max(u.minLength,c.value):c.value,c.message,o);break;case"max":(0,e.setResponseValueAndErrors)(u,"maxLength",typeof u.maxLength=="number"?Math.min(u.maxLength,c.value):c.value,c.message,o);break;case"email":switch(o.emailStrategy){case"format:email":s(u,"email",c.message,o);break;case"format:idn-email":s(u,"idn-email",c.message,o);break;case"pattern:zod":i(u,n.emailPattern,c.message,o);break}break;case"url":s(u,"uri",c.message,o);break;case"uuid":s(u,"uuid",c.message,o);break;case"regex":i(u,c.regex.source,c.message,o);break;case"cuid":i(u,n.cuidPattern,c.message,o);break;case"cuid2":i(u,n.cuid2Pattern,c.message,o);break;case"startsWith":i(u,"^"+r(c.value),c.message,o);break;case"endsWith":i(u,r(c.value)+"$",c.message,o);break;case"datetime":s(u,"date-time",c.message,o);break;case"length":(0,e.setResponseValueAndErrors)(u,"minLength",typeof u.minLength=="number"?Math.max(u.minLength,c.value):c.value,c.message,o),(0,e.setResponseValueAndErrors)(u,"maxLength",typeof u.maxLength=="number"?Math.min(u.maxLength,c.value):c.value,c.message,o);break;case"includes":{i(u,r(c.value),c.message,o);break}case"ip":{c.version!=="v6"&&s(u,"ipv4",c.message,o),c.version!=="v4"&&s(u,"ipv6",c.message,o);break}case"emoji":i(u,n.emojiPattern,c.message,o);break;case"ulid":{i(u,n.ulidPattern,c.message,o);break}}return u}n.parseStringDef=t;const r=a=>Array.from(a).map(o=>/[a-zA-Z0-9]/.test(o)?o:`\\${o}`).join(""),s=(a,o,u,c)=>{var l;a.format||!((l=a.anyOf)===null||l===void 0)&&l.some(d=>d.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push(Object.assign({format:a.format},a.errorMessage&&c.errorMessages&&{errorMessage:{format:a.errorMessage.format}})),delete a.format,a.errorMessage&&(delete a.errorMessage.format,Object.keys(a.errorMessage).length===0&&delete a.errorMessage)),a.anyOf.push(Object.assign({format:o},u&&c.errorMessages&&{errorMessage:{format:u}}))):(0,e.setResponseValueAndErrors)(a,"format",o,u,c)},i=(a,o,u,c)=>{var l;a.pattern||!((l=a.allOf)===null||l===void 0)&&l.some(d=>d.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push(Object.assign({pattern:a.pattern},a.errorMessage&&c.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}})),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,Object.keys(a.errorMessage).length===0&&delete a.errorMessage)),a.allOf.push(Object.assign({pattern:o},u&&c.errorMessages&&{errorMessage:{pattern:u}}))):(0,e.setResponseValueAndErrors)(a,"pattern",o,u,c)}})(Vi);var go;function qy(){if(go)return Rr;go=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.parseRecordDef=void 0;const n=Bi,e=Ce(),t=Vi;function r(s,i){var a,o,u,c,l;if(i.target==="openApi3"&&((a=s.keyType)===null||a===void 0?void 0:a._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((h,b)=>{var m;return Object.assign(Object.assign({},h),{[b]:(m=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"properties",b]})))!==null&&m!==void 0?m:{}})},{}),additionalProperties:!1};const d={type:"object",additionalProperties:(o=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"additionalProperties"]})))!==null&&o!==void 0?o:{}};if(i.target==="openApi3")return d;if(((u=s.keyType)===null||u===void 0?void 0:u._def.typeName)===n.ZodFirstPartyTypeKind.ZodString&&(!((c=s.keyType._def.checks)===null||c===void 0)&&c.length)){const h=Object.entries((0,t.parseStringDef)(s.keyType._def,i)).reduce((b,[m,_])=>m==="type"?b:Object.assign(Object.assign({},b),{[m]:_}),{});return Object.assign(Object.assign({},d),{propertyNames:h})}else if(((l=s.keyType)===null||l===void 0?void 0:l._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return Object.assign(Object.assign({},d),{propertyNames:{enum:s.keyType._def.values}});return d}return Rr.parseRecordDef=r,Rr}var Dr={},bo;function zy(){if(bo)return Dr;bo=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.parseSetDef=void 0;const n=ot,e=Ce();function t(r,s){const a={type:"array",uniqueItems:!0,items:(0,e.parseDef)(r.valueType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"items"]}))};return r.minSize&&(0,n.setResponseValueAndErrors)(a,"minItems",r.minSize.value,r.minSize.message,s),r.maxSize&&(0,n.setResponseValueAndErrors)(a,"maxItems",r.maxSize.value,r.maxSize.message,s),a}return Dr.parseSetDef=t,Dr}var Nr={},vo;function Hy(){if(vo)return Nr;vo=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.parseTupleDef=void 0;const n=Ce();function e(t,r){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((s,i)=>(0,n.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((s,i)=>i===void 0?s:[...s,i],[]),additionalItems:(0,n.parseDef)(t.rest._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"additionalItems"]}))}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((s,i)=>(0,n.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((s,i)=>i===void 0?s:[...s,i],[])}}return Nr.parseTupleDef=e,Nr}var is={};Object.defineProperty(is,"__esModule",{value:!0});is.parseUndefinedDef=void 0;function Ky(){return{not:{}}}is.parseUndefinedDef=Ky;var as={};Object.defineProperty(as,"__esModule",{value:!0});as.parseUnknownDef=void 0;function Zy(){return{}}as.parseUnknownDef=Zy;var _o;function Ce(){if(_o)return wr;_o=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.parseDef=void 0;const n=Bi,e=Gn,t=wy(),r=Yn,s=Wn,i=Ay(),a=Ty(),o=Qn,u=Sy(),c=ky(),l=Xn,d=Cy(),h=es,b=Ry(),m=ts,_=rs,y=ns,x=$y(),C=ss,j=Uy(),P=Fy(),D=By(),A=Vy(),I=qy(),g=zy(),w=Vi,p=Hy(),E=is,k=Ac(),J=as;function O(S,U,F=!1){const ie=U.seen.get(S);if(ie&&!F){const Le=R(ie,U);if(Le!==void 0)return Le}const Me={def:S,path:U.currentPath,jsonSchema:void 0};U.seen.set(S,Me);const Pe=H(S,S.typeName,U);return Pe&&Z(S,U,Pe),Me.jsonSchema=Pe,Pe}wr.parseDef=O;const R=(S,U)=>{switch(U.$refStrategy){case"root":return{$ref:S.path.length===0?"":S.path.length===1?`${S.path[0]}/`:S.path.join("/")};case"relative":return{$ref:N(U.currentPath,S.path)};case"none":return S.path.length<U.currentPath.length&&S.path.every((F,ie)=>U.currentPath[ie]===F)?(console.warn(`Recursive reference detected at ${U.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return S.path.length<U.currentPath.length&&S.path.every((F,ie)=>U.currentPath[ie]===F)?(console.warn(`Recursive reference detected at ${U.currentPath.join("/")}! Defaulting to any`),{}):S.jsonSchema}},N=(S,U)=>{let F=0;for(;F<S.length&&F<U.length&&S[F]===U[F];F++);return[(S.length-F).toString(),...U.slice(F)].join("/")},H=(S,U,F)=>{switch(U){case n.ZodFirstPartyTypeKind.ZodString:return(0,w.parseStringDef)(S,F);case n.ZodFirstPartyTypeKind.ZodNumber:return(0,C.parseNumberDef)(S,F);case n.ZodFirstPartyTypeKind.ZodObject:return(0,j.parseObjectDef)(S,F);case n.ZodFirstPartyTypeKind.ZodBigInt:return(0,r.parseBigintDef)(S,F);case n.ZodFirstPartyTypeKind.ZodBoolean:return(0,s.parseBooleanDef)();case n.ZodFirstPartyTypeKind.ZodDate:return(0,o.parseDateDef)(S,F);case n.ZodFirstPartyTypeKind.ZodUndefined:return(0,E.parseUndefinedDef)();case n.ZodFirstPartyTypeKind.ZodNull:return(0,y.parseNullDef)(F);case n.ZodFirstPartyTypeKind.ZodArray:return(0,t.parseArrayDef)(S,F);case n.ZodFirstPartyTypeKind.ZodUnion:case n.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,k.parseUnionDef)(S,F);case n.ZodFirstPartyTypeKind.ZodIntersection:return(0,d.parseIntersectionDef)(S,F);case n.ZodFirstPartyTypeKind.ZodTuple:return(0,p.parseTupleDef)(S,F);case n.ZodFirstPartyTypeKind.ZodRecord:return(0,I.parseRecordDef)(S,F);case n.ZodFirstPartyTypeKind.ZodLiteral:return(0,h.parseLiteralDef)(S,F);case n.ZodFirstPartyTypeKind.ZodEnum:return(0,l.parseEnumDef)(S);case n.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,m.parseNativeEnumDef)(S);case n.ZodFirstPartyTypeKind.ZodNullable:return(0,x.parseNullableDef)(S,F);case n.ZodFirstPartyTypeKind.ZodOptional:return(0,P.parseOptionalDef)(S,F);case n.ZodFirstPartyTypeKind.ZodMap:return(0,b.parseMapDef)(S,F);case n.ZodFirstPartyTypeKind.ZodSet:return(0,g.parseSetDef)(S,F);case n.ZodFirstPartyTypeKind.ZodLazy:return O(S.getter()._def,F);case n.ZodFirstPartyTypeKind.ZodPromise:return(0,A.parsePromiseDef)(S,F);case n.ZodFirstPartyTypeKind.ZodNaN:case n.ZodFirstPartyTypeKind.ZodNever:return(0,_.parseNeverDef)();case n.ZodFirstPartyTypeKind.ZodEffects:return(0,c.parseEffectsDef)(S,F);case n.ZodFirstPartyTypeKind.ZodAny:return(0,e.parseAnyDef)();case n.ZodFirstPartyTypeKind.ZodUnknown:return(0,J.parseUnknownDef)();case n.ZodFirstPartyTypeKind.ZodDefault:return(0,u.parseDefaultDef)(S,F);case n.ZodFirstPartyTypeKind.ZodBranded:return(0,i.parseBrandedDef)(S,F);case n.ZodFirstPartyTypeKind.ZodCatch:return(0,a.parseCatchDef)(S,F);case n.ZodFirstPartyTypeKind.ZodPipeline:return(0,D.parsePipelineDef)(S,F);case n.ZodFirstPartyTypeKind.ZodFunction:case n.ZodFirstPartyTypeKind.ZodVoid:case n.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(ie=>{})()}},Z=(S,U,F)=>(S.description&&(F.description=S.description,U.markdownDescription&&(F.markdownDescription=S.description)),F);return wr}var os={},Tc={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultOptions=n.defaultOptions=void 0,n.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"};const e=t=>typeof t=="string"?Object.assign(Object.assign({},n.defaultOptions),{name:t}):Object.assign(Object.assign({},n.defaultOptions),t);n.getDefaultOptions=e})(Tc);Object.defineProperty(os,"__esModule",{value:!0});os.getRefs=void 0;const Jy=Tc,Gy=n=>{const e=(0,Jy.getDefaultOptions)(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return Object.assign(Object.assign({},e),{currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))})};os.getRefs=Gy;Object.defineProperty(Jn,"__esModule",{value:!0});Jn.zodToJsonSchema=void 0;const wo=Ce(),Yy=os,Wy=(n,e)=>{var t;const r=(0,Yy.getRefs)(e),s=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var d;return Object.assign(Object.assign({},u),{[c]:(d=(0,wo.parseDef)(l._def,Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,c]}),!0))!==null&&d!==void 0?d:{}})},{}):void 0,i=typeof e=="string"?e:e==null?void 0:e.name,a=(t=(0,wo.parseDef)(n._def,i===void 0?r:Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,i]}),!1))!==null&&t!==void 0?t:{},o=i===void 0?s?Object.assign(Object.assign({},a),{[r.definitionPath]:s}):a:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:Object.assign(Object.assign({},s),{[i]:a})};return r.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};Jn.zodToJsonSchema=Wy;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.zodToJsonSchema=void 0;const e=Jn;Object.defineProperty(n,"zodToJsonSchema",{enumerable:!0,get:function(){return e.zodToJsonSchema}}),n.default=e.zodToJsonSchema})(by);/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function Pc(n){return typeof n>"u"||n===null}function Qy(n){return typeof n=="object"&&n!==null}function Xy(n){return Array.isArray(n)?n:Pc(n)?[]:[n]}function eg(n,e){var t,r,s,i;if(e)for(i=Object.keys(e),t=0,r=i.length;t<r;t+=1)s=i[t],n[s]=e[s];return n}function tg(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function rg(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var ng=Pc,sg=Qy,ig=Xy,ag=tg,og=rg,ug=eg,qi={isNothing:ng,isObject:sg,toArray:ig,repeat:ag,isNegativeZero:og,extend:ug};function xc(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function Xr(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=xc(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Xr.prototype=Object.create(Error.prototype);Xr.prototype.constructor=Xr;Xr.prototype.toString=function(e){return this.name+": "+xc(this,e)};var Ft=Xr,cg=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],lg=["scalar","sequence","mapping"];function dg(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function hg(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(cg.indexOf(t)===-1)throw new Ft('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=dg(e.styleAliases||null),lg.indexOf(this.kind)===-1)throw new Ft('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var De=hg;function Oo(n,e){var t=[];return n[e].forEach(function(r){var s=t.length;t.forEach(function(i,a){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(s=a)}),t[s]=r}),t}function fg(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(s){s.multi?(n.multi[s.kind].push(s),n.multi.fallback.push(s)):n[s.kind][s.tag]=n.fallback[s.tag]=s}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function si(n){return this.extend(n)}si.prototype.extend=function(e){var t=[],r=[];if(e instanceof De)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new Ft("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(i){if(!(i instanceof De))throw new Ft("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new Ft("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new Ft("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof De))throw new Ft("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(si.prototype);return s.implicit=(this.implicit||[]).concat(t),s.explicit=(this.explicit||[]).concat(r),s.compiledImplicit=Oo(s,"implicit"),s.compiledExplicit=Oo(s,"explicit"),s.compiledTypeMap=fg(s.compiledImplicit,s.compiledExplicit),s};var pg=si,mg=new De("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),yg=new De("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),gg=new De("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),bg=new pg({explicit:[mg,yg,gg]});function vg(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function _g(){return null}function wg(n){return n===null}var Og=new De("tag:yaml.org,2002:null",{kind:"scalar",resolve:vg,construct:_g,predicate:wg,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Eg(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function Ag(n){return n==="true"||n==="True"||n==="TRUE"}function Tg(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var Pg=new De("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Eg,construct:Ag,predicate:Tg,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function xg(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function Sg(n){return 48<=n&&n<=55}function kg(n){return 48<=n&&n<=57}function jg(n){if(n===null)return!1;var e=n.length,t=0,r=!1,s;if(!e)return!1;if(s=n[t],(s==="-"||s==="+")&&(s=n[++t]),s==="0"){if(t+1===e)return!0;if(s=n[++t],s==="b"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(s!=="0"&&s!=="1")return!1;r=!0}return r&&s!=="_"}if(s==="x"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(!xg(n.charCodeAt(t)))return!1;r=!0}return r&&s!=="_"}if(s==="o"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(!Sg(n.charCodeAt(t)))return!1;r=!0}return r&&s!=="_"}}if(s==="_")return!1;for(;t<e;t++)if(s=n[t],s!=="_"){if(!kg(n.charCodeAt(t)))return!1;r=!0}return!(!r||s==="_")}function Cg(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function Ig(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!qi.isNegativeZero(n)}var Rg=new De("tag:yaml.org,2002:int",{kind:"scalar",resolve:jg,construct:Cg,predicate:Ig,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Dg=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Ng(n){return!(n===null||!Dg.test(n)||n[n.length-1]==="_")}function Lg(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var $g=/^[-+]?[0-9]+e/;function Mg(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(qi.isNegativeZero(n))return"-0.0";return t=n.toString(10),$g.test(t)?t.replace("e",".e"):t}function Ug(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||qi.isNegativeZero(n))}var Fg=new De("tag:yaml.org,2002:float",{kind:"scalar",resolve:Ng,construct:Lg,predicate:Ug,represent:Mg,defaultStyle:"lowercase"}),Bg=bg.extend({implicit:[Og,Pg,Rg,Fg]}),Vg=Bg,Sc=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),kc=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function qg(n){return n===null?!1:Sc.exec(n)!==null||kc.exec(n)!==null}function zg(n){var e,t,r,s,i,a,o,u=0,c=null,l,d,h;if(e=Sc.exec(n),e===null&&(e=kc.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,s=+e[3],!e[4])return new Date(Date.UTC(t,r,s));if(i=+e[4],a=+e[5],o=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(l=+e[10],d=+(e[11]||0),c=(l*60+d)*6e4,e[9]==="-"&&(c=-c)),h=new Date(Date.UTC(t,r,s,i,a,o,u)),c&&h.setTime(h.getTime()-c),h}function Hg(n){return n.toISOString()}var Kg=new De("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:qg,construct:zg,instanceOf:Date,represent:Hg});function Zg(n){return n==="<<"||n===null}var Jg=new De("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Zg}),zi=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Gg(n){if(n===null)return!1;var e,t,r=0,s=n.length,i=zi;for(t=0;t<s;t++)if(e=i.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function Yg(n){var e,t,r=n.replace(/[\r\n=]/g,""),s=r.length,i=zi,a=0,o=[];for(e=0;e<s;e++)e%4===0&&e&&(o.push(a>>16&255),o.push(a>>8&255),o.push(a&255)),a=a<<6|i.indexOf(r.charAt(e));return t=s%4*6,t===0?(o.push(a>>16&255),o.push(a>>8&255),o.push(a&255)):t===18?(o.push(a>>10&255),o.push(a>>2&255)):t===12&&o.push(a>>4&255),new Uint8Array(o)}function Wg(n){var e="",t=0,r,s,i=n.length,a=zi;for(r=0;r<i;r++)r%3===0&&r&&(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]),t=(t<<8)+n[r];return s=i%3,s===0?(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]):s===2?(e+=a[t>>10&63],e+=a[t>>4&63],e+=a[t<<2&63],e+=a[64]):s===1&&(e+=a[t>>2&63],e+=a[t<<4&63],e+=a[64],e+=a[64]),e}function Qg(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var Xg=new De("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Gg,construct:Yg,predicate:Qg,represent:Wg}),eb=Object.prototype.hasOwnProperty,tb=Object.prototype.toString;function rb(n){if(n===null)return!0;var e=[],t,r,s,i,a,o=n;for(t=0,r=o.length;t<r;t+=1){if(s=o[t],a=!1,tb.call(s)!=="[object Object]")return!1;for(i in s)if(eb.call(s,i))if(!a)a=!0;else return!1;if(!a)return!1;if(e.indexOf(i)===-1)e.push(i);else return!1}return!0}function nb(n){return n!==null?n:[]}var sb=new De("tag:yaml.org,2002:omap",{kind:"sequence",resolve:rb,construct:nb}),ib=Object.prototype.toString;function ab(n){if(n===null)return!0;var e,t,r,s,i,a=n;for(i=new Array(a.length),e=0,t=a.length;e<t;e+=1){if(r=a[e],ib.call(r)!=="[object Object]"||(s=Object.keys(r),s.length!==1))return!1;i[e]=[s[0],r[s[0]]]}return!0}function ob(n){if(n===null)return[];var e,t,r,s,i,a=n;for(i=new Array(a.length),e=0,t=a.length;e<t;e+=1)r=a[e],s=Object.keys(r),i[e]=[s[0],r[s[0]]];return i}var ub=new De("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:ab,construct:ob}),cb=Object.prototype.hasOwnProperty;function lb(n){if(n===null)return!0;var e,t=n;for(e in t)if(cb.call(t,e)&&t[e]!==null)return!1;return!0}function db(n){return n!==null?n:{}}var hb=new De("tag:yaml.org,2002:set",{kind:"mapping",resolve:lb,construct:db});Vg.extend({implicit:[Kg,Jg],explicit:[Xg,sb,ub,hb]});function Eo(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}var fb=new Array(256),pb=new Array(256);for(var Wt=0;Wt<256;Wt++)fb[Wt]=Eo(Wt)?1:0,pb[Wt]=Eo(Wt);function vn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jc={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(r,s,i){function a(c,l){if(!s[c]){if(!r[c]){var d=typeof vn=="function"&&vn;if(!l&&d)return d(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+c+"'")}l=s[c]={exports:{}},r[c][0].call(l.exports,function(h){var b=r[c][1][h];return a(b||h)},l,l.exports,t,r,s,i)}return s[c].exports}for(var o=typeof vn=="function"&&vn,u=0;u<i.length;u++)a(i[u]);return a}({1:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){var m=t("crypto");function _(A,I){I=C(A,I);var g;return(g=I.algorithm!=="passthrough"?m.createHash(I.algorithm):new D).write===void 0&&(g.write=g.update,g.end=g.update),P(I,g).dispatch(A),g.update||g.end(""),g.digest?g.digest(I.encoding==="buffer"?void 0:I.encoding):(A=g.read(),I.encoding!=="buffer"?A.toString(I.encoding):A)}(s=r.exports=_).sha1=function(A){return _(A)},s.keys=function(A){return _(A,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},s.MD5=function(A){return _(A,{algorithm:"md5",encoding:"hex"})},s.keysMD5=function(A){return _(A,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var y=m.getHashes?m.getHashes().slice():["sha1","md5"],x=(y.push("passthrough"),["buffer","hex","binary","base64"]);function C(A,I){var g={};if(g.algorithm=(I=I||{}).algorithm||"sha1",g.encoding=I.encoding||"hex",g.excludeValues=!!I.excludeValues,g.algorithm=g.algorithm.toLowerCase(),g.encoding=g.encoding.toLowerCase(),g.ignoreUnknown=I.ignoreUnknown===!0,g.respectType=I.respectType!==!1,g.respectFunctionNames=I.respectFunctionNames!==!1,g.respectFunctionProperties=I.respectFunctionProperties!==!1,g.unorderedArrays=I.unorderedArrays===!0,g.unorderedSets=I.unorderedSets!==!1,g.unorderedObjects=I.unorderedObjects!==!1,g.replacer=I.replacer||void 0,g.excludeKeys=I.excludeKeys||void 0,A===void 0)throw new Error("Object argument required.");for(var w=0;w<y.length;++w)y[w].toLowerCase()===g.algorithm.toLowerCase()&&(g.algorithm=y[w]);if(y.indexOf(g.algorithm)===-1)throw new Error('Algorithm "'+g.algorithm+'"  not supported. supported values: '+y.join(", "));if(x.indexOf(g.encoding)===-1&&g.algorithm!=="passthrough")throw new Error('Encoding "'+g.encoding+'"  not supported. supported values: '+x.join(", "));return g}function j(A){if(typeof A=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(A))!=null}function P(A,I,g){g=g||[];function w(p){return I.update?I.update(p,"utf8"):I.write(p,"utf8")}return{dispatch:function(p){return this["_"+((p=A.replacer?A.replacer(p):p)===null?"null":typeof p)](p)},_object:function(p){var E,k=Object.prototype.toString.call(p),J=/\[object (.*)\]/i.exec(k);if(J=(J=J?J[1]:"unknown:["+k+"]").toLowerCase(),0<=(k=g.indexOf(p)))return this.dispatch("[CIRCULAR:"+k+"]");if(g.push(p),o!==void 0&&o.isBuffer&&o.isBuffer(p))return w("buffer:"),w(p);if(J==="object"||J==="function"||J==="asyncfunction")return k=Object.keys(p),A.unorderedObjects&&(k=k.sort()),A.respectType===!1||j(p)||k.splice(0,0,"prototype","__proto__","constructor"),A.excludeKeys&&(k=k.filter(function(O){return!A.excludeKeys(O)})),w("object:"+k.length+":"),E=this,k.forEach(function(O){E.dispatch(O),w(":"),A.excludeValues||E.dispatch(p[O]),w(",")});if(!this["_"+J]){if(A.ignoreUnknown)return w("["+J+"]");throw new Error('Unknown object type "'+J+'"')}this["_"+J](p)},_array:function(p,O){O=O!==void 0?O:A.unorderedArrays!==!1;var k=this;if(w("array:"+p.length+":"),!O||p.length<=1)return p.forEach(function(R){return k.dispatch(R)});var J=[],O=p.map(function(R){var N=new D,H=g.slice();return P(A,N,H).dispatch(R),J=J.concat(H.slice(g.length)),N.read().toString()});return g=g.concat(J),O.sort(),this._array(O,!1)},_date:function(p){return w("date:"+p.toJSON())},_symbol:function(p){return w("symbol:"+p.toString())},_error:function(p){return w("error:"+p.toString())},_boolean:function(p){return w("bool:"+p.toString())},_string:function(p){w("string:"+p.length+":"),w(p.toString())},_function:function(p){w("fn:"),j(p)?this.dispatch("[native]"):this.dispatch(p.toString()),A.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(p.name)),A.respectFunctionProperties&&this._object(p)},_number:function(p){return w("number:"+p.toString())},_xml:function(p){return w("xml:"+p.toString())},_null:function(){return w("Null")},_undefined:function(){return w("Undefined")},_regexp:function(p){return w("regex:"+p.toString())},_uint8array:function(p){return w("uint8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint8clampedarray:function(p){return w("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(p))},_int8array:function(p){return w("int8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint16array:function(p){return w("uint16array:"),this.dispatch(Array.prototype.slice.call(p))},_int16array:function(p){return w("int16array:"),this.dispatch(Array.prototype.slice.call(p))},_uint32array:function(p){return w("uint32array:"),this.dispatch(Array.prototype.slice.call(p))},_int32array:function(p){return w("int32array:"),this.dispatch(Array.prototype.slice.call(p))},_float32array:function(p){return w("float32array:"),this.dispatch(Array.prototype.slice.call(p))},_float64array:function(p){return w("float64array:"),this.dispatch(Array.prototype.slice.call(p))},_arraybuffer:function(p){return w("arraybuffer:"),this.dispatch(new Uint8Array(p))},_url:function(p){return w("url:"+p.toString())},_map:function(p){return w("map:"),p=Array.from(p),this._array(p,A.unorderedSets!==!1)},_set:function(p){return w("set:"),p=Array.from(p),this._array(p,A.unorderedSets!==!1)},_file:function(p){return w("file:"),this.dispatch([p.name,p.size,p.type,p.lastModfied])},_blob:function(){if(A.ignoreUnknown)return w("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return w("domwindow")},_bigint:function(p){return w("bigint:"+p.toString())},_process:function(){return w("process")},_timer:function(){return w("timer")},_pipe:function(){return w("pipe")},_tcp:function(){return w("tcp")},_udp:function(){return w("udp")},_tty:function(){return w("tty")},_statwatcher:function(){return w("statwatcher")},_securecontext:function(){return w("securecontext")},_connection:function(){return w("connection")},_zlib:function(){return w("zlib")},_context:function(){return w("context")},_nodescript:function(){return w("nodescript")},_httpparser:function(){return w("httpparser")},_dataview:function(){return w("dataview")},_signal:function(){return w("signal")},_fsevent:function(){return w("fsevent")},_tlswrap:function(){return w("tlswrap")}}}function D(){return{buf:"",write:function(A){this.buf+=A},end:function(A){this.buf+=A},read:function(){return this.buf}}}s.writeToStream=function(A,I,g){return g===void 0&&(g=I,I={}),P(I=C(A,I),g).dispatch(A)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){(function(m){var _=typeof Uint8Array<"u"?Uint8Array:Array,y="+".charCodeAt(0),x="/".charCodeAt(0),C="0".charCodeAt(0),j="a".charCodeAt(0),P="A".charCodeAt(0),D="-".charCodeAt(0),A="_".charCodeAt(0);function I(g){return g=g.charCodeAt(0),g===y||g===D?62:g===x||g===A?63:g<C?-1:g<C+10?g-C+26+26:g<P+26?g-P:g<j+26?g-j+26:void 0}m.toByteArray=function(g){var w,p;if(0<g.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var E=g.length,E=g.charAt(E-2)==="="?2:g.charAt(E-1)==="="?1:0,k=new _(3*g.length/4-E),J=0<E?g.length-4:g.length,O=0;function R(N){k[O++]=N}for(w=0;w<J;w+=4,0)R((16711680&(p=I(g.charAt(w))<<18|I(g.charAt(w+1))<<12|I(g.charAt(w+2))<<6|I(g.charAt(w+3))))>>16),R((65280&p)>>8),R(255&p);return E==2?R(255&(p=I(g.charAt(w))<<2|I(g.charAt(w+1))>>4)):E==1&&(R((p=I(g.charAt(w))<<10|I(g.charAt(w+1))<<4|I(g.charAt(w+2))>>2)>>8&255),R(255&p)),k},m.fromByteArray=function(g){var w,p,E,k,J=g.length%3,O="";function R(N){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(N)}for(w=0,E=g.length-J;w<E;w+=3)p=(g[w]<<16)+(g[w+1]<<8)+g[w+2],O+=R((k=p)>>18&63)+R(k>>12&63)+R(k>>6&63)+R(63&k);switch(J){case 1:O=(O+=R((p=g[g.length-1])>>2))+R(p<<4&63)+"==";break;case 2:O=(O=(O+=R((p=(g[g.length-2]<<8)+g[g.length-1])>>10))+R(p>>4&63))+R(p<<2&63)+"="}return O}})(s===void 0?this.base64js={}:s)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,r,s){(function(i,a,y,u,c,l,d,h,b){var m=t("base64-js"),_=t("ieee754");function y(f,v,T){if(!(this instanceof y))return new y(f,v,T);var $,L,V,ae,ye=typeof f;if(v==="base64"&&ye=="string")for(f=(ae=f).trim?ae.trim():ae.replace(/^\s+|\s+$/g,"");f.length%4!=0;)f+="=";if(ye=="number")$=Z(f);else if(ye=="string")$=y.byteLength(f,v);else{if(ye!="object")throw new Error("First argument needs to be a number, array or string.");$=Z(f.length)}if(y._useTypedArrays?L=y._augment(new Uint8Array($)):((L=this).length=$,L._isBuffer=!0),y._useTypedArrays&&typeof f.byteLength=="number")L._set(f);else if(S(ae=f)||y.isBuffer(ae)||ae&&typeof ae=="object"&&typeof ae.length=="number")for(V=0;V<$;V++)y.isBuffer(f)?L[V]=f.readUInt8(V):L[V]=f[V];else if(ye=="string")L.write(f,0,v);else if(ye=="number"&&!y._useTypedArrays&&!T)for(V=0;V<$;V++)L[V]=0;return L}function x(f,v,T,$){return y._charsWritten=Me(function(L){for(var V=[],ae=0;ae<L.length;ae++)V.push(255&L.charCodeAt(ae));return V}(v),f,T,$)}function C(f,v,T,$){return y._charsWritten=Me(function(L){for(var V,ae,ye=[],Ee=0;Ee<L.length;Ee++)ae=L.charCodeAt(Ee),V=ae>>8,ae=ae%256,ye.push(ae),ye.push(V);return ye}(v),f,T,$)}function j(f,v,T){var $="";T=Math.min(f.length,T);for(var L=v;L<T;L++)$+=String.fromCharCode(f[L]);return $}function P(f,v,T,V){V||(B(typeof T=="boolean","missing or invalid endian"),B(v!=null,"missing offset"),B(v+1<f.length,"Trying to read beyond buffer length"));var L,V=f.length;if(!(V<=v))return T?(L=f[v],v+1<V&&(L|=f[v+1]<<8)):(L=f[v]<<8,v+1<V&&(L|=f[v+1])),L}function D(f,v,T,V){V||(B(typeof T=="boolean","missing or invalid endian"),B(v!=null,"missing offset"),B(v+3<f.length,"Trying to read beyond buffer length"));var L,V=f.length;if(!(V<=v))return T?(v+2<V&&(L=f[v+2]<<16),v+1<V&&(L|=f[v+1]<<8),L|=f[v],v+3<V&&(L+=f[v+3]<<24>>>0)):(v+1<V&&(L=f[v+1]<<16),v+2<V&&(L|=f[v+2]<<8),v+3<V&&(L|=f[v+3]),L+=f[v]<<24>>>0),L}function A(f,v,T,$){if($||(B(typeof T=="boolean","missing or invalid endian"),B(v!=null,"missing offset"),B(v+1<f.length,"Trying to read beyond buffer length")),!(f.length<=v))return $=P(f,v,T,!0),32768&$?-1*(65535-$+1):$}function I(f,v,T,$){if($||(B(typeof T=="boolean","missing or invalid endian"),B(v!=null,"missing offset"),B(v+3<f.length,"Trying to read beyond buffer length")),!(f.length<=v))return $=D(f,v,T,!0),2147483648&$?-1*(4294967295-$+1):$}function g(f,v,T,$){return $||(B(typeof T=="boolean","missing or invalid endian"),B(v+3<f.length,"Trying to read beyond buffer length")),_.read(f,v,T,23,4)}function w(f,v,T,$){return $||(B(typeof T=="boolean","missing or invalid endian"),B(v+7<f.length,"Trying to read beyond buffer length")),_.read(f,v,T,52,8)}function p(f,v,T,$,L){if(L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+1<f.length,"trying to write beyond buffer length"),Le(v,65535)),L=f.length,!(L<=T))for(var V=0,ae=Math.min(L-T,2);V<ae;V++)f[T+V]=(v&255<<8*($?V:1-V))>>>8*($?V:1-V)}function E(f,v,T,$,L){if(L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+3<f.length,"trying to write beyond buffer length"),Le(v,4294967295)),L=f.length,!(L<=T))for(var V=0,ae=Math.min(L-T,4);V<ae;V++)f[T+V]=v>>>8*($?V:3-V)&255}function k(f,v,T,$,L){L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+1<f.length,"Trying to write beyond buffer length"),pe(v,32767,-32768)),f.length<=T||p(f,0<=v?v:65535+v+1,T,$,L)}function J(f,v,T,$,L){L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+3<f.length,"Trying to write beyond buffer length"),pe(v,2147483647,-2147483648)),f.length<=T||E(f,0<=v?v:4294967295+v+1,T,$,L)}function O(f,v,T,$,L){L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+3<f.length,"Trying to write beyond buffer length"),ve(v,34028234663852886e22,-34028234663852886e22)),f.length<=T||_.write(f,v,T,$,23,4)}function R(f,v,T,$,L){L||(B(v!=null,"missing value"),B(typeof $=="boolean","missing or invalid endian"),B(T!=null,"missing offset"),B(T+7<f.length,"Trying to write beyond buffer length"),ve(v,17976931348623157e292,-17976931348623157e292)),f.length<=T||_.write(f,v,T,$,52,8)}s.Buffer=y,s.SlowBuffer=y,s.INSPECT_MAX_BYTES=50,y.poolSize=8192,y._useTypedArrays=function(){try{var f=new ArrayBuffer(0),v=new Uint8Array(f);return v.foo=function(){return 42},v.foo()===42&&typeof v.subarray=="function"}catch{return!1}}(),y.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.isBuffer=function(f){return!(f==null||!f._isBuffer)},y.byteLength=function(f,v){var T;switch(f+="",v||"utf8"){case"hex":T=f.length/2;break;case"utf8":case"utf-8":T=F(f).length;break;case"ascii":case"binary":case"raw":T=f.length;break;case"base64":T=ie(f).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":T=2*f.length;break;default:throw new Error("Unknown encoding")}return T},y.concat=function(f,v){if(B(S(f),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),f.length===0)return new y(0);if(f.length===1)return f[0];if(typeof v!="number")for(L=v=0;L<f.length;L++)v+=f[L].length;for(var T=new y(v),$=0,L=0;L<f.length;L++){var V=f[L];V.copy(T,$),$+=V.length}return T},y.prototype.write=function(f,v,T,$){isFinite(v)?isFinite(T)||($=T,T=void 0):(Ee=$,$=v,v=T,T=Ee),v=Number(v)||0;var L,V,ae,ye,Ee=this.length-v;switch((!T||Ee<(T=Number(T)))&&(T=Ee),$=String($||"utf8").toLowerCase()){case"hex":L=function(tt,Ue,Fe,Ae){Fe=Number(Fe)||0;var we=tt.length-Fe;(!Ae||we<(Ae=Number(Ae)))&&(Ae=we),B((we=Ue.length)%2==0,"Invalid hex string"),we/2<Ae&&(Ae=we/2);for(var zt=0;zt<Ae;zt++){var Zi=parseInt(Ue.substr(2*zt,2),16);B(!isNaN(Zi),"Invalid hex string"),tt[Fe+zt]=Zi}return y._charsWritten=2*zt,zt}(this,f,v,T);break;case"utf8":case"utf-8":V=this,ae=v,ye=T,L=y._charsWritten=Me(F(f),V,ae,ye);break;case"ascii":case"binary":L=x(this,f,v,T);break;case"base64":V=this,ae=v,ye=T,L=y._charsWritten=Me(ie(f),V,ae,ye);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":L=C(this,f,v,T);break;default:throw new Error("Unknown encoding")}return L},y.prototype.toString=function(f,v,T){var $,L,V,ae,ye=this;if(f=String(f||"utf8").toLowerCase(),v=Number(v)||0,(T=T!==void 0?Number(T):ye.length)===v)return"";switch(f){case"hex":$=function(Ee,tt,Ue){var Fe=Ee.length;(!tt||tt<0)&&(tt=0),(!Ue||Ue<0||Fe<Ue)&&(Ue=Fe);for(var Ae="",we=tt;we<Ue;we++)Ae+=U(Ee[we]);return Ae}(ye,v,T);break;case"utf8":case"utf-8":$=function(Ee,tt,Ue){var Fe="",Ae="";Ue=Math.min(Ee.length,Ue);for(var we=tt;we<Ue;we++)Ee[we]<=127?(Fe+=Pe(Ae)+String.fromCharCode(Ee[we]),Ae=""):Ae+="%"+Ee[we].toString(16);return Fe+Pe(Ae)}(ye,v,T);break;case"ascii":case"binary":$=j(ye,v,T);break;case"base64":L=ye,ae=T,$=(V=v)===0&&ae===L.length?m.fromByteArray(L):m.fromByteArray(L.slice(V,ae));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":$=function(Ee,tt,Ue){for(var Fe=Ee.slice(tt,Ue),Ae="",we=0;we<Fe.length;we+=2)Ae+=String.fromCharCode(Fe[we]+256*Fe[we+1]);return Ae}(ye,v,T);break;default:throw new Error("Unknown encoding")}return $},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},y.prototype.copy=function(f,v,T,$){if(v=v||0,($=$||$===0?$:this.length)!==(T=T||0)&&f.length!==0&&this.length!==0){B(T<=$,"sourceEnd < sourceStart"),B(0<=v&&v<f.length,"targetStart out of bounds"),B(0<=T&&T<this.length,"sourceStart out of bounds"),B(0<=$&&$<=this.length,"sourceEnd out of bounds"),$>this.length&&($=this.length);var L=($=f.length-v<$-T?f.length-v+T:$)-T;if(L<100||!y._useTypedArrays)for(var V=0;V<L;V++)f[V+v]=this[V+T];else f._set(this.subarray(T,T+L),v)}},y.prototype.slice=function(f,v){var T=this.length;if(f=H(f,T,0),v=H(v,T,T),y._useTypedArrays)return y._augment(this.subarray(f,v));for(var $=v-f,L=new y($,void 0,!0),V=0;V<$;V++)L[V]=this[V+f];return L},y.prototype.get=function(f){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(f)},y.prototype.set=function(f,v){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(f,v)},y.prototype.readUInt8=function(f,v){if(v||(B(f!=null,"missing offset"),B(f<this.length,"Trying to read beyond buffer length")),!(f>=this.length))return this[f]},y.prototype.readUInt16LE=function(f,v){return P(this,f,!0,v)},y.prototype.readUInt16BE=function(f,v){return P(this,f,!1,v)},y.prototype.readUInt32LE=function(f,v){return D(this,f,!0,v)},y.prototype.readUInt32BE=function(f,v){return D(this,f,!1,v)},y.prototype.readInt8=function(f,v){if(v||(B(f!=null,"missing offset"),B(f<this.length,"Trying to read beyond buffer length")),!(f>=this.length))return 128&this[f]?-1*(255-this[f]+1):this[f]},y.prototype.readInt16LE=function(f,v){return A(this,f,!0,v)},y.prototype.readInt16BE=function(f,v){return A(this,f,!1,v)},y.prototype.readInt32LE=function(f,v){return I(this,f,!0,v)},y.prototype.readInt32BE=function(f,v){return I(this,f,!1,v)},y.prototype.readFloatLE=function(f,v){return g(this,f,!0,v)},y.prototype.readFloatBE=function(f,v){return g(this,f,!1,v)},y.prototype.readDoubleLE=function(f,v){return w(this,f,!0,v)},y.prototype.readDoubleBE=function(f,v){return w(this,f,!1,v)},y.prototype.writeUInt8=function(f,v,T){T||(B(f!=null,"missing value"),B(v!=null,"missing offset"),B(v<this.length,"trying to write beyond buffer length"),Le(f,255)),v>=this.length||(this[v]=f)},y.prototype.writeUInt16LE=function(f,v,T){p(this,f,v,!0,T)},y.prototype.writeUInt16BE=function(f,v,T){p(this,f,v,!1,T)},y.prototype.writeUInt32LE=function(f,v,T){E(this,f,v,!0,T)},y.prototype.writeUInt32BE=function(f,v,T){E(this,f,v,!1,T)},y.prototype.writeInt8=function(f,v,T){T||(B(f!=null,"missing value"),B(v!=null,"missing offset"),B(v<this.length,"Trying to write beyond buffer length"),pe(f,127,-128)),v>=this.length||(0<=f?this.writeUInt8(f,v,T):this.writeUInt8(255+f+1,v,T))},y.prototype.writeInt16LE=function(f,v,T){k(this,f,v,!0,T)},y.prototype.writeInt16BE=function(f,v,T){k(this,f,v,!1,T)},y.prototype.writeInt32LE=function(f,v,T){J(this,f,v,!0,T)},y.prototype.writeInt32BE=function(f,v,T){J(this,f,v,!1,T)},y.prototype.writeFloatLE=function(f,v,T){O(this,f,v,!0,T)},y.prototype.writeFloatBE=function(f,v,T){O(this,f,v,!1,T)},y.prototype.writeDoubleLE=function(f,v,T){R(this,f,v,!0,T)},y.prototype.writeDoubleBE=function(f,v,T){R(this,f,v,!1,T)},y.prototype.fill=function(f,v,T){if(v=v||0,T=T||this.length,B(typeof(f=typeof(f=f||0)=="string"?f.charCodeAt(0):f)=="number"&&!isNaN(f),"value is not a number"),B(v<=T,"end < start"),T!==v&&this.length!==0){B(0<=v&&v<this.length,"start out of bounds"),B(0<=T&&T<=this.length,"end out of bounds");for(var $=v;$<T;$++)this[$]=f}},y.prototype.inspect=function(){for(var f=[],v=this.length,T=0;T<v;T++)if(f[T]=U(this[T]),T===s.INSPECT_MAX_BYTES){f[T+1]="...";break}return"<Buffer "+f.join(" ")+">"},y.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(y._useTypedArrays)return new y(this).buffer;for(var f=new Uint8Array(this.length),v=0,T=f.length;v<T;v+=1)f[v]=this[v];return f.buffer};var N=y.prototype;function H(f,v,T){return typeof f!="number"?T:v<=(f=~~f)?v:0<=f||0<=(f+=v)?f:0}function Z(f){return(f=~~Math.ceil(+f))<0?0:f}function S(f){return(Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"})(f)}function U(f){return f<16?"0"+f.toString(16):f.toString(16)}function F(f){for(var v=[],T=0;T<f.length;T++){var $=f.charCodeAt(T);if($<=127)v.push(f.charCodeAt(T));else for(var L=T,V=(55296<=$&&$<=57343&&T++,encodeURIComponent(f.slice(L,T+1)).substr(1).split("%")),ae=0;ae<V.length;ae++)v.push(parseInt(V[ae],16))}return v}function ie(f){return m.toByteArray(f)}function Me(f,v,T,$){for(var L=0;L<$&&!(L+T>=v.length||L>=f.length);L++)v[L+T]=f[L];return L}function Pe(f){try{return decodeURIComponent(f)}catch{return String.fromCharCode(65533)}}function Le(f,v){B(typeof f=="number","cannot write a non-number as a number"),B(0<=f,"specified a negative value for writing an unsigned value"),B(f<=v,"value is larger than maximum value for type"),B(Math.floor(f)===f,"value has a fractional component")}function pe(f,v,T){B(typeof f=="number","cannot write a non-number as a number"),B(f<=v,"value larger than maximum allowed value"),B(T<=f,"value smaller than minimum allowed value"),B(Math.floor(f)===f,"value has a fractional component")}function ve(f,v,T){B(typeof f=="number","cannot write a non-number as a number"),B(f<=v,"value larger than maximum allowed value"),B(T<=f,"value smaller than minimum allowed value")}function B(f,v){if(!f)throw new Error(v||"Failed assertion")}y._augment=function(f){return f._isBuffer=!0,f._get=f.get,f._set=f.set,f.get=N.get,f.set=N.set,f.write=N.write,f.toString=N.toString,f.toLocaleString=N.toString,f.toJSON=N.toJSON,f.copy=N.copy,f.slice=N.slice,f.readUInt8=N.readUInt8,f.readUInt16LE=N.readUInt16LE,f.readUInt16BE=N.readUInt16BE,f.readUInt32LE=N.readUInt32LE,f.readUInt32BE=N.readUInt32BE,f.readInt8=N.readInt8,f.readInt16LE=N.readInt16LE,f.readInt16BE=N.readInt16BE,f.readInt32LE=N.readInt32LE,f.readInt32BE=N.readInt32BE,f.readFloatLE=N.readFloatLE,f.readFloatBE=N.readFloatBE,f.readDoubleLE=N.readDoubleLE,f.readDoubleBE=N.readDoubleBE,f.writeUInt8=N.writeUInt8,f.writeUInt16LE=N.writeUInt16LE,f.writeUInt16BE=N.writeUInt16BE,f.writeUInt32LE=N.writeUInt32LE,f.writeUInt32BE=N.writeUInt32BE,f.writeInt8=N.writeInt8,f.writeInt16LE=N.writeInt16LE,f.writeInt16BE=N.writeInt16BE,f.writeInt32LE=N.writeInt32LE,f.writeInt32BE=N.writeInt32BE,f.writeFloatLE=N.writeFloatLE,f.writeFloatBE=N.writeFloatBE,f.writeDoubleLE=N.writeDoubleLE,f.writeDoubleBE=N.writeDoubleBE,f.fill=N.fill,f.inspect=N.inspect,f.toArrayBuffer=N.toArrayBuffer,f}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,r,s){(function(i,a,m,u,c,l,d,h,b){var m=t("buffer").Buffer,_=4,y=new m(_);y.fill(0),r.exports={hash:function(x,C,j,P){for(var D=C(function(p,E){p.length%_!=0&&(k=p.length+(_-p.length%_),p=m.concat([p,y],k));for(var k,J=[],O=E?p.readInt32BE:p.readInt32LE,R=0;R<p.length;R+=_)J.push(O.call(p,R));return J}(x=m.isBuffer(x)?x:new m(x),P),8*x.length),C=P,A=new m(j),I=C?A.writeInt32BE:A.writeInt32LE,g=0;g<D.length;g++)I.call(A,D[g],4*g,!0);return A}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,r,s){(function(i,a,m,u,c,l,d,h,b){var m=t("buffer").Buffer,_=t("./sha"),y=t("./sha256"),x=t("./rng"),C={sha1:_,sha256:y,md5:t("./md5")},j=64,P=new m(j);function D(p,E){var k=C[p=p||"sha1"],J=[];return k||A("algorithm:",p,"is not yet supported"),{update:function(O){return m.isBuffer(O)||(O=new m(O)),J.push(O),O.length,this},digest:function(O){var R=m.concat(J),R=E?function(N,H,Z){m.isBuffer(H)||(H=new m(H)),m.isBuffer(Z)||(Z=new m(Z)),H.length>j?H=N(H):H.length<j&&(H=m.concat([H,P],j));for(var S=new m(j),U=new m(j),F=0;F<j;F++)S[F]=54^H[F],U[F]=92^H[F];return Z=N(m.concat([S,Z])),N(m.concat([U,Z]))}(k,E,R):k(R);return J=null,O?R.toString(O):R}}}function A(){var p=[].slice.call(arguments).join(" ");throw new Error([p,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}P.fill(0),s.createHash=function(p){return D(p)},s.createHmac=D,s.randomBytes=function(p,E){if(!E||!E.call)return new m(x(p));try{E.call(this,void 0,new m(x(p)))}catch(k){E(k)}};var I,g=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],w=function(p){s[p]=function(){A("sorry,",p,"is not implemented yet")}};for(I in g)w(g[I])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){var m=t("./helpers");function _(A,I){A[I>>5]|=128<<I%32,A[14+(I+64>>>9<<4)]=I;for(var g=1732584193,w=-271733879,p=-1732584194,E=271733878,k=0;k<A.length;k+=16){var J=g,O=w,R=p,N=E,g=x(g,w,p,E,A[k+0],7,-680876936),E=x(E,g,w,p,A[k+1],12,-389564586),p=x(p,E,g,w,A[k+2],17,606105819),w=x(w,p,E,g,A[k+3],22,-1044525330);g=x(g,w,p,E,A[k+4],7,-176418897),E=x(E,g,w,p,A[k+5],12,1200080426),p=x(p,E,g,w,A[k+6],17,-1473231341),w=x(w,p,E,g,A[k+7],22,-45705983),g=x(g,w,p,E,A[k+8],7,1770035416),E=x(E,g,w,p,A[k+9],12,-1958414417),p=x(p,E,g,w,A[k+10],17,-42063),w=x(w,p,E,g,A[k+11],22,-1990404162),g=x(g,w,p,E,A[k+12],7,1804603682),E=x(E,g,w,p,A[k+13],12,-40341101),p=x(p,E,g,w,A[k+14],17,-1502002290),g=C(g,w=x(w,p,E,g,A[k+15],22,1236535329),p,E,A[k+1],5,-165796510),E=C(E,g,w,p,A[k+6],9,-1069501632),p=C(p,E,g,w,A[k+11],14,643717713),w=C(w,p,E,g,A[k+0],20,-373897302),g=C(g,w,p,E,A[k+5],5,-701558691),E=C(E,g,w,p,A[k+10],9,38016083),p=C(p,E,g,w,A[k+15],14,-660478335),w=C(w,p,E,g,A[k+4],20,-405537848),g=C(g,w,p,E,A[k+9],5,568446438),E=C(E,g,w,p,A[k+14],9,-1019803690),p=C(p,E,g,w,A[k+3],14,-187363961),w=C(w,p,E,g,A[k+8],20,1163531501),g=C(g,w,p,E,A[k+13],5,-1444681467),E=C(E,g,w,p,A[k+2],9,-51403784),p=C(p,E,g,w,A[k+7],14,1735328473),g=j(g,w=C(w,p,E,g,A[k+12],20,-1926607734),p,E,A[k+5],4,-378558),E=j(E,g,w,p,A[k+8],11,-2022574463),p=j(p,E,g,w,A[k+11],16,1839030562),w=j(w,p,E,g,A[k+14],23,-35309556),g=j(g,w,p,E,A[k+1],4,-1530992060),E=j(E,g,w,p,A[k+4],11,1272893353),p=j(p,E,g,w,A[k+7],16,-155497632),w=j(w,p,E,g,A[k+10],23,-1094730640),g=j(g,w,p,E,A[k+13],4,681279174),E=j(E,g,w,p,A[k+0],11,-358537222),p=j(p,E,g,w,A[k+3],16,-722521979),w=j(w,p,E,g,A[k+6],23,76029189),g=j(g,w,p,E,A[k+9],4,-640364487),E=j(E,g,w,p,A[k+12],11,-421815835),p=j(p,E,g,w,A[k+15],16,530742520),g=P(g,w=j(w,p,E,g,A[k+2],23,-995338651),p,E,A[k+0],6,-198630844),E=P(E,g,w,p,A[k+7],10,1126891415),p=P(p,E,g,w,A[k+14],15,-1416354905),w=P(w,p,E,g,A[k+5],21,-57434055),g=P(g,w,p,E,A[k+12],6,1700485571),E=P(E,g,w,p,A[k+3],10,-1894986606),p=P(p,E,g,w,A[k+10],15,-1051523),w=P(w,p,E,g,A[k+1],21,-2054922799),g=P(g,w,p,E,A[k+8],6,1873313359),E=P(E,g,w,p,A[k+15],10,-30611744),p=P(p,E,g,w,A[k+6],15,-1560198380),w=P(w,p,E,g,A[k+13],21,1309151649),g=P(g,w,p,E,A[k+4],6,-145523070),E=P(E,g,w,p,A[k+11],10,-1120210379),p=P(p,E,g,w,A[k+2],15,718787259),w=P(w,p,E,g,A[k+9],21,-343485551),g=D(g,J),w=D(w,O),p=D(p,R),E=D(E,N)}return Array(g,w,p,E)}function y(A,I,g,w,p,E){return D((I=D(D(I,A),D(w,E)))<<p|I>>>32-p,g)}function x(A,I,g,w,p,E,k){return y(I&g|~I&w,A,I,p,E,k)}function C(A,I,g,w,p,E,k){return y(I&w|g&~w,A,I,p,E,k)}function j(A,I,g,w,p,E,k){return y(I^g^w,A,I,p,E,k)}function P(A,I,g,w,p,E,k){return y(g^(I|~w),A,I,p,E,k)}function D(A,I){var g=(65535&A)+(65535&I);return(A>>16)+(I>>16)+(g>>16)<<16|65535&g}r.exports=function(A){return m.hash(A,_,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){r.exports=function(m){for(var _,y=new Array(m),x=0;x<m;x++)!(3&x)&&(_=4294967296*Math.random()),y[x]=_>>>((3&x)<<3)&255;return y}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){var m=t("./helpers");function _(C,j){C[j>>5]|=128<<24-j%32,C[15+(j+64>>9<<4)]=j;for(var P,D,A,I=Array(80),g=1732584193,w=-271733879,p=-1732584194,E=271733878,k=-1009589776,J=0;J<C.length;J+=16){for(var O=g,R=w,N=p,H=E,Z=k,S=0;S<80;S++){I[S]=S<16?C[J+S]:x(I[S-3]^I[S-8]^I[S-14]^I[S-16],1);var U=y(y(x(g,5),(U=w,D=p,A=E,(P=S)<20?U&D|~U&A:!(P<40)&&P<60?U&D|U&A|D&A:U^D^A)),y(y(k,I[S]),(P=S)<20?1518500249:P<40?1859775393:P<60?-1894007588:-899497514)),k=E,E=p,p=x(w,30),w=g,g=U}g=y(g,O),w=y(w,R),p=y(p,N),E=y(E,H),k=y(k,Z)}return Array(g,w,p,E,k)}function y(C,j){var P=(65535&C)+(65535&j);return(C>>16)+(j>>16)+(P>>16)<<16|65535&P}function x(C,j){return C<<j|C>>>32-j}r.exports=function(C){return m.hash(C,_,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){function m(j,P){var D=(65535&j)+(65535&P);return(j>>16)+(P>>16)+(D>>16)<<16|65535&D}function _(j,P){var D,A=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),I=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),g=new Array(64);j[P>>5]|=128<<24-P%32,j[15+(P+64>>9<<4)]=P;for(var w,p,E=0;E<j.length;E+=16){for(var k=I[0],J=I[1],O=I[2],R=I[3],N=I[4],H=I[5],Z=I[6],S=I[7],U=0;U<64;U++)g[U]=U<16?j[U+E]:m(m(m((p=g[U-2],x(p,17)^x(p,19)^C(p,10)),g[U-7]),(p=g[U-15],x(p,7)^x(p,18)^C(p,3))),g[U-16]),D=m(m(m(m(S,x(p=N,6)^x(p,11)^x(p,25)),N&H^~N&Z),A[U]),g[U]),w=m(x(w=k,2)^x(w,13)^x(w,22),k&J^k&O^J&O),S=Z,Z=H,H=N,N=m(R,D),R=O,O=J,J=k,k=m(D,w);I[0]=m(k,I[0]),I[1]=m(J,I[1]),I[2]=m(O,I[2]),I[3]=m(R,I[3]),I[4]=m(N,I[4]),I[5]=m(H,I[5]),I[6]=m(Z,I[6]),I[7]=m(S,I[7])}return I}var y=t("./helpers"),x=function(j,P){return j>>>P|j<<32-P},C=function(j,P){return j>>>P};r.exports=function(j){return y.hash(j,_,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){s.read=function(m,_,y,x,E){var j,P,D=8*E-x-1,A=(1<<D)-1,I=A>>1,g=-7,w=y?E-1:0,p=y?-1:1,E=m[_+w];for(w+=p,j=E&(1<<-g)-1,E>>=-g,g+=D;0<g;j=256*j+m[_+w],w+=p,g-=8);for(P=j&(1<<-g)-1,j>>=-g,g+=x;0<g;P=256*P+m[_+w],w+=p,g-=8);if(j===0)j=1-I;else{if(j===A)return P?NaN:1/0*(E?-1:1);P+=Math.pow(2,x),j-=I}return(E?-1:1)*P*Math.pow(2,j-x)},s.write=function(m,_,y,x,C,k){var P,D,A=8*k-C-1,I=(1<<A)-1,g=I>>1,w=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=x?0:k-1,E=x?1:-1,k=_<0||_===0&&1/_<0?1:0;for(_=Math.abs(_),isNaN(_)||_===1/0?(D=isNaN(_)?1:0,P=I):(P=Math.floor(Math.log(_)/Math.LN2),_*(x=Math.pow(2,-P))<1&&(P--,x*=2),2<=(_+=1<=P+g?w/x:w*Math.pow(2,1-g))*x&&(P++,x/=2),I<=P+g?(D=0,P=I):1<=P+g?(D=(_*x-1)*Math.pow(2,C),P+=g):(D=_*Math.pow(2,g-1)*Math.pow(2,C),P=0));8<=C;m[y+p]=255&D,p+=E,D/=256,C-=8);for(P=P<<C|D,A+=C;0<A;m[y+p]=255&P,p+=E,P/=256,A-=8);m[y+p-E]|=128*k}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,r,s){(function(i,a,o,u,c,l,d,h,b){var m,_,y;function x(){}(i=r.exports={}).nextTick=(_=typeof window<"u"&&window.setImmediate,y=typeof window<"u"&&window.postMessage&&window.addEventListener,_?function(C){return window.setImmediate(C)}:y?(m=[],window.addEventListener("message",function(C){var j=C.source;j!==window&&j!==null||C.data!=="process-tick"||(C.stopPropagation(),0<m.length&&m.shift()())},!0),function(C){m.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=x,i.addListener=x,i.once=x,i.off=x,i.removeListener=x,i.removeAllListeners=x,i.emit=x,i.binding=function(C){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(jc);var mb=jc.exports;const yb=pr(mb),Ao=(...n)=>yb(n.join("_")),gb=new Map;class Hi extends Kh{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Ao(e,t))??null)}async update(e,t,r){this.cache.set(Ao(e,t),r)}static global(){return new Hi(gb)}}class bb extends Cu{constructor({cache:e,concurrency:t,...r}){super(t?{maxConcurrency:t,...r}:r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="object"?this.cache=e:e?this.cache=Hi.global():this.cache=void 0}async generatePrompt(e,t,r){const s=e.map(i=>i.toString());return this.generate(s,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const s=e.generations[r];if(r===0)t.push({generations:[s],llmOutput:e.llmOutput});else{const i=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[s],llmOutput:i})}}return t}async _generateUncached(e,t,r){const s=await xt.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this==null?void 0:this.invocationParams(t)},a=await(s==null?void 0:s.handleLLMStart(this.toJSON(),e,void 0,void 0,i));let o;try{o=await this._generate(e,t,a==null?void 0:a[0])}catch(l){throw await Promise.all((a??[]).map(d=>d==null?void 0:d.handleLLMError(l))),l}const u=this._flattenLLMResult(o);await Promise.all((a??[]).map((l,d)=>l==null?void 0:l.handleLLMEnd(u[d])));const c=(a==null?void 0:a.map(l=>l.runId))||void 0;return Object.defineProperty(o,nu,{value:c?{runIds:c}:void 0,configurable:!0}),o}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let s;Array.isArray(t)?s={stop:t}:t!=null&&t.timeout&&!t.signal?s={...t,signal:AbortSignal.timeout(t.timeout)}:s=t??{};const i={tags:s.tags,metadata:s.metadata,callbacks:s.callbacks??r};if(delete s.tags,delete s.metadata,delete s.callbacks,!this.cache)return this._generateUncached(e,s,i);const{cache:a}=this,o=this.serialize();o.stop=s.stop??o.stop;const u=`${Object.entries(o).sort()}`,c=[],l=await Promise.all(e.map(async(h,b)=>{const m=await a.lookup(h,u);return m||c.push(b),m}));let d={};if(c.length>0){const h=await this._generateUncached(c.map(b=>e[b]),s,i);await Promise.all(h.generations.map(async(b,m)=>{const _=c[m];return l[_]=b,a.update(e[_],u,b)})),d=h.llmOutput??{}}return{generations:l,llmOutput:d}}async call(e,t,r){const{generations:s}=await this.generate([e],t??{},r);return s[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const s=ji(e),i=await this.call(s,t,r);return new iu(i)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static async deserialize(e){const{_type:t,_model:r,...s}=e;if(r&&r!=="base_llm")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await _e(()=>import("./openai.3c7ab638.js"),["_app/immutable/chunks/openai.3c7ab638.js","_app/immutable/chunks/prompt-layer.00daf386.js"])).OpenAI}[t];if(i===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new i(s)}}class vb extends bb{async _generate(e,t,r){return{generations:await Promise.all(e.map((i,a)=>this._call(i,{...t,promptIndex:a},r).then(o=>[{text:o}])))}}}class Ki extends vb{get lc_secrets(){return{apiKey:"HUGGINGFACEHUB_API_KEY"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt2"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=(e==null?void 0:e.model)??this.model,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.topK=(e==null?void 0:e.topK)??this.topK,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.apiKey=(e==null?void 0:e.apiKey)??Te("HUGGINGFACEHUB_API_KEY"),!this.apiKey)throw new Error("Please set an API key for HuggingFace Hub in the environment variable HUGGINGFACEHUB_API_KEY or in the apiKey field of the HuggingFaceInference constructor.")}_llmType(){return"hf"}async _call(e,t){const{HfInference:r}=await Ki.imports(),s=new r(this.apiKey);return(await this.caller.callWithOptions({signal:t.signal},s.textGeneration.bind(s),{model:this.model,parameters:{return_full_text:!1,temperature:this.temperature,max_new_tokens:this.maxTokens,top_p:this.topP,top_k:this.topK,repetition_penalty:this.frequencyPenalty},inputs:e})).generated_text}static async imports(){try{const{HfInference:e}=await _e(()=>Promise.resolve().then(()=>Uh),void 0);return{HfInference:e}}catch{throw new Error("Please install huggingface as a dependency with, e.g. `yarn add @huggingface/inference`")}}}async function To(n,e,t,r,s){const i=s,a=new Ki({apiKey:n,model:"tiiuae/falcon-7b-instruct",maxTokens:5e3}),u=await Di.fromLLM(a,e.asRetriever(),{returnSourceDocuments:!0}).call({question:i,chat_history:[]});console.log("result",u),console.log(u.text)}function ii(n){n.from("documents").select("name:metadata->>file_name, size:metadata->>file_size",{count:"exact"}).then(e=>{const r=e.data.reduce((a,o)=>(a.find(c=>c.name===o.name)||a.push(o),a),[]);r.sort((a,o)=>parseInt(o.size)-parseInt(a.size));const s=r.length,i=r.reduce((a,o)=>a+parseInt(o.size),0);console.log("Total Documents:",s),console.log("Total Size (bytes):",i),r.forEach(a=>{`${a.name}`,console.log(`**${a.name}** (${a.size} bytes)`),console.log("❌")})}).catch(e=>{console.error("Error:",e)})}const ee="src/routes/+page.svelte";function Cc(n){let e,t,r="Configuration",s,i,a=ii(n[4])+"",o;const u={c:function(){e=Q("div"),t=Q("h2"),t.textContent=r,s=de(),i=Q("div"),o=Pn(a),this.h()},l:function(l){e=X(l,"DIV",{class:!0});var d=be(e);t=X(d,"H2",{"data-svelte-h":!0}),Oe(t)!=="svelte-bx2tqs"&&(t.textContent=r),d.forEach(ce),s=he(l),i=X(l,"DIV",{class:!0});var h=be(i);o=xn(h,a),h.forEach(ce),this.h()},h:function(){W(t,ee,212,8,6079),te(e,"class","sidebar"),W(e,ee,211,6,6049),te(i,"class","content"),W(i,ee,217,6,6258)},m:function(l,d){dt(l,e,d),q(e,t),dt(l,s,d),dt(l,i,d),q(i,o)},p:function(l,d){d&16&&a!==(a=ii(l[4])+"")&&Sn(o,a)},d:function(l){l&&(ce(e),ce(s),ce(i))}};return en("SvelteRegisterBlock",{block:u,id:Cc.name,type:"if",source:"(176:32) ",ctx:n}),u}function Ic(n){let e,t,r="Configuration",s,i,a="Choose your model and temperature for asking questions.",o,u,c,l="Model",d,h,b,m="tiiuae/falcon-7b-instruct",_,y="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",x,C,j,P="Temperature",D,A,I,g,w,p,E,k,J,O,R="Add the URL to the database",N,H;const Z={c:function(){e=Q("div"),t=Q("h2"),t.textContent=r,s=de(),i=Q("p"),i.textContent=a,o=de(),u=Q("div"),c=Q("label"),c.textContent=l,d=de(),h=Q("select"),b=Q("option"),b.textContent=m,_=Q("option"),_.textContent=y,x=de(),C=Q("div"),j=Q("label"),j.textContent=P,D=de(),A=Q("input"),I=de(),g=Q("span"),w=Pn(n[9]),p=de(),E=Q("div"),k=Q("textarea"),J=de(),O=Q("button"),O.textContent=R,this.h()},l:function(U){e=X(U,"DIV",{class:!0});var F=be(e);t=X(F,"H2",{"data-svelte-h":!0}),Oe(t)!=="svelte-bx2tqs"&&(t.textContent=r),s=he(F),i=X(F,"P",{"data-svelte-h":!0}),Oe(i)!=="svelte-1o6n24x"&&(i.textContent=a),o=he(F),u=X(F,"DIV",{class:!0});var ie=be(u);c=X(ie,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(c)!=="svelte-6cjlpw"&&(c.textContent=l),d=he(ie),h=X(ie,"SELECT",{id:!0});var Me=be(h);b=X(Me,"OPTION",{"data-svelte-h":!0}),Oe(b)!=="svelte-m8jcxa"&&(b.textContent=m),_=X(Me,"OPTION",{"data-svelte-h":!0}),Oe(_)!=="svelte-1epjw1g"&&(_.textContent=y),Me.forEach(ce),ie.forEach(ce),x=he(F),C=X(F,"DIV",{class:!0});var Pe=be(C);j=X(Pe,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(j)!=="svelte-11sobei"&&(j.textContent=P),D=he(Pe),A=X(Pe,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0}),I=he(Pe),g=X(Pe,"SPAN",{});var Le=be(g);w=xn(Le,n[9]),Le.forEach(ce),Pe.forEach(ce),F.forEach(ce),p=he(U),E=X(U,"DIV",{class:!0});var pe=be(E);k=X(pe,"TEXTAREA",{}),be(k).forEach(ce),J=he(pe),O=X(pe,"BUTTON",{"data-svelte-h":!0}),Oe(O)!=="svelte-1ul8iy1"&&(O.textContent=R),pe.forEach(ce),this.h()},h:function(){W(t,ee,168,8,4667),W(i,ee,169,8,4698),te(c,"for","model"),W(c,ee,171,10,4800),b.__value="tiiuae/falcon-7b-instruct",$e(b,b.__value),W(b,ee,173,12,4895),_.__value="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",$e(_,_.__value),W(_,ee,176,12,5012),te(h,"id","model"),n[8]===void 0&&$c(()=>n[24].call(h)),W(h,ee,172,10,4843),te(u,"class","select"),W(u,ee,170,8,4769),te(j,"for","temperature"),W(j,ee,182,10,5233),te(A,"type","range"),te(A,"id","temperature"),te(A,"min","0.1"),te(A,"max","1.0"),te(A,"step","0.2"),W(A,ee,183,10,5288),W(g,ee,191,10,5477),te(C,"class","slider"),W(C,ee,181,8,5202),te(e,"class","sidebar"),W(e,ee,167,6,4637),W(k,ee,197,8,5627),W(O,ee,198,8,5670),te(E,"class","content"),W(E,ee,196,6,5597)},m:function(U,F){dt(U,e,F),q(e,t),q(e,s),q(e,i),q(e,o),q(e,u),q(u,c),q(u,d),q(u,h),q(h,b),q(h,_),Yi(h,n[8],!0),q(e,x),q(e,C),q(C,j),q(C,D),q(C,A),$e(A,n[9]),q(C,I),q(C,g),q(g,w),dt(U,p,F),dt(U,E,F),q(E,k),$e(k,n[3]),q(E,J),q(E,O),N||(H=[Re(h,"change",n[24]),Re(A,"change",n[25]),Re(A,"input",n[25]),Re(k,"input",n[26]),Re(O,"click",n[27],!1,!1,!1,!1)],N=!0)},p:function(U,F){F&256&&Yi(h,U[8]),F&512&&$e(A,U[9]),F&512&&Sn(w,U[9]),F&8&&$e(k,U[3])},d:function(U){U&&(ce(e),ce(p),ce(E)),N=!1,oi(H)}};return en("SvelteRegisterBlock",{block:Z,id:Ic.name,type:"if",source:"(132:46) ",ctx:n}),Z}function Rc(n){let e,t,r="Configuration",s,i,a="Choose your chunk size and overlap for adding knowledge.",o,u,c,l="Chunk Size",d,h,b,m,_,y,x,C,j="Chunk Overlap",P,D,A,I,g,w,p,E,k,J,O,R="Upload Files",N,H,Z,S,U,F="Add the URL to the database",ie,Me;const Pe={c:function(){e=Q("div"),t=Q("h2"),t.textContent=r,s=de(),i=Q("p"),i.textContent=a,o=de(),u=Q("div"),c=Q("label"),c.textContent=l,d=de(),h=Q("input"),b=de(),m=Q("span"),_=Pn(n[6]),y=de(),x=Q("div"),C=Q("label"),C.textContent=j,P=de(),D=Q("input"),A=de(),I=Q("span"),g=Pn(n[7]),w=de(),p=Q("div"),E=Q("div"),k=Q("input"),J=de(),O=Q("button"),O.textContent=R,N=de(),H=Q("div"),Z=Q("textarea"),S=de(),U=Q("button"),U.textContent=F,this.h()},l:function(pe){e=X(pe,"DIV",{class:!0});var ve=be(e);t=X(ve,"H2",{"data-svelte-h":!0}),Oe(t)!=="svelte-bx2tqs"&&(t.textContent=r),s=he(ve),i=X(ve,"P",{"data-svelte-h":!0}),Oe(i)!=="svelte-gxt4ze"&&(i.textContent=a),o=he(ve),u=X(ve,"DIV",{class:!0});var B=be(u);c=X(B,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(c)!=="svelte-xcnf9x"&&(c.textContent=l),d=he(B),h=X(B,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0}),b=he(B),m=X(B,"SPAN",{});var f=be(m);_=xn(f,n[6]),f.forEach(ce),B.forEach(ce),y=he(ve),x=X(ve,"DIV",{class:!0});var v=be(x);C=X(v,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(C)!=="svelte-1yjlqk5"&&(C.textContent=j),P=he(v),D=X(v,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0}),A=he(v),I=X(v,"SPAN",{});var T=be(I);g=xn(T,n[7]),T.forEach(ce),v.forEach(ce),ve.forEach(ce),w=he(pe),p=X(pe,"DIV",{class:!0});var $=be(p);E=X($,"DIV",{class:!0});var L=be(E);k=X(L,"INPUT",{type:!0}),J=he(L),O=X(L,"BUTTON",{"data-svelte-h":!0}),Oe(O)!=="svelte-1f0holf"&&(O.textContent=R),L.forEach(ce),N=he($),H=X($,"DIV",{class:!0});var V=be(H);Z=X(V,"TEXTAREA",{}),be(Z).forEach(ce),S=he(V),U=X(V,"BUTTON",{"data-svelte-h":!0}),Oe(U)!=="svelte-1y0kmke"&&(U.textContent=F),V.forEach(ce),$.forEach(ce),this.h()},h:function(){W(t,ee,113,8,2894),W(i,ee,114,8,2925),te(c,"for","chunk-size"),W(c,ee,116,10,3028),te(h,"type","range"),te(h,"id","chunk-size"),te(h,"min","100"),te(h,"max","1000"),te(h,"step","50"),W(h,ee,117,10,3081),W(m,ee,125,10,3267),te(u,"class","slider"),W(u,ee,115,8,2997),te(C,"for","chunk-overlap"),W(C,ee,128,10,3347),te(D,"type","range"),te(D,"id","chunk-overlap"),te(D,"min","0"),te(D,"max","100"),te(D,"step","10"),W(D,ee,129,10,3406),W(I,ee,137,10,3595),te(x,"class","slider"),W(x,ee,127,8,3316),te(e,"class","sidebar"),W(e,ee,112,6,2864),te(k,"type","file"),k.multiple=!0,W(k,ee,144,10,3785),W(O,ee,145,10,3845),te(E,"class","file-uploader"),W(E,ee,143,8,3747),W(Z,ee,152,10,4057),W(U,ee,153,10,4097),te(H,"class","url-uploader"),W(H,ee,151,8,4020),te(p,"class","content"),W(p,ee,142,6,3717)},m:function(pe,ve){dt(pe,e,ve),q(e,t),q(e,s),q(e,i),q(e,o),q(e,u),q(u,c),q(u,d),q(u,h),$e(h,n[6]),q(u,b),q(u,m),q(m,_),q(e,y),q(e,x),q(x,C),q(x,P),q(x,D),$e(D,n[7]),q(x,A),q(x,I),q(I,g),dt(pe,w,ve),dt(pe,p,ve),q(p,E),q(E,k),q(E,J),q(E,O),q(p,N),q(p,H),q(H,Z),$e(Z,n[2]),q(H,S),q(H,U),ie||(Me=[Re(h,"change",n[19]),Re(h,"input",n[19]),Re(D,"change",n[20]),Re(D,"input",n[20]),Re(k,"change",n[14],!1,!1,!1,!1),Re(O,"click",n[21],!1,!1,!1,!1),Re(Z,"input",n[22]),Re(U,"click",n[23],!1,!1,!1,!1)],ie=!0)},p:function(pe,ve){ve&64&&$e(h,pe[6]),ve&64&&Sn(_,pe[6]),ve&128&&$e(D,pe[7]),ve&128&&Sn(g,pe[7]),ve&4&&$e(Z,pe[2])},d:function(pe){pe&&(ce(e),ce(w),ce(p)),ie=!1,oi(Me)}};return en("SvelteRegisterBlock",{block:Pe,id:Rc.name,type:"if",source:'(77:4) {#if mode === \\"Add Knowledge\\"}',ctx:n}),Pe}function ai(n){let e,t,r,s="🧠🧠 James 🧠🧠",i,a,o=`He will remember everything you tell him and answer your questions.
      (Please let me know if I have to discipline him. He's still learning, and
      any feedback is welcome!)`,u,c,l,d,h,b,m="Add Knowledge",_,y,x,C,j="Chat with your Brain",P,D,A,I,g="Forget",w,p,E,k;function J(H,Z){if(H[0]==="Add Knowledge")return Rc;if(H[0]==="Chat with your Brain")return Ic;if(H[0]==="Forget")return Cc}let O=J(n),R=O&&O(n);p=Fc(n[16][0]);const N={c:function(){e=Q("div"),t=Q("div"),r=Q("h1"),r.textContent=s,i=de(),a=Q("p"),a.textContent=o,u=de(),c=Q("div"),l=Q("div"),d=Q("input"),h=de(),b=Q("label"),b.textContent=m,_=de(),y=Q("input"),x=de(),C=Q("label"),C.textContent=j,P=de(),D=Q("input"),A=de(),I=Q("label"),I.textContent=g,w=de(),R&&R.c(),this.h()},l:function(Z){e=X(Z,"DIV",{class:!0});var S=be(e);t=X(S,"DIV",{class:!0});var U=be(t);r=X(U,"H1",{"data-svelte-h":!0}),Oe(r)!=="svelte-la326"&&(r.textContent=s),i=he(U),a=X(U,"P",{"data-svelte-h":!0}),Oe(a)!=="svelte-1esjus8"&&(a.textContent=o),U.forEach(ce),u=he(S),c=X(S,"DIV",{class:!0});var F=be(c);l=X(F,"DIV",{class:!0});var ie=be(l);d=X(ie,"INPUT",{type:!0,id:!0}),h=he(ie),b=X(ie,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(b)!=="svelte-112aynz"&&(b.textContent=m),_=he(ie),y=X(ie,"INPUT",{type:!0,id:!0}),x=he(ie),C=X(ie,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(C)!=="svelte-41acxd"&&(C.textContent=j),P=he(ie),D=X(ie,"INPUT",{type:!0,id:!0}),A=he(ie),I=X(ie,"LABEL",{for:!0,"data-svelte-h":!0}),Oe(I)!=="svelte-1h6y6ie"&&(I.textContent=g),ie.forEach(ce),w=he(F),R&&R.l(F),F.forEach(ce),S.forEach(ce),this.h()},h:function(){W(r,ee,80,4,1888),W(a,ee,81,4,1917),te(t,"class","app-header"),W(t,ee,79,2,1859),te(d,"type","radio"),d.__value="Add Knowledge",$e(d,d.__value),te(d,"id","add-knowledge"),W(d,ee,90,6,2250),te(b,"for","add-knowledge"),W(b,ee,96,6,2376),te(y,"type","radio"),y.__value="Chat with your Brain",$e(y,y.__value),te(y,"id","chat-with-brain"),W(y,ee,98,6,2432),te(C,"for","chat-with-brain"),W(C,ee,104,6,2567),te(D,"type","radio"),D.__value="Forget",$e(D,D.__value),te(D,"id","forget"),W(D,ee,106,6,2632),te(I,"for","forget"),W(I,ee,107,6,2706),te(l,"class","action-selection"),W(l,ee,89,4,2213),te(c,"class","app-content"),W(c,ee,87,2,2127),te(e,"class","app-container"),W(e,ee,78,0,1829),p.p(d,y,D)},m:function(Z,S){dt(Z,e,S),q(e,t),q(t,r),q(t,i),q(t,a),q(e,u),q(e,c),q(c,l),q(l,d),d.checked=d.__value===n[0],q(l,h),q(l,b),q(l,_),q(l,y),y.checked=y.__value===n[0],q(l,x),q(l,C),q(l,P),q(l,D),D.checked=D.__value===n[0],q(l,A),q(l,I),q(c,w),R&&R.m(c,null),E||(k=[Re(d,"change",n[15]),Re(y,"change",n[17]),Re(D,"change",n[18])],E=!0)},p:function(Z,[S]){S&1&&(d.checked=d.__value===Z[0]),S&1&&(y.checked=y.__value===Z[0]),S&1&&(D.checked=D.__value===Z[0]),O===(O=J(Z))&&R?R.p(Z,S):(R&&R.d(1),R=O&&O(Z),R&&(R.c(),R.m(c,null)))},i:Gi,o:Gi,d:function(Z){Z&&ce(e),R&&R.d(),p.r(),E=!1,oi(k)}};return en("SvelteRegisterBlock",{block:N,id:ai.name,type:"component",source:"",ctx:n}),N}const Bs="https://jqfandcxceztebtpwzxd.supabase.co",Vs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpxZmFuZGN4Y2V6dGVidHB3enhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODkzNzI0NzUsImV4cCI6MjAwNDk0ODQ3NX0.MXs4u_1XMM-foNe08LLYHQLENjmwTF3jqUmNXCSbOU4",qs="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",_b="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",Po="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";function wb(n,e,t){let r,s,i,a,{$$slots:o={},$$scope:u}=e;Bc("Page",o,[]);let c,l=vr("tiiuae/falcon-7b-instruct");un(l,"model"),cn(n,l,S=>t(8,i=S));let d=vr(.2);un(d,"temperature"),cn(n,d,S=>t(9,a=S));let h=vr(500);un(h,"chunkSize"),cn(n,h,S=>t(6,r=S));let b=vr(0);un(b,"chunkOverlap"),cn(n,b,S=>t(7,s=S));let m,_,y="",x,C,j;Ji(()=>{t(4,x=er(Bs,Vs));const S=er(Bs,Vs);j=new Ys({apiKey:"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"}),t(5,C=new tr(j,{client:S,tableName:"documents"}))});async function P(S){t(1,m=S.target.files[0])}const D=[];Object.keys(e).forEach(S=>{!~D.indexOf(S)&&S.slice(0,2)!=="$$"&&S!=="slot"&&console.warn(`<Page> was created with unknown prop '${S}'`)});const A=[[]];function I(){c=this.__value,t(0,c)}function g(){c=this.__value,t(0,c)}function w(){c=this.__value,t(0,c)}function p(){r=us(this.value),h.set(r)}function E(){s=us(this.value),b.set(s)}const k=()=>Za(x,qs,C,m);function J(){_=this.value,t(2,_)}const O=()=>Ja(x,qs,C,_);function R(){i=Vc(this),l.set(i)}function N(){a=us(this.value),d.set(a)}function H(){y=this.value,t(3,y)}const Z=()=>To(Po,C,l,d,y);return n.$capture_state=()=>({onMount:Ji,file_uploader:Za,url_uploader:Ja,chatWithDoc:To,brain:ii,createClient:er,OpenAIEmbeddings:Eu,SupabaseVectorStore:tr,writable:vr,HuggingFaceInferenceEmbeddings:Ys,mode:c,model:l,temperature:d,chunkSize:h,chunkOverlap:b,files:m,url:_,question:y,supabase_url:Bs,supabase_key:Vs,openai_api_key:qs,openAIApiKey:_b,huggingfacehub_api_token:Po,supabase:x,vector:C,embeddings:j,upload:P,$chunkSize:r,$chunkOverlap:s,$model:i,$temperature:a}),n.$inject_state=S=>{"mode"in S&&t(0,c=S.mode),"model"in S&&t(10,l=S.model),"temperature"in S&&t(11,d=S.temperature),"chunkSize"in S&&t(12,h=S.chunkSize),"chunkOverlap"in S&&t(13,b=S.chunkOverlap),"files"in S&&t(1,m=S.files),"url"in S&&t(2,_=S.url),"question"in S&&t(3,y=S.question),"supabase"in S&&t(4,x=S.supabase),"vector"in S&&t(5,C=S.vector),"embeddings"in S&&(j=S.embeddings)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),[c,m,_,y,x,C,r,s,i,a,l,d,h,b,P,I,A,g,w,p,E,k,J,O,R,N,H,Z]}class jb extends Mc{constructor(e){super(e),Uc(this,e,wb,ai,Lc,{}),en("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:ai.name})}}export{iu as A,nn as B,xt as C,su as H,Ke as L,ke as P,nu as R,zh as S,vb as a,Cp as b,bb as c,Ws as d,jp as e,Pp as f,Te as g,kb as h,ru as i,hm as j,_m as k,ry as l,Cu as m,ku as n,Sb as o,jb as p,Ru as r,by as z};
