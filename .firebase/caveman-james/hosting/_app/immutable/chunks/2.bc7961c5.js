var Mn=Object.defineProperty;var Ln=(r,e,t)=>e in r?Mn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ze=(r,e,t)=>(Ln(r,typeof e!="symbol"?e+"":e,t),t),kt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var P=(r,e,t)=>(kt(r,e,"read from private field"),t?t.call(r):e.get(r)),se=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},be=(r,e,t,n)=>(kt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var bt=(r,e,t,n)=>({set _(s){be(r,e,s,t)},get _(){return P(r,e,n)}}),de=(r,e,t)=>(kt(r,e,"access private method"),t);import{i as is_promise,j as get_current_component,k as set_current_component,l as flush,s as safe_not_equal,d as add_location,n as noop$1,e as create_slot,u as update_slot_base,g as get_all_dirty_from_scope,f as get_slot_changes,o as onMount,r as run_all,m as add_render_callback,v as validate_store,h as component_subscribe,p as set_store_value}from"./scheduler.d474dcd1.js";import{r as group_outros,t as transition_out,b as check_outros,f as transition_in,S as SvelteComponentDev,i as init,d as dispatch_dev,v as validate_slots,e as empty$1,a as insert_hydration_dev,g as detach_dev,j as element,o as text,k as claim_element,l as children,p as claim_text,m as attr_dev,z as append_hydration_dev,A as get_svelte_dataset,s as space,c as claim_space,B as set_input_value,C as listen_dev,q as set_data_dev,D as select_option,E as select_value,F as to_number,G as ensure_array_like_dev,H as destroy_each,u as create_component,w as claim_component,x as mount_component,y as destroy_component}from"./index.93df3e69.js";import{g as globals}from"./globals.7f7f1b26.js";import{g as getDefaultExportFromCjs,b as commonjsGlobal,d as getAugmentedNamespace,c as createClient,P as PUBLIC_SUPABASE_KEY,a as PUBLIC_SUPABASE_URL,e as PUBLIC_HUGGINGFACE_API_KEY,_ as __vitePreload}from"./public.816bc6b5.js";import{w as writable}from"./index.421580be.js";function handle_promise(r,e){const t=e.token={};function n(s,a,o,l){if(e.token!==t)return;e.resolved=l;let d=e.ctx;o!==void 0&&(d=d.slice(),d[o]=l);const c=s&&(e.current=s)(d);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,b)=>{b!==a&&h&&(group_outros(),transition_out(h,1,1,()=>{e.blocks[b]===h&&(e.blocks[b]=null)}),check_outros())}):e.block.d(1),c.c(),transition_in(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[a]=c),u&&flush()}if(is_promise(r)){const s=get_current_component();if(r.then(a=>{set_current_component(s),n(e.then,1,e.value,a),set_current_component(null)},a=>{if(set_current_component(s),n(e.catch,2,e.error,a),set_current_component(null),!e.hasCatch)throw a}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function update_await_block_branch(r,e,t){const n=e.slice(),{resolved:s}=r;r.current===r.then&&(n[r.value]=s),r.current===r.catch&&(n[r.error]=s),r.block.p(n,t)}class Document{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var __defProp=Object.defineProperty,__defNormalProp=(r,e,t)=>e in r?__defProp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,__publicField=(r,e,t)=>(__defNormalProp(r,typeof e!="symbol"?e+"":e,t),t),base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$1=0,len=code.length;i$1<len;++i$1)lookup[i$1]=code[i$1],revLookup[code.charCodeAt(i$1)]=i$1;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function byteLength(r){var e=getLens(r),t=e[0],n=e[1];return(t+n)*3/4-n}function _byteLength(r,e,t){return(e+t)*3/4-t}function toByteArray(r){var e,t=getLens(r),n=t[0],s=t[1],a=new Arr(_byteLength(r,n,s)),o=0,l=s>0?n-4:n,d;for(d=0;d<l;d+=4)e=revLookup[r.charCodeAt(d)]<<18|revLookup[r.charCodeAt(d+1)]<<12|revLookup[r.charCodeAt(d+2)]<<6|revLookup[r.charCodeAt(d+3)],a[o++]=e>>16&255,a[o++]=e>>8&255,a[o++]=e&255;return s===2&&(e=revLookup[r.charCodeAt(d)]<<2|revLookup[r.charCodeAt(d+1)]>>4,a[o++]=e&255),s===1&&(e=revLookup[r.charCodeAt(d)]<<10|revLookup[r.charCodeAt(d+1)]<<4|revLookup[r.charCodeAt(d+2)]>>2,a[o++]=e>>8&255,a[o++]=e&255),a}function tripletToBase64(r){return lookup[r>>18&63]+lookup[r>>12&63]+lookup[r>>6&63]+lookup[r&63]}function encodeChunk(r,e,t){for(var n,s=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),s.push(tripletToBase64(n));return s.join("")}function fromByteArray(r){for(var e,t=r.length,n=t%3,s=[],a=16383,o=0,l=t-n;o<l;o+=a)s.push(encodeChunk(r,o,o+a>l?l:o+a));return n===1?(e=r[t-1],s.push(lookup[e>>2]+lookup[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),s.join("")}function bytePairMerge(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const a=r.slice(t[s].start,t[s+1].end),o=e.get(a.join(","));o!=null&&(n==null||o<n[0])&&(n=[o,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function bytePairEncode(r,e){return r.length===1?[e.get(r.join(","))]:bytePairMerge(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function escapeRegex(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var _Tiktoken=class{constructor(r,e){ze(this,"specialTokens");ze(this,"inverseSpecialTokens");ze(this,"patStr");ze(this,"textEncoder",new TextEncoder);ze(this,"textDecoder",new TextDecoder("utf-8"));ze(this,"rankMap",new Map);ze(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,o,...l]=s.split(" "),d=Number.parseInt(o,10);return l.forEach((c,u)=>n[c]=d+u),n},{});for(const[n,s]of Object.entries(t)){const a=base64Js.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=_Tiktoken.specialTokenRegex(Object.keys(this.specialTokens)),a=[],o=new Set(e==="all"?Object.keys(this.specialTokens):e),l=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!o.has(c)):t);if(l.size>0){const c=_Tiktoken.specialTokenRegex([...l]),u=r.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let d=0;for(;;){let c=null,u=d;for(;s.lastIndex=u,c=s.exec(r),!(c==null||o.has(c[0]));)u=c.index+1;const h=(c==null?void 0:c.index)??r.length;for(const A of r.substring(d,h).matchAll(n)){const w=this.textEncoder.encode(A[0]),g=this.rankMap.get(w.join(","));if(g!=null){a.push(g);continue}a.push(...bytePairEncode(w,this.rankMap))}if(c==null)break;let b=this.specialTokens[c[0]];a.push(b),d=c.index+c[0].length}return a}decode(r){const e=[];let t=0;for(let a=0;a<r.length;++a){const o=r[a],l=this.textMap.get(o)??this.inverseSpecialTokens[o];l!=null&&(e.push(l),t+=l.length)}const n=new Uint8Array(t);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},Tiktoken=_Tiktoken;__publicField(Tiktoken,"specialTokenRegex",r=>new RegExp(r.map(e=>escapeRegex(e)).join("|"),"g"));function getEncodingNameForModel(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var pRetry$2={exports:{}},retry$2={};function RetryOperation(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};RetryOperation.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};RetryOperation.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};RetryOperation.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};RetryOperation.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};RetryOperation.prototype.start=RetryOperation.prototype.try;RetryOperation.prototype.errors=function(){return this._errors};RetryOperation.prototype.attempts=function(){return this._attempts};RetryOperation.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],a=s.message,o=(r[a]||0)+1;r[a]=o,o>=t&&(e=s,t=o)}return e};(function(r){var e=retry_operation;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],o=0;o<n.retries;o++)a.push(this.createTimeout(o,n));return t&&t.forever&&!a.length&&a.push(this.createTimeout(o,n)),a.sort(function(l,d){return l-d}),a},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,a=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return a=Math.min(a,n.maxTimeout),a},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var o=0;o<s.length;o++){var l=s[o],d=t[l];t[l]=(function(u){var h=r.operation(n),b=Array.prototype.slice.call(arguments,1),A=b.pop();b.push(function(w){h.retry(w)||(w&&(arguments[0]=h.mainError()),A.apply(this,arguments))}),h.attempt(function(){u.apply(t,b)})}).bind(t,d),t[l].options=n}}})(retry$2);var retry$1=retry$2;const retry=retry$1,networkErrorMsgs=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class AbortError extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const decorateErrorWithCounts=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},isNetworkError=r=>networkErrorMsgs.includes(r),pRetry=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=retry.operation(e);s.attempt(async a=>{try{t(await r(a))}catch(o){if(!(o instanceof Error)){n(new TypeError(`Non-error was thrown: "${o}". You should only throw errors.`));return}if(o instanceof AbortError)s.stop(),n(o.originalError);else if(o instanceof TypeError&&!isNetworkError(o.message))s.stop(),n(o);else{decorateErrorWithCounts(o,a,e);try{await e.onFailedAttempt(o)}catch(l){n(l);return}s.retry(o)||n(s.mainError())}}})});pRetry$2.exports=pRetry;pRetry$2.exports.default=pRetry;pRetry$2.exports.AbortError=AbortError;var pRetryExports=pRetry$2.exports;const pRetry$1=getDefaultExportFromCjs(pRetryExports);var dist$1={},eventemitter3={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(d,c,u){this.fn=d,this.context=c,this.once=u||!1}function a(d,c,u,h,b){if(typeof u!="function")throw new TypeError("The listener must be a function");var A=new s(u,h||d,b),w=t?t+c:c;return d._events[w]?d._events[w].fn?d._events[w]=[d._events[w],A]:d._events[w].push(A):(d._events[w]=A,d._eventsCount++),d}function o(d,c){--d._eventsCount===0?d._events=new n:delete d._events[c]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},l.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var b=0,A=h.length,w=new Array(A);b<A;b++)w[b]=h[b].fn;return w},l.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(c,u,h,b,A,w){var g=t?t+c:c;if(!this._events[g])return!1;var v=this._events[g],T=arguments.length,C,x;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),T){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,h),!0;case 4:return v.fn.call(v.context,u,h,b),!0;case 5:return v.fn.call(v.context,u,h,b,A),!0;case 6:return v.fn.call(v.context,u,h,b,A,w),!0}for(x=1,C=new Array(T-1);x<T;x++)C[x-1]=arguments[x];v.fn.apply(v.context,C)}else{var S=v.length,D;for(x=0;x<S;x++)switch(v[x].once&&this.removeListener(c,v[x].fn,void 0,!0),T){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,u);break;case 3:v[x].fn.call(v[x].context,u,h);break;case 4:v[x].fn.call(v[x].context,u,h,b);break;default:if(!C)for(D=1,C=new Array(T-1);D<T;D++)C[D-1]=arguments[D];v[x].fn.apply(v[x].context,C)}}return!0},l.prototype.on=function(c,u,h){return a(this,c,u,h,!1)},l.prototype.once=function(c,u,h){return a(this,c,u,h,!0)},l.prototype.removeListener=function(c,u,h,b){var A=t?t+c:c;if(!this._events[A])return this;if(!u)return o(this,A),this;var w=this._events[A];if(w.fn)w.fn===u&&(!b||w.once)&&(!h||w.context===h)&&o(this,A);else{for(var g=0,v=[],T=w.length;g<T;g++)(w[g].fn!==u||b&&!w[g].once||h&&w[g].context!==h)&&v.push(w[g]);v.length?this._events[A]=v.length===1?v[0]:v:o(this,A)}return this},l.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,r.exports=l})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,pTimeout$1={exports:{}},pFinally$1=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})));const pFinally=pFinally$1;class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}const pTimeout=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}const a=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(d){s(d)}return}const o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,l=t instanceof Error?t:new TimeoutError(o);typeof r.cancel=="function"&&r.cancel(),s(l)},e);pFinally(r.then(n,s),()=>{clearTimeout(a)})});pTimeout$1.exports=pTimeout;pTimeout$1.exports.default=pTimeout;pTimeout$1.exports.TimeoutError=TimeoutError;var pTimeoutExports=pTimeout$1.exports,priorityQueue={},lowerBound$1={};Object.defineProperty(lowerBound$1,"__esModule",{value:!0});function lowerBound(r,e,t){let n=0,s=r.length;for(;s>0;){const a=s/2|0;let o=n+a;t(r[o],e)<=0?(n=++o,s-=a+1):s=a}return n}lowerBound$1.default=lowerBound;Object.defineProperty(priorityQueue,"__esModule",{value:!0});const lower_bound_1=lowerBound$1;class PriorityQueue{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}const s=lower_bound_1.default(this._queue,n,(a,o)=>o.priority-a.priority);this._queue.splice(s,0,n)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}priorityQueue.default=PriorityQueue;Object.defineProperty(dist$1,"__esModule",{value:!0});const EventEmitter=eventemitter3Exports,p_timeout_1=pTimeoutExports,priority_queue_1=priorityQueue,empty=()=>{},timeoutError=new p_timeout_1.TimeoutError;class PQueue extends EventEmitter{constructor(e){var t,n,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=empty,this._resolveIdle=empty,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:priority_queue_1.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=empty,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=empty,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,s)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const o=this._timeout===void 0&&t.timeout===void 0?e():p_timeout_1.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(timeoutError)});n(await o)}catch(o){s(o)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var _default$1=dist$1.default=PQueue;const STATUS_NO_RETRY$1=[400,401,403,404,405,406,407,408,409];let AsyncCaller$1=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in _default$1?_default$1.default:_default$1;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>pRetry$1(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt(n){var o,l,d,c;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.message.startsWith("AbortError")||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const s=(o=n==null?void 0:n.response)==null?void 0:o.status;if(s&&STATUS_NO_RETRY$1.includes(+s))throw n;const a=(l=n==null?void 0:n.response)==null?void 0:l.data;if(((d=a==null?void 0:a.error)==null?void 0:d.code)==="insufficient_quota"){const u=new Error((c=a==null?void 0:a.error)==null?void 0:c.message);throw u.name="InsufficientQuotaError",u}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var o;(o=e.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const cache={},caller=new AsyncCaller$1({});async function getEncoding(r,e){return r in cache||(cache[r]=caller.fetch(`https://tiktoken.pages.dev/js/${r}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete cache[r],t})),new Tiktoken(await cache[r],e==null?void 0:e.extendedSpecialTokens)}async function encodingForModel(r,e){return getEncoding(getEncodingNameForModel(r),e)}var decamelize=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const snakeCase=getDefaultExportFromCjs(decamelize);var camelcase={exports:{}};const UPPERCASE=/[\p{Lu}]/u,LOWERCASE=/[\p{Ll}]/u,LEADING_CAPITAL=/^[\p{Lu}](?![\p{Lu}])/gu,IDENTIFIER=/([\p{Alpha}\p{N}_]|$)/u,SEPARATORS=/[_.\- ]+/,LEADING_SEPARATORS=new RegExp("^"+SEPARATORS.source),SEPARATORS_AND_IDENTIFIER=new RegExp(SEPARATORS.source+IDENTIFIER.source,"gu"),NUMBERS_AND_IDENTIFIER=new RegExp("\\d+"+IDENTIFIER.source,"gu"),preserveCamelCase=(r,e,t)=>{let n=!1,s=!1,a=!1;for(let o=0;o<r.length;o++){const l=r[o];n&&UPPERCASE.test(l)?(r=r.slice(0,o)+"-"+r.slice(o),n=!1,a=s,s=!0,o++):s&&a&&LOWERCASE.test(l)?(r=r.slice(0,o-1)+"-"+r.slice(o-1),a=s,s=!1,n=!0):(n=e(l)===l&&t(l)!==l,a=s,s=t(l)===l&&e(l)!==l)}return r},preserveConsecutiveUppercase=(r,e)=>(LEADING_CAPITAL.lastIndex=0,r.replace(LEADING_CAPITAL,t=>e(t))),postProcess=(r,e)=>(SEPARATORS_AND_IDENTIFIER.lastIndex=0,NUMBERS_AND_IDENTIFIER.lastIndex=0,r.replace(SEPARATORS_AND_IDENTIFIER,(t,n)=>e(n)).replace(NUMBERS_AND_IDENTIFIER,t=>e(t))),camelCase=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(a=>a.trim()).filter(a=>a.length).join("-"):r=r.trim(),r.length===0)return"";const t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=preserveCamelCase(r,t,n)),r=r.replace(LEADING_SEPARATORS,""),e.preserveConsecutiveUppercase?r=preserveConsecutiveUppercase(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),postProcess(r,n))};camelcase.exports=camelCase;camelcase.exports.default=camelCase;function keyToJson(r,e){return(e==null?void 0:e[r])||snakeCase(r)}function mapKeys(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function shallowCopy(r){return Array.isArray(r)?[...r]:{...r}}function replaceSecrets(r,e){const t=shallowCopy(r);for(const[n,s]of Object.entries(e)){const[a,...o]=n.split(".").reverse();let l=t;for(const d of o.reverse()){if(l[d]===void 0)break;l[d]=shallowCopy(l[d]),l=l[d]}l[a]!==void 0&&(l[a]={lc:1,type:"secret",id:[s]})}return t}class Serializable{get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Serializable||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));for(const s in t)s in this&&this[s]!==void 0&&(n[s]=this[s]||n[s]);return{lc:1,type:"constructor",id:[...this.lc_namespace,this.constructor.name],kwargs:mapKeys(Object.keys(t).length?replaceSecrets(n,t):n,keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:[...this.lc_namespace,this.constructor.name]}}}class BaseDocumentTransformer extends Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}}class TextSplitter extends BaseDocumentTransformer{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:t=>t.length}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let n;if(t)if(this.keepSeparator){const s=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${s})`))}else n=e.split(t);else n=e.split("");return n.filter(s=>s!=="")}async createDocuments(e,t=[],n={}){const s=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:a="",chunkOverlapHeader:o="(cont'd) ",appendChunkOverlapHeader:l=!1}=n,d=new Array;for(let c=0;c<e.length;c+=1){const u=e[c];let h=1,b=null;for(const A of await this.splitText(u)){let w=a,g=0;if(b){const x=u.indexOf(A),S=u.indexOf(b)+this.lengthFunction(b);g=(u.slice(S,x).match(/\n/g)||[]).length,l&&(w+=o)}h+=g;const v=(A.match(/\n/g)||[]).length,T=s[c].loc&&typeof s[c].loc=="object"?{...s[c].loc}:{};T.lines={from:h,to:h+v};const C={...s[c],loc:T};w+=A,d.push(new Document({pageContent:w,metadata:C})),h+=v,b=A}}return d}async splitDocuments(e,t={}){const n=e.filter(o=>o.pageContent!==void 0),s=n.map(o=>o.pageContent),a=n.map(o=>o.metadata);return this.createDocuments(s,a,t)}joinDocs(e,t){const n=e.join(t).trim();return n===""?null:n}mergeSplits(e,t){const n=[],s=[];let a=0;for(const l of e){const d=this.lengthFunction(l);if(a+d+(s.length>0?t.length:0)>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const c=this.joinDocs(s,t);for(c!==null&&n.push(c);a>this.chunkOverlap||a+d>this.chunkSize&&a>0;)a-=this.lengthFunction(s[0]),s.shift()}s.push(l),a+=d}const o=this.joinDocs(s,t);return o!==null&&n.push(o),n}}class RecursiveCharacterTextSplitter extends TextSplitter{constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const n=[];let s=t[t.length-1],a;for(let c=0;c<t.length;c+=1){const u=t[c];if(u===""){s=u;break}if(e.includes(u)){s=u,a=t.slice(c+1);break}}const o=this.splitOnSeparator(e,s);let l=[];const d=this.keepSeparator?"":s;for(const c of o)if(this.lengthFunction(c)<this.chunkSize)l.push(c);else{if(l.length){const u=this.mergeSplits(l,d);n.push(...u),l=[]}if(!a)n.push(c);else{const u=await this._splitText(c,a);n.push(...u)}}if(l.length){const c=this.mergeSplits(l,d);n.push(...c)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new RecursiveCharacterTextSplitter({...t,separators:RecursiveCharacterTextSplitter.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}async function computeSHA1FromFile(r){const t=await(await fetch(r)).arrayBuffer(),n=await crypto.subtle.digest("SHA-1",t),a=Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromFile: ",a),a}async function computeSHA1FromContent(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-1",t),a=Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromContent: ",a),a}function toArray$2(r){return Array.isArray(r)?r:[r]}function getLines$1(r){let e,t,n,s=!1;return function(o){e===void 0?(e=o,t=0,n=-1):e=concat$1(e,o);const l=e.length;let d=0;for(;t<l;){s&&(e[t]===10&&(d=++t),s=!1);let c=-1;for(;t<l&&c===-1;++t)switch(e[t]){case 58:n===-1&&(n=t-d);break;case 13:s=!0;case 10:c=t;break}if(c===-1)break;r(e.subarray(d,c),n),d=t,n=-1}d===l?e=void 0:d!==0&&(e=e.subarray(d),t-=d)}}function getMessages$1(r,e,t){let n=newMessage$1();const s=new TextDecoder;return function(o,l){if(o.length===0)t==null||t(n),n=newMessage$1();else if(l>0){const d=s.decode(o.subarray(0,l)),c=l+(o[l+1]===32?2:1),u=s.decode(o.subarray(c));switch(d){case"data":n.data=n.data?n.data+`
`+u:u;break;case"event":n.event=u;break;case"id":r(n.id=u);break;case"retry":const h=parseInt(u,10);isNaN(h)||e(n.retry=h);break}}}}function concat$1(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function newMessage$1(){return{data:"",event:"",id:"",retry:void 0}}var HF_INFERENCE_API_BASE_URL="https://api-inference.huggingface.co/models/",TextGenerationStreamFinishReason=(r=>(r.Length="length",r.EndOfSequenceToken="eos_token",r.StopSequence="stop_sequence",r))(TextGenerationStreamFinishReason||{}),HfInference=class{constructor(r="",e={}){ze(this,"apiKey");ze(this,"defaultOptions");this.apiKey=r,this.defaultOptions=e}async fillMask(r,e){const t=await this.request(r,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.score=="number"&&typeof s.sequence=="string"&&typeof s.token=="number"&&typeof s.token_str=="string")))throw new TypeError("Invalid inference output: output must be of type Array<score: number, sequence:string, token:number, token_str:string>");return t}async summarization(r,e){const t=await this.request(r,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.summary_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<summary_text: string>");return t==null?void 0:t[0]}async questionAnswer(r,e){const t=await this.request(r,e);if(!(typeof t.answer=="string"&&typeof t.end=="number"&&typeof t.score=="number"&&typeof t.start=="number"))throw new TypeError("Invalid inference output: output must be of type <answer: string, end: number, score: number, start: number>");return t}async tableQuestionAnswer(r,e){const t=await this.request(r,e);if(!(typeof t.aggregator=="string"&&typeof t.answer=="string"&&Array.isArray(t.cells)&&t.cells.every(s=>typeof s=="string")&&Array.isArray(t.coordinates)&&t.coordinates.every(s=>Array.isArray(s)&&s.every(a=>typeof a=="number"))))throw new TypeError("Invalid inference output: output must be of type <aggregator: string, answer: string, cells: string[], coordinates: number[][]>");return t}async textClassification(r,e){var s;const t=(s=await this.request(r,e))==null?void 0:s[0];if(!(Array.isArray(t)&&t.every(a=>typeof a.label=="string"&&typeof a.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async textGeneration(r,e){const t=await this.request(r,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.generated_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<generated_text: string>");return t==null?void 0:t[0]}async*textGenerationStream(r,e){yield*this.streamingRequest(r,e)}async tokenClassification(r,e){const t=toArray$2(await this.request(r,e));if(!(Array.isArray(t)&&t.every(s=>typeof s.end=="number"&&typeof s.entity_group=="string"&&typeof s.score=="number"&&typeof s.start=="number"&&typeof s.word=="string")))throw new TypeError("Invalid inference output: output must be of type Array<end: number, entity_group: string, score: number, start: number, word: string>");return t}async translation(r,e){const t=await this.request(r,e);if(!(Array.isArray(t)&&t.every(s=>typeof s.translation_text=="string")))throw new TypeError("Invalid inference output: output must be of type Array<translation_text: string>");return t==null?void 0:t[0]}async zeroShotClassification(r,e){const t=toArray$2(await this.request(r,e));if(!(Array.isArray(t)&&t.every(s=>Array.isArray(s.labels)&&s.labels.every(a=>typeof a=="string")&&Array.isArray(s.scores)&&s.scores.every(a=>typeof a=="number")&&typeof s.sequence=="string")))throw new TypeError("Invalid inference output: output must be of type Array<labels: string[], scores: number[], sequence: string>");return t}async conversational(r,e){const t=await this.request(r,e);if(!(Array.isArray(t.conversation.generated_responses)&&t.conversation.generated_responses.every(s=>typeof s=="string")&&Array.isArray(t.conversation.past_user_inputs)&&t.conversation.past_user_inputs.every(s=>typeof s=="string")&&typeof t.generated_text=="string"&&Array.isArray(t.warnings)&&t.warnings.every(s=>typeof s=="string")))throw new TypeError("Invalid inference output: output must be of type <conversation: {generated_responses: string[], past_user_inputs: string[]}, generated_text: string, warnings: string[]>");return t}async featureExtraction(r,e){return await this.request(r,e)}async automaticSpeechRecognition(r,e){const t=await this.request(r,{...e,binary:!0});if(!(typeof t.text=="string"))throw new TypeError("Invalid inference output: output must be of type <text: string>");return t}async audioClassification(r,e){const t=await this.request(r,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async imageClassification(r,e){const t=await this.request(r,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, score: number>");return t}async objectDetection(r,e){const t=await this.request(r,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.score=="number"&&typeof s.box.xmin=="number"&&typeof s.box.ymin=="number"&&typeof s.box.xmax=="number"&&typeof s.box.ymax=="number")))throw new TypeError("Invalid inference output: output must be of type Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return t}async imageSegmentation(r,e){const t=await this.request(r,{...e,binary:!0});if(!(Array.isArray(t)&&t.every(s=>typeof s.label=="string"&&typeof s.mask=="string"&&typeof s.score=="number")))throw new TypeError("Invalid inference output: output must be of type Array<label: string, mask: string, score: number>");return t}async textToImage(r,e){const t=await this.request(r,{...e,blob:!0});if(!(t&&t instanceof Blob))throw new TypeError("Invalid inference output: output must be of type object & of instance Blob");return t}async imageToText(r,e){var t;return(t=await this.request(r,{...e,binary:!0}))==null?void 0:t[0]}makeRequestOptions(r,e){const t={...this.defaultOptions,...e},{model:n,...s}=r,a={};this.apiKey&&(a.Authorization=`Bearer ${this.apiKey}`),e!=null&&e.binary||(a["Content-Type"]="application/json"),e!=null&&e.binary&&(t.wait_for_model&&(a["X-Wait-For-Model"]="true"),t.use_cache===!1&&(a["X-Use-Cache"]="false"),t.dont_load_model&&(a["X-Load-Model"]="0"));const o=`${HF_INFERENCE_API_BASE_URL}${n}`,l={headers:a,method:"POST",body:e!=null&&e.binary?r.data:JSON.stringify({...s,options:t}),credentials:e!=null&&e.includeCredentials?"include":"same-origin"};return{url:o,info:l,mergedOptions:t}}async request(r,e){const{url:t,info:n,mergedOptions:s}=this.makeRequestOptions(r,e),a=await fetch(t,n);if(s.retry_on_error!==!1&&a.status===503&&!s.wait_for_model)return this.request(r,{...s,wait_for_model:!0});if(e!=null&&e.blob){if(!a.ok)throw new Error("An error occurred while fetching the blob");return await a.blob()}const o=await a.json();if(o.error)throw new Error(o.error);return o}async*streamingRequest(r,e){var u;const{url:t,info:n,mergedOptions:s}=this.makeRequestOptions({...r,stream:!0},e),a=await fetch(t,n);if(s.retry_on_error!==!1&&a.status===503&&!s.wait_for_model)return this.streamingRequest(r,{...s,wait_for_model:!0});if(!a.ok){if((u=a.headers.get("Content-Type"))!=null&&u.startsWith("application/json")){const h=await a.json();if(h.error)throw new Error(h.error)}throw new Error(`Server response contains error: ${a.status}`)}if(a.headers.get("content-type")!=="text/event-stream")throw new Error("Server does not support event stream content type, it returned "+a.headers.get("content-type"));if(!a.body)return;const o=a.body.getReader();let l=[];const c=getLines$1(getMessages$1(()=>{},()=>{},h=>{l.push(h)}));try{for(;;){const{done:h,value:b}=await o.read();if(h)return;c(b);for(const A of l)A.data.length>0&&(yield JSON.parse(A.data));l=[]}}finally{o.releaseLock()}}};const index=Object.freeze(Object.defineProperty({__proto__:null,HfInference,TextGenerationStreamFinishReason},Symbol.toStringTag,{value:"Module"}));class Embeddings{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new AsyncCaller$1(e??{})}}const isBrowser$1=()=>typeof window<"u"&&typeof window.document<"u",isWebWorker$1=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",isJsDom$1=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno$1=()=>typeof Deno<"u",isNode$1=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!isDeno$1(),getEnv$1=()=>{let r;return isBrowser$1()?r="browser":isNode$1()?r="node":isWebWorker$1()?r="webworker":isJsDom$1()?r="jsdom":isDeno$1()?r="deno":r="other",r};let runtimeEnvironment$1;async function getRuntimeEnvironment$1(){return runtimeEnvironment$1===void 0&&(runtimeEnvironment$1={library:"langchain-js",runtime:getEnv$1()}),runtimeEnvironment$1}function getEnvironmentVariable$1(r){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[r]:void 0}catch{return}}class HuggingFaceInferenceEmbeddings extends Embeddings{constructor(e){super(e??{}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=(e==null?void 0:e.model)??"sentence-transformers/distilbert-base-nli-mean-tokens",this.apiKey=(e==null?void 0:e.apiKey)??getEnvironmentVariable$1("HUGGINGFACEHUB_API_KEY"),this.client=new HfInference(this.apiKey)}async _embed(e){const t=e.map(n=>n.replace(/\n/g," "));return this.caller.call(()=>this.client.featureExtraction({model:this.model,inputs:t}))}embedQuery(e){return this._embed([e]).then(t=>t[0])}embedDocuments(e){return this._embed(e)}}const RUN_KEY="__run";class BaseMessage extends Serializable{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class HumanMessage extends BaseMessage{_getType(){return"human"}}class AIMessage extends BaseMessage{_getType(){return"ai"}}class SystemMessage extends BaseMessage{_getType(){return"system"}}class ChatMessage extends BaseMessage{constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}}class BasePromptValue extends Serializable{}class BaseRetriever{}class BaseCache{}class VectorStoreRetriever extends BaseRetriever{constructor(e){super(),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.filter=e.filter}async getRelevantDocuments(e){return await this.vectorStore.similaritySearch(e,this.k,this.filter)}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class VectorStore{constructor(e,t){Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,n=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)).map(a=>a[0])}async similaritySearchWithScore(e,t=4,n=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)}static fromTexts(e,t,n,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t){return new VectorStoreRetriever({vectorStore:this,k:e,filter:t})}}class SupabaseVectorStore extends VectorStore{constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter}async addDocuments(e,t){const n=e.map(({pageContent:s})=>s);return this.addVectors(await this.embeddings.embedDocuments(n),e,t)}async addVectors(e,t,n){const s=e.map((l,d)=>({content:t[d].pageContent,embedding:l,metadata:t[d].metadata})),a=500;let o=[];for(let l=0;l<s.length;l+=a){const d=s.slice(l,l+a).map(u=>n!=null&&n.ids?{id:n.ids[l],...u}:u),c=await this.client.from(this.tableName).upsert(d).select();if(c.error)throw new Error(`Error inserting: ${c.error.message} ${c.status} ${c.statusText}`);c.data&&(o=o.concat(c.data.map(u=>u.id)))}return o}async delete(e){const{ids:t}=e;for(const n of t)await this.client.from(this.tableName).delete().eq("id",n)}async similaritySearchVectorWithScore(e,t,n){if(n&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=n??this.filter??{},a={query_embedding:e};let o;if(typeof s=="function")o=h=>s(h).limit(t);else if(typeof s=="object")a.filter=s,a.match_count=t,o=h=>h;else throw new Error("invalid filter type");const l=this.client.rpc(this.queryName,a),{data:d,error:c}=await o(l);if(c)throw new Error(`Error searching for documents: ${c.code} ${c.message} ${c.details}`);return d.map(h=>[new Document({metadata:h.metadata,pageContent:h.content}),h.similarity])}static async fromTexts(e,t,n,s){const a=[];for(let o=0;o<e.length;o+=1){const l=Array.isArray(t)?t[o]:t,d=new Document({pageContent:e[o],metadata:l});a.push(d)}return SupabaseVectorStore.fromDocuments(a,n,s)}static async fromDocuments(e,t,n){const s=new this(t,n);return await s.addDocuments(e),s}static async fromExistingIndex(e,t){return new this(e,t)}}var dist={},api={},axios$4={exports:{}},bind$3=function(e,t){return function(){for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];return e.apply(t,s)}},bind$2=bind$3,toString$2=Object.prototype.toString;function isArray$2(r){return Array.isArray(r)}function isUndefined$2(r){return typeof r>"u"}function isBuffer$1(r){return r!==null&&!isUndefined$2(r)&&r.constructor!==null&&!isUndefined$2(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function isArrayBuffer$1(r){return toString$2.call(r)==="[object ArrayBuffer]"}function isFormData$2(r){return toString$2.call(r)==="[object FormData]"}function isArrayBufferView$1(r){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&isArrayBuffer$1(r.buffer),e}function isString$1(r){return typeof r=="string"}function isNumber$1(r){return typeof r=="number"}function isObject$3(r){return r!==null&&typeof r=="object"}function isPlainObject$1(r){if(toString$2.call(r)!=="[object Object]")return!1;var e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}function isDate$2(r){return toString$2.call(r)==="[object Date]"}function isFile$1(r){return toString$2.call(r)==="[object File]"}function isBlob$1(r){return toString$2.call(r)==="[object Blob]"}function isFunction$1(r){return toString$2.call(r)==="[object Function]"}function isStream$1(r){return isObject$3(r)&&isFunction$1(r.pipe)}function isURLSearchParams$2(r){return toString$2.call(r)==="[object URLSearchParams]"}function trim$1(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv$2(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function forEach$2(r,e){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),isArray$2(r))for(var t=0,n=r.length;t<n;t++)e.call(null,r[t],t,r);else for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.call(null,r[s],s,r)}function merge$2(){var r={};function e(s,a){isPlainObject$1(r[a])&&isPlainObject$1(s)?r[a]=merge$2(r[a],s):isPlainObject$1(s)?r[a]=merge$2({},s):isArray$2(s)?r[a]=s.slice():r[a]=s}for(var t=0,n=arguments.length;t<n;t++)forEach$2(arguments[t],e);return r}function extend$2(r,e,t){return forEach$2(e,function(s,a){t&&typeof s=="function"?r[a]=bind$2(s,t):r[a]=s}),r}function stripBOM$1(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var utils$a={isArray:isArray$2,isArrayBuffer:isArrayBuffer$1,isBuffer:isBuffer$1,isFormData:isFormData$2,isArrayBufferView:isArrayBufferView$1,isString:isString$1,isNumber:isNumber$1,isObject:isObject$3,isPlainObject:isPlainObject$1,isUndefined:isUndefined$2,isDate:isDate$2,isFile:isFile$1,isBlob:isBlob$1,isFunction:isFunction$1,isStream:isStream$1,isURLSearchParams:isURLSearchParams$2,isStandardBrowserEnv:isStandardBrowserEnv$2,forEach:forEach$2,merge:merge$2,extend:extend$2,trim:trim$1,stripBOM:stripBOM$1},utils$9=utils$a;function encode$3(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$3=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(utils$9.isURLSearchParams(t))s=t.toString();else{var a=[];utils$9.forEach(t,function(d,c){d===null||typeof d>"u"||(utils$9.isArray(d)?c=c+"[]":d=[d],utils$9.forEach(d,function(h){utils$9.isDate(h)?h=h.toISOString():utils$9.isObject(h)&&(h=JSON.stringify(h)),a.push(encode$3(c)+"="+encode$3(h))}))}),s=a.join("&")}if(s){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e},utils$8=utils$a;function InterceptorManager$3(){this.handlers=[]}InterceptorManager$3.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};InterceptorManager$3.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};InterceptorManager$3.prototype.forEach=function(e){utils$8.forEach(this.handlers,function(n){n!==null&&e(n)})};var InterceptorManager_1=InterceptorManager$3,utils$7=utils$a,normalizeHeaderName$1=function(e,t){utils$7.forEach(e,function(s,a){a!==t&&a.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[a])})},enhanceError$2=function(e,t,n,s,a){return e.config=t,n&&(e.code=n),e.request=s,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},createError$1,hasRequiredCreateError;function requireCreateError(){if(hasRequiredCreateError)return createError$1;hasRequiredCreateError=1;var r=enhanceError$2;return createError$1=function(t,n,s,a,o){var l=new Error(t);return r(l,n,s,a,o)},createError$1}var settle$2,hasRequiredSettle;function requireSettle(){if(hasRequiredSettle)return settle$2;hasRequiredSettle=1;var r=requireCreateError();return settle$2=function(t,n,s){var a=s.config.validateStatus;!s.status||!a||a(s.status)?t(s):n(r("Request failed with status code "+s.status,s.config,null,s.request,s))},settle$2}var cookies$1,hasRequiredCookies;function requireCookies(){if(hasRequiredCookies)return cookies$1;hasRequiredCookies=1;var r=utils$a;return cookies$1=r.isStandardBrowserEnv()?function(){return{write:function(n,s,a,o,l,d){var c=[];c.push(n+"="+encodeURIComponent(s)),r.isNumber(a)&&c.push("expires="+new Date(a).toGMTString()),r.isString(o)&&c.push("path="+o),r.isString(l)&&c.push("domain="+l),d===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(n){var s=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),cookies$1}var isAbsoluteURL$2,hasRequiredIsAbsoluteURL;function requireIsAbsoluteURL(){return hasRequiredIsAbsoluteURL||(hasRequiredIsAbsoluteURL=1,isAbsoluteURL$2=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),isAbsoluteURL$2}var combineURLs$2,hasRequiredCombineURLs;function requireCombineURLs(){return hasRequiredCombineURLs||(hasRequiredCombineURLs=1,combineURLs$2=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),combineURLs$2}var buildFullPath$2,hasRequiredBuildFullPath;function requireBuildFullPath(){if(hasRequiredBuildFullPath)return buildFullPath$2;hasRequiredBuildFullPath=1;var r=requireIsAbsoluteURL(),e=requireCombineURLs();return buildFullPath$2=function(n,s){return n&&!r(s)?e(n,s):s},buildFullPath$2}var parseHeaders$1,hasRequiredParseHeaders;function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders$1;hasRequiredParseHeaders=1;var r=utils$a,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders$1=function(n){var s={},a,o,l;return n&&r.forEach(n.split(`
`),function(c){if(l=c.indexOf(":"),a=r.trim(c.substr(0,l)).toLowerCase(),o=r.trim(c.substr(l+1)),a){if(s[a]&&e.indexOf(a)>=0)return;a==="set-cookie"?s[a]=(s[a]?s[a]:[]).concat([o]):s[a]=s[a]?s[a]+", "+o:o}}),s},parseHeaders$1}var isURLSameOrigin$1,hasRequiredIsURLSameOrigin;function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin$1;hasRequiredIsURLSameOrigin=1;var r=utils$a;return isURLSameOrigin$1=r.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),s;function a(o){var l=o;return t&&(n.setAttribute("href",l),l=n.href),n.setAttribute("href",l),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return s=a(window.location.href),function(l){var d=r.isString(l)?a(l):l;return d.protocol===s.protocol&&d.host===s.host}}():function(){return function(){return!0}}(),isURLSameOrigin$1}var Cancel_1,hasRequiredCancel;function requireCancel(){if(hasRequiredCancel)return Cancel_1;hasRequiredCancel=1;function r(e){this.message=e}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Cancel_1=r,Cancel_1}var xhr,hasRequiredXhr;function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var r=utils$a,e=requireSettle(),t=requireCookies(),n=buildURL$3,s=requireBuildFullPath(),a=requireParseHeaders(),o=requireIsURLSameOrigin(),l=requireCreateError(),d=transitional,c=requireCancel();return xhr=function(h){return new Promise(function(A,w){var g=h.data,v=h.headers,T=h.responseType,C;function x(){h.cancelToken&&h.cancelToken.unsubscribe(C),h.signal&&h.signal.removeEventListener("abort",C)}r.isFormData(g)&&delete v["Content-Type"];var S=new XMLHttpRequest;if(h.auth){var D=h.auth.username||"",m=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";v.Authorization="Basic "+btoa(D+":"+m)}var _=s(h.baseURL,h.url);S.open(h.method.toUpperCase(),n(_,h.params,h.paramsSerializer),!0),S.timeout=h.timeout;function f(){if(S){var p="getAllResponseHeaders"in S?a(S.getAllResponseHeaders()):null,k=!T||T==="text"||T==="json"?S.responseText:S.response,L={data:k,status:S.status,statusText:S.statusText,headers:p,config:h,request:S};e(function(N){A(N),x()},function(N){w(N),x()},L),S=null}}if("onloadend"in S?S.onloadend=f:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(f)},S.onabort=function(){S&&(w(l("Request aborted",h,"ECONNABORTED",S)),S=null)},S.onerror=function(){w(l("Network Error",h,null,S)),S=null},S.ontimeout=function(){var k=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded",L=h.transitional||d;h.timeoutErrorMessage&&(k=h.timeoutErrorMessage),w(l(k,h,L.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",S)),S=null},r.isStandardBrowserEnv()){var y=(h.withCredentials||o(_))&&h.xsrfCookieName?t.read(h.xsrfCookieName):void 0;y&&(v[h.xsrfHeaderName]=y)}"setRequestHeader"in S&&r.forEach(v,function(k,L){typeof g>"u"&&L.toLowerCase()==="content-type"?delete v[L]:S.setRequestHeader(L,k)}),r.isUndefined(h.withCredentials)||(S.withCredentials=!!h.withCredentials),T&&T!=="json"&&(S.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&S.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&S.upload&&S.upload.addEventListener("progress",h.onUploadProgress),(h.cancelToken||h.signal)&&(C=function(p){S&&(w(!p||p&&p.type?new c("canceled"):p),S.abort(),S=null)},h.cancelToken&&h.cancelToken.subscribe(C),h.signal&&(h.signal.aborted?C():h.signal.addEventListener("abort",C))),g||(g=null),S.send(g)})},xhr}var utils$6=utils$a,normalizeHeaderName=normalizeHeaderName$1,enhanceError$1=enhanceError$2,transitionalDefaults$1=transitional,DEFAULT_CONTENT_TYPE$1={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(r,e){!utils$6.isUndefined(r)&&utils$6.isUndefined(r["Content-Type"])&&(r["Content-Type"]=e)}function getDefaultAdapter(){var r;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(r=requireXhr()),r}function stringifySafely$1(r,e,t){if(utils$6.isString(r))try{return(e||JSON.parse)(r),utils$6.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var defaults$5={transitional:transitionalDefaults$1,adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$6.isFormData(e)||utils$6.isArrayBuffer(e)||utils$6.isBuffer(e)||utils$6.isStream(e)||utils$6.isFile(e)||utils$6.isBlob(e)?e:utils$6.isArrayBufferView(e)?e.buffer:utils$6.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils$6.isObject(e)||t&&t["Content-Type"]==="application/json"?(setContentTypeIfUnset(t,"application/json"),stringifySafely$1(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$5.transitional,n=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,a=!n&&this.responseType==="json";if(a||s&&utils$6.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?enhanceError$1(o,this,"E_JSON_PARSE"):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$6.forEach(["delete","get","head"],function(e){defaults$5.headers[e]={}});utils$6.forEach(["post","put","patch"],function(e){defaults$5.headers[e]=utils$6.merge(DEFAULT_CONTENT_TYPE$1)});var defaults_1=defaults$5,utils$5=utils$a,defaults$4=defaults_1,transformData$2=function(e,t,n){var s=this||defaults$4;return utils$5.forEach(n,function(o){e=o.call(s,e,t)}),e},isCancel$2,hasRequiredIsCancel;function requireIsCancel(){return hasRequiredIsCancel||(hasRequiredIsCancel=1,isCancel$2=function(e){return!!(e&&e.__CANCEL__)}),isCancel$2}var utils$4=utils$a,transformData$1=transformData$2,isCancel$1=requireIsCancel(),defaults$3=defaults_1,Cancel=requireCancel();function throwIfCancellationRequested$1(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Cancel("canceled")}var dispatchRequest$2=function(e){throwIfCancellationRequested$1(e),e.headers=e.headers||{},e.data=transformData$1.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$4.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$4.forEach(["delete","get","head","post","put","patch","common"],function(s){delete e.headers[s]});var t=e.adapter||defaults$3.adapter;return t(e).then(function(s){return throwIfCancellationRequested$1(e),s.data=transformData$1.call(e,s.data,s.headers,e.transformResponse),s},function(s){return isCancel$1(s)||(throwIfCancellationRequested$1(e),s&&s.response&&(s.response.data=transformData$1.call(e,s.response.data,s.response.headers,e.transformResponse))),Promise.reject(s)})},utils$3=utils$a,mergeConfig$3=function(e,t){t=t||{};var n={};function s(u,h){return utils$3.isPlainObject(u)&&utils$3.isPlainObject(h)?utils$3.merge(u,h):utils$3.isPlainObject(h)?utils$3.merge({},h):utils$3.isArray(h)?h.slice():h}function a(u){if(utils$3.isUndefined(t[u])){if(!utils$3.isUndefined(e[u]))return s(void 0,e[u])}else return s(e[u],t[u])}function o(u){if(!utils$3.isUndefined(t[u]))return s(void 0,t[u])}function l(u){if(utils$3.isUndefined(t[u])){if(!utils$3.isUndefined(e[u]))return s(void 0,e[u])}else return s(void 0,t[u])}function d(u){if(u in t)return s(e[u],t[u]);if(u in e)return s(void 0,e[u])}var c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:d};return utils$3.forEach(Object.keys(e).concat(Object.keys(t)),function(h){var b=c[h]||a,A=b(h);utils$3.isUndefined(A)&&b!==d||(n[h]=A)}),n},data,hasRequiredData;function requireData(){return hasRequiredData||(hasRequiredData=1,data={version:"0.26.1"}),data}var VERSION$1=requireData().version,validators$3={};["object","boolean","number","function","string","symbol"].forEach(function(r,e){validators$3[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var deprecatedWarnings$1={};validators$3.transitional=function(e,t,n){function s(a,o){return"[Axios v"+VERSION$1+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return function(a,o,l){if(e===!1)throw new Error(s(o," has been removed"+(t?" in "+t:"")));return t&&!deprecatedWarnings$1[o]&&(deprecatedWarnings$1[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,o,l):!0}};function assertOptions$1(r,e,t){if(typeof r!="object")throw new TypeError("options must be an object");for(var n=Object.keys(r),s=n.length;s-- >0;){var a=n[s],o=e[a];if(o){var l=r[a],d=l===void 0||o(l,a,r);if(d!==!0)throw new TypeError("option "+a+" must be "+d);continue}if(t!==!0)throw Error("Unknown option "+a)}}var validator$2={assertOptions:assertOptions$1,validators:validators$3},utils$2=utils$a,buildURL$2=buildURL$3,InterceptorManager$2=InterceptorManager_1,dispatchRequest$1=dispatchRequest$2,mergeConfig$2=mergeConfig$3,validator$1=validator$2,validators$2=validator$1.validators;function Axios$3(r){this.defaults=r,this.interceptors={request:new InterceptorManager$2,response:new InterceptorManager$2}}Axios$3.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=mergeConfig$2(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&validator$1.assertOptions(n,{silentJSONParsing:validators$2.transitional(validators$2.boolean),forcedJSONParsing:validators$2.transitional(validators$2.boolean),clarifyTimeoutError:validators$2.transitional(validators$2.boolean)},!1);var s=[],a=!0;this.interceptors.request.forEach(function(A){typeof A.runWhen=="function"&&A.runWhen(t)===!1||(a=a&&A.synchronous,s.unshift(A.fulfilled,A.rejected))});var o=[];this.interceptors.response.forEach(function(A){o.push(A.fulfilled,A.rejected)});var l;if(!a){var d=[dispatchRequest$1,void 0];for(Array.prototype.unshift.apply(d,s),d=d.concat(o),l=Promise.resolve(t);d.length;)l=l.then(d.shift(),d.shift());return l}for(var c=t;s.length;){var u=s.shift(),h=s.shift();try{c=u(c)}catch(b){h(b);break}}try{l=dispatchRequest$1(c)}catch(b){return Promise.reject(b)}for(;o.length;)l=l.then(o.shift(),o.shift());return l};Axios$3.prototype.getUri=function(e){return e=mergeConfig$2(this.defaults,e),buildURL$2(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};utils$2.forEach(["delete","get","head","options"],function(e){Axios$3.prototype[e]=function(t,n){return this.request(mergeConfig$2(n||{},{method:e,url:t,data:(n||{}).data}))}});utils$2.forEach(["post","put","patch"],function(e){Axios$3.prototype[e]=function(t,n,s){return this.request(mergeConfig$2(s||{},{method:e,url:t,data:n}))}});var Axios_1=Axios$3,CancelToken_1,hasRequiredCancelToken;function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var r=requireCancel();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(o){n=o});var s=this;this.promise.then(function(a){if(s._listeners){var o,l=s._listeners.length;for(o=0;o<l;o++)s._listeners[o](a);s._listeners=null}}),this.promise.then=function(a){var o,l=new Promise(function(d){s.subscribe(d),o=d}).then(a);return l.cancel=function(){s.unsubscribe(o)},l},t(function(o){s.reason||(s.reason=new r(o),n(s.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]},e.prototype.unsubscribe=function(n){if(this._listeners){var s=this._listeners.indexOf(n);s!==-1&&this._listeners.splice(s,1)}},e.source=function(){var n,s=new e(function(o){n=o});return{token:s,cancel:n}},CancelToken_1=e,CancelToken_1}var spread$1,hasRequiredSpread;function requireSpread(){return hasRequiredSpread||(hasRequiredSpread=1,spread$1=function(e){return function(n){return e.apply(null,n)}}),spread$1}var isAxiosError$1,hasRequiredIsAxiosError;function requireIsAxiosError(){if(hasRequiredIsAxiosError)return isAxiosError$1;hasRequiredIsAxiosError=1;var r=utils$a;return isAxiosError$1=function(t){return r.isObject(t)&&t.isAxiosError===!0},isAxiosError$1}var utils$1=utils$a,bind$1=bind$3,Axios$2=Axios_1,mergeConfig$1=mergeConfig$3,defaults$2=defaults_1;function createInstance$1(r){var e=new Axios$2(r),t=bind$1(Axios$2.prototype.request,e);return utils$1.extend(t,Axios$2.prototype,e),utils$1.extend(t,e),t.create=function(s){return createInstance$1(mergeConfig$1(r,s))},t}var axios$3=createInstance$1(defaults$2);axios$3.Axios=Axios$2;axios$3.Cancel=requireCancel();axios$3.CancelToken=requireCancelToken();axios$3.isCancel=requireIsCancel();axios$3.VERSION=requireData().version;axios$3.all=function(e){return Promise.all(e)};axios$3.spread=requireSpread();axios$3.isAxiosError=requireIsAxiosError();axios$4.exports=axios$3;axios$4.exports.default=axios$3;var axiosExports=axios$4.exports,axios$2=axiosExports,common$1={},base={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RequiredError=r.BaseAPI=r.COLLECTION_FORMATS=r.BASE_PATH=void 0;const e=axios$2;r.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),r.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"	",pipes:"|"};class t{constructor(a,o=r.BASE_PATH,l=e.default){this.basePath=o,this.axios=l,a&&(this.configuration=a,this.basePath=a.basePath||this.basePath)}}r.BaseAPI=t;class n extends Error{constructor(a,o){super(o),this.field=a,this.name="RequiredError"}}r.RequiredError=n})(base);var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,e,t,n){function s(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(u){try{c(n.next(u))}catch(h){o(h)}}function d(u){try{c(n.throw(u))}catch(h){o(h)}}function c(u){u.done?a(u.value):s(u.value).then(l,d)}c((n=n.apply(r,e||[])).next())})};Object.defineProperty(common$1,"__esModule",{value:!0});common$1.createRequestFunction=common$1.toPathString=common$1.serializeDataIfNeeded=common$1.setSearchParams=common$1.setOAuthToObject=common$1.setBearerAuthToObject=common$1.setBasicAuthToObject=common$1.setApiKeyToObject=common$1.assertParamExists=common$1.DUMMY_BASE_URL=void 0;const base_1=base;common$1.DUMMY_BASE_URL="https://example.com";common$1.assertParamExists=function(r,e,t){if(t==null)throw new base_1.RequiredError(e,`Required parameter ${e} was null or undefined when calling ${r}.`)};common$1.setApiKeyToObject=function(r,e,t){return __awaiter(this,void 0,void 0,function*(){if(t&&t.apiKey){const n=typeof t.apiKey=="function"?yield t.apiKey(e):yield t.apiKey;r[e]=n}})};common$1.setBasicAuthToObject=function(r,e){e&&(e.username||e.password)&&(r.auth={username:e.username,password:e.password})};common$1.setBearerAuthToObject=function(r,e){return __awaiter(this,void 0,void 0,function*(){if(e&&e.accessToken){const t=typeof e.accessToken=="function"?yield e.accessToken():yield e.accessToken;r.Authorization="Bearer "+t}})};common$1.setOAuthToObject=function(r,e,t,n){return __awaiter(this,void 0,void 0,function*(){if(n&&n.accessToken){const s=typeof n.accessToken=="function"?yield n.accessToken(e,t):yield n.accessToken;r.Authorization="Bearer "+s}})};function setFlattenedQueryParams(r,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(n=>setFlattenedQueryParams(r,n,t)):Object.keys(e).forEach(n=>setFlattenedQueryParams(r,e[n],`${t}${t!==""?".":""}${n}`)):r.has(t)?r.append(t,e):r.set(t,e))}common$1.setSearchParams=function(r,...e){const t=new URLSearchParams(r.search);setFlattenedQueryParams(t,e),r.search=t.toString()};common$1.serializeDataIfNeeded=function(r,e,t){const n=typeof r!="string";return(n&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):n)?JSON.stringify(r!==void 0?r:{}):r||""};common$1.toPathString=function(r){return r.pathname+r.search+r.hash};common$1.createRequestFunction=function(r,e,t,n){return(s=e,a=t)=>{const o=Object.assign(Object.assign({},r.options),{url:((n==null?void 0:n.basePath)||a)+r.url});return s.request(o)}};(function(r){var e=commonjsGlobal&&commonjsGlobal.__awaiter||function(o,l,d,c){function u(h){return h instanceof d?h:new d(function(b){b(h)})}return new(d||(d=Promise))(function(h,b){function A(v){try{g(c.next(v))}catch(T){b(T)}}function w(v){try{g(c.throw(v))}catch(T){b(T)}}function g(v){v.done?h(v.value):u(v.value).then(A,w)}g((c=c.apply(o,l||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.OpenAIApi=r.OpenAIApiFactory=r.OpenAIApiFp=r.OpenAIApiAxiosParamCreator=r.CreateImageRequestResponseFormatEnum=r.CreateImageRequestSizeEnum=r.ChatCompletionResponseMessageRoleEnum=r.ChatCompletionRequestMessageRoleEnum=void 0;const t=axios$2,n=common$1,s=base;r.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},r.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},r.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},r.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},r.OpenAIApiAxiosParamCreator=function(o){return{cancelFineTune:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("cancelFineTune","fineTuneId",l);const c="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),createAnswer:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createAnswer","createAnswerRequest",l);const c="/answers",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createChatCompletion:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createChatCompletion","createChatCompletionRequest",l);const c="/chat/completions",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createClassification:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createClassification","createClassificationRequest",l);const c="/classifications",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createCompletion:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createCompletion","createCompletionRequest",l);const c="/completions",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createEdit:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createEdit","createEditRequest",l);const c="/edits",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createEmbedding:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createEmbedding","createEmbeddingRequest",l);const c="/embeddings",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createFile:(l,d,c={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createFile","file",l),n.assertParamExists("createFile","purpose",d);const u="/files",h=new URL(u,n.DUMMY_BASE_URL);let b;o&&(b=o.baseOptions);const A=Object.assign(Object.assign({method:"POST"},b),c),w={},g={},v=new(o&&o.formDataCtor||FormData);l!==void 0&&v.append("file",l),d!==void 0&&v.append("purpose",d),w["Content-Type"]="multipart/form-data",n.setSearchParams(h,g);let T=b&&b.headers?b.headers:{};return A.headers=Object.assign(Object.assign(Object.assign(Object.assign({},w),v.getHeaders()),T),c.headers),A.data=v,{url:n.toPathString(h),options:A}}),createFineTune:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createFineTune","createFineTuneRequest",l);const c="/fine-tunes",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createImage:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createImage","createImageRequest",l);const c="/images/generations",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createImageEdit:(l,d,c,u,h,b,A,w={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createImageEdit","image",l),n.assertParamExists("createImageEdit","prompt",d);const g="/images/edits",v=new URL(g,n.DUMMY_BASE_URL);let T;o&&(T=o.baseOptions);const C=Object.assign(Object.assign({method:"POST"},T),w),x={},S={},D=new(o&&o.formDataCtor||FormData);l!==void 0&&D.append("image",l),c!==void 0&&D.append("mask",c),d!==void 0&&D.append("prompt",d),u!==void 0&&D.append("n",u),h!==void 0&&D.append("size",h),b!==void 0&&D.append("response_format",b),A!==void 0&&D.append("user",A),x["Content-Type"]="multipart/form-data",n.setSearchParams(v,S);let m=T&&T.headers?T.headers:{};return C.headers=Object.assign(Object.assign(Object.assign(Object.assign({},x),D.getHeaders()),m),w.headers),C.data=D,{url:n.toPathString(v),options:C}}),createImageVariation:(l,d,c,u,h,b={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createImageVariation","image",l);const A="/images/variations",w=new URL(A,n.DUMMY_BASE_URL);let g;o&&(g=o.baseOptions);const v=Object.assign(Object.assign({method:"POST"},g),b),T={},C={},x=new(o&&o.formDataCtor||FormData);l!==void 0&&x.append("image",l),d!==void 0&&x.append("n",d),c!==void 0&&x.append("size",c),u!==void 0&&x.append("response_format",u),h!==void 0&&x.append("user",h),T["Content-Type"]="multipart/form-data",n.setSearchParams(w,C);let S=g&&g.headers?g.headers:{};return v.headers=Object.assign(Object.assign(Object.assign(Object.assign({},T),x.getHeaders()),S),b.headers),v.data=x,{url:n.toPathString(w),options:v}}),createModeration:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createModeration","createModerationRequest",l);const c="/moderations",u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"POST"},h),d),A={},w={};A["Content-Type"]="application/json",n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),b.data=n.serializeDataIfNeeded(l,b,o),{url:n.toPathString(u),options:b}}),createSearch:(l,d,c={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createSearch","engineId",l),n.assertParamExists("createSearch","createSearchRequest",d);const u="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(l))),h=new URL(u,n.DUMMY_BASE_URL);let b;o&&(b=o.baseOptions);const A=Object.assign(Object.assign({method:"POST"},b),c),w={},g={};w["Content-Type"]="application/json",n.setSearchParams(h,g);let v=b&&b.headers?b.headers:{};return A.headers=Object.assign(Object.assign(Object.assign({},w),v),c.headers),A.data=n.serializeDataIfNeeded(d,A,o),{url:n.toPathString(h),options:A}}),createTranscription:(l,d,c,u,h,b,A={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createTranscription","file",l),n.assertParamExists("createTranscription","model",d);const w="/audio/transcriptions",g=new URL(w,n.DUMMY_BASE_URL);let v;o&&(v=o.baseOptions);const T=Object.assign(Object.assign({method:"POST"},v),A),C={},x={},S=new(o&&o.formDataCtor||FormData);l!==void 0&&S.append("file",l),d!==void 0&&S.append("model",d),c!==void 0&&S.append("prompt",c),u!==void 0&&S.append("response_format",u),h!==void 0&&S.append("temperature",h),b!==void 0&&S.append("language",b),C["Content-Type"]="multipart/form-data",n.setSearchParams(g,x);let D=v&&v.headers?v.headers:{};return T.headers=Object.assign(Object.assign(Object.assign(Object.assign({},C),S.getHeaders()),D),A.headers),T.data=S,{url:n.toPathString(g),options:T}}),createTranslation:(l,d,c,u,h,b={})=>e(this,void 0,void 0,function*(){n.assertParamExists("createTranslation","file",l),n.assertParamExists("createTranslation","model",d);const A="/audio/translations",w=new URL(A,n.DUMMY_BASE_URL);let g;o&&(g=o.baseOptions);const v=Object.assign(Object.assign({method:"POST"},g),b),T={},C={},x=new(o&&o.formDataCtor||FormData);l!==void 0&&x.append("file",l),d!==void 0&&x.append("model",d),c!==void 0&&x.append("prompt",c),u!==void 0&&x.append("response_format",u),h!==void 0&&x.append("temperature",h),T["Content-Type"]="multipart/form-data",n.setSearchParams(w,C);let S=g&&g.headers?g.headers:{};return v.headers=Object.assign(Object.assign(Object.assign(Object.assign({},T),x.getHeaders()),S),b.headers),v.data=x,{url:n.toPathString(w),options:v}}),deleteFile:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("deleteFile","fileId",l);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"DELETE"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),deleteModel:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("deleteModel","model",l);const c="/models/{model}".replace("{model}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"DELETE"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),downloadFile:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("downloadFile","fileId",l);const c="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),listEngines:(l={})=>e(this,void 0,void 0,function*(){const d="/engines",c=new URL(d,n.DUMMY_BASE_URL);let u;o&&(u=o.baseOptions);const h=Object.assign(Object.assign({method:"GET"},u),l),b={},A={};n.setSearchParams(c,A);let w=u&&u.headers?u.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),w),l.headers),{url:n.toPathString(c),options:h}}),listFiles:(l={})=>e(this,void 0,void 0,function*(){const d="/files",c=new URL(d,n.DUMMY_BASE_URL);let u;o&&(u=o.baseOptions);const h=Object.assign(Object.assign({method:"GET"},u),l),b={},A={};n.setSearchParams(c,A);let w=u&&u.headers?u.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),w),l.headers),{url:n.toPathString(c),options:h}}),listFineTuneEvents:(l,d,c={})=>e(this,void 0,void 0,function*(){n.assertParamExists("listFineTuneEvents","fineTuneId",l);const u="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(l))),h=new URL(u,n.DUMMY_BASE_URL);let b;o&&(b=o.baseOptions);const A=Object.assign(Object.assign({method:"GET"},b),c),w={},g={};d!==void 0&&(g.stream=d),n.setSearchParams(h,g);let v=b&&b.headers?b.headers:{};return A.headers=Object.assign(Object.assign(Object.assign({},w),v),c.headers),{url:n.toPathString(h),options:A}}),listFineTunes:(l={})=>e(this,void 0,void 0,function*(){const d="/fine-tunes",c=new URL(d,n.DUMMY_BASE_URL);let u;o&&(u=o.baseOptions);const h=Object.assign(Object.assign({method:"GET"},u),l),b={},A={};n.setSearchParams(c,A);let w=u&&u.headers?u.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),w),l.headers),{url:n.toPathString(c),options:h}}),listModels:(l={})=>e(this,void 0,void 0,function*(){const d="/models",c=new URL(d,n.DUMMY_BASE_URL);let u;o&&(u=o.baseOptions);const h=Object.assign(Object.assign({method:"GET"},u),l),b={},A={};n.setSearchParams(c,A);let w=u&&u.headers?u.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},b),w),l.headers),{url:n.toPathString(c),options:h}}),retrieveEngine:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("retrieveEngine","engineId",l);const c="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),retrieveFile:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("retrieveFile","fileId",l);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),retrieveFineTune:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("retrieveFineTune","fineTuneId",l);const c="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}}),retrieveModel:(l,d={})=>e(this,void 0,void 0,function*(){n.assertParamExists("retrieveModel","model",l);const c="/models/{model}".replace("{model}",encodeURIComponent(String(l))),u=new URL(c,n.DUMMY_BASE_URL);let h;o&&(h=o.baseOptions);const b=Object.assign(Object.assign({method:"GET"},h),d),A={},w={};n.setSearchParams(u,w);let g=h&&h.headers?h.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},A),g),d.headers),{url:n.toPathString(u),options:b}})}},r.OpenAIApiFp=function(o){const l=r.OpenAIApiAxiosParamCreator(o);return{cancelFineTune(d,c){return e(this,void 0,void 0,function*(){const u=yield l.cancelFineTune(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createAnswer(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createAnswer(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createChatCompletion(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createChatCompletion(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createClassification(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createClassification(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createCompletion(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createCompletion(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createEdit(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createEdit(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createEmbedding(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createEmbedding(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createFile(d,c,u){return e(this,void 0,void 0,function*(){const h=yield l.createFile(d,c,u);return n.createRequestFunction(h,t.default,s.BASE_PATH,o)})},createFineTune(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createFineTune(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createImage(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createImage(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createImageEdit(d,c,u,h,b,A,w,g){return e(this,void 0,void 0,function*(){const v=yield l.createImageEdit(d,c,u,h,b,A,w,g);return n.createRequestFunction(v,t.default,s.BASE_PATH,o)})},createImageVariation(d,c,u,h,b,A){return e(this,void 0,void 0,function*(){const w=yield l.createImageVariation(d,c,u,h,b,A);return n.createRequestFunction(w,t.default,s.BASE_PATH,o)})},createModeration(d,c){return e(this,void 0,void 0,function*(){const u=yield l.createModeration(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},createSearch(d,c,u){return e(this,void 0,void 0,function*(){const h=yield l.createSearch(d,c,u);return n.createRequestFunction(h,t.default,s.BASE_PATH,o)})},createTranscription(d,c,u,h,b,A,w){return e(this,void 0,void 0,function*(){const g=yield l.createTranscription(d,c,u,h,b,A,w);return n.createRequestFunction(g,t.default,s.BASE_PATH,o)})},createTranslation(d,c,u,h,b,A){return e(this,void 0,void 0,function*(){const w=yield l.createTranslation(d,c,u,h,b,A);return n.createRequestFunction(w,t.default,s.BASE_PATH,o)})},deleteFile(d,c){return e(this,void 0,void 0,function*(){const u=yield l.deleteFile(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},deleteModel(d,c){return e(this,void 0,void 0,function*(){const u=yield l.deleteModel(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},downloadFile(d,c){return e(this,void 0,void 0,function*(){const u=yield l.downloadFile(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},listEngines(d){return e(this,void 0,void 0,function*(){const c=yield l.listEngines(d);return n.createRequestFunction(c,t.default,s.BASE_PATH,o)})},listFiles(d){return e(this,void 0,void 0,function*(){const c=yield l.listFiles(d);return n.createRequestFunction(c,t.default,s.BASE_PATH,o)})},listFineTuneEvents(d,c,u){return e(this,void 0,void 0,function*(){const h=yield l.listFineTuneEvents(d,c,u);return n.createRequestFunction(h,t.default,s.BASE_PATH,o)})},listFineTunes(d){return e(this,void 0,void 0,function*(){const c=yield l.listFineTunes(d);return n.createRequestFunction(c,t.default,s.BASE_PATH,o)})},listModels(d){return e(this,void 0,void 0,function*(){const c=yield l.listModels(d);return n.createRequestFunction(c,t.default,s.BASE_PATH,o)})},retrieveEngine(d,c){return e(this,void 0,void 0,function*(){const u=yield l.retrieveEngine(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},retrieveFile(d,c){return e(this,void 0,void 0,function*(){const u=yield l.retrieveFile(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},retrieveFineTune(d,c){return e(this,void 0,void 0,function*(){const u=yield l.retrieveFineTune(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})},retrieveModel(d,c){return e(this,void 0,void 0,function*(){const u=yield l.retrieveModel(d,c);return n.createRequestFunction(u,t.default,s.BASE_PATH,o)})}}},r.OpenAIApiFactory=function(o,l,d){const c=r.OpenAIApiFp(o);return{cancelFineTune(u,h){return c.cancelFineTune(u,h).then(b=>b(d,l))},createAnswer(u,h){return c.createAnswer(u,h).then(b=>b(d,l))},createChatCompletion(u,h){return c.createChatCompletion(u,h).then(b=>b(d,l))},createClassification(u,h){return c.createClassification(u,h).then(b=>b(d,l))},createCompletion(u,h){return c.createCompletion(u,h).then(b=>b(d,l))},createEdit(u,h){return c.createEdit(u,h).then(b=>b(d,l))},createEmbedding(u,h){return c.createEmbedding(u,h).then(b=>b(d,l))},createFile(u,h,b){return c.createFile(u,h,b).then(A=>A(d,l))},createFineTune(u,h){return c.createFineTune(u,h).then(b=>b(d,l))},createImage(u,h){return c.createImage(u,h).then(b=>b(d,l))},createImageEdit(u,h,b,A,w,g,v,T){return c.createImageEdit(u,h,b,A,w,g,v,T).then(C=>C(d,l))},createImageVariation(u,h,b,A,w,g){return c.createImageVariation(u,h,b,A,w,g).then(v=>v(d,l))},createModeration(u,h){return c.createModeration(u,h).then(b=>b(d,l))},createSearch(u,h,b){return c.createSearch(u,h,b).then(A=>A(d,l))},createTranscription(u,h,b,A,w,g,v){return c.createTranscription(u,h,b,A,w,g,v).then(T=>T(d,l))},createTranslation(u,h,b,A,w,g){return c.createTranslation(u,h,b,A,w,g).then(v=>v(d,l))},deleteFile(u,h){return c.deleteFile(u,h).then(b=>b(d,l))},deleteModel(u,h){return c.deleteModel(u,h).then(b=>b(d,l))},downloadFile(u,h){return c.downloadFile(u,h).then(b=>b(d,l))},listEngines(u){return c.listEngines(u).then(h=>h(d,l))},listFiles(u){return c.listFiles(u).then(h=>h(d,l))},listFineTuneEvents(u,h,b){return c.listFineTuneEvents(u,h,b).then(A=>A(d,l))},listFineTunes(u){return c.listFineTunes(u).then(h=>h(d,l))},listModels(u){return c.listModels(u).then(h=>h(d,l))},retrieveEngine(u,h){return c.retrieveEngine(u,h).then(b=>b(d,l))},retrieveFile(u,h){return c.retrieveFile(u,h).then(b=>b(d,l))},retrieveFineTune(u,h){return c.retrieveFineTune(u,h).then(b=>b(d,l))},retrieveModel(u,h){return c.retrieveModel(u,h).then(b=>b(d,l))}}};class a extends s.BaseAPI{cancelFineTune(l,d){return r.OpenAIApiFp(this.configuration).cancelFineTune(l,d).then(c=>c(this.axios,this.basePath))}createAnswer(l,d){return r.OpenAIApiFp(this.configuration).createAnswer(l,d).then(c=>c(this.axios,this.basePath))}createChatCompletion(l,d){return r.OpenAIApiFp(this.configuration).createChatCompletion(l,d).then(c=>c(this.axios,this.basePath))}createClassification(l,d){return r.OpenAIApiFp(this.configuration).createClassification(l,d).then(c=>c(this.axios,this.basePath))}createCompletion(l,d){return r.OpenAIApiFp(this.configuration).createCompletion(l,d).then(c=>c(this.axios,this.basePath))}createEdit(l,d){return r.OpenAIApiFp(this.configuration).createEdit(l,d).then(c=>c(this.axios,this.basePath))}createEmbedding(l,d){return r.OpenAIApiFp(this.configuration).createEmbedding(l,d).then(c=>c(this.axios,this.basePath))}createFile(l,d,c){return r.OpenAIApiFp(this.configuration).createFile(l,d,c).then(u=>u(this.axios,this.basePath))}createFineTune(l,d){return r.OpenAIApiFp(this.configuration).createFineTune(l,d).then(c=>c(this.axios,this.basePath))}createImage(l,d){return r.OpenAIApiFp(this.configuration).createImage(l,d).then(c=>c(this.axios,this.basePath))}createImageEdit(l,d,c,u,h,b,A,w){return r.OpenAIApiFp(this.configuration).createImageEdit(l,d,c,u,h,b,A,w).then(g=>g(this.axios,this.basePath))}createImageVariation(l,d,c,u,h,b){return r.OpenAIApiFp(this.configuration).createImageVariation(l,d,c,u,h,b).then(A=>A(this.axios,this.basePath))}createModeration(l,d){return r.OpenAIApiFp(this.configuration).createModeration(l,d).then(c=>c(this.axios,this.basePath))}createSearch(l,d,c){return r.OpenAIApiFp(this.configuration).createSearch(l,d,c).then(u=>u(this.axios,this.basePath))}createTranscription(l,d,c,u,h,b,A){return r.OpenAIApiFp(this.configuration).createTranscription(l,d,c,u,h,b,A).then(w=>w(this.axios,this.basePath))}createTranslation(l,d,c,u,h,b){return r.OpenAIApiFp(this.configuration).createTranslation(l,d,c,u,h,b).then(A=>A(this.axios,this.basePath))}deleteFile(l,d){return r.OpenAIApiFp(this.configuration).deleteFile(l,d).then(c=>c(this.axios,this.basePath))}deleteModel(l,d){return r.OpenAIApiFp(this.configuration).deleteModel(l,d).then(c=>c(this.axios,this.basePath))}downloadFile(l,d){return r.OpenAIApiFp(this.configuration).downloadFile(l,d).then(c=>c(this.axios,this.basePath))}listEngines(l){return r.OpenAIApiFp(this.configuration).listEngines(l).then(d=>d(this.axios,this.basePath))}listFiles(l){return r.OpenAIApiFp(this.configuration).listFiles(l).then(d=>d(this.axios,this.basePath))}listFineTuneEvents(l,d,c){return r.OpenAIApiFp(this.configuration).listFineTuneEvents(l,d,c).then(u=>u(this.axios,this.basePath))}listFineTunes(l){return r.OpenAIApiFp(this.configuration).listFineTunes(l).then(d=>d(this.axios,this.basePath))}listModels(l){return r.OpenAIApiFp(this.configuration).listModels(l).then(d=>d(this.axios,this.basePath))}retrieveEngine(l,d){return r.OpenAIApiFp(this.configuration).retrieveEngine(l,d).then(c=>c(this.axios,this.basePath))}retrieveFile(l,d){return r.OpenAIApiFp(this.configuration).retrieveFile(l,d).then(c=>c(this.axios,this.basePath))}retrieveFineTune(l,d){return r.OpenAIApiFp(this.configuration).retrieveFineTune(l,d).then(c=>c(this.axios,this.basePath))}retrieveModel(l,d){return r.OpenAIApiFp(this.configuration).retrieveModel(l,d).then(c=>c(this.axios,this.basePath))}}r.OpenAIApi=a})(api);var configuration={};const name="openai",version="3.3.0",description="Node.js library for the OpenAI API",repository={type:"git",url:"git@github.com:openai/openai-node.git"},keywords=["openai","open","ai","gpt-3","gpt3"],author="OpenAI",license="MIT",main="./dist/index.js",types="./dist/index.d.ts",scripts={build:"tsc --outDir dist/"},dependencies={axios:"^0.26.0","form-data":"^4.0.0"},devDependencies={"@types/node":"^12.11.5",typescript:"^3.6.4"},require$$0$1={name,version,description,repository,keywords,author,license,main,types,scripts,dependencies,devDependencies};var browser,hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,browser=typeof self=="object"?self.FormData:window.FormData),browser}Object.defineProperty(configuration,"__esModule",{value:!0});configuration.Configuration=void 0;const packageJson=require$$0$1;class Configuration{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${packageJson.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=requireBrowser())}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}configuration.Configuration=Configuration;(function(r){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(n,s,a,o){o===void 0&&(o=a),Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[a]}})}:function(n,s,a,o){o===void 0&&(o=a),n[o]=s[a]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(n,s){for(var a in n)a!=="default"&&!s.hasOwnProperty(a)&&e(s,n,a)};Object.defineProperty(r,"__esModule",{value:!0}),t(api,r),t(configuration,r)})(dist);function bind(r,e){return function(){return r.apply(e,arguments)}}const{toString:toString$1}=Object.prototype,{getPrototypeOf}=Object,kindOf=(r=>e=>{const t=toString$1.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=r=>(r=r.toLowerCase(),e=>kindOf(e)===r),typeOfTest=r=>e=>typeof e===r,{isArray:isArray$1}=Array,isUndefined$1=typeOfTest("undefined");function isBuffer(r){return r!==null&&!isUndefined$1(r)&&r.constructor!==null&&!isUndefined$1(r.constructor)&&isFunction(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&isArrayBuffer(r.buffer),e}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject$2=r=>r!==null&&typeof r=="object",isBoolean$1=r=>r===!0||r===!1,isPlainObject=r=>{if(kindOf(r)!=="object")return!1;const e=getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},isDate$1=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=r=>isObject$2(r)&&isFunction(r.pipe),isFormData$1=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||isFunction(r.append)&&((e=kindOf(r))==="formdata"||e==="object"&&isFunction(r.toString)&&r.toString()==="[object FormData]"))},isURLSearchParams$1=kindOfTest("URLSearchParams"),trim=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach$1(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),isArray$1(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{const a=t?Object.getOwnPropertyNames(r):Object.keys(r),o=a.length;let l;for(n=0;n<o;n++)l=a[n],e.call(null,r[l],l,r)}}function findKey(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,s;for(;n-- >0;)if(s=t[n],e===s.toLowerCase())return s;return null}const _global=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),isContextDefined=r=>!isUndefined$1(r)&&r!==_global;function merge$1(){const{caseless:r}=isContextDefined(this)&&this||{},e={},t=(n,s)=>{const a=r&&findKey(e,s)||s;isPlainObject(e[a])&&isPlainObject(n)?e[a]=merge$1(e[a],n):isPlainObject(n)?e[a]=merge$1({},n):isArray$1(n)?e[a]=n.slice():e[a]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&forEach$1(arguments[n],t);return e}const extend$1=(r,e,t,{allOwnKeys:n}={})=>(forEach$1(e,(s,a)=>{t&&isFunction(s)?r[a]=bind(s,t):r[a]=s},{allOwnKeys:n}),r),stripBOM=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),inherits=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},toFlatObject=(r,e,t,n)=>{let s,a,o;const l={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),a=s.length;a-- >0;)o=s[a],(!n||n(o,r,e))&&!l[o]&&(e[o]=r[o],l[o]=!0);r=t!==!1&&getPrototypeOf(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},endsWith=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},toArray$1=r=>{if(!r)return null;if(isArray$1(r))return r;let e=r.length;if(!isNumber(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},isTypedArray=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let s;for(;(s=n.next())&&!s.done;){const a=s.value;e.call(r,a[0],a[1])}},matchAll=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,s){return n.toUpperCase()+s}),hasOwnProperty=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};forEach$1(t,(s,a)=>{e(s,a,r)!==!1&&(n[a]=s)}),Object.defineProperties(r,n)},freezeMethods=r=>{reduceDescriptors(r,(e,t)=>{if(isFunction(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(isFunction(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},toObjectSet=(r,e)=>{const t={},n=s=>{s.forEach(a=>{t[a]=!0})};return isArray$1(r)?n(r):n(String(r).split(e)),t},noop=()=>{},toFiniteNumber=(r,e)=>(r=+r,Number.isFinite(r)?r:e),ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT,ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(r=16,e=ALPHABET.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function isSpecCompliantForm(r){return!!(r&&isFunction(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const toJSONObject=r=>{const e=new Array(10),t=(n,s)=>{if(isObject$2(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const a=isArray$1(n)?[]:{};return forEach$1(n,(o,l)=>{const d=t(o,s+1);!isUndefined$1(d)&&(a[l]=d)}),e[s]=void 0,a}}return n};return t(r,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=r=>r&&(isObject$2(r)||isFunction(r))&&isFunction(r.then)&&isFunction(r.catch),utils={isArray:isArray$1,isArrayBuffer,isBuffer,isFormData:isFormData$1,isArrayBufferView,isString,isNumber,isBoolean:isBoolean$1,isObject:isObject$2,isPlainObject,isUndefined:isUndefined$1,isDate:isDate$1,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams:isURLSearchParams$1,isTypedArray,isFileList,forEach:forEach$1,merge:merge$1,extend:extend$1,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray:toArray$1,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,ALPHABET,generateString,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable};function AxiosError(r,e,t,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),s&&(this.response=s)}utils.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{descriptors[r]={value:r}});Object.defineProperties(AxiosError,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError.from=(r,e,t,n,s,a)=>{const o=Object.create(prototype$1);return utils.toFlatObject(r,o,function(d){return d!==Error.prototype},l=>l!=="isAxiosError"),AxiosError.call(o,r.message,e,t,n,s),o.cause=r,o.name=r.name,a&&Object.assign(o,a),o};const httpAdapter=null;function isVisitable(r){return utils.isPlainObject(r)||utils.isArray(r)}function removeBrackets(r){return utils.endsWith(r,"[]")?r.slice(0,-2):r}function renderKey(r,e,t){return r?r.concat(e).map(function(s,a){return s=removeBrackets(s),!t&&a?"["+s+"]":s}).join(t?".":""):e}function isFlatArray(r){return utils.isArray(r)&&!r.some(isVisitable)}const predicates=utils.toFlatObject(utils,{},null,function(e){return/^is[A-Z]/.test(e)});function toFormData(r,e,t){if(!utils.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=utils.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,v){return!utils.isUndefined(v[g])});const n=t.metaTokens,s=t.visitor||u,a=t.dots,o=t.indexes,d=(t.Blob||typeof Blob<"u"&&Blob)&&utils.isSpecCompliantForm(e);if(!utils.isFunction(s))throw new TypeError("visitor must be a function");function c(w){if(w===null)return"";if(utils.isDate(w))return w.toISOString();if(!d&&utils.isBlob(w))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils.isArrayBuffer(w)||utils.isTypedArray(w)?d&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function u(w,g,v){let T=w;if(w&&!v&&typeof w=="object"){if(utils.endsWith(g,"{}"))g=n?g:g.slice(0,-2),w=JSON.stringify(w);else if(utils.isArray(w)&&isFlatArray(w)||(utils.isFileList(w)||utils.endsWith(g,"[]"))&&(T=utils.toArray(w)))return g=removeBrackets(g),T.forEach(function(x,S){!(utils.isUndefined(x)||x===null)&&e.append(o===!0?renderKey([g],S,a):o===null?g:g+"[]",c(x))}),!1}return isVisitable(w)?!0:(e.append(renderKey(v,g,a),c(w)),!1)}const h=[],b=Object.assign(predicates,{defaultVisitor:u,convertValue:c,isVisitable});function A(w,g){if(!utils.isUndefined(w)){if(h.indexOf(w)!==-1)throw Error("Circular reference detected in "+g.join("."));h.push(w),utils.forEach(w,function(T,C){(!(utils.isUndefined(T)||T===null)&&s.call(e,T,utils.isString(C)?C.trim():C,g,b))===!0&&A(T,g?g.concat(C):[C])}),h.pop()}}if(!utils.isObject(r))throw new TypeError("data must be an object");return A(r),e}function encode$2(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function AxiosURLSearchParams(r,e){this._pairs=[],r&&toFormData(r,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(e,t){this._pairs.push([e,t])};prototype.toString=function(e){const t=e?function(n){return e.call(this,n,encode$2)}:encode$2;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function encode$1(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL$1(r,e,t){if(!e)return r;const n=t&&t.encode||encode$1,s=t&&t.serialize;let a;if(s?a=s(e,t):a=utils.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,t).toString(n),a){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+a}return r}class InterceptorManager{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils.forEach(this.handlers,function(n){n!==null&&e(n)})}}const InterceptorManager$1=InterceptorManager,transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,isStandardBrowserEnv$1=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),isStandardBrowserWebWorkerEnv=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),platform={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},isStandardBrowserEnv:isStandardBrowserEnv$1,isStandardBrowserWebWorkerEnv,protocols:["http","https","file","blob","url","data"]};function toURLEncodedForm(r,e){return toFormData(r,new platform.classes.URLSearchParams,Object.assign({visitor:function(t,n,s,a){return platform.isNode&&utils.isBuffer(t)?(this.append(n,t.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function parsePropPath(r){return utils.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(r){const e={},t=Object.keys(r);let n;const s=t.length;let a;for(n=0;n<s;n++)a=t[n],e[a]=r[a];return e}function formDataToJSON(r){function e(t,n,s,a){let o=t[a++];const l=Number.isFinite(+o),d=a>=t.length;return o=!o&&utils.isArray(s)?s.length:o,d?(utils.hasOwnProp(s,o)?s[o]=[s[o],n]:s[o]=n,!l):((!s[o]||!utils.isObject(s[o]))&&(s[o]=[]),e(t,n,s[o],a)&&utils.isArray(s[o])&&(s[o]=arrayToObject(s[o])),!l)}if(utils.isFormData(r)&&utils.isFunction(r.entries)){const t={};return utils.forEachEntry(r,(n,s)=>{e(parsePropPath(n),s,t,0)}),t}return null}const DEFAULT_CONTENT_TYPE={"Content-Type":void 0};function stringifySafely(r,e,t){if(utils.isString(r))try{return(e||JSON.parse)(r),utils.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",s=n.indexOf("application/json")>-1,a=utils.isObject(e);if(a&&utils.isHTMLForm(e)&&(e=new FormData(e)),utils.isFormData(e))return s&&s?JSON.stringify(formDataToJSON(e)):e;if(utils.isArrayBuffer(e)||utils.isBuffer(e)||utils.isStream(e)||utils.isFile(e)||utils.isBlob(e))return e;if(utils.isArrayBufferView(e))return e.buffer;if(utils.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((l=utils.isFileList(e))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return toFormData(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return a||s?(t.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(e){const t=this.transitional||defaults.transitional,n=t&&t.forcedJSONParsing,s=this.responseType==="json";if(e&&utils.isString(e)&&(n&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?AxiosError.from(l,AxiosError.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],function(e){defaults.headers[e]={}});utils.forEach(["post","put","patch"],function(e){defaults.headers[e]=utils.merge(DEFAULT_CONTENT_TYPE)});const defaults$1=defaults,ignoreDuplicateOf=utils.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=r=>{const e={};let t,n,s;return r&&r.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),n=o.substring(s+1).trim(),!(!t||e[t]&&ignoreDuplicateOf[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},$internals=Symbol("internals");function normalizeHeader(r){return r&&String(r).trim().toLowerCase()}function normalizeValue(r){return r===!1||r==null?r:utils.isArray(r)?r.map(normalizeValue):String(r)}function parseTokens(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const isValidHeaderName=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function matchHeaderValue(r,e,t,n,s){if(utils.isFunction(n))return n.call(this,e,t);if(s&&(e=t),!!utils.isString(e)){if(utils.isString(n))return e.indexOf(n)!==-1;if(utils.isRegExp(n))return n.test(e)}}function formatHeader(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function buildAccessors(r,e){const t=utils.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(s,a,o){return this[n].call(this,e,s,a,o)},configurable:!0})})}class AxiosHeaders{constructor(e){e&&this.set(e)}set(e,t,n){const s=this;function a(l,d,c){const u=normalizeHeader(d);if(!u)throw new Error("header name must be a non-empty string");const h=utils.findKey(s,u);(!h||s[h]===void 0||c===!0||c===void 0&&s[h]!==!1)&&(s[h||d]=normalizeValue(l))}const o=(l,d)=>utils.forEach(l,(c,u)=>a(c,u,d));return utils.isPlainObject(e)||e instanceof this.constructor?o(e,t):utils.isString(e)&&(e=e.trim())&&!isValidHeaderName(e)?o(parseHeaders(e),t):e!=null&&a(t,e,n),this}get(e,t){if(e=normalizeHeader(e),e){const n=utils.findKey(this,e);if(n){const s=this[n];if(!t)return s;if(t===!0)return parseTokens(s);if(utils.isFunction(t))return t.call(this,s,n);if(utils.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=normalizeHeader(e),e){const n=utils.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||matchHeaderValue(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let s=!1;function a(o){if(o=normalizeHeader(o),o){const l=utils.findKey(n,o);l&&(!t||matchHeaderValue(n,n[l],l,t))&&(delete n[l],s=!0)}}return utils.isArray(e)?e.forEach(a):a(e),s}clear(e){const t=Object.keys(this);let n=t.length,s=!1;for(;n--;){const a=t[n];(!e||matchHeaderValue(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){const t=this,n={};return utils.forEach(this,(s,a)=>{const o=utils.findKey(n,a);if(o){t[o]=normalizeValue(s),delete t[a];return}const l=e?formatHeader(a):String(a).trim();l!==a&&delete t[a],t[l]=normalizeValue(s),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return utils.forEach(this,(n,s)=>{n!=null&&n!==!1&&(t[s]=e&&utils.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[$internals]=this[$internals]={accessors:{}}).accessors,s=this.prototype;function a(o){const l=normalizeHeader(o);n[l]||(buildAccessors(s,o),n[l]=!0)}return utils.isArray(e)?e.forEach(a):a(e),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils.freezeMethods(AxiosHeaders.prototype);utils.freezeMethods(AxiosHeaders);const AxiosHeaders$1=AxiosHeaders;function transformData(r,e){const t=this||defaults$1,n=e||t,s=AxiosHeaders$1.from(n.headers);let a=n.data;return utils.forEach(r,function(l){a=l.call(t,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function isCancel(r){return!!(r&&r.__CANCEL__)}function CanceledError(r,e,t){AxiosError.call(this,r??"canceled",AxiosError.ERR_CANCELED,e,t),this.name="CanceledError"}utils.inherits(CanceledError,AxiosError,{__CANCEL__:!0});function settle$1(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new AxiosError("Request failed with status code "+t.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const cookies=platform.isStandardBrowserEnv?function(){return{write:function(t,n,s,a,o,l){const d=[];d.push(t+"="+encodeURIComponent(n)),utils.isNumber(s)&&d.push("expires="+new Date(s).toGMTString()),utils.isString(a)&&d.push("path="+a),utils.isString(o)&&d.push("domain="+o),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function isAbsoluteURL$1(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function combineURLs$1(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function buildFullPath$1(r,e){return r&&!isAbsoluteURL$1(e)?combineURLs$1(r,e):e}const isURLSameOrigin=platform.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function s(a){let o=a;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=s(window.location.href),function(o){const l=utils.isString(o)?s(o):o;return l.protocol===n.protocol&&l.host===n.host}}():function(){return function(){return!0}}();function parseProtocol(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function speedometer(r,e){r=r||10;const t=new Array(r),n=new Array(r);let s=0,a=0,o;return e=e!==void 0?e:1e3,function(d){const c=Date.now(),u=n[a];o||(o=c),t[s]=d,n[s]=c;let h=a,b=0;for(;h!==s;)b+=t[h++],h=h%r;if(s=(s+1)%r,s===a&&(a=(a+1)%r),c-o<e)return;const A=u&&c-u;return A?Math.round(b*1e3/A):void 0}}function progressEventReducer(r,e){let t=0;const n=speedometer(50,250);return s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,l=a-t,d=n(l),c=a<=o;t=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:d||void 0,estimated:d&&o&&c?(o-a)/d:void 0,event:s};u[e?"download":"upload"]=!0,r(u)}}const isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(r){return new Promise(function(t,n){let s=r.data;const a=AxiosHeaders$1.from(r.headers).normalize(),o=r.responseType;let l;function d(){r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener("abort",l)}utils.isFormData(s)&&(platform.isStandardBrowserEnv||platform.isStandardBrowserWebWorkerEnv?a.setContentType(!1):a.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(r.auth){const A=r.auth.username||"",w=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";a.set("Authorization","Basic "+btoa(A+":"+w))}const u=buildFullPath$1(r.baseURL,r.url);c.open(r.method.toUpperCase(),buildURL$1(u,r.params,r.paramsSerializer),!0),c.timeout=r.timeout;function h(){if(!c)return;const A=AxiosHeaders$1.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),g={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:A,config:r,request:c};settle$1(function(T){t(T),d()},function(T){n(T),d()},g),c=null}if("onloadend"in c?c.onloadend=h:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(h)},c.onabort=function(){c&&(n(new AxiosError("Request aborted",AxiosError.ECONNABORTED,r,c)),c=null)},c.onerror=function(){n(new AxiosError("Network Error",AxiosError.ERR_NETWORK,r,c)),c=null},c.ontimeout=function(){let w=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const g=r.transitional||transitionalDefaults;r.timeoutErrorMessage&&(w=r.timeoutErrorMessage),n(new AxiosError(w,g.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,r,c)),c=null},platform.isStandardBrowserEnv){const A=(r.withCredentials||isURLSameOrigin(u))&&r.xsrfCookieName&&cookies.read(r.xsrfCookieName);A&&a.set(r.xsrfHeaderName,A)}s===void 0&&a.setContentType(null),"setRequestHeader"in c&&utils.forEach(a.toJSON(),function(w,g){c.setRequestHeader(g,w)}),utils.isUndefined(r.withCredentials)||(c.withCredentials=!!r.withCredentials),o&&o!=="json"&&(c.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&c.addEventListener("progress",progressEventReducer(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",progressEventReducer(r.onUploadProgress)),(r.cancelToken||r.signal)&&(l=A=>{c&&(n(!A||A.type?new CanceledError(null,r,c):A),c.abort(),c=null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener("abort",l)));const b=parseProtocol(u);if(b&&platform.protocols.indexOf(b)===-1){n(new AxiosError("Unsupported protocol "+b+":",AxiosError.ERR_BAD_REQUEST,r));return}c.send(s||null)})},knownAdapters={http:httpAdapter,xhr:xhrAdapter};utils.forEach(knownAdapters,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const adapters={getAdapter:r=>{r=utils.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let s=0;s<e&&(t=r[s],!(n=utils.isString(t)?knownAdapters[t.toLowerCase()]:t));s++);if(!n)throw n===!1?new AxiosError(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(utils.hasOwnProp(knownAdapters,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!utils.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:knownAdapters};function throwIfCancellationRequested(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new CanceledError(null,r)}function dispatchRequest(r){return throwIfCancellationRequested(r),r.headers=AxiosHeaders$1.from(r.headers),r.data=transformData.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(r.adapter||defaults$1.adapter)(r).then(function(n){return throwIfCancellationRequested(r),n.data=transformData.call(r,r.transformResponse,n),n.headers=AxiosHeaders$1.from(n.headers),n},function(n){return isCancel(n)||(throwIfCancellationRequested(r),n&&n.response&&(n.response.data=transformData.call(r,r.transformResponse,n.response),n.response.headers=AxiosHeaders$1.from(n.response.headers))),Promise.reject(n)})}const headersToObject=r=>r instanceof AxiosHeaders$1?r.toJSON():r;function mergeConfig(r,e){e=e||{};const t={};function n(c,u,h){return utils.isPlainObject(c)&&utils.isPlainObject(u)?utils.merge.call({caseless:h},c,u):utils.isPlainObject(u)?utils.merge({},u):utils.isArray(u)?u.slice():u}function s(c,u,h){if(utils.isUndefined(u)){if(!utils.isUndefined(c))return n(void 0,c,h)}else return n(c,u,h)}function a(c,u){if(!utils.isUndefined(u))return n(void 0,u)}function o(c,u){if(utils.isUndefined(u)){if(!utils.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function l(c,u,h){if(h in e)return n(c,u);if(h in r)return n(void 0,c)}const d={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(c,u)=>s(headersToObject(c),headersToObject(u),!0)};return utils.forEach(Object.keys(Object.assign({},r,e)),function(u){const h=d[u]||s,b=h(r[u],e[u],u);utils.isUndefined(b)&&h!==l||(t[u]=b)}),t}const VERSION="1.4.0",validators$1={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{validators$1[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const deprecatedWarnings={};validators$1.transitional=function(e,t,n){function s(a,o){return"[Axios v"+VERSION+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return(a,o,l)=>{if(e===!1)throw new AxiosError(s(o," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[o]&&(deprecatedWarnings[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,o,l):!0}};function assertOptions(r,e,t){if(typeof r!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let s=n.length;for(;s-- >0;){const a=n[s],o=e[a];if(o){const l=r[a],d=l===void 0||o(l,a,r);if(d!==!0)throw new AxiosError("option "+a+" must be "+d,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new AxiosError("Unknown option "+a,AxiosError.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(e){this.defaults=e,this.interceptors={request:new InterceptorManager$1,response:new InterceptorManager$1}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=mergeConfig(this.defaults,t);const{transitional:n,paramsSerializer:s,headers:a}=t;n!==void 0&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),s!=null&&(utils.isFunction(s)?t.paramsSerializer={serialize:s}:validator.assertOptions(s,{encode:validators.function,serialize:validators.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=a&&utils.merge(a.common,a[t.method]),o&&utils.forEach(["delete","get","head","post","put","patch","common"],w=>{delete a[w]}),t.headers=AxiosHeaders$1.concat(o,a);const l=[];let d=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(d=d&&g.synchronous,l.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let u,h=0,b;if(!d){const w=[dispatchRequest.bind(this),void 0];for(w.unshift.apply(w,l),w.push.apply(w,c),b=w.length,u=Promise.resolve(t);h<b;)u=u.then(w[h++],w[h++]);return u}b=l.length;let A=t;for(h=0;h<b;){const w=l[h++],g=l[h++];try{A=w(A)}catch(v){g.call(this,v);break}}try{u=dispatchRequest.call(this,A)}catch(w){return Promise.reject(w)}for(h=0,b=c.length;h<b;)u=u.then(c[h++],c[h++]);return u}getUri(e){e=mergeConfig(this.defaults,e);const t=buildFullPath$1(e.baseURL,e.url);return buildURL$1(t,e.params,e.paramsSerializer)}}utils.forEach(["delete","get","head","options"],function(e){Axios.prototype[e]=function(t,n){return this.request(mergeConfig(n||{},{method:e,url:t,data:(n||{}).data}))}});utils.forEach(["post","put","patch"],function(e){function t(n){return function(a,o,l){return this.request(mergeConfig(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}Axios.prototype[e]=t(),Axios.prototype[e+"Form"]=t(!0)});const Axios$1=Axios;class CancelToken{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(a){t=a});const n=this;this.promise.then(s=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](s);n._listeners=null}),this.promise.then=s=>{let a;const o=new Promise(l=>{n.subscribe(l),a=l}).then(s);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a,o,l){n.reason||(n.reason=new CanceledError(a,o,l),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new CancelToken(function(s){e=s}),cancel:e}}}const CancelToken$1=CancelToken;function spread(r){return function(t){return r.apply(null,t)}}function isAxiosError(r){return utils.isObject(r)&&r.isAxiosError===!0}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach(([r,e])=>{HttpStatusCode[e]=r});const HttpStatusCode$1=HttpStatusCode;function createInstance(r){const e=new Axios$1(r),t=bind(Axios$1.prototype.request,e);return utils.extend(t,Axios$1.prototype,e,{allOwnKeys:!0}),utils.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return createInstance(mergeConfig(r,s))},t}const axios=createInstance(defaults$1);axios.Axios=Axios$1;axios.CanceledError=CanceledError;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel;axios.VERSION=VERSION;axios.toFormData=toFormData;axios.AxiosError=AxiosError;axios.Cancel=axios.CanceledError;axios.all=function(e){return Promise.all(e)};axios.spread=spread;axios.isAxiosError=isAxiosError;axios.mergeConfig=mergeConfig;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=r=>formDataToJSON(utils.isHTMLForm(r)?new FormData(r):r);axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const axios$1=axios,EventStreamContentType="text/event-stream";async function getBytes(r,e){const t=r.getReader();for(;;){const n=await t.read();if(n.done){e(new Uint8Array,!0);break}e(n.value)}}function getLines(r){let e,t,n,s=!1;return function(o,l){if(l){r(o,0,!0);return}e===void 0?(e=o,t=0,n=-1):e=concat(e,o);const d=e.length;let c=0;for(;t<d;){s&&(e[t]===10&&(c=++t),s=!1);let u=-1;for(;t<d&&u===-1;++t)switch(e[t]){case 58:n===-1&&(n=t-c);break;case 13:s=!0;case 10:u=t;break}if(u===-1)break;r(e.subarray(c,u),n),c=t,n=-1}c===d?e=void 0:c!==0&&(e=e.subarray(c),t-=c)}}function getMessages(r,e,t){let n=newMessage();const s=new TextDecoder;return function(o,l,d){if(d){isEmpty(n)||(r==null||r(n),n=newMessage());return}if(o.length===0)r==null||r(n),n=newMessage();else if(l>0){const c=s.decode(o.subarray(0,l)),u=l+(o[l+1]===32?2:1),h=s.decode(o.subarray(u));switch(c){case"data":n.data=n.data?n.data+`
`+h:h;break;case"event":n.event=h;break;case"id":e==null||e(n.id=h);break;case"retry":{const b=parseInt(h,10);Number.isNaN(b)||t==null||t(n.retry=b);break}}}}}function concat(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function newMessage(){return{data:"",event:"",id:"",retry:void 0}}function isEmpty(r){return r.data===""&&r.event===""&&r.id===""&&r.retry===void 0}function tryJsonStringify$1(r){try{return JSON.stringify(r)}catch{return r}}function settle(r,e,t){const{validateStatus:n}=t.config;!t.status||!n||n(t.status)?r(t):e(createError(`Request failed with status code ${t.status} and body ${typeof t.data=="string"?t.data:tryJsonStringify$1(t.data)}`,t.config,null,t.request,t))}function isAbsoluteURL(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function combineURLs(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function encode(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(r,e,t){if(!e)return r;var n;if(t)n=t(e);else if(isURLSearchParams(e))n=e.toString();else{var s=[];forEach(e,function(l,d){l===null||typeof l>"u"||(isArray(l)?d=`${d}[]`:l=[l],forEach(l,function(u){isDate(u)?u=u.toISOString():isObject$1(u)&&(u=JSON.stringify(u)),s.push(`${encode(d)}=${encode(u)}`)}))}),n=s.join("&")}if(n){var a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+n}return r}function buildFullPath(r,e){return r&&!isAbsoluteURL(e)?combineURLs(r,e):e}function isUndefined(r){return typeof r>"u"}function isObject$1(r){return r!==null&&typeof r=="object"}function isDate(r){return toString.call(r)==="[object Date]"}function isURLSearchParams(r){return toString.call(r)==="[object URLSearchParams]"}function isArray(r){return Array.isArray(r)}function forEach(r,e){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),isArray(r))for(var t=0,n=r.length;t<n;t++)e.call(null,r[t],t,r);else for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.call(null,r[s],s,r)}function isFormData(r){return toString.call(r)==="[object FormData]"}function isStandardBrowserEnv(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}async function fetchAdapter(r){const e=createRequest(r),t=await getResponse(e,r);return new Promise((n,s)=>{t instanceof Error?s(t):Object.prototype.toString.call(r.settle)==="[object Function]"?r.settle(n,s,t):settle(n,s,t)})}async function getResponse(r,e){let t;try{t=await fetch(r)}catch(a){return a&&a.name==="AbortError"?createError("Request aborted",e,"ECONNABORTED",r):a&&a.name==="TimeoutError"?createError("Request timeout",e,"ECONNABORTED",r):createError("Network Error",e,"ERR_NETWORK",r)}const n={};t.headers.forEach((a,o)=>{n[o]=a});const s={ok:t.ok,status:t.status,statusText:t.statusText,headers:n,config:e,request:r};if(t.status>=200&&t.status!==204)if(e.responseType==="stream"){const a=t.headers.get("content-type");if(!(a!=null&&a.startsWith(EventStreamContentType))){if(t.status>=400)return a!=null&&a.startsWith("application/json")?(s.data=await t.json(),s):(s.data=await t.text(),s);throw new Error(`Expected content-type to be ${EventStreamContentType}, Actual: ${a}`)}await getBytes(t.body,getLines(getMessages(e.onmessage)))}else switch(e.responseType){case"arraybuffer":s.data=await t.arrayBuffer();break;case"blob":s.data=await t.blob();break;case"json":s.data=await t.json();break;case"formData":s.data=await t.formData();break;default:s.data=await t.text();break}return s}function createRequest(r){const e=new Headers(r.headers);if(r.auth){const o=r.auth.username||"",l=r.auth.password?decodeURI(encodeURIComponent(r.auth.password)):"";e.set("Authorization",`Basic ${btoa(`${o}:${l}`)}`)}const t=r.method.toUpperCase(),n={headers:e,method:t};t!=="GET"&&t!=="HEAD"&&(n.body=r.data,isFormData(n.body)&&isStandardBrowserEnv()&&e.delete("Content-Type")),typeof n.body=="string"&&(n.body=new TextEncoder().encode(n.body)),r.mode&&(n.mode=r.mode),r.cache&&(n.cache=r.cache),r.integrity&&(n.integrity=r.integrity),r.redirect&&(n.redirect=r.redirect),r.referrer&&(n.referrer=r.referrer),r.timeout&&r.timeout>0&&(n.signal=AbortSignal.timeout(r.timeout)),r.signal&&(n.signal=r.signal),isUndefined(r.withCredentials)||(n.credentials=r.withCredentials?"include":"omit"),r.responseType==="stream"&&n.headers.set("Accept",EventStreamContentType);const s=buildFullPath(r.baseURL,r.url),a=buildURL(s,r.params,r.paramsSerializer);return new Request(a,n)}function createError(r,e,t,n,s){if(axios$1.AxiosError&&typeof axios$1.AxiosError=="function")return new axios$1.AxiosError(r,axios$1.AxiosError[t],e,n,s);const a=new Error(r);return enhanceError(a,e,t,n,s)}function enhanceError(r,e,t,n,s){return r.config=e,t&&(r.code=t),r.request=n,r.response=s,r.isAxiosError=!0,r.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},r}const chunkArray=(r,e)=>r.reduce((t,n,s)=>{const a=Math.floor(s/e),o=t[a]||[];return t[a]=o.concat([n]),t},[]);function getEndpoint(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,basePath:a}=r;if(n&&s&&e)return`${s}/${e}`;if(n){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}class OpenAIEmbeddings extends Embeddings{constructor(e,t){super(e??{}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=(e==null?void 0:e.openAIApiKey)??getEnvironmentVariable$1("OPENAI_API_KEY"),s=(e==null?void 0:e.azureOpenAIApiKey)??getEnvironmentVariable$1("AZURE_OPENAI_API_KEY");if(!s&&!n)throw new Error("OpenAI or Azure OpenAI API key not found");const a=(e==null?void 0:e.azureOpenAIApiInstanceName)??getEnvironmentVariable$1("AZURE_OPENAI_API_INSTANCE_NAME"),o=((e==null?void 0:e.azureOpenAIApiEmbeddingsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(getEnvironmentVariable$1("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||getEnvironmentVariable$1("AZURE_OPENAI_API_DEPLOYMENT_NAME")),l=(e==null?void 0:e.azureOpenAIApiVersion)??getEnvironmentVariable$1("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??getEnvironmentVariable$1("AZURE_OPENAI_BASE_PATH"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.batchSize=(e==null?void 0:e.batchSize)??(s?1:this.batchSize),this.stripNewLines=(e==null?void 0:e.stripNewLines)??this.stripNewLines,this.timeout=e==null?void 0:e.timeout,this.azureOpenAIApiVersion=l,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:n,...t}}async embedDocuments(e){const t=chunkArray(this.stripNewLines?e.map(s=>s.replace(/\n/g," ")):e,this.batchSize),n=[];for(let s=0;s<t.length;s+=1){const a=t[s],{data:o}=await this.embeddingWithRetry({model:this.modelName,input:a});for(let l=0;l<a.length;l+=1)n.push(o.data[l].embedding)}return n}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t.data[0].embedding}async embeddingWithRetry(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,basePath:this.clientConfig.basePath},s=getEndpoint(n),a=new dist.Configuration({...this.clientConfig,basePath:s,baseOptions:{timeout:this.timeout,adapter:isNode$1()?void 0:fetchAdapter,...this.clientConfig.baseOptions}});this.client=new dist.OpenAIApi(a)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.params={"api-version":this.azureOpenAIApiVersion,...t.params}),this.caller.call(this.client.createEmbedding.bind(this.client),e,t)}}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal=new Proxy({},{get(r,e){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(e,t){module.exports=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,(r,e)=>{var De;Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.RenderingIntentFlag=e.PromiseCapability=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.MAX_IMAGE_SIZE_TO_CACHE=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=Q,e.bytesToString=O,e.createValidAbsoluteUrl=pe,e.getModificationDate=Ae,e.getVerbosityLevel=N,e.info=q,e.isArrayBuffer=ie,e.isArrayEqual=ve,e.normalizeUnicode=Ne,e.objectFromMap=ne,e.objectSize=Y,e.setVerbosityLevel=X,e.shadow=he,e.string32=K,e.stringToBytes=M,e.stringToPDFString=Te,e.stringToUTF8String=ye,e.unreachable=oe,e.utf8StringToString=ae,e.warn=te;const t=[1,0,0,1,0,0];e.IDENTITY_MATRIX=t;const n=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=n;const s=1e7;e.MAX_IMAGE_SIZE_TO_CACHE=s;const a=1.35;e.LINE_FACTOR=a;const o=.35;e.LINE_DESCENT_FACTOR=o;const l=o/a;e.BASELINE_FACTOR=l;const d={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=d;const c={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=c;const u="pdfjs_internal_editor_";e.AnnotationEditorPrefix=u;const h={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};e.AnnotationEditorType=h;const b={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=b;const A={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=A;const w={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=w;const g={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=g;const v={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=v;const T={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=T;const C={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=C;const x={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=x;const S={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=S;const D={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=D;const m={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=m;const _={O:"PageOpen",C:"PageClose"};e.PageActionEventType=_;const f={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=f;const y={NONE:0,BINARY:1};e.CMapCompressionType=y;const p={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=p;const k={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=k;let L=f.WARNINGS;function X(V){Number.isInteger(V)&&(L=V)}function N(){return L}function q(V){L>=f.INFOS&&console.log(`Info: ${V}`)}function te(V){L>=f.WARNINGS&&console.log(`Warning: ${V}`)}function oe(V){throw new Error(V)}function Q(V,H){V||oe(H)}function W(V){switch(V==null?void 0:V.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function pe(V,H=null,ee=null){if(!V)return null;try{if(ee&&typeof V=="string"){if(ee.addDefaultProtocol&&V.startsWith("www.")){const Fe=V.match(/\./g);(Fe==null?void 0:Fe.length)>=2&&(V=`http://${V}`)}if(ee.tryConvertEncoding)try{V=ye(V)}catch{}}const ge=H?new URL(V,H):new URL(V);if(W(ge))return ge}catch{}return null}function he(V,H,ee,ge=!1){return Object.defineProperty(V,H,{value:ee,enumerable:!ge,configurable:!0,writable:!1}),ee}const _e=function(){function H(ee,ge){this.constructor===H&&oe("Cannot initialize BaseException."),this.message=ee,this.name=ge}return H.prototype=new Error,H.constructor=H,H}();e.BaseException=_e;class Oe extends _e{constructor(H,ee){super(H,"PasswordException"),this.code=ee}}e.PasswordException=Oe;class J extends _e{constructor(H,ee){super(H,"UnknownErrorException"),this.details=ee}}e.UnknownErrorException=J;class F extends _e{constructor(H){super(H,"InvalidPDFException")}}e.InvalidPDFException=F;class I extends _e{constructor(H){super(H,"MissingPDFException")}}e.MissingPDFException=I;class $ extends _e{constructor(H,ee){super(H,"UnexpectedResponseException"),this.status=ee}}e.UnexpectedResponseException=$;class U extends _e{constructor(H){super(H,"FormatError")}}e.FormatError=U;class E extends _e{constructor(H){super(H,"AbortException")}}e.AbortException=E;function O(V){(typeof V!="object"||(V==null?void 0:V.length)===void 0)&&oe("Invalid argument for bytesToString");const H=V.length,ee=8192;if(H<ee)return String.fromCharCode.apply(null,V);const ge=[];for(let Fe=0;Fe<H;Fe+=ee){const je=Math.min(Fe+ee,H),Ve=V.subarray(Fe,je);ge.push(String.fromCharCode.apply(null,Ve))}return ge.join("")}function M(V){typeof V!="string"&&oe("Invalid argument for stringToBytes");const H=V.length,ee=new Uint8Array(H);for(let ge=0;ge<H;++ge)ee[ge]=V.charCodeAt(ge)&255;return ee}function K(V){return String.fromCharCode(V>>24&255,V>>16&255,V>>8&255,V&255)}function Y(V){return Object.keys(V).length}function ne(V){const H=Object.create(null);for(const[ee,ge]of V)H[ee]=ge;return H}function ue(){const V=new Uint8Array(4);return V[0]=1,new Uint32Array(V.buffer,0,1)[0]===1}function fe(){try{return new Function(""),!0}catch{return!1}}class we{static get isLittleEndian(){return he(this,"isLittleEndian",ue())}static get isEvalSupported(){return he(this,"isEvalSupported",fe())}static get isOffscreenCanvasSupported(){return he(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?he(this,"platform",{isWin:!1,isMac:!1}):he(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}e.FeatureTest=we;const me=[...Array(256).keys()].map(V=>V.toString(16).padStart(2,"0"));class Ce{static makeHexColor(H,ee,ge){return`#${me[H]}${me[ee]}${me[ge]}`}static scaleMinMax(H,ee){let ge;H[0]?(H[0]<0&&(ge=ee[0],ee[0]=ee[1],ee[1]=ge),ee[0]*=H[0],ee[1]*=H[0],H[3]<0&&(ge=ee[2],ee[2]=ee[3],ee[3]=ge),ee[2]*=H[3],ee[3]*=H[3]):(ge=ee[0],ee[0]=ee[2],ee[2]=ge,ge=ee[1],ee[1]=ee[3],ee[3]=ge,H[1]<0&&(ge=ee[2],ee[2]=ee[3],ee[3]=ge),ee[2]*=H[1],ee[3]*=H[1],H[2]<0&&(ge=ee[0],ee[0]=ee[1],ee[1]=ge),ee[0]*=H[2],ee[1]*=H[2]),ee[0]+=H[4],ee[1]+=H[4],ee[2]+=H[5],ee[3]+=H[5]}static transform(H,ee){return[H[0]*ee[0]+H[2]*ee[1],H[1]*ee[0]+H[3]*ee[1],H[0]*ee[2]+H[2]*ee[3],H[1]*ee[2]+H[3]*ee[3],H[0]*ee[4]+H[2]*ee[5]+H[4],H[1]*ee[4]+H[3]*ee[5]+H[5]]}static applyTransform(H,ee){const ge=H[0]*ee[0]+H[1]*ee[2]+ee[4],Fe=H[0]*ee[1]+H[1]*ee[3]+ee[5];return[ge,Fe]}static applyInverseTransform(H,ee){const ge=ee[0]*ee[3]-ee[1]*ee[2],Fe=(H[0]*ee[3]-H[1]*ee[2]+ee[2]*ee[5]-ee[4]*ee[3])/ge,je=(-H[0]*ee[1]+H[1]*ee[0]+ee[4]*ee[1]-ee[5]*ee[0])/ge;return[Fe,je]}static getAxialAlignedBoundingBox(H,ee){const ge=this.applyTransform(H,ee),Fe=this.applyTransform(H.slice(2,4),ee),je=this.applyTransform([H[0],H[3]],ee),Ve=this.applyTransform([H[2],H[1]],ee);return[Math.min(ge[0],Fe[0],je[0],Ve[0]),Math.min(ge[1],Fe[1],je[1],Ve[1]),Math.max(ge[0],Fe[0],je[0],Ve[0]),Math.max(ge[1],Fe[1],je[1],Ve[1])]}static inverseTransform(H){const ee=H[0]*H[3]-H[1]*H[2];return[H[3]/ee,-H[1]/ee,-H[2]/ee,H[0]/ee,(H[2]*H[5]-H[4]*H[3])/ee,(H[4]*H[1]-H[5]*H[0])/ee]}static singularValueDecompose2dScale(H){const ee=[H[0],H[2],H[1],H[3]],ge=H[0]*ee[0]+H[1]*ee[2],Fe=H[0]*ee[1]+H[1]*ee[3],je=H[2]*ee[0]+H[3]*ee[2],Ve=H[2]*ee[1]+H[3]*ee[3],Ze=(ge+Ve)/2,Qe=Math.sqrt((ge+Ve)**2-4*(ge*Ve-je*Fe))/2,We=Ze+Qe||1,Xe=Ze-Qe||1;return[Math.sqrt(We),Math.sqrt(Xe)]}static normalizeRect(H){const ee=H.slice(0);return H[0]>H[2]&&(ee[0]=H[2],ee[2]=H[0]),H[1]>H[3]&&(ee[1]=H[3],ee[3]=H[1]),ee}static intersect(H,ee){const ge=Math.max(Math.min(H[0],H[2]),Math.min(ee[0],ee[2])),Fe=Math.min(Math.max(H[0],H[2]),Math.max(ee[0],ee[2]));if(ge>Fe)return null;const je=Math.max(Math.min(H[1],H[3]),Math.min(ee[1],ee[3])),Ve=Math.min(Math.max(H[1],H[3]),Math.max(ee[1],ee[3]));return je>Ve?null:[ge,je,Fe,Ve]}static bezierBoundingBox(H,ee,ge,Fe,je,Ve,Ze,Qe){const We=[],Xe=[[],[]];let Le,Z,j,R,B,G,re,ce;for(let ke=0;ke<2;++ke){if(ke===0?(Z=6*H-12*ge+6*je,Le=-3*H+9*ge-9*je+3*Ze,j=3*ge-3*H):(Z=6*ee-12*Fe+6*Ve,Le=-3*ee+9*Fe-9*Ve+3*Qe,j=3*Fe-3*ee),Math.abs(Le)<1e-12){if(Math.abs(Z)<1e-12)continue;R=-j/Z,0<R&&R<1&&We.push(R);continue}re=Z*Z-4*j*Le,ce=Math.sqrt(re),!(re<0)&&(B=(-Z+ce)/(2*Le),0<B&&B<1&&We.push(B),G=(-Z-ce)/(2*Le),0<G&&G<1&&We.push(G))}let Ee=We.length,Pe;const le=Ee;for(;Ee--;)R=We[Ee],Pe=1-R,Xe[0][Ee]=Pe*Pe*Pe*H+3*Pe*Pe*R*ge+3*Pe*R*R*je+R*R*R*Ze,Xe[1][Ee]=Pe*Pe*Pe*ee+3*Pe*Pe*R*Fe+3*Pe*R*R*Ve+R*R*R*Qe;return Xe[0][le]=H,Xe[1][le]=ee,Xe[0][le+1]=Ze,Xe[1][le+1]=Qe,Xe[0].length=Xe[1].length=le+2,[Math.min(...Xe[0]),Math.min(...Xe[1]),Math.max(...Xe[0]),Math.max(...Xe[1])]}}e.Util=Ce;const Re=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Te(V){if(V[0]>="ï"){let ee;if(V[0]==="þ"&&V[1]==="ÿ"?ee="utf-16be":V[0]==="ÿ"&&V[1]==="þ"?ee="utf-16le":V[0]==="ï"&&V[1]==="»"&&V[2]==="¿"&&(ee="utf-8"),ee)try{const ge=new TextDecoder(ee,{fatal:!0}),Fe=M(V);return ge.decode(Fe)}catch(ge){te(`stringToPDFString: "${ge}".`)}}const H=[];for(let ee=0,ge=V.length;ee<ge;ee++){const Fe=Re[V.charCodeAt(ee)];H.push(Fe?String.fromCharCode(Fe):V.charAt(ee))}return H.join("")}function ye(V){return decodeURIComponent(escape(V))}function ae(V){return unescape(encodeURIComponent(V))}function ie(V){return typeof V=="object"&&(V==null?void 0:V.byteLength)!==void 0}function ve(V,H){if(V.length!==H.length)return!1;for(let ee=0,ge=V.length;ee<ge;ee++)if(V[ee]!==H[ee])return!1;return!0}function Ae(V=new Date){return[V.getUTCFullYear().toString(),(V.getUTCMonth()+1).toString().padStart(2,"0"),V.getUTCDate().toString().padStart(2,"0"),V.getUTCHours().toString().padStart(2,"0"),V.getUTCMinutes().toString().padStart(2,"0"),V.getUTCSeconds().toString().padStart(2,"0")].join("")}class xe{constructor(){se(this,De,!1);this.promise=new Promise((H,ee)=>{this.resolve=ge=>{be(this,De,!0),H(ge)},this.reject=ge=>{be(this,De,!0),ee(ge)}})}get settled(){return P(this,De)}}De=new WeakMap,e.PromiseCapability=xe;let Me=null,Ue=null;function Ne(V){return Me||(Me=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ue=new Map([["ﬅ","ſt"]])),V.replaceAll(Me,(H,ee,ge)=>ee?ee.normalize("NFKC"):Ue.get(ge))}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,t,n,s,it,o,vt,d,c,u,h,b,A,w,g,It,T,C,Rt,S,D;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:_}=__w_pdfjs_require__(21);createPDFNetworkStream=f=>new _(f)}else{const{PDFNetworkStream:_}=__w_pdfjs_require__(24),{PDFFetchStream:f}=__w_pdfjs_require__(25);createPDFNetworkStream=y=>(0,_display_utils.isValidFetchUrl)(y.url)?new f(y):new _(y)}function getDocument(_){if(typeof _=="string"||_ instanceof URL?_={url:_}:(0,_util.isArrayBuffer)(_)&&(_={data:_}),typeof _!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!_.url&&!_.data&&!_.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const f=new PDFDocumentLoadingTask,{docId:y}=f,p=_.url?getUrlProp(_.url):null,k=_.data?getDataProp(_.data):null,L=_.httpHeaders||null,X=_.withCredentials===!0,N=_.password??null,q=_.range instanceof PDFDataRangeTransport?_.range:null,te=Number.isInteger(_.rangeChunkSize)&&_.rangeChunkSize>0?_.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let oe=_.worker instanceof PDFWorker?_.worker:null;const Q=_.verbosity,W=typeof _.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(_.docBaseUrl)?_.docBaseUrl:null,pe=typeof _.cMapUrl=="string"?_.cMapUrl:null,he=_.cMapPacked!==!1,_e=_.CMapReaderFactory||DefaultCMapReaderFactory,Oe=typeof _.standardFontDataUrl=="string"?_.standardFontDataUrl:null,J=_.StandardFontDataFactory||DefaultStandardFontDataFactory,F=_.stopAtErrors!==!0,I=Number.isInteger(_.maxImageSize)&&_.maxImageSize>-1?_.maxImageSize:-1,$=_.isEvalSupported!==!1,U=typeof _.isOffscreenCanvasSupported=="boolean"?_.isOffscreenCanvasSupported:!_is_node.isNodeJS,E=Number.isInteger(_.canvasMaxAreaInBytes)?_.canvasMaxAreaInBytes:-1,O=typeof _.disableFontFace=="boolean"?_.disableFontFace:_is_node.isNodeJS,M=_.fontExtraProperties===!0,K=_.enableXfa===!0,Y=_.ownerDocument||globalThis.document,ne=_.disableRange===!0,ue=_.disableStream===!0,fe=_.disableAutoFetch===!0,we=_.pdfBug===!0,me=q?q.length:_.length??NaN,Ce=typeof _.useSystemFonts=="boolean"?_.useSystemFonts:!_is_node.isNodeJS&&!O,Re=typeof _.useWorkerFetch=="boolean"?_.useWorkerFetch:_e===_display_utils.DOMCMapReaderFactory&&J===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(pe,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Oe,document.baseURI),Te=_.canvasFactory||new DefaultCanvasFactory({ownerDocument:Y}),ye=_.filterFactory||new DefaultFilterFactory({docId:y,ownerDocument:Y}),ae=null;(0,_util.setVerbosityLevel)(Q);const ie={canvasFactory:Te,filterFactory:ye};if(Re||(ie.cMapReaderFactory=new _e({baseUrl:pe,isCompressed:he}),ie.standardFontDataFactory=new J({baseUrl:Oe})),!oe){const xe={verbosity:Q,port:_worker_options.GlobalWorkerOptions.workerPort};oe=xe.port?PDFWorker.fromPort(xe):new PDFWorker(xe),f._worker=oe}const ve={docId:y,apiVersion:"3.8.162",data:k,password:N,disableAutoFetch:fe,rangeChunkSize:te,length:me,docBaseUrl:W,enableXfa:K,evaluatorOptions:{maxImageSize:I,disableFontFace:O,ignoreErrors:F,isEvalSupported:$,isOffscreenCanvasSupported:U,canvasMaxAreaInBytes:E,fontExtraProperties:M,useSystemFonts:Ce,cMapUrl:Re?pe:null,standardFontDataUrl:Re?Oe:null}},Ae={ignoreErrors:F,isEvalSupported:$,disableFontFace:O,fontExtraProperties:M,enableXfa:K,ownerDocument:Y,disableAutoFetch:fe,pdfBug:we,styleElement:ae};return oe.promise.then(function(){if(f.destroyed)throw new Error("Loading aborted");const xe=_fetchDocument(oe,ve),Me=new Promise(function(Ue){let Ne;q?Ne=new _transport_stream.PDFDataTransportStream({length:me,initialData:q.initialData,progressiveDone:q.progressiveDone,contentDispositionFilename:q.contentDispositionFilename,disableRange:ne,disableStream:ue},q):k||(Ne=createPDFNetworkStream({url:p,length:me,httpHeaders:L,withCredentials:X,rangeChunkSize:te,disableRange:ne,disableStream:ue})),Ue(Ne)});return Promise.all([xe,Me]).then(function([Ue,Ne]){if(f.destroyed)throw new Error("Loading aborted");const De=new _message_handler.MessageHandler(y,Ue,oe.port),V=new WorkerTransport(De,f,Ne,Ae,ie);f._transport=V,De.send("Ready",null)})}).catch(f._capability.reject),f}async function _fetchDocument(_,f){if(_.destroyed)throw new Error("Worker was destroyed");const y=await _.messageHandler.sendWithPromise("GetDocRequest",f,f.data?[f.data.buffer]:null);if(_.destroyed)throw new Error("Worker was destroyed");return y}function getUrlProp(_){if(_ instanceof URL)return _.href;try{return new URL(_,window.location).href}catch{if(_is_node.isNodeJS&&typeof _=="string")return _}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(_){if(_is_node.isNodeJS&&typeof Buffer<"u"&&_ instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(_ instanceof Uint8Array&&_.byteLength===_.buffer.byteLength)return _;if(typeof _=="string")return(0,_util.stringToBytes)(_);if(typeof _=="object"&&!isNaN(_==null?void 0:_.length)||(0,_util.isArrayBuffer)(_))return new Uint8Array(_);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const e=class e{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${bt(e,r)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var f;this.destroyed=!0,await((f=this._transport)==null?void 0:f.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};r=new WeakMap,se(e,r,0);let PDFDocumentLoadingTask=e;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(f,y,p=!1,k=null){this.length=f,this.initialData=y,this.progressiveDone=p,this.contentDispositionFilename=k,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(f){this._rangeListeners.push(f)}addProgressListener(f){this._progressListeners.push(f)}addProgressiveReadListener(f){this._progressiveReadListeners.push(f)}addProgressiveDoneListener(f){this._progressiveDoneListeners.push(f)}onDataRange(f,y){for(const p of this._rangeListeners)p(f,y)}onDataProgress(f,y){this._readyCapability.promise.then(()=>{for(const p of this._progressListeners)p(f,y)})}onDataProgressiveRead(f){this._readyCapability.promise.then(()=>{for(const y of this._progressiveReadListeners)y(f)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const f of this._progressiveDoneListeners)f()})}transportReady(){this._readyCapability.resolve()}requestDataRange(f,y){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(f,y){this._pdfInfo=f,this._transport=y}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(f){return this._transport.getPage(f)}getPageIndex(f){return this._transport.getPageIndex(f)}getDestinations(){return this._transport.getDestinations()}getDestination(f){return this._transport.getDestination(f)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(f=!1){return this._transport.startCleanup(f||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(f,y,p,k=!1){se(this,s);se(this,o);se(this,t,null);se(this,n,!1);this._pageIndex=f,this._pageInfo=y,this._transport=p,this._stats=k?new _display_utils.StatTimer:null,this._pdfBug=k,this.commonObjs=p.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:f,rotation:y=this.rotate,offsetX:p=0,offsetY:k=0,dontFlip:L=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:f,rotation:y,offsetX:p,offsetY:k,dontFlip:L})}getAnnotations({intent:f="display"}={}){const y=this._transport.getRenderingIntent(f);return this._transport.getAnnotations(this._pageIndex,y.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var f;return((f=this._transport._htmlForXfa)==null?void 0:f.children[this._pageIndex])||null}render({canvasContext:f,viewport:y,intent:p="display",annotationMode:k=_util.AnnotationMode.ENABLE,transform:L=null,background:X=null,optionalContentConfigPromise:N=null,annotationCanvasMap:q=null,pageColors:te=null,printAnnotationStorage:oe=null}){var J,F;(J=this._stats)==null||J.time("Overall");const Q=this._transport.getRenderingIntent(p,k,oe);be(this,n,!1),de(this,o,vt).call(this),N||(N=this._transport.getOptionalContentConfig());let W=this._intentStates.get(Q.cacheKey);W||(W=Object.create(null),this._intentStates.set(Q.cacheKey,W)),W.streamReaderCancelTimeout&&(clearTimeout(W.streamReaderCancelTimeout),W.streamReaderCancelTimeout=null);const pe=!!(Q.renderingIntent&_util.RenderingIntentFlag.PRINT);W.displayReadyCapability||(W.displayReadyCapability=new _util.PromiseCapability,W.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(F=this._stats)==null||F.time("Page Request"),this._pumpOperatorList(Q));const he=I=>{var $,U;W.renderTasks.delete(_e),(this._maybeCleanupAfterRender||pe)&&be(this,n,!0),de(this,s,it).call(this,!pe),I?(_e.capability.reject(I),this._abortOperatorList({intentState:W,reason:I instanceof Error?I:new Error(I)})):_e.capability.resolve(),($=this._stats)==null||$.timeEnd("Rendering"),(U=this._stats)==null||U.timeEnd("Overall")},_e=new InternalRenderTask({callback:he,params:{canvasContext:f,viewport:y,transform:L,background:X},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:q,operatorList:W.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!pe,pdfBug:this._pdfBug,pageColors:te});(W.renderTasks||(W.renderTasks=new Set)).add(_e);const Oe=_e.task;return Promise.all([W.displayReadyCapability.promise,N]).then(([I,$])=>{var U;if(this.destroyed){he();return}(U=this._stats)==null||U.time("Rendering"),_e.initializeGraphics({transparency:I,optionalContentConfig:$}),_e.operatorListChanged()}).catch(he),Oe}getOperatorList({intent:f="display",annotationMode:y=_util.AnnotationMode.ENABLE,printAnnotationStorage:p=null}={}){var q;function k(){X.operatorList.lastChunk&&(X.opListReadCapability.resolve(X.operatorList),X.renderTasks.delete(N))}const L=this._transport.getRenderingIntent(f,y,p,!0);let X=this._intentStates.get(L.cacheKey);X||(X=Object.create(null),this._intentStates.set(L.cacheKey,X));let N;return X.opListReadCapability||(N=Object.create(null),N.operatorListChanged=k,X.opListReadCapability=new _util.PromiseCapability,(X.renderTasks||(X.renderTasks=new Set)).add(N),X.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(q=this._stats)==null||q.time("Page Request"),this._pumpOperatorList(L)),X.opListReadCapability.promise}streamTextContent({includeMarkedContent:f=!1,disableNormalization:y=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:f===!0,disableNormalization:y===!0},{highWaterMark:100,size(k){return k.items.length}})}getTextContent(f={}){if(this._transport._htmlForXfa)return this.getXfa().then(p=>_xfa_text.XfaText.textContent(p));const y=this.streamTextContent(f);return new Promise(function(p,k){function L(){X.read().then(function({value:q,done:te}){if(te){p(N);return}Object.assign(N.styles,q.styles),N.items.push(...q.items),L()},k)}const X=y.getReader(),N={items:[],styles:Object.create(null)};L()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const f=[];for(const y of this._intentStates.values())if(this._abortOperatorList({intentState:y,reason:new Error("Page was destroyed."),force:!0}),!y.opListReadCapability)for(const p of y.renderTasks)f.push(p.completed),p.cancel();return this.objs.clear(),be(this,n,!1),de(this,o,vt).call(this),Promise.all(f)}cleanup(f=!1){be(this,n,!0);const y=de(this,s,it).call(this,!1);return f&&y&&this._stats&&(this._stats=new _display_utils.StatTimer),y}_startRenderPage(f,y){var k,L;const p=this._intentStates.get(y);p&&((k=this._stats)==null||k.timeEnd("Page Request"),(L=p.displayReadyCapability)==null||L.resolve(f))}_renderPageChunk(f,y){for(let p=0,k=f.length;p<k;p++)y.operatorList.fnArray.push(f.fnArray[p]),y.operatorList.argsArray.push(f.argsArray[p]);y.operatorList.lastChunk=f.lastChunk,y.operatorList.separateAnnots=f.separateAnnots;for(const p of y.renderTasks)p.operatorListChanged();f.lastChunk&&de(this,s,it).call(this,!0)}_pumpOperatorList({renderingIntent:f,cacheKey:y,annotationStorageSerializable:p}){const{map:k,transfers:L}=p,N=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:f,cacheKey:y,annotationStorage:k},L).getReader(),q=this._intentStates.get(y);q.streamReader=N;const te=()=>{N.read().then(({value:oe,done:Q})=>{if(Q){q.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(oe,q),te())},oe=>{if(q.streamReader=null,!this._transport.destroyed){if(q.operatorList){q.operatorList.lastChunk=!0;for(const Q of q.renderTasks)Q.operatorListChanged();de(this,s,it).call(this,!0)}if(q.displayReadyCapability)q.displayReadyCapability.reject(oe);else if(q.opListReadCapability)q.opListReadCapability.reject(oe);else throw oe}})};te()}_abortOperatorList({intentState:f,reason:y,force:p=!1}){if(f.streamReader){if(f.streamReaderCancelTimeout&&(clearTimeout(f.streamReaderCancelTimeout),f.streamReaderCancelTimeout=null),!p){if(f.renderTasks.size>0)return;if(y instanceof _display_utils.RenderingCancelledException){let k=RENDERING_CANCELLED_TIMEOUT;y.extraDelay>0&&y.extraDelay<1e3&&(k+=y.extraDelay),f.streamReaderCancelTimeout=setTimeout(()=>{f.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:f,reason:y,force:!0})},k);return}}if(f.streamReader.cancel(new _util.AbortException(y.message)).catch(()=>{}),f.streamReader=null,!this._transport.destroyed){for(const[k,L]of this._intentStates)if(L===f){this._intentStates.delete(k);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,n=new WeakMap,s=new WeakSet,it=function(f=!1){if(de(this,o,vt).call(this),!P(this,n)||this.destroyed)return!1;if(f)return be(this,t,setTimeout(()=>{be(this,t,null),de(this,s,it).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:y,operatorList:p}of this._intentStates.values())if(y.size>0||!p.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),be(this,n,!1),!0},o=new WeakSet,vt=function(){P(this,t)&&(clearTimeout(P(this,t)),be(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){se(this,d,new Set);se(this,c,Promise.resolve())}postMessage(f,y){const p={data:structuredClone(f,y?{transfer:y}:null)};P(this,c).then(()=>{for(const k of P(this,d))k.call(this,p)})}addEventListener(f,y){P(this,d).add(y)}removeEventListener(f,y){P(this,d).delete(y)}terminate(){P(this,d).clear()}}d=new WeakMap,c=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const _=(u=document==null?void 0:document.currentScript)==null?void 0:u.src;_&&(PDFWorkerUtil.fallbackWorkerSrc=_.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(_,f){let y;try{if(y=new URL(_),!y.origin||y.origin==="null")return!1}catch{return!1}const p=new URL(f,y);return y.origin===p.origin},PDFWorkerUtil.createCDNWrapper=function(_){const f=`importScripts("${_}");`;return URL.createObjectURL(new Blob([f]))}}const _PDFWorker=class _PDFWorker{constructor({name:_=null,port:f=null,verbosity:y=(0,_util.getVerbosityLevel)()}={}){if(f&&P(_PDFWorker,h).has(f))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=_,this.destroyed=!1,this.verbosity=y,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,f){P(_PDFWorker,h).set(f,this),this._initializeFromPort(f);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(_){this._port=_,this._messageHandler=new _message_handler.MessageHandler("main","worker",_),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:_}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,_)||(_=PDFWorkerUtil.createCDNWrapper(new URL(_,window.location).href));const f=new Worker(_),y=new _message_handler.MessageHandler("main","worker",f),p=()=>{f.removeEventListener("error",k),y.destroy(),f.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},k=()=>{this._webWorker||p()};f.addEventListener("error",k),y.on("test",X=>{if(f.removeEventListener("error",k),this.destroyed){p();return}X?(this._messageHandler=y,this._port=f,this._webWorker=f,this._readyCapability.resolve(),y.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),y.destroy(),f.terminate())}),y.on("ready",X=>{if(f.removeEventListener("error",k),this.destroyed){p();return}try{L()}catch{this._setupFakeWorker()}});const L=()=>{const X=new Uint8Array;y.send("test",X,[X.buffer])};L();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(_=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const f=new LoopbackPort;this._port=f;const y=`fake${PDFWorkerUtil.fakeWorkerId++}`,p=new _message_handler.MessageHandler(y+"_worker",y,f);_.setup(p,f);const k=new _message_handler.MessageHandler(y,y+"_worker",f);this._messageHandler=k,this._readyCapability.resolve(),k.send("configure",{verbosity:this.verbosity})}).catch(_=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${_.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),P(_PDFWorker,h).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(_){if(!(_!=null&&_.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return P(this,h).has(_.port)?P(this,h).get(_.port):new _PDFWorker(_)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var _;try{return((_=globalThis.pdfjsWorker)==null?void 0:_.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};h=new WeakMap,se(_PDFWorker,h,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(f,y,p,k,L){se(this,g);se(this,b,new Map);se(this,A,new Map);se(this,w,new Map);this.messageHandler=f,this.loadingTask=y,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:k.ownerDocument,styleElement:k.styleElement}),this._params=k,this.canvasFactory=L.canvasFactory,this.filterFactory=L.filterFactory,this.cMapReaderFactory=L.cMapReaderFactory,this.standardFontDataFactory=L.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=p,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(f,y=_util.AnnotationMode.ENABLE,p=null,k=!1){let L=_util.RenderingIntentFlag.DISPLAY,X=_annotation_storage.SerializableEmpty;switch(f){case"any":L=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":L=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${f}`)}switch(y){case _util.AnnotationMode.DISABLE:L+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:L+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:L+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,X=(L&_util.RenderingIntentFlag.PRINT&&p instanceof _annotation_storage.PrintAnnotationStorage?p:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${y}`)}return k&&(L+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:L,cacheKey:`${L}_${X.hash}`,annotationStorageSerializable:X}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const f=[];for(const p of P(this,A).values())f.push(p._destroy());P(this,A).clear(),P(this,w).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const y=this.messageHandler.sendWithPromise("Terminate",null);return f.push(y),Promise.all(f).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),P(this,b).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:f,loadingTask:y}=this;f.on("GetReader",(p,k)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=L=>{this._lastProgress={loaded:L.loaded,total:L.total}},k.onPull=()=>{this._fullReader.read().then(function({value:L,done:X}){if(X){k.close();return}(0,_util.assert)(L instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),k.enqueue(new Uint8Array(L),1,[L])}).catch(L=>{k.error(L)})},k.onCancel=L=>{this._fullReader.cancel(L),k.ready.catch(X=>{if(!this.destroyed)throw X})}}),f.on("ReaderHeadersReady",p=>{const k=new _util.PromiseCapability,L=this._fullReader;return L.headersReady.then(()=>{var X;(!L.isStreamingSupported||!L.isRangeSupported)&&(this._lastProgress&&((X=y.onProgress)==null||X.call(y,this._lastProgress)),L.onProgress=N=>{var q;(q=y.onProgress)==null||q.call(y,{loaded:N.loaded,total:N.total})}),k.resolve({isStreamingSupported:L.isStreamingSupported,isRangeSupported:L.isRangeSupported,contentLength:L.contentLength})},k.reject),k.promise}),f.on("GetRangeReader",(p,k)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const L=this._networkStream.getRangeReader(p.begin,p.end);if(!L){k.close();return}k.onPull=()=>{L.read().then(function({value:X,done:N}){if(N){k.close();return}(0,_util.assert)(X instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),k.enqueue(new Uint8Array(X),1,[X])}).catch(X=>{k.error(X)})},k.onCancel=X=>{L.cancel(X),k.ready.catch(N=>{if(!this.destroyed)throw N})}}),f.on("GetDoc",({pdfInfo:p})=>{this._numPages=p.numPages,this._htmlForXfa=p.htmlForXfa,delete p.htmlForXfa,y._capability.resolve(new PDFDocumentProxy(p,this))}),f.on("DocException",function(p){let k;switch(p.name){case"PasswordException":k=new _util.PasswordException(p.message,p.code);break;case"InvalidPDFException":k=new _util.InvalidPDFException(p.message);break;case"MissingPDFException":k=new _util.MissingPDFException(p.message);break;case"UnexpectedResponseException":k=new _util.UnexpectedResponseException(p.message,p.status);break;case"UnknownErrorException":k=new _util.UnknownErrorException(p.message,p.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}y._capability.reject(k)}),f.on("PasswordRequest",p=>{if(this._passwordCapability=new _util.PromiseCapability,y.onPassword){const k=L=>{L instanceof Error?this._passwordCapability.reject(L):this._passwordCapability.resolve({password:L})};try{y.onPassword(k,p.code)}catch(L){this._passwordCapability.reject(L)}}else this._passwordCapability.reject(new _util.PasswordException(p.message,p.code));return this._passwordCapability.promise}),f.on("DataLoaded",p=>{var k;(k=y.onProgress)==null||k.call(y,{loaded:p.length,total:p.length}),this.downloadInfoCapability.resolve(p)}),f.on("StartRenderPage",p=>{if(this.destroyed)return;P(this,A).get(p.pageIndex)._startRenderPage(p.transparency,p.cacheKey)}),f.on("commonobj",([p,k,L])=>{var X;if(!this.destroyed&&!this.commonObjs.has(p))switch(k){case"Font":const N=this._params;if("error"in L){const oe=L.error;(0,_util.warn)(`Error during font loading: ${oe}`),this.commonObjs.resolve(p,oe);break}const q=N.pdfBug&&((X=globalThis.FontInspector)!=null&&X.enabled)?(oe,Q)=>globalThis.FontInspector.fontAdded(oe,Q):null,te=new _font_loader.FontFaceObject(L,{isEvalSupported:N.isEvalSupported,disableFontFace:N.disableFontFace,ignoreErrors:N.ignoreErrors,inspectFont:q});this.fontLoader.bind(te).catch(oe=>f.sendWithPromise("FontFallback",{id:p})).finally(()=>{!N.fontExtraProperties&&te.data&&(te.data=null),this.commonObjs.resolve(p,te)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(p,L);break;default:throw new Error(`Got unknown common object type ${k}`)}}),f.on("obj",([p,k,L,X])=>{var q;if(this.destroyed)return;const N=P(this,A).get(k);if(!N.objs.has(p))switch(L){case"Image":if(N.objs.resolve(p,X),X){let te;if(X.bitmap){const{width:oe,height:Q}=X;te=oe*Q*4}else te=((q=X.data)==null?void 0:q.length)||0;te>_util.MAX_IMAGE_SIZE_TO_CACHE&&(N._maybeCleanupAfterRender=!0)}break;case"Pattern":N.objs.resolve(p,X);break;default:throw new Error(`Got unknown object type ${L}`)}}),f.on("DocProgress",p=>{var k;this.destroyed||(k=y.onProgress)==null||k.call(y,{loaded:p.loaded,total:p.total})}),f.on("FetchBuiltInCMap",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(p):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),f.on("FetchStandardFontData",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(p):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var p;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:f,transfers:y}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:f,filename:((p=this._fullReader)==null?void 0:p.filename)??null},y).finally(()=>{this.annotationStorage.resetModified()})}getPage(f){if(!Number.isInteger(f)||f<=0||f>this._numPages)return Promise.reject(new Error("Invalid page request."));const y=f-1,p=P(this,w).get(y);if(p)return p;const k=this.messageHandler.sendWithPromise("GetPage",{pageIndex:y}).then(L=>{if(this.destroyed)throw new Error("Transport destroyed");const X=new PDFPageProxy(y,L,this,this._params.pdfBug);return P(this,A).set(y,X),X});return P(this,w).set(y,k),k}getPageIndex(f){return typeof f!="object"||f===null||!Number.isInteger(f.num)||f.num<0||!Number.isInteger(f.gen)||f.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:f.num,gen:f.gen})}getAnnotations(f,y){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:f,intent:y})}getFieldObjects(){return de(this,g,It).call(this,"GetFieldObjects")}hasJSActions(){return de(this,g,It).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(f){return typeof f!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:f})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(f){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:f})}getStructTree(f){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:f})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(f=>new _optional_content_config.OptionalContentConfig(f))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const f="GetMetadata",y=P(this,b).get(f);if(y)return y;const p=this.messageHandler.sendWithPromise(f,null).then(k=>{var L,X;return{info:k[0],metadata:k[1]?new _metadata.Metadata(k[1]):null,contentDispositionFilename:((L=this._fullReader)==null?void 0:L.filename)??null,contentLength:((X=this._fullReader)==null?void 0:X.contentLength)??null}});return P(this,b).set(f,p),p}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(f=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const y of P(this,A).values())if(!y.cleanup())throw new Error(`startCleanup: Page ${y.pageNumber} is currently rendering.`);this.commonObjs.clear(),f||this.fontLoader.clear(),P(this,b).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:f,enableXfa:y}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:f,enableXfa:y})}}b=new WeakMap,A=new WeakMap,w=new WeakMap,g=new WeakSet,It=function(f,y=null){const p=P(this,b).get(f);if(p)return p;const k=this.messageHandler.sendWithPromise(f,y);return P(this,b).set(f,k),k};class PDFObjects{constructor(){se(this,C);se(this,T,Object.create(null))}get(f,y=null){if(y){const k=de(this,C,Rt).call(this,f);return k.capability.promise.then(()=>y(k.data)),null}const p=P(this,T)[f];if(!(p!=null&&p.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${f}.`);return p.data}has(f){const y=P(this,T)[f];return(y==null?void 0:y.capability.settled)||!1}resolve(f,y=null){const p=de(this,C,Rt).call(this,f);p.data=y,p.capability.resolve()}clear(){var f;for(const y in P(this,T)){const{data:p}=P(this,T)[y];(f=p==null?void 0:p.bitmap)==null||f.close()}be(this,T,Object.create(null))}}T=new WeakMap,C=new WeakSet,Rt=function(f){const y=P(this,T)[f];return y||(P(this,T)[f]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(f){se(this,S,null);be(this,S,f),this.onContinue=null}get promise(){return P(this,S).capability.promise}cancel(f=0){P(this,S).cancel(null,f)}get separateAnnots(){const{separateAnnots:f}=P(this,S).operatorList;if(!f)return!1;const{annotationCanvasMap:y}=P(this,S);return f.form||f.canvas&&(y==null?void 0:y.size)>0}}S=new WeakMap,exports.RenderTask=RenderTask;const m=class m{constructor({callback:f,params:y,objs:p,commonObjs:k,annotationCanvasMap:L,operatorList:X,pageIndex:N,canvasFactory:q,filterFactory:te,useRequestAnimationFrame:oe=!1,pdfBug:Q=!1,pageColors:W=null}){this.callback=f,this.params=y,this.objs=p,this.commonObjs=k,this.annotationCanvasMap=L,this.operatorListIdx=null,this.operatorList=X,this._pageIndex=N,this.canvasFactory=q,this.filterFactory=te,this._pdfBug=Q,this.pageColors=W,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=oe===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=y.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:f=!1,optionalContentConfig:y}){var N,q;if(this.cancelled)return;if(this._canvas){if(P(m,D).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");P(m,D).add(this._canvas)}this._pdfBug&&((N=globalThis.StepperManager)!=null&&N.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:p,viewport:k,transform:L,background:X}=this.params;this.gfx=new _canvas.CanvasGraphics(p,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:y},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:L,viewport:k,transparency:f,background:X}),this.operatorListIdx=0,this.graphicsReady=!0,(q=this.graphicsReadyCallback)==null||q.call(this)}cancel(f=null,y=0){var p;this.running=!1,this.cancelled=!0,(p=this.gfx)==null||p.endDrawing(),this._canvas&&P(m,D).delete(this._canvas),this.callback(f||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,y))}operatorListChanged(){var f;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(f=this.stepper)==null||f.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&P(m,D).delete(this._canvas),this.callback())))}};D=new WeakMap,se(m,D,new WeakSet);let InternalRenderTask=m;const version="3.8.162";exports.version=version;const build="2c74323e3";exports.build=build},(r,e,t)=>{var c,u,h,an,A;Object.defineProperty(e,"__esModule",{value:!0}),e.SerializableEmpty=e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var n=t(1),s=t(4),a=t(8);const o=Object.freeze({map:null,hash:"",transfers:void 0});e.SerializableEmpty=o;class l{constructor(){se(this,h);se(this,c,!1);se(this,u,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(g,v){const T=P(this,u).get(g);return T===void 0?v:Object.assign(v,T)}getRawValue(g){return P(this,u).get(g)}remove(g){if(P(this,u).delete(g),P(this,u).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const v of P(this,u).values())if(v instanceof s.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(g,v){const T=P(this,u).get(g);let C=!1;if(T!==void 0)for(const[x,S]of Object.entries(v))T[x]!==S&&(C=!0,T[x]=S);else C=!0,P(this,u).set(g,v);C&&de(this,h,an).call(this),v instanceof s.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(v.constructor._type)}has(g){return P(this,u).has(g)}getAll(){return P(this,u).size>0?(0,n.objectFromMap)(P(this,u)):null}setAll(g){for(const[v,T]of Object.entries(g))this.setValue(v,T)}get size(){return P(this,u).size}resetModified(){P(this,c)&&(be(this,c,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new d(this)}get serializable(){if(P(this,u).size===0)return o;const g=new Map,v=new a.MurmurHash3_64,T=[];for(const[C,x]of P(this,u)){const S=x instanceof s.AnnotationEditor?x.serialize():x;S&&(g.set(C,S),v.update(`${C}:${JSON.stringify(S)}`),S.bitmap&&T.push(S.bitmap))}return g.size>0?{map:g,hash:v.hexdigest(),transfers:T}:o}}c=new WeakMap,u=new WeakMap,h=new WeakSet,an=function(){P(this,c)||(be(this,c,!0),typeof this.onSetModified=="function"&&this.onSetModified())},e.AnnotationStorage=l;class d extends l{constructor(v){super();se(this,A,void 0);const{map:T,hash:C,transfers:x}=v.serializable,S=structuredClone(T,x?{transfer:x}:null);be(this,A,{map:S,hash:C,transfers:x})}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return P(this,A)}}A=new WeakMap,e.PrintAnnotationStorage=d},(r,e,t)=>{var l,d,c,u,h,b;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var n=t(5),s=t(1);const A=class A{constructor(g){se(this,l,this.focusin.bind(this));se(this,d,this.focusout.bind(this));se(this,c,!1);se(this,u,!1);se(this,h,!1);ze(this,"_uiManager",null);se(this,b,A._zIndex++);this.constructor===A&&(0,s.unreachable)("Cannot initialize AnnotationEditor."),this.parent=g.parent,this.id=g.id,this.width=this.height=null,this.pageIndex=g.parent.pageIndex,this.name=g.name,this.div=null,this._uiManager=g.uiManager,this.annotationElementId=null;const{rotation:v,rawDims:{pageWidth:T,pageHeight:C,pageX:x,pageY:S}}=this.parent.viewport;this.rotation=v,this.pageRotation=(360+v-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[T,C],this.pageTranslation=[x,S];const[D,m]=this.parentDimensions;this.x=g.x/D,this.y=g.y/m,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,s.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(g){const v=new o({id:g.parent.getNextId(),parent:g.parent,uiManager:g._uiManager});v.annotationElementId=g.annotationElementId,v.deleted=!0,v._uiManager.addToAnnotationStorage(v)}addCommands(g){this._uiManager.addCommands(g)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=P(this,b)}setParent(g){g!==null&&(this.pageIndex=g.pageIndex,this.pageDimensions=g.pageDimensions),this.parent=g}focusin(g){P(this,c)?be(this,c,!1):this.parent.setSelected(this)}focusout(g){var T;if(!this.isAttachedToDOM)return;const v=g.relatedTarget;v!=null&&v.closest(`#${this.id}`)||(g.preventDefault(),(T=this.parent)!=null&&T.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(g){const v=this.parent.div.getBoundingClientRect();this.startX=g.clientX-v.x,this.startY=g.clientY-v.y,g.dataTransfer.setData("text/plain",this.id),g.dataTransfer.effectAllowed="move"}setAt(g,v,T,C){const[x,S]=this.parentDimensions;[T,C]=this.screenToPageTranslation(T,C),this.x=(g+T)/x,this.y=(v+C)/S,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(g,v){const[T,C]=this.parentDimensions;[g,v]=this.screenToPageTranslation(g,v),this.x+=g/T,this.y+=v/C,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(g,v){switch(this.parentRotation){case 90:return[v,-g];case 180:return[-g,-v];case 270:return[-v,g];default:return[g,v]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:g}=this._uiManager.viewParameters,[v,T]=this.pageDimensions;return[v*g,T*g]}setDims(g,v){const[T,C]=this.parentDimensions;this.div.style.width=`${100*g/T}%`,this.div.style.height=`${100*v/C}%`}fixDims(){const{style:g}=this.div,{height:v,width:T}=g,C=T.endsWith("%"),x=v.endsWith("%");if(C&&x)return;const[S,D]=this.parentDimensions;C||(g.width=`${100*parseFloat(T)/S}%`),x||(g.height=`${100*parseFloat(v)/D}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",P(this,l)),this.div.addEventListener("focusout",P(this,d));const[g,v]=this.getInitialTranslation();return this.translate(g,v),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(g){const{isMac:v}=s.FeatureTest.platform;if(g.button!==0||g.ctrlKey&&v){g.preventDefault();return}g.ctrlKey&&!v||g.shiftKey||g.metaKey&&v?this.parent.toggleSelected(this):this.parent.setSelected(this),be(this,c,!0)}getRect(g,v){const T=this.parentScale,[C,x]=this.pageDimensions,[S,D]=this.pageTranslation,m=g/T,_=v/T,f=this.x*C,y=this.y*x,p=this.width*C,k=this.height*x;switch(this.rotation){case 0:return[f+m+S,x-y-_-k+D,f+m+p+S,x-y-_+D];case 90:return[f+_+S,x-y+m+D,f+_+k+S,x-y+m+p+D];case 180:return[f-m-p+S,x-y+_+D,f-m+S,x-y+_+k+D];case 270:return[f-_-k+S,x-y-m-p+D,f-_+S,x-y-m+D];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(g,v){const[T,C,x,S]=g,D=x-T,m=S-C;switch(this.rotation){case 0:return[T,v-S,D,m];case 90:return[T,v-C,m,D];case 180:return[x,v-C,D,m];case 270:return[x,v-S,m,D];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){be(this,h,!0)}disableEditMode(){be(this,h,!1)}isInEditMode(){return P(this,h)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var g,v;(g=this.div)==null||g.addEventListener("focusin",P(this,l)),(v=this.div)==null||v.addEventListener("focusout",P(this,d))}serialize(g=!1){(0,s.unreachable)("An editor must be serializable")}static deserialize(g,v,T){const C=new this.prototype.constructor({parent:v,id:v.getNextId(),uiManager:T});C.rotation=g.rotation;const[x,S]=C.pageDimensions,[D,m,_,f]=C.getRectInCurrentCoords(g.rect,S);return C.x=D/x,C.y=m/S,C.width=_/x,C.height=f/S,C}remove(){this.div.removeEventListener("focusin",P(this,l)),this.div.removeEventListener("focusout",P(this,d)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var g;(g=this.div)==null||g.classList.add("selectedEditor")}unselect(){var g;(g=this.div)==null||g.classList.remove("selectedEditor")}updateParams(g,v){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return P(this,u)}set isEditing(g){be(this,u,g),g?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};l=new WeakMap,d=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap,b=new WeakMap,ze(A,"_colorManager",new n.ColorManager),ze(A,"_zIndex",1);let a=A;e.AnnotationEditor=a;class o extends a{constructor(g){super(g),this.annotationElementId=g.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(r,e,t)=>{var b,A,w,g,v,T,on,S,D,m,_,f,y,p,k,L,X,N,q,te,oe,Q,W,pe,he,_e,Oe,J,F,I,$,U,ln,O,Ft,K,cn,ne,un,fe,et,me,dt,Re,dn,ye,hn,ie,Dt,Ae,ht,Me,Mt;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=a,e.opacityToHex=o;var n=t(1),s=t(6);function a(De,V,H){for(const ee of H)V.addEventListener(ee,De[ee].bind(De))}function o(De){return Math.round(Math.min(255,Math.max(1,255*De))).toString(16).padStart(2,"0")}class l{constructor(){se(this,b,0)}getId(){return`${n.AnnotationEditorPrefix}${bt(this,b)._++}`}}b=new WeakMap;class d{constructor(V=128){se(this,A,[]);se(this,w,!1);se(this,g,void 0);se(this,v,-1);be(this,g,V)}add({cmd:V,undo:H,mustExec:ee,type:ge=NaN,overwriteIfSameType:Fe=!1,keepUndo:je=!1}){if(ee&&V(),P(this,w))return;const Ve={cmd:V,undo:H,type:ge};if(P(this,v)===-1){P(this,A).length>0&&(P(this,A).length=0),be(this,v,0),P(this,A).push(Ve);return}if(Fe&&P(this,A)[P(this,v)].type===ge){je&&(Ve.undo=P(this,A)[P(this,v)].undo),P(this,A)[P(this,v)]=Ve;return}const Ze=P(this,v)+1;Ze===P(this,g)?P(this,A).splice(0,1):(be(this,v,Ze),Ze<P(this,A).length&&P(this,A).splice(Ze)),P(this,A).push(Ve)}undo(){P(this,v)!==-1&&(be(this,w,!0),P(this,A)[P(this,v)].undo(),be(this,w,!1),be(this,v,P(this,v)-1))}redo(){P(this,v)<P(this,A).length-1&&(be(this,v,P(this,v)+1),be(this,w,!0),P(this,A)[P(this,v)].cmd(),be(this,w,!1))}hasSomethingToUndo(){return P(this,v)!==-1}hasSomethingToRedo(){return P(this,v)<P(this,A).length-1}destroy(){be(this,A,null)}}A=new WeakMap,w=new WeakMap,g=new WeakMap,v=new WeakMap,e.CommandManager=d;class c{constructor(V){se(this,T);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:H}=n.FeatureTest.platform;for(const[ee,ge,Fe=!1]of V)for(const je of ee){const Ve=je.startsWith("mac+");H&&Ve?(this.callbacks.set(je.slice(4),{callback:ge,bubbles:Fe}),this.allKeys.add(je.split("+").at(-1))):!H&&!Ve&&(this.callbacks.set(je,{callback:ge,bubbles:Fe}),this.allKeys.add(je.split("+").at(-1)))}}exec(V,H){if(!this.allKeys.has(H.key))return;const ee=this.callbacks.get(de(this,T,on).call(this,H));if(!ee)return;const{callback:ge,bubbles:Fe}=ee;ge.bind(V)(),Fe||(H.stopPropagation(),H.preventDefault())}}T=new WeakSet,on=function(V){V.altKey&&this.buffer.push("alt"),V.ctrlKey&&this.buffer.push("ctrl"),V.metaKey&&this.buffer.push("meta"),V.shiftKey&&this.buffer.push("shift"),this.buffer.push(V.key);const H=this.buffer.join("+");return this.buffer.length=0,H},e.KeyboardManager=c;const x=class x{get _colors(){const V=new Map([["CanvasText",null],["Canvas",null]]);return(0,s.getColorValues)(V),(0,n.shadow)(this,"_colors",V)}convert(V){const H=(0,s.getRGB)(V);if(!window.matchMedia("(forced-colors: active)").matches)return H;for(const[ee,ge]of this._colors)if(ge.every((Fe,je)=>Fe===H[je]))return x._colorsMapping.get(ee);return H}getHexCode(V){const H=this._colors.get(V);return H?n.Util.makeHexColor(...H):V}};ze(x,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let u=x;e.ColorManager=u;const Ne=class Ne{constructor(V,H,ee){se(this,U);se(this,O);se(this,K);se(this,ne);se(this,fe);se(this,me);se(this,Re);se(this,ye);se(this,ie);se(this,Ae);se(this,Me);se(this,S,null);se(this,D,new Map);se(this,m,new Map);se(this,_,null);se(this,f,new d);se(this,y,0);se(this,p,new Set);se(this,k,null);se(this,L,new Set);se(this,X,null);se(this,N,new l);se(this,q,!1);se(this,te,n.AnnotationEditorType.NONE);se(this,oe,new Set);se(this,Q,this.copy.bind(this));se(this,W,this.cut.bind(this));se(this,pe,this.paste.bind(this));se(this,he,this.keydown.bind(this));se(this,_e,this.onEditingAction.bind(this));se(this,Oe,this.onPageChanging.bind(this));se(this,J,this.onScaleChanging.bind(this));se(this,F,this.onRotationChanging.bind(this));se(this,I,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});se(this,$,null);be(this,$,V),be(this,X,H),P(this,X)._on("editingaction",P(this,_e)),P(this,X)._on("pagechanging",P(this,Oe)),P(this,X)._on("scalechanging",P(this,J)),P(this,X)._on("rotationchanging",P(this,F)),be(this,_,ee),this.viewParameters={realScale:s.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){return(0,n.shadow)(this,"_keyboardManager",new c([[["ctrl+a","mac+meta+a"],Ne.prototype.selectAll],[["ctrl+z","mac+meta+z"],Ne.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],Ne.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],Ne.prototype.delete],[["Escape","mac+Escape"],Ne.prototype.unselectAll]]))}destroy(){de(this,O,Ft).call(this),P(this,X)._off("editingaction",P(this,_e)),P(this,X)._off("pagechanging",P(this,Oe)),P(this,X)._off("scalechanging",P(this,J)),P(this,X)._off("rotationchanging",P(this,F));for(const V of P(this,m).values())V.destroy();P(this,m).clear(),P(this,D).clear(),P(this,L).clear(),be(this,S,null),P(this,oe).clear(),P(this,f).destroy()}onPageChanging({pageNumber:V}){be(this,y,V-1)}focusMainContainer(){P(this,$).focus()}addShouldRescale(V){P(this,L).add(V)}removeShouldRescale(V){P(this,L).delete(V)}onScaleChanging({scale:V}){this.commitOrRemove(),this.viewParameters.realScale=V*s.PixelsPerInch.PDF_TO_CSS_UNITS;for(const H of P(this,L))H.onScaleChanging()}onRotationChanging({pagesRotation:V}){this.commitOrRemove(),this.viewParameters.rotation=V}addToAnnotationStorage(V){!V.isEmpty()&&P(this,_)&&!P(this,_).has(V.id)&&P(this,_).setValue(V.id,V)}copy(V){if(V.preventDefault(),P(this,S)&&P(this,S).commitOrRemove(),!this.hasSelection)return;const H=[];for(const ee of P(this,oe)){const ge=ee.serialize(!0);ge&&H.push(ge)}H.length!==0&&V.clipboardData.setData("application/pdfjs",JSON.stringify(H))}cut(V){this.copy(V),this.delete()}paste(V){V.preventDefault();let H=V.clipboardData.getData("application/pdfjs");if(!H)return;try{H=JSON.parse(H)}catch(ge){(0,n.warn)(`paste: "${ge.message}".`);return}if(!Array.isArray(H))return;this.unselectAll();const ee=P(this,m).get(P(this,y));try{const ge=[];for(const Ve of H){const Ze=ee.deserialize(Ve);if(!Ze)return;ge.push(Ze)}const Fe=()=>{for(const Ve of ge)de(this,ie,Dt).call(this,Ve);de(this,Me,Mt).call(this,ge)},je=()=>{for(const Ve of ge)Ve.remove()};this.addCommands({cmd:Fe,undo:je,mustExec:!0})}catch(ge){(0,n.warn)(`paste: "${ge.message}".`)}}keydown(V){var H;(H=this.getActive())!=null&&H.shouldGetKeyboardEvents()||Ne._keyboardManager.exec(this,V)}onEditingAction(V){["undo","redo","delete","selectAll"].includes(V.name)&&this[V.name]()}setEditingState(V){V?(de(this,U,ln).call(this),de(this,K,cn).call(this),de(this,fe,et).call(this,{isEditing:P(this,te)!==n.AnnotationEditorType.NONE,isEmpty:de(this,Ae,ht).call(this),hasSomethingToUndo:P(this,f).hasSomethingToUndo(),hasSomethingToRedo:P(this,f).hasSomethingToRedo(),hasSelectedEditor:!1})):(de(this,O,Ft).call(this),de(this,ne,un).call(this),de(this,fe,et).call(this,{isEditing:!1}))}registerEditorTypes(V){if(!P(this,k)){be(this,k,V);for(const H of P(this,k))de(this,me,dt).call(this,H.defaultPropertiesToUpdate)}}getId(){return P(this,N).getId()}get currentLayer(){return P(this,m).get(P(this,y))}get currentPageIndex(){return P(this,y)}addLayer(V){P(this,m).set(V.pageIndex,V),P(this,q)?V.enable():V.disable()}removeLayer(V){P(this,m).delete(V.pageIndex)}updateMode(V){if(be(this,te,V),V===n.AnnotationEditorType.NONE)this.setEditingState(!1),de(this,ye,hn).call(this);else{this.setEditingState(!0),de(this,Re,dn).call(this);for(const H of P(this,m).values())H.updateMode(V)}}updateToolbar(V){V!==P(this,te)&&P(this,X).dispatch("switchannotationeditormode",{source:this,mode:V})}updateParams(V,H){if(P(this,k)){for(const ee of P(this,oe))ee.updateParams(V,H);for(const ee of P(this,k))ee.updateDefaultParams(V,H)}}getEditors(V){const H=[];for(const ee of P(this,D).values())ee.pageIndex===V&&H.push(ee);return H}getEditor(V){return P(this,D).get(V)}addEditor(V){P(this,D).set(V.id,V)}removeEditor(V){var H;P(this,D).delete(V.id),this.unselect(V),(!V.annotationElementId||!P(this,p).has(V.annotationElementId))&&((H=P(this,_))==null||H.remove(V.id))}addDeletedAnnotationElement(V){P(this,p).add(V.annotationElementId),V.deleted=!0}isDeletedAnnotationElement(V){return P(this,p).has(V)}removeDeletedAnnotationElement(V){P(this,p).delete(V.annotationElementId),V.deleted=!1}setActiveEditor(V){P(this,S)!==V&&(be(this,S,V),V&&de(this,me,dt).call(this,V.propertiesToUpdate))}toggleSelected(V){if(P(this,oe).has(V)){P(this,oe).delete(V),V.unselect(),de(this,fe,et).call(this,{hasSelectedEditor:this.hasSelection});return}P(this,oe).add(V),V.select(),de(this,me,dt).call(this,V.propertiesToUpdate),de(this,fe,et).call(this,{hasSelectedEditor:!0})}setSelected(V){for(const H of P(this,oe))H!==V&&H.unselect();P(this,oe).clear(),P(this,oe).add(V),V.select(),de(this,me,dt).call(this,V.propertiesToUpdate),de(this,fe,et).call(this,{hasSelectedEditor:!0})}isSelected(V){return P(this,oe).has(V)}unselect(V){V.unselect(),P(this,oe).delete(V),de(this,fe,et).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return P(this,oe).size!==0}undo(){P(this,f).undo(),de(this,fe,et).call(this,{hasSomethingToUndo:P(this,f).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:de(this,Ae,ht).call(this)})}redo(){P(this,f).redo(),de(this,fe,et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:P(this,f).hasSomethingToRedo(),isEmpty:de(this,Ae,ht).call(this)})}addCommands(V){P(this,f).add(V),de(this,fe,et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:de(this,Ae,ht).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const V=[...P(this,oe)],H=()=>{for(const ge of V)ge.remove()},ee=()=>{for(const ge of V)de(this,ie,Dt).call(this,ge)};this.addCommands({cmd:H,undo:ee,mustExec:!0})}commitOrRemove(){var V;(V=P(this,S))==null||V.commitOrRemove()}selectAll(){for(const V of P(this,oe))V.commit();de(this,Me,Mt).call(this,P(this,D).values())}unselectAll(){if(P(this,S)){P(this,S).commitOrRemove();return}if(P(this,oe).size!==0){for(const V of P(this,oe))V.unselect();P(this,oe).clear(),de(this,fe,et).call(this,{hasSelectedEditor:!1})}}isActive(V){return P(this,S)===V}getActive(){return P(this,S)}getMode(){return P(this,te)}};S=new WeakMap,D=new WeakMap,m=new WeakMap,_=new WeakMap,f=new WeakMap,y=new WeakMap,p=new WeakMap,k=new WeakMap,L=new WeakMap,X=new WeakMap,N=new WeakMap,q=new WeakMap,te=new WeakMap,oe=new WeakMap,Q=new WeakMap,W=new WeakMap,pe=new WeakMap,he=new WeakMap,_e=new WeakMap,Oe=new WeakMap,J=new WeakMap,F=new WeakMap,I=new WeakMap,$=new WeakMap,U=new WeakSet,ln=function(){P(this,$).addEventListener("keydown",P(this,he))},O=new WeakSet,Ft=function(){P(this,$).removeEventListener("keydown",P(this,he))},K=new WeakSet,cn=function(){document.addEventListener("copy",P(this,Q)),document.addEventListener("cut",P(this,W)),document.addEventListener("paste",P(this,pe))},ne=new WeakSet,un=function(){document.removeEventListener("copy",P(this,Q)),document.removeEventListener("cut",P(this,W)),document.removeEventListener("paste",P(this,pe))},fe=new WeakSet,et=function(V){Object.entries(V).some(([ee,ge])=>P(this,I)[ee]!==ge)&&P(this,X).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(P(this,I),V)})},me=new WeakSet,dt=function(V){P(this,X).dispatch("annotationeditorparamschanged",{source:this,details:V})},Re=new WeakSet,dn=function(){if(!P(this,q)){be(this,q,!0);for(const V of P(this,m).values())V.enable()}},ye=new WeakSet,hn=function(){if(this.unselectAll(),P(this,q)){be(this,q,!1);for(const V of P(this,m).values())V.disable()}},ie=new WeakSet,Dt=function(V){const H=P(this,m).get(V.pageIndex);H?H.addOrRebuild(V):this.addEditor(V)},Ae=new WeakSet,ht=function(){if(P(this,D).size===0)return!0;if(P(this,D).size===1)for(const V of P(this,D).values())return V.isEmpty();return!1},Me=new WeakSet,Mt=function(V){P(this,oe).clear();for(const H of V)H.isEmpty()||(P(this,oe).add(H),H.select());de(this,fe,et).call(this,{hasSelectedEditor:!0})};let h=Ne;e.AnnotationEditorUIManager=h},(r,e,t)=>{var oe,Q,W,pe,he,_e,Oe,J,F,I,$,U,at,O,ot,K,Lt,ne,At,fe,wt,me,ft,Re,pt;Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMFilterFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=_,e.getColorValues=L,e.getCurrentTransform=X,e.getCurrentTransformInverse=N,e.getFilenameFromUrl=C,e.getPdfFilenameFromUrl=x,e.getRGB=k,e.getXfaPageViewport=p,e.isDataScheme=v,e.isPdfFile=T,e.isValidFetchUrl=D,e.loadScript=m,e.setLayerDimensions=q;var n=t(7),s=t(1);const a="http://www.w3.org/2000/svg",o="pdfjs_internal_id_";e.AnnotationPrefix=o;const te=class te{};ze(te,"CSS",96),ze(te,"PDF",72),ze(te,"PDF_TO_CSS_UNITS",te.CSS/te.PDF);let l=te;e.PixelsPerInch=l;class d extends n.BaseFilterFactory{constructor({docId:ie,ownerDocument:ve=globalThis.document}={}){super();se(this,U);se(this,O);se(this,K);se(this,ne);se(this,fe);se(this,me);se(this,Re);se(this,oe,void 0);se(this,Q,void 0);se(this,W,void 0);se(this,pe,void 0);se(this,he,void 0);se(this,_e,void 0);se(this,Oe,void 0);se(this,J,void 0);se(this,F,void 0);se(this,I,void 0);se(this,$,0);be(this,W,ie),be(this,pe,ve)}addFilter(ie){if(!ie)return"none";let ve=P(this,U,at).get(ie);if(ve)return ve;let Ae,xe,Me,Ue;if(ie.length===1){const H=ie[0],ee=new Array(256);for(let ge=0;ge<256;ge++)ee[ge]=H[ge]/255;Ue=Ae=xe=Me=ee.join(",")}else{const[H,ee,ge]=ie,Fe=new Array(256),je=new Array(256),Ve=new Array(256);for(let Ze=0;Ze<256;Ze++)Fe[Ze]=H[Ze]/255,je[Ze]=ee[Ze]/255,Ve[Ze]=ge[Ze]/255;Ae=Fe.join(","),xe=je.join(","),Me=Ve.join(","),Ue=`${Ae}${xe}${Me}`}if(ve=P(this,U,at).get(Ue),ve)return P(this,U,at).set(ie,ve),ve;const Ne=`g_${P(this,W)}_transfer_map_${bt(this,$)._++}`,De=`url(#${Ne})`;P(this,U,at).set(ie,De),P(this,U,at).set(Ue,De);const V=de(this,ne,At).call(this,Ne);return de(this,me,ft).call(this,Ae,xe,Me,V),De}addHCMFilter(ie,ve){var ee;const Ae=`${ie}-${ve}`;if(P(this,_e)===Ae)return P(this,Oe);if(be(this,_e,Ae),be(this,Oe,"none"),(ee=P(this,he))==null||ee.remove(),!ie||!ve)return P(this,Oe);const xe=de(this,Re,pt).call(this,ie);ie=s.Util.makeHexColor(...xe);const Me=de(this,Re,pt).call(this,ve);if(ve=s.Util.makeHexColor(...Me),P(this,O,ot).style.color="",ie==="#000000"&&ve==="#ffffff"||ie===ve)return P(this,Oe);const Ue=new Array(256);for(let ge=0;ge<=255;ge++){const Fe=ge/255;Ue[ge]=Fe<=.03928?Fe/12.92:((Fe+.055)/1.055)**2.4}const Ne=Ue.join(","),De=`g_${P(this,W)}_hcm_filter`,V=be(this,J,de(this,ne,At).call(this,De));de(this,me,ft).call(this,Ne,Ne,Ne,V),de(this,K,Lt).call(this,V);const H=(ge,Fe)=>{const je=xe[ge]/255,Ve=Me[ge]/255,Ze=new Array(Fe+1);for(let Qe=0;Qe<=Fe;Qe++)Ze[Qe]=je+Qe/Fe*(Ve-je);return Ze.join(",")};return de(this,me,ft).call(this,H(0,5),H(1,5),H(2,5),V),be(this,Oe,`url(#${De})`),P(this,Oe)}addHighlightHCMFilter(ie,ve,Ae,xe){var Ve;const Me=`${ie}-${ve}-${Ae}-${xe}`;if(P(this,F)===Me)return P(this,I);if(be(this,F,Me),be(this,I,"none"),(Ve=P(this,J))==null||Ve.remove(),!ie||!ve)return P(this,I);const[Ue,Ne]=[ie,ve].map(de(this,Re,pt).bind(this));let De=Math.round(.2126*Ue[0]+.7152*Ue[1]+.0722*Ue[2]),V=Math.round(.2126*Ne[0]+.7152*Ne[1]+.0722*Ne[2]),[H,ee]=[Ae,xe].map(de(this,Re,pt).bind(this));V<De&&([De,V,H,ee]=[V,De,ee,H]),P(this,O,ot).style.color="";const ge=(Ze,Qe,We)=>{const Xe=new Array(256),Le=(V-De)/We,Z=Ze/255,j=(Qe-Ze)/(255*We);let R=0;for(let B=0;B<=We;B++){const G=Math.round(De+B*Le),re=Z+B*j;for(let ce=R;ce<=G;ce++)Xe[ce]=re;R=G+1}for(let B=R;B<256;B++)Xe[B]=Xe[R-1];return Xe.join(",")},Fe=`g_${P(this,W)}_hcm_highlight_filter`,je=be(this,J,de(this,ne,At).call(this,Fe));return de(this,K,Lt).call(this,je),de(this,me,ft).call(this,ge(H[0],ee[0],5),ge(H[1],ee[1],5),ge(H[2],ee[2],5),je),be(this,I,`url(#${Fe})`),P(this,I)}destroy(ie=!1){ie&&(P(this,Oe)||P(this,I))||(P(this,Q)&&(P(this,Q).parentNode.parentNode.remove(),be(this,Q,null)),P(this,oe)&&(P(this,oe).clear(),be(this,oe,null)),be(this,$,0))}}oe=new WeakMap,Q=new WeakMap,W=new WeakMap,pe=new WeakMap,he=new WeakMap,_e=new WeakMap,Oe=new WeakMap,J=new WeakMap,F=new WeakMap,I=new WeakMap,$=new WeakMap,U=new WeakSet,at=function(){return P(this,oe)||be(this,oe,new Map)},O=new WeakSet,ot=function(){if(!P(this,Q)){const ie=P(this,pe).createElement("div"),{style:ve}=ie;ve.visibility="hidden",ve.contain="strict",ve.width=ve.height=0,ve.position="absolute",ve.top=ve.left=0,ve.zIndex=-1;const Ae=P(this,pe).createElementNS(a,"svg");Ae.setAttribute("width",0),Ae.setAttribute("height",0),be(this,Q,P(this,pe).createElementNS(a,"defs")),ie.append(Ae),Ae.append(P(this,Q)),P(this,pe).body.append(ie)}return P(this,Q)},K=new WeakSet,Lt=function(ie){const ve=P(this,pe).createElementNS(a,"feColorMatrix");ve.setAttribute("type","matrix"),ve.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),ie.append(ve)},ne=new WeakSet,At=function(ie){const ve=P(this,pe).createElementNS(a,"filter");return ve.setAttribute("color-interpolation-filters","sRGB"),ve.setAttribute("id",ie),P(this,O,ot).append(ve),ve},fe=new WeakSet,wt=function(ie,ve,Ae){const xe=P(this,pe).createElementNS(a,ve);xe.setAttribute("type","discrete"),xe.setAttribute("tableValues",Ae),ie.append(xe)},me=new WeakSet,ft=function(ie,ve,Ae,xe){const Me=P(this,pe).createElementNS(a,"feComponentTransfer");xe.append(Me),de(this,fe,wt).call(this,Me,"feFuncR",ie),de(this,fe,wt).call(this,Me,"feFuncG",ve),de(this,fe,wt).call(this,Me,"feFuncB",Ae)},Re=new WeakSet,pt=function(ie){return P(this,O,ot).style.color=ie,k(getComputedStyle(P(this,O,ot)).getPropertyValue("color"))},e.DOMFilterFactory=d;class c extends n.BaseCanvasFactory{constructor({ownerDocument:ae=globalThis.document}={}){super(),this._document=ae}_createCanvas(ae,ie){const ve=this._document.createElement("canvas");return ve.width=ae,ve.height=ie,ve}}e.DOMCanvasFactory=c;async function u(ye,ae=!1){if(D(ye,document.baseURI)){const ie=await fetch(ye);if(!ie.ok)throw new Error(ie.statusText);return ae?new Uint8Array(await ie.arrayBuffer()):(0,s.stringToBytes)(await ie.text())}return new Promise((ie,ve)=>{const Ae=new XMLHttpRequest;Ae.open("GET",ye,!0),ae&&(Ae.responseType="arraybuffer"),Ae.onreadystatechange=()=>{if(Ae.readyState===XMLHttpRequest.DONE){if(Ae.status===200||Ae.status===0){let xe;if(ae&&Ae.response?xe=new Uint8Array(Ae.response):!ae&&Ae.responseText&&(xe=(0,s.stringToBytes)(Ae.responseText)),xe){ie(xe);return}}ve(new Error(Ae.statusText))}},Ae.send(null)})}class h extends n.BaseCMapReaderFactory{_fetchData(ae,ie){return u(ae,this.isCompressed).then(ve=>({cMapData:ve,compressionType:ie}))}}e.DOMCMapReaderFactory=h;class b extends n.BaseStandardFontDataFactory{_fetchData(ae){return u(ae,!0)}}e.DOMStandardFontDataFactory=b;class A extends n.BaseSVGFactory{_createSVG(ae){return document.createElementNS(a,ae)}}e.DOMSVGFactory=A;class w{constructor({viewBox:ae,scale:ie,rotation:ve,offsetX:Ae=0,offsetY:xe=0,dontFlip:Me=!1}){this.viewBox=ae,this.scale=ie,this.rotation=ve,this.offsetX=Ae,this.offsetY=xe;const Ue=(ae[2]+ae[0])/2,Ne=(ae[3]+ae[1])/2;let De,V,H,ee;switch(ve%=360,ve<0&&(ve+=360),ve){case 180:De=-1,V=0,H=0,ee=1;break;case 90:De=0,V=1,H=1,ee=0;break;case 270:De=0,V=-1,H=-1,ee=0;break;case 0:De=1,V=0,H=0,ee=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Me&&(H=-H,ee=-ee);let ge,Fe,je,Ve;De===0?(ge=Math.abs(Ne-ae[1])*ie+Ae,Fe=Math.abs(Ue-ae[0])*ie+xe,je=(ae[3]-ae[1])*ie,Ve=(ae[2]-ae[0])*ie):(ge=Math.abs(Ue-ae[0])*ie+Ae,Fe=Math.abs(Ne-ae[1])*ie+xe,je=(ae[2]-ae[0])*ie,Ve=(ae[3]-ae[1])*ie),this.transform=[De*ie,V*ie,H*ie,ee*ie,ge-De*ie*Ue-H*ie*Ne,Fe-V*ie*Ue-ee*ie*Ne],this.width=je,this.height=Ve}get rawDims(){const{viewBox:ae}=this;return(0,s.shadow)(this,"rawDims",{pageWidth:ae[2]-ae[0],pageHeight:ae[3]-ae[1],pageX:ae[0],pageY:ae[1]})}clone({scale:ae=this.scale,rotation:ie=this.rotation,offsetX:ve=this.offsetX,offsetY:Ae=this.offsetY,dontFlip:xe=!1}={}){return new w({viewBox:this.viewBox.slice(),scale:ae,rotation:ie,offsetX:ve,offsetY:Ae,dontFlip:xe})}convertToViewportPoint(ae,ie){return s.Util.applyTransform([ae,ie],this.transform)}convertToViewportRectangle(ae){const ie=s.Util.applyTransform([ae[0],ae[1]],this.transform),ve=s.Util.applyTransform([ae[2],ae[3]],this.transform);return[ie[0],ie[1],ve[0],ve[1]]}convertToPdfPoint(ae,ie){return s.Util.applyInverseTransform([ae,ie],this.transform)}}e.PageViewport=w;class g extends s.BaseException{constructor(ae,ie=0){super(ae,"RenderingCancelledException"),this.extraDelay=ie}}e.RenderingCancelledException=g;function v(ye){const ae=ye.length;let ie=0;for(;ie<ae&&ye[ie].trim()==="";)ie++;return ye.substring(ie,ie+5).toLowerCase()==="data:"}function T(ye){return typeof ye=="string"&&/\.pdf$/i.test(ye)}function C(ye,ae=!1){return ae||([ye]=ye.split(/[#?]/,1)),ye.substring(ye.lastIndexOf("/")+1)}function x(ye,ae="document.pdf"){if(typeof ye!="string")return ae;if(v(ye))return(0,s.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),ae;const ie=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,ve=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Ae=ie.exec(ye);let xe=ve.exec(Ae[1])||ve.exec(Ae[2])||ve.exec(Ae[3]);if(xe&&(xe=xe[0],xe.includes("%")))try{xe=ve.exec(decodeURIComponent(xe))[0]}catch{}return xe||ae}class S{constructor(){ze(this,"started",Object.create(null));ze(this,"times",[])}time(ae){ae in this.started&&(0,s.warn)(`Timer is already running for ${ae}`),this.started[ae]=Date.now()}timeEnd(ae){ae in this.started||(0,s.warn)(`Timer has not been started for ${ae}`),this.times.push({name:ae,start:this.started[ae],end:Date.now()}),delete this.started[ae]}toString(){const ae=[];let ie=0;for(const{name:ve}of this.times)ie=Math.max(ve.length,ie);for(const{name:ve,start:Ae,end:xe}of this.times)ae.push(`${ve.padEnd(ie)} ${xe-Ae}ms
`);return ae.join("")}}e.StatTimer=S;function D(ye,ae){try{const{protocol:ie}=ae?new URL(ye,ae):new URL(ye);return ie==="http:"||ie==="https:"}catch{return!1}}function m(ye,ae=!1){return new Promise((ie,ve)=>{const Ae=document.createElement("script");Ae.src=ye,Ae.onload=function(xe){ae&&Ae.remove(),ie(xe)},Ae.onerror=function(){ve(new Error(`Cannot load script at: ${Ae.src}`))},(document.head||document.documentElement).append(Ae)})}function _(ye){console.log("Deprecated API usage: "+ye)}let f;class y{static toDateObject(ae){if(!ae||typeof ae!="string")return null;f||(f=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const ie=f.exec(ae);if(!ie)return null;const ve=parseInt(ie[1],10);let Ae=parseInt(ie[2],10);Ae=Ae>=1&&Ae<=12?Ae-1:0;let xe=parseInt(ie[3],10);xe=xe>=1&&xe<=31?xe:1;let Me=parseInt(ie[4],10);Me=Me>=0&&Me<=23?Me:0;let Ue=parseInt(ie[5],10);Ue=Ue>=0&&Ue<=59?Ue:0;let Ne=parseInt(ie[6],10);Ne=Ne>=0&&Ne<=59?Ne:0;const De=ie[7]||"Z";let V=parseInt(ie[8],10);V=V>=0&&V<=23?V:0;let H=parseInt(ie[9],10)||0;return H=H>=0&&H<=59?H:0,De==="-"?(Me+=V,Ue+=H):De==="+"&&(Me-=V,Ue-=H),new Date(Date.UTC(ve,Ae,xe,Me,Ue,Ne))}}e.PDFDateString=y;function p(ye,{scale:ae=1,rotation:ie=0}){const{width:ve,height:Ae}=ye.attributes.style,xe=[0,0,parseInt(ve),parseInt(Ae)];return new w({viewBox:xe,scale:ae,rotation:ie})}function k(ye){if(ye.startsWith("#")){const ae=parseInt(ye.slice(1),16);return[(ae&16711680)>>16,(ae&65280)>>8,ae&255]}return ye.startsWith("rgb(")?ye.slice(4,-1).split(",").map(ae=>parseInt(ae)):ye.startsWith("rgba(")?ye.slice(5,-1).split(",").map(ae=>parseInt(ae)).slice(0,3):((0,s.warn)(`Not a valid color format: "${ye}"`),[0,0,0])}function L(ye){const ae=document.createElement("span");ae.style.visibility="hidden",document.body.append(ae);for(const ie of ye.keys()){ae.style.color=ie;const ve=window.getComputedStyle(ae).color;ye.set(ie,k(ve))}ae.remove()}function X(ye){const{a:ae,b:ie,c:ve,d:Ae,e:xe,f:Me}=ye.getTransform();return[ae,ie,ve,Ae,xe,Me]}function N(ye){const{a:ae,b:ie,c:ve,d:Ae,e:xe,f:Me}=ye.getTransform().invertSelf();return[ae,ie,ve,Ae,xe,Me]}function q(ye,ae,ie=!1,ve=!0){if(ae instanceof w){const{pageWidth:Ae,pageHeight:xe}=ae.rawDims,{style:Me}=ye,Ue=`calc(var(--scale-factor) * ${Ae}px)`,Ne=`calc(var(--scale-factor) * ${xe}px)`;!ie||ae.rotation%180===0?(Me.width=Ue,Me.height=Ne):(Me.width=Ne,Me.height=Ue)}ve&&ye.setAttribute("data-main-rotation",ae.rotation)}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseFilterFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var n=t(1);class s{constructor(){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(u){return"none"}addHCMFilter(u,h){return"none"}addHighlightHCMFilter(u,h,b,A){return"none"}destroy(u=!1){}}e.BaseFilterFactory=s;class a{constructor(){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(u,h){if(u<=0||h<=0)throw new Error("Invalid canvas size");const b=this._createCanvas(u,h);return{canvas:b,context:b.getContext("2d")}}reset(u,h,b){if(!u.canvas)throw new Error("Canvas is not specified");if(h<=0||b<=0)throw new Error("Invalid canvas size");u.canvas.width=h,u.canvas.height=b}destroy(u){if(!u.canvas)throw new Error("Canvas is not specified");u.canvas.width=0,u.canvas.height=0,u.canvas=null,u.context=null}_createCanvas(u,h){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=a;class o{constructor({baseUrl:u=null,isCompressed:h=!0}){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=u,this.isCompressed=h}async fetch({name:u}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!u)throw new Error("CMap name must be specified.");const h=this.baseUrl+u+(this.isCompressed?".bcmap":""),b=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(h,b).catch(A=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${h}`)})}_fetchData(u,h){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class l{constructor({baseUrl:u=null}){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=u}async fetch({filename:u}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!u)throw new Error("Font filename must be specified.");const h=`${this.baseUrl}${u}`;return this._fetchData(h).catch(b=>{throw new Error(`Unable to load font data at: ${h}`)})}_fetchData(u){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=l;class d{constructor(){this.constructor===d&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(u,h,b=!1){if(u<=0||h<=0)throw new Error("Invalid SVG dimensions");const A=this._createSVG("svg:svg");return A.setAttribute("version","1.1"),b||(A.setAttribute("width",`${u}px`),A.setAttribute("height",`${h}px`)),A.setAttribute("preserveAspectRatio","none"),A.setAttribute("viewBox",`0 0 ${u} ${h}`),A}createElement(u){if(typeof u!="string")throw new Error("Invalid SVG element type");return this._createSVG(u)}_createSVG(u){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=d},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var n=t(1);const s=3285377520,a=4294901760,o=65535;class l{constructor(c){this.h1=c?c&4294967295:s,this.h2=c?c&4294967295:s}update(c){let u,h;if(typeof c=="string"){u=new Uint8Array(c.length*2),h=0;for(let _=0,f=c.length;_<f;_++){const y=c.charCodeAt(_);y<=255?u[h++]=y:(u[h++]=y>>>8,u[h++]=y&255)}}else if((0,n.isArrayBuffer)(c))u=c.slice(),h=u.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const b=h>>2,A=h-b*4,w=new Uint32Array(u.buffer,0,b);let g=0,v=0,T=this.h1,C=this.h2;const x=3432918353,S=461845907,D=x&o,m=S&o;for(let _=0;_<b;_++)_&1?(g=w[_],g=g*x&a|g*D&o,g=g<<15|g>>>17,g=g*S&a|g*m&o,T^=g,T=T<<13|T>>>19,T=T*5+3864292196):(v=w[_],v=v*x&a|v*D&o,v=v<<15|v>>>17,v=v*S&a|v*m&o,C^=v,C=C<<13|C>>>19,C=C*5+3864292196);switch(g=0,A){case 3:g^=u[b*4+2]<<16;case 2:g^=u[b*4+1]<<8;case 1:g^=u[b*4],g=g*x&a|g*D&o,g=g<<15|g>>>17,g=g*S&a|g*m&o,b&1?T^=g:C^=g}this.h1=T,this.h2=C}hexdigest(){let c=this.h1,u=this.h2;return c^=u>>>1,c=c*3981806797&a|c*36045&o,u=u*4283543511&a|((u<<16|c>>>16)*2950163797&a)>>>16,c^=u>>>1,c=c*444984403&a|c*60499&o,u=u*3301882366&a|((u<<16|c>>>16)*3120437893&a)>>>16,c^=u>>>1,(c>>>0).toString(16).padStart(8,"0")+(u>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=l},(r,e,t)=>{var l;Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var n=t(1),s=t(10);class a{constructor({ownerDocument:c=globalThis.document,styleElement:u=null}){se(this,l,new Set);this._document=c,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(c){this.nativeFontFaces.add(c),this._document.fonts.add(c)}removeNativeFontFace(c){this.nativeFontFaces.delete(c),this._document.fonts.delete(c)}insertRule(c){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const u=this.styleElement.sheet;u.insertRule(c,u.cssRules.length)}clear(){for(const c of this.nativeFontFaces)this._document.fonts.delete(c);this.nativeFontFaces.clear(),P(this,l).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(c){if(!(!c||P(this,l).has(c.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:u,src:h,style:b}=c,A=new FontFace(u,h,b);this.addNativeFontFace(A);try{await A.load(),P(this,l).add(u)}catch{(0,n.warn)(`Cannot load system font: ${c.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(A)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(c){if(c.attached||c.missingFile&&!c.systemFontInfo)return;if(c.attached=!0,c.systemFontInfo){await this.loadSystemFont(c.systemFontInfo);return}if(this.isFontLoadingAPISupported){const h=c.createNativeFontFace();if(h){this.addNativeFontFace(h);try{await h.loaded}catch(b){throw(0,n.warn)(`Failed to load font '${h.family}': '${b}'.`),c.disableFontFace=!0,b}}return}const u=c.createFontFaceRule();if(u){if(this.insertRule(u),this.isSyncFontLoadingSupported)return;await new Promise(h=>{const b=this._queueLoadingCallback(h);this._prepareFontLoadEvent(c,b)})}}get isFontLoadingAPISupported(){var u;const c=!!((u=this._document)!=null&&u.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",c)}get isSyncFontLoadingSupported(){let c=!1;return(s.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(c=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",c)}_queueLoadingCallback(c){function u(){for((0,n.assert)(!b.done,"completeRequest() cannot be called twice."),b.done=!0;h.length>0&&h[0].done;){const A=h.shift();setTimeout(A.callback,0)}}const{loadingRequests:h}=this,b={done:!1,complete:u,callback:c};return h.push(b),b}get _loadTestFont(){const c=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",c)}_prepareFontLoadEvent(c,u){function h(L,X){return L.charCodeAt(X)<<24|L.charCodeAt(X+1)<<16|L.charCodeAt(X+2)<<8|L.charCodeAt(X+3)&255}function b(L,X,N,q){const te=L.substring(0,X),oe=L.substring(X+N);return te+q+oe}let A,w;const g=this._document.createElement("canvas");g.width=1,g.height=1;const v=g.getContext("2d");let T=0;function C(L,X){if(++T>30){(0,n.warn)("Load test font never loaded."),X();return}if(v.font="30px "+L,v.fillText(".",0,20),v.getImageData(0,0,1,1).data[3]>0){X();return}setTimeout(C.bind(null,L,X))}const x=`lt${Date.now()}${this.loadTestFontId++}`;let S=this._loadTestFont;S=b(S,976,x.length,x);const m=16,_=1482184792;let f=h(S,m);for(A=0,w=x.length-3;A<w;A+=4)f=f-_+h(x,A)|0;A<x.length&&(f=f-_+h(x+"XXX",A)|0),S=b(S,m,4,(0,n.string32)(f));const y=`url(data:font/opentype;base64,${btoa(S)});`,p=`@font-face {font-family:"${x}";src:${y}}`;this.insertRule(p);const k=this._document.createElement("div");k.style.visibility="hidden",k.style.width=k.style.height="10px",k.style.position="absolute",k.style.top=k.style.left="0px";for(const L of[c.loadedName,x]){const X=this._document.createElement("span");X.textContent="Hi",X.style.fontFamily=L,k.append(X)}this._document.body.append(k),C(x,()=>{k.remove(),u.complete()})}}l=new WeakMap,e.FontLoader=a;class o{constructor(c,{isEvalSupported:u=!0,disableFontFace:h=!1,ignoreErrors:b=!1,inspectFont:A=null}){this.compiledGlyphs=Object.create(null);for(const w in c)this[w]=c[w];this.isEvalSupported=u!==!1,this.disableFontFace=h===!0,this.ignoreErrors=b===!0,this._inspectFont=A}createNativeFontFace(){var u;if(!this.data||this.disableFontFace)return null;let c;if(!this.cssFontInfo)c=new FontFace(this.loadedName,this.data,{});else{const h={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(h.style=`oblique ${this.cssFontInfo.italicAngle}deg`),c=new FontFace(this.cssFontInfo.fontFamily,this.data,h)}return(u=this._inspectFont)==null||u.call(this,this),c}createFontFaceRule(){var b;if(!this.data||this.disableFontFace)return null;const c=(0,n.bytesToString)(this.data),u=`url(data:${this.mimetype};base64,${btoa(c)});`;let h;if(!this.cssFontInfo)h=`@font-face {font-family:"${this.loadedName}";src:${u}}`;else{let A=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(A+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),h=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${A}src:${u}}`}return(b=this._inspectFont)==null||b.call(this,this,u),h}getPathGenerator(c,u){if(this.compiledGlyphs[u]!==void 0)return this.compiledGlyphs[u];let h;try{h=c.get(this.loadedName+"_path_"+u)}catch(b){if(!this.ignoreErrors)throw b;return(0,n.warn)(`getPathGenerator - ignoring character: "${b}".`),this.compiledGlyphs[u]=function(A,w){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const b=[];for(const A of h){const w=A.args!==void 0?A.args.join(","):"";b.push("c.",A.cmd,"(",w,`);
`)}return this.compiledGlyphs[u]=new Function("c","size",b.join(""))}return this.compiledGlyphs[u]=function(b,A){for(const w of h)w.cmd==="scale"&&(w.args=[A,-A]),b[w.cmd].apply(b,w.args)}}}e.FontFaceObject=o},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(r,e,t)=>{var W,Nt,he,jt;Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var n=t(1),s=t(6),a=t(12),o=t(13),l=t(10);const d=16,c=100,u=4096,h=15,b=10,A=1e3,w=16;function g(J,F){if(J._removeMirroring)throw new Error("Context is already forwarding operations.");J.__originalSave=J.save,J.__originalRestore=J.restore,J.__originalRotate=J.rotate,J.__originalScale=J.scale,J.__originalTranslate=J.translate,J.__originalTransform=J.transform,J.__originalSetTransform=J.setTransform,J.__originalResetTransform=J.resetTransform,J.__originalClip=J.clip,J.__originalMoveTo=J.moveTo,J.__originalLineTo=J.lineTo,J.__originalBezierCurveTo=J.bezierCurveTo,J.__originalRect=J.rect,J.__originalClosePath=J.closePath,J.__originalBeginPath=J.beginPath,J._removeMirroring=()=>{J.save=J.__originalSave,J.restore=J.__originalRestore,J.rotate=J.__originalRotate,J.scale=J.__originalScale,J.translate=J.__originalTranslate,J.transform=J.__originalTransform,J.setTransform=J.__originalSetTransform,J.resetTransform=J.__originalResetTransform,J.clip=J.__originalClip,J.moveTo=J.__originalMoveTo,J.lineTo=J.__originalLineTo,J.bezierCurveTo=J.__originalBezierCurveTo,J.rect=J.__originalRect,J.closePath=J.__originalClosePath,J.beginPath=J.__originalBeginPath,delete J._removeMirroring},J.save=function(){F.save(),this.__originalSave()},J.restore=function(){F.restore(),this.__originalRestore()},J.translate=function($,U){F.translate($,U),this.__originalTranslate($,U)},J.scale=function($,U){F.scale($,U),this.__originalScale($,U)},J.transform=function($,U,E,O,M,K){F.transform($,U,E,O,M,K),this.__originalTransform($,U,E,O,M,K)},J.setTransform=function($,U,E,O,M,K){F.setTransform($,U,E,O,M,K),this.__originalSetTransform($,U,E,O,M,K)},J.resetTransform=function(){F.resetTransform(),this.__originalResetTransform()},J.rotate=function($){F.rotate($),this.__originalRotate($)},J.clip=function($){F.clip($),this.__originalClip($)},J.moveTo=function(I,$){F.moveTo(I,$),this.__originalMoveTo(I,$)},J.lineTo=function(I,$){F.lineTo(I,$),this.__originalLineTo(I,$)},J.bezierCurveTo=function(I,$,U,E,O,M){F.bezierCurveTo(I,$,U,E,O,M),this.__originalBezierCurveTo(I,$,U,E,O,M)},J.rect=function(I,$,U,E){F.rect(I,$,U,E),this.__originalRect(I,$,U,E)},J.closePath=function(){F.closePath(),this.__originalClosePath()},J.beginPath=function(){F.beginPath(),this.__originalBeginPath()}}class v{constructor(F){this.canvasFactory=F,this.cache=Object.create(null)}getCanvas(F,I,$){let U;return this.cache[F]!==void 0?(U=this.cache[F],this.canvasFactory.reset(U,I,$)):(U=this.canvasFactory.create(I,$),this.cache[F]=U),U}delete(F){delete this.cache[F]}clear(){for(const F in this.cache){const I=this.cache[F];this.canvasFactory.destroy(I),delete this.cache[F]}}}function T(J,F,I,$,U,E,O,M,K,Y){const[ne,ue,fe,we,me,Ce]=(0,s.getCurrentTransform)(J);if(ue===0&&fe===0){const ye=O*ne+me,ae=Math.round(ye),ie=M*we+Ce,ve=Math.round(ie),Ae=(O+K)*ne+me,xe=Math.abs(Math.round(Ae)-ae)||1,Me=(M+Y)*we+Ce,Ue=Math.abs(Math.round(Me)-ve)||1;return J.setTransform(Math.sign(ne),0,0,Math.sign(we),ae,ve),J.drawImage(F,I,$,U,E,0,0,xe,Ue),J.setTransform(ne,ue,fe,we,me,Ce),[xe,Ue]}if(ne===0&&we===0){const ye=M*fe+me,ae=Math.round(ye),ie=O*ue+Ce,ve=Math.round(ie),Ae=(M+Y)*fe+me,xe=Math.abs(Math.round(Ae)-ae)||1,Me=(O+K)*ue+Ce,Ue=Math.abs(Math.round(Me)-ve)||1;return J.setTransform(0,Math.sign(ue),Math.sign(fe),0,ae,ve),J.drawImage(F,I,$,U,E,0,0,Ue,xe),J.setTransform(ne,ue,fe,we,me,Ce),[Ue,xe]}J.drawImage(F,I,$,U,E,O,M,K,Y);const Re=Math.hypot(ne,ue),Te=Math.hypot(fe,we);return[Re*K,Te*Y]}function C(J){const{width:F,height:I}=J;if(F>A||I>A)return null;const $=1e3,U=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),E=F+1;let O=new Uint8Array(E*(I+1)),M,K,Y;const ne=F+7&-8;let ue=new Uint8Array(ne*I),fe=0;for(const Te of J.data){let ye=128;for(;ye>0;)ue[fe++]=Te&ye?0:255,ye>>=1}let we=0;for(fe=0,ue[fe]!==0&&(O[0]=1,++we),K=1;K<F;K++)ue[fe]!==ue[fe+1]&&(O[K]=ue[fe]?2:1,++we),fe++;for(ue[fe]!==0&&(O[K]=2,++we),M=1;M<I;M++){fe=M*ne,Y=M*E,ue[fe-ne]!==ue[fe]&&(O[Y]=ue[fe]?1:8,++we);let Te=(ue[fe]?4:0)+(ue[fe-ne]?8:0);for(K=1;K<F;K++)Te=(Te>>2)+(ue[fe+1]?4:0)+(ue[fe-ne+1]?8:0),U[Te]&&(O[Y+K]=U[Te],++we),fe++;if(ue[fe-ne]!==ue[fe]&&(O[Y+K]=ue[fe]?2:4,++we),we>$)return null}for(fe=ne*(I-1),Y=M*E,ue[fe]!==0&&(O[Y]=8,++we),K=1;K<F;K++)ue[fe]!==ue[fe+1]&&(O[Y+K]=ue[fe]?4:8,++we),fe++;if(ue[fe]!==0&&(O[Y+K]=4,++we),we>$)return null;const me=new Int32Array([0,E,-1,0,-E,0,0,0,1]),Ce=new Path2D;for(M=0;we&&M<=I;M++){let Te=M*E;const ye=Te+F;for(;Te<ye&&!O[Te];)Te++;if(Te===ye)continue;Ce.moveTo(Te%E,M);const ae=Te;let ie=O[Te];do{const ve=me[ie];do Te+=ve;while(!O[Te]);const Ae=O[Te];Ae!==5&&Ae!==10?(ie=Ae,O[Te]=0):(ie=Ae&51*ie>>4,O[Te]&=ie>>2|ie<<2),Ce.lineTo(Te%E,Te/E|0),O[Te]||--we}while(ae!==Te);--M}return ue=null,O=null,function(Te){Te.save(),Te.scale(1/F,-1/I),Te.translate(0,-I),Te.fill(Ce),Te.beginPath(),Te.restore()}}class x{constructor(F,I){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,F,I])}clone(){const F=Object.create(this);return F.clipBox=this.clipBox.slice(),F}setCurrentPoint(F,I){this.x=F,this.y=I}updatePathMinMax(F,I,$){[I,$]=n.Util.applyTransform([I,$],F),this.minX=Math.min(this.minX,I),this.minY=Math.min(this.minY,$),this.maxX=Math.max(this.maxX,I),this.maxY=Math.max(this.maxY,$)}updateRectMinMax(F,I){const $=n.Util.applyTransform(I,F),U=n.Util.applyTransform(I.slice(2),F);this.minX=Math.min(this.minX,$[0],U[0]),this.minY=Math.min(this.minY,$[1],U[1]),this.maxX=Math.max(this.maxX,$[0],U[0]),this.maxY=Math.max(this.maxY,$[1],U[1])}updateScalingPathMinMax(F,I){n.Util.scaleMinMax(F,I),this.minX=Math.min(this.minX,I[0]),this.maxX=Math.max(this.maxX,I[1]),this.minY=Math.min(this.minY,I[2]),this.maxY=Math.max(this.maxY,I[3])}updateCurvePathMinMax(F,I,$,U,E,O,M,K,Y,ne){const ue=n.Util.bezierBoundingBox(I,$,U,E,O,M,K,Y);if(ne){ne[0]=Math.min(ne[0],ue[0],ue[2]),ne[1]=Math.max(ne[1],ue[0],ue[2]),ne[2]=Math.min(ne[2],ue[1],ue[3]),ne[3]=Math.max(ne[3],ue[1],ue[3]);return}this.updateRectMinMax(F,ue)}getPathBoundingBox(F=a.PathType.FILL,I=null){const $=[this.minX,this.minY,this.maxX,this.maxY];if(F===a.PathType.STROKE){I||(0,n.unreachable)("Stroke bounding box must include transform.");const U=n.Util.singularValueDecompose2dScale(I),E=U[0]*this.lineWidth/2,O=U[1]*this.lineWidth/2;$[0]-=E,$[1]-=O,$[2]+=E,$[3]+=O}return $}updateClipFromPath(){const F=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(F||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(F){this.clipBox=F,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(F=a.PathType.FILL,I=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(F,I))}}function S(J,F){if(typeof ImageData<"u"&&F instanceof ImageData){J.putImageData(F,0,0);return}const I=F.height,$=F.width,U=I%w,E=(I-U)/w,O=U===0?E:E+1,M=J.createImageData($,w);let K=0,Y;const ne=F.data,ue=M.data;let fe,we,me,Ce;if(F.kind===n.ImageKind.GRAYSCALE_1BPP){const Re=ne.byteLength,Te=new Uint32Array(ue.buffer,0,ue.byteLength>>2),ye=Te.length,ae=$+7>>3,ie=4294967295,ve=n.FeatureTest.isLittleEndian?4278190080:255;for(fe=0;fe<O;fe++){for(me=fe<E?w:U,Y=0,we=0;we<me;we++){const Ae=Re-K;let xe=0;const Me=Ae>ae?$:Ae*8-7,Ue=Me&-8;let Ne=0,De=0;for(;xe<Ue;xe+=8)De=ne[K++],Te[Y++]=De&128?ie:ve,Te[Y++]=De&64?ie:ve,Te[Y++]=De&32?ie:ve,Te[Y++]=De&16?ie:ve,Te[Y++]=De&8?ie:ve,Te[Y++]=De&4?ie:ve,Te[Y++]=De&2?ie:ve,Te[Y++]=De&1?ie:ve;for(;xe<Me;xe++)Ne===0&&(De=ne[K++],Ne=128),Te[Y++]=De&Ne?ie:ve,Ne>>=1}for(;Y<ye;)Te[Y++]=0;J.putImageData(M,0,fe*w)}}else if(F.kind===n.ImageKind.RGBA_32BPP){for(we=0,Ce=$*w*4,fe=0;fe<E;fe++)ue.set(ne.subarray(K,K+Ce)),K+=Ce,J.putImageData(M,0,we),we+=w;fe<O&&(Ce=$*U*4,ue.set(ne.subarray(K,K+Ce)),J.putImageData(M,0,we))}else if(F.kind===n.ImageKind.RGB_24BPP)for(me=w,Ce=$*me,fe=0;fe<O;fe++){for(fe>=E&&(me=U,Ce=$*me),Y=0,we=Ce;we--;)ue[Y++]=ne[K++],ue[Y++]=ne[K++],ue[Y++]=ne[K++],ue[Y++]=255;J.putImageData(M,0,fe*w)}else throw new Error(`bad image kind: ${F.kind}`)}function D(J,F){if(F.bitmap){J.drawImage(F.bitmap,0,0);return}const I=F.height,$=F.width,U=I%w,E=(I-U)/w,O=U===0?E:E+1,M=J.createImageData($,w);let K=0;const Y=F.data,ne=M.data;for(let ue=0;ue<O;ue++){const fe=ue<E?w:U;({srcPos:K}=(0,o.convertBlackAndWhiteToRGBA)({src:Y,srcPos:K,dest:ne,width:$,height:fe,nonBlackColor:0})),J.putImageData(M,0,ue*w)}}function m(J,F){const I=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const $ of I)J[$]!==void 0&&(F[$]=J[$]);J.setLineDash!==void 0&&(F.setLineDash(J.getLineDash()),F.lineDashOffset=J.lineDashOffset)}function _(J){J.strokeStyle=J.fillStyle="#000000",J.fillRule="nonzero",J.globalAlpha=1,J.lineWidth=1,J.lineCap="butt",J.lineJoin="miter",J.miterLimit=10,J.globalCompositeOperation="source-over",J.font="10px sans-serif",J.setLineDash!==void 0&&(J.setLineDash([]),J.lineDashOffset=0),l.isNodeJS||(J.filter="none")}function f(J,F,I,$){const U=J.length;for(let E=3;E<U;E+=4){const O=J[E];if(O===0)J[E-3]=F,J[E-2]=I,J[E-1]=$;else if(O<255){const M=255-O;J[E-3]=J[E-3]*O+F*M>>8,J[E-2]=J[E-2]*O+I*M>>8,J[E-1]=J[E-1]*O+$*M>>8}}}function y(J,F,I){const $=J.length,U=1/255;for(let E=3;E<$;E+=4){const O=I?I[J[E]]:J[E];F[E]=F[E]*O*U|0}}function p(J,F,I){const $=J.length;for(let U=3;U<$;U+=4){const E=J[U-3]*77+J[U-2]*152+J[U-1]*28;F[U]=I?F[U]*I[E>>8]>>8:F[U]*E>>16}}function k(J,F,I,$,U,E,O,M,K,Y,ne){const ue=!!E,fe=ue?E[0]:0,we=ue?E[1]:0,me=ue?E[2]:0;let Ce;U==="Luminosity"?Ce=p:Ce=y;const Te=Math.min($,Math.ceil(1048576/I));for(let ye=0;ye<$;ye+=Te){const ae=Math.min(Te,$-ye),ie=J.getImageData(M-Y,ye+(K-ne),I,ae),ve=F.getImageData(M,ye+K,I,ae);ue&&f(ie.data,fe,we,me),Ce(ie.data,ve.data,O),F.putImageData(ve,M,ye+K)}}function L(J,F,I,$){const U=$[0],E=$[1],O=$[2]-U,M=$[3]-E;O===0||M===0||(k(F.context,I,O,M,F.subtype,F.backdrop,F.transferMap,U,E,F.offsetX,F.offsetY),J.save(),J.globalAlpha=1,J.globalCompositeOperation="source-over",J.setTransform(1,0,0,1,0,0),J.drawImage(I.canvas,0,0),J.restore())}function X(J,F){const I=n.Util.singularValueDecompose2dScale(J);I[0]=Math.fround(I[0]),I[1]=Math.fround(I[1]);const $=Math.fround((globalThis.devicePixelRatio||1)*s.PixelsPerInch.PDF_TO_CSS_UNITS);return F!==void 0?F:I[0]<=$||I[1]<=$}const N=["butt","round","square"],q=["miter","round","bevel"],te={},oe={},Oe=class Oe{constructor(F,I,$,U,E,{optionalContentConfig:O,markedContentStack:M=null},K,Y){se(this,W);se(this,he);this.ctx=F,this.current=new x(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=I,this.objs=$,this.canvasFactory=U,this.filterFactory=E,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=M||[],this.optionalContentConfig=O,this.cachedCanvases=new v(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=K,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=Y,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(F,I=null){return typeof F=="string"?F.startsWith("g_")?this.commonObjs.get(F):this.objs.get(F):I}beginDrawing({transform:F,viewport:I,transparency:$=!1,background:U=null}){const E=this.ctx.canvas.width,O=this.ctx.canvas.height,M=this.ctx.fillStyle;if(this.ctx.fillStyle=U||"#ffffff",this.ctx.fillRect(0,0,E,O),this.ctx.fillStyle=M,$){const K=this.cachedCanvases.getCanvas("transparent",E,O);this.compositeCtx=this.ctx,this.transparentCanvas=K.canvas,this.ctx=K.context,this.ctx.save(),this.ctx.transform(...(0,s.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),_(this.ctx),F&&(this.ctx.transform(...F),this.outputScaleX=F[0],this.outputScaleY=F[0]),this.ctx.transform(...I.transform),this.viewportScale=I.scale,this.baseTransform=(0,s.getCurrentTransform)(this.ctx)}executeOperatorList(F,I,$,U){const E=F.argsArray,O=F.fnArray;let M=I||0;const K=E.length;if(K===M)return M;const Y=K-M>b&&typeof $=="function",ne=Y?Date.now()+h:0;let ue=0;const fe=this.commonObjs,we=this.objs;let me;for(;;){if(U!==void 0&&M===U.nextBreakPoint)return U.breakIt(M,$),M;if(me=O[M],me!==n.OPS.dependency)this[me].apply(this,E[M]);else for(const Ce of E[M]){const Re=Ce.startsWith("g_")?fe:we;if(!Re.has(Ce))return Re.get(Ce,$),M}if(M++,M===K)return M;if(Y&&++ue>b){if(Date.now()>ne)return $(),M;ue=0}}}endDrawing(){de(this,W,Nt).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const F of this._cachedBitmapsMap.values()){for(const I of F.values())typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement&&(I.width=I.height=0);F.clear()}this._cachedBitmapsMap.clear(),de(this,he,jt).call(this)}_scaleImage(F,I){const $=F.width,U=F.height;let E=Math.max(Math.hypot(I[0],I[1]),1),O=Math.max(Math.hypot(I[2],I[3]),1),M=$,K=U,Y="prescale1",ne,ue;for(;E>2&&M>1||O>2&&K>1;){let fe=M,we=K;E>2&&M>1&&(fe=M>=16384?Math.floor(M/2)-1||1:Math.ceil(M/2),E/=M/fe),O>2&&K>1&&(we=K>=16384?Math.floor(K/2)-1||1:Math.ceil(K)/2,O/=K/we),ne=this.cachedCanvases.getCanvas(Y,fe,we),ue=ne.context,ue.clearRect(0,0,fe,we),ue.drawImage(F,0,0,M,K,0,0,fe,we),F=ne.canvas,M=fe,K=we,Y=Y==="prescale1"?"prescale2":"prescale1"}return{img:F,paintWidth:M,paintHeight:K}}_createMaskCanvas(F){const I=this.ctx,{width:$,height:U}=F,E=this.current.fillColor,O=this.current.patternFill,M=(0,s.getCurrentTransform)(I);let K,Y,ne,ue;if((F.bitmap||F.data)&&F.count>1){const xe=F.bitmap||F.data.buffer;Y=JSON.stringify(O?M:[M.slice(0,4),E]),K=this._cachedBitmapsMap.get(xe),K||(K=new Map,this._cachedBitmapsMap.set(xe,K));const Me=K.get(Y);if(Me&&!O){const Ue=Math.round(Math.min(M[0],M[2])+M[4]),Ne=Math.round(Math.min(M[1],M[3])+M[5]);return{canvas:Me,offsetX:Ue,offsetY:Ne}}ne=Me}ne||(ue=this.cachedCanvases.getCanvas("maskCanvas",$,U),D(ue.context,F));let fe=n.Util.transform(M,[1/$,0,0,-1/U,0,0]);fe=n.Util.transform(fe,[1,0,0,1,0,-U]);const we=n.Util.applyTransform([0,0],fe),me=n.Util.applyTransform([$,U],fe),Ce=n.Util.normalizeRect([we[0],we[1],me[0],me[1]]),Re=Math.round(Ce[2]-Ce[0])||1,Te=Math.round(Ce[3]-Ce[1])||1,ye=this.cachedCanvases.getCanvas("fillCanvas",Re,Te),ae=ye.context,ie=Math.min(we[0],me[0]),ve=Math.min(we[1],me[1]);ae.translate(-ie,-ve),ae.transform(...fe),ne||(ne=this._scaleImage(ue.canvas,(0,s.getCurrentTransformInverse)(ae)),ne=ne.img,K&&O&&K.set(Y,ne)),ae.imageSmoothingEnabled=X((0,s.getCurrentTransform)(ae),F.interpolate),T(ae,ne,0,0,ne.width,ne.height,0,0,$,U),ae.globalCompositeOperation="source-in";const Ae=n.Util.transform((0,s.getCurrentTransformInverse)(ae),[1,0,0,1,-ie,-ve]);return ae.fillStyle=O?E.getPattern(I,this,Ae,a.PathType.FILL):E,ae.fillRect(0,0,$,U),K&&!O&&(this.cachedCanvases.delete("fillCanvas"),K.set(Y,ye.canvas)),{canvas:ye.canvas,offsetX:Math.round(ie),offsetY:Math.round(ve)}}setLineWidth(F){F!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=F,this.ctx.lineWidth=F}setLineCap(F){this.ctx.lineCap=N[F]}setLineJoin(F){this.ctx.lineJoin=q[F]}setMiterLimit(F){this.ctx.miterLimit=F}setDash(F,I){const $=this.ctx;$.setLineDash!==void 0&&($.setLineDash(F),$.lineDashOffset=I)}setRenderingIntent(F){}setFlatness(F){}setGState(F){for(const[I,$]of F)switch(I){case"LW":this.setLineWidth($);break;case"LC":this.setLineCap($);break;case"LJ":this.setLineJoin($);break;case"ML":this.setMiterLimit($);break;case"D":this.setDash($[0],$[1]);break;case"RI":this.setRenderingIntent($);break;case"FL":this.setFlatness($);break;case"Font":this.setFont($[0],$[1]);break;case"CA":this.current.strokeAlpha=$;break;case"ca":this.current.fillAlpha=$,this.ctx.globalAlpha=$;break;case"BM":this.ctx.globalCompositeOperation=$;break;case"SMask":this.current.activeSMask=$?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter($);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const F=this.inSMaskMode;this.current.activeSMask&&!F?this.beginSMaskMode():!this.current.activeSMask&&F&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const F=this.ctx.canvas.width,I=this.ctx.canvas.height,$="smaskGroupAt"+this.groupLevel,U=this.cachedCanvases.getCanvas($,F,I);this.suspendedCtx=this.ctx,this.ctx=U.context;const E=this.ctx;E.setTransform(...(0,s.getCurrentTransform)(this.suspendedCtx)),m(this.suspendedCtx,E),g(E,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),m(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(F){if(!this.current.activeSMask)return;F?(F[0]=Math.floor(F[0]),F[1]=Math.floor(F[1]),F[2]=Math.ceil(F[2]),F[3]=Math.ceil(F[3])):F=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const I=this.current.activeSMask,$=this.suspendedCtx;L($,I,this.ctx,F),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(m(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const F=this.current;this.stateStack.push(F),this.current=F.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),m(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(F,I,$,U,E,O){this.ctx.transform(F,I,$,U,E,O),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(F,I,$){const U=this.ctx,E=this.current;let O=E.x,M=E.y,K,Y;const ne=(0,s.getCurrentTransform)(U),ue=ne[0]===0&&ne[3]===0||ne[1]===0&&ne[2]===0,fe=ue?$.slice(0):null;for(let we=0,me=0,Ce=F.length;we<Ce;we++)switch(F[we]|0){case n.OPS.rectangle:O=I[me++],M=I[me++];const Re=I[me++],Te=I[me++],ye=O+Re,ae=M+Te;U.moveTo(O,M),Re===0||Te===0?U.lineTo(ye,ae):(U.lineTo(ye,M),U.lineTo(ye,ae),U.lineTo(O,ae)),ue||E.updateRectMinMax(ne,[O,M,ye,ae]),U.closePath();break;case n.OPS.moveTo:O=I[me++],M=I[me++],U.moveTo(O,M),ue||E.updatePathMinMax(ne,O,M);break;case n.OPS.lineTo:O=I[me++],M=I[me++],U.lineTo(O,M),ue||E.updatePathMinMax(ne,O,M);break;case n.OPS.curveTo:K=O,Y=M,O=I[me+4],M=I[me+5],U.bezierCurveTo(I[me],I[me+1],I[me+2],I[me+3],O,M),E.updateCurvePathMinMax(ne,K,Y,I[me],I[me+1],I[me+2],I[me+3],O,M,fe),me+=6;break;case n.OPS.curveTo2:K=O,Y=M,U.bezierCurveTo(O,M,I[me],I[me+1],I[me+2],I[me+3]),E.updateCurvePathMinMax(ne,K,Y,O,M,I[me],I[me+1],I[me+2],I[me+3],fe),O=I[me+2],M=I[me+3],me+=4;break;case n.OPS.curveTo3:K=O,Y=M,O=I[me+2],M=I[me+3],U.bezierCurveTo(I[me],I[me+1],O,M,O,M),E.updateCurvePathMinMax(ne,K,Y,I[me],I[me+1],O,M,O,M,fe),me+=4;break;case n.OPS.closePath:U.closePath();break}ue&&E.updateScalingPathMinMax(ne,fe),E.setCurrentPoint(O,M)}closePath(){this.ctx.closePath()}stroke(F=!0){const I=this.ctx,$=this.current.strokeColor;I.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof $=="object"&&($!=null&&$.getPattern)?(I.save(),I.strokeStyle=$.getPattern(I,this,(0,s.getCurrentTransformInverse)(I),a.PathType.STROKE),this.rescaleAndStroke(!1),I.restore()):this.rescaleAndStroke(!0)),F&&this.consumePath(this.current.getClippedPathBoundingBox()),I.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(F=!0){const I=this.ctx,$=this.current.fillColor,U=this.current.patternFill;let E=!1;U&&(I.save(),I.fillStyle=$.getPattern(I,this,(0,s.getCurrentTransformInverse)(I),a.PathType.FILL),E=!0);const O=this.current.getClippedPathBoundingBox();this.contentVisible&&O!==null&&(this.pendingEOFill?(I.fill("evenodd"),this.pendingEOFill=!1):I.fill()),E&&I.restore(),F&&this.consumePath(O)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=te}eoClip(){this.pendingClip=oe}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const F=this.pendingTextPaths,I=this.ctx;if(F===void 0){I.beginPath();return}I.save(),I.beginPath();for(const $ of F)I.setTransform(...$.transform),I.translate($.x,$.y),$.addToPath(I,$.fontSize);I.restore(),I.clip(),I.beginPath(),delete this.pendingTextPaths}setCharSpacing(F){this.current.charSpacing=F}setWordSpacing(F){this.current.wordSpacing=F}setHScale(F){this.current.textHScale=F/100}setLeading(F){this.current.leading=-F}setFont(F,I){var ne;const $=this.commonObjs.get(F),U=this.current;if(!$)throw new Error(`Can't find font for ${F}`);if(U.fontMatrix=$.fontMatrix||n.FONT_IDENTITY_MATRIX,(U.fontMatrix[0]===0||U.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+F),I<0?(I=-I,U.fontDirection=-1):U.fontDirection=1,this.current.font=$,this.current.fontSize=I,$.isType3Font)return;const E=$.loadedName||"sans-serif",O=((ne=$.systemFontInfo)==null?void 0:ne.css)||`"${E}", ${$.fallbackName}`;let M="normal";$.black?M="900":$.bold&&(M="bold");const K=$.italic?"italic":"normal";let Y=I;I<d?Y=d:I>c&&(Y=c),this.current.fontSizeScale=I/Y,this.ctx.font=`${K} ${M} ${Y}px ${O}`}setTextRenderingMode(F){this.current.textRenderingMode=F}setTextRise(F){this.current.textRise=F}moveText(F,I){this.current.x=this.current.lineX+=F,this.current.y=this.current.lineY+=I}setLeadingMoveText(F,I){this.setLeading(-I),this.moveText(F,I)}setTextMatrix(F,I,$,U,E,O){this.current.textMatrix=[F,I,$,U,E,O],this.current.textMatrixScale=Math.hypot(F,I),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(F,I,$,U){const E=this.ctx,O=this.current,M=O.font,K=O.textRenderingMode,Y=O.fontSize/O.fontSizeScale,ne=K&n.TextRenderingMode.FILL_STROKE_MASK,ue=!!(K&n.TextRenderingMode.ADD_TO_PATH_FLAG),fe=O.patternFill&&!M.missingFile;let we;(M.disableFontFace||ue||fe)&&(we=M.getPathGenerator(this.commonObjs,F)),M.disableFontFace||fe?(E.save(),E.translate(I,$),E.beginPath(),we(E,Y),U&&E.setTransform(...U),(ne===n.TextRenderingMode.FILL||ne===n.TextRenderingMode.FILL_STROKE)&&E.fill(),(ne===n.TextRenderingMode.STROKE||ne===n.TextRenderingMode.FILL_STROKE)&&E.stroke(),E.restore()):((ne===n.TextRenderingMode.FILL||ne===n.TextRenderingMode.FILL_STROKE)&&E.fillText(F,I,$),(ne===n.TextRenderingMode.STROKE||ne===n.TextRenderingMode.FILL_STROKE)&&E.strokeText(F,I,$)),ue&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,s.getCurrentTransform)(E),x:I,y:$,fontSize:Y,addToPath:we})}get isFontSubpixelAAEnabled(){const{context:F}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);F.scale(1.5,1),F.fillText("I",0,10);const I=F.getImageData(0,0,10,10).data;let $=!1;for(let U=3;U<I.length;U+=4)if(I[U]>0&&I[U]<255){$=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",$)}showText(F){const I=this.current,$=I.font;if($.isType3Font)return this.showType3Text(F);const U=I.fontSize;if(U===0)return;const E=this.ctx,O=I.fontSizeScale,M=I.charSpacing,K=I.wordSpacing,Y=I.fontDirection,ne=I.textHScale*Y,ue=F.length,fe=$.vertical,we=fe?1:-1,me=$.defaultVMetrics,Ce=U*I.fontMatrix[0],Re=I.textRenderingMode===n.TextRenderingMode.FILL&&!$.disableFontFace&&!I.patternFill;E.save(),E.transform(...I.textMatrix),E.translate(I.x,I.y+I.textRise),Y>0?E.scale(ne,-1):E.scale(ne,1);let Te;if(I.patternFill){E.save();const Ae=I.fillColor.getPattern(E,this,(0,s.getCurrentTransformInverse)(E),a.PathType.FILL);Te=(0,s.getCurrentTransform)(E),E.restore(),E.fillStyle=Ae}let ye=I.lineWidth;const ae=I.textMatrixScale;if(ae===0||ye===0){const Ae=I.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(Ae===n.TextRenderingMode.STROKE||Ae===n.TextRenderingMode.FILL_STROKE)&&(ye=this.getSinglePixelWidth())}else ye/=ae;if(O!==1&&(E.scale(O,O),ye/=O),E.lineWidth=ye,$.isInvalidPDFjsFont){const Ae=[];let xe=0;for(const Me of F)Ae.push(Me.unicode),xe+=Me.width;E.fillText(Ae.join(""),0,0),I.x+=xe*Ce*ne,E.restore(),this.compose();return}let ie=0,ve;for(ve=0;ve<ue;++ve){const Ae=F[ve];if(typeof Ae=="number"){ie+=we*Ae*U/1e3;continue}let xe=!1;const Me=(Ae.isSpace?K:0)+M,Ue=Ae.fontChar,Ne=Ae.accent;let De,V,H=Ae.width;if(fe){const ge=Ae.vmetric||me,Fe=-(Ae.vmetric?ge[1]:H*.5)*Ce,je=ge[2]*Ce;H=ge?-ge[0]:H,De=Fe/O,V=(ie+je)/O}else De=ie/O,V=0;if($.remeasure&&H>0){const ge=E.measureText(Ue).width*1e3/U*O;if(H<ge&&this.isFontSubpixelAAEnabled){const Fe=H/ge;xe=!0,E.save(),E.scale(Fe,1),De/=Fe}else H!==ge&&(De+=(H-ge)/2e3*U/O)}if(this.contentVisible&&(Ae.isInFont||$.missingFile)){if(Re&&!Ne)E.fillText(Ue,De,V);else if(this.paintChar(Ue,De,V,Te),Ne){const ge=De+U*Ne.offset.x/O,Fe=V-U*Ne.offset.y/O;this.paintChar(Ne.fontChar,ge,Fe,Te)}}let ee;fe?ee=H*Ce-Me*Y:ee=H*Ce+Me*Y,ie+=ee,xe&&E.restore()}fe?I.y-=ie:I.x+=ie*ne,E.restore(),this.compose()}showType3Text(F){const I=this.ctx,$=this.current,U=$.font,E=$.fontSize,O=$.fontDirection,M=U.vertical?1:-1,K=$.charSpacing,Y=$.wordSpacing,ne=$.textHScale*O,ue=$.fontMatrix||n.FONT_IDENTITY_MATRIX,fe=F.length,we=$.textRenderingMode===n.TextRenderingMode.INVISIBLE;let me,Ce,Re,Te;if(!(we||E===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,I.save(),I.transform(...$.textMatrix),I.translate($.x,$.y),I.scale(ne,O),me=0;me<fe;++me){if(Ce=F[me],typeof Ce=="number"){Te=M*Ce*E/1e3,this.ctx.translate(Te,0),$.x+=Te*ne;continue}const ye=(Ce.isSpace?Y:0)+K,ae=U.charProcOperatorList[Ce.operatorListId];if(!ae){(0,n.warn)(`Type3 character "${Ce.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Ce,this.save(),I.scale(E,E),I.transform(...ue),this.executeOperatorList(ae),this.restore()),Re=n.Util.applyTransform([Ce.width,0],ue)[0]*E+ye,I.translate(Re,0),$.x+=Re*ne}I.restore(),this.processingType3=null}}setCharWidth(F,I){}setCharWidthAndBounds(F,I,$,U,E,O){this.ctx.rect($,U,E-$,O-U),this.ctx.clip(),this.endPath()}getColorN_Pattern(F){let I;if(F[0]==="TilingPattern"){const $=F[1],U=this.baseTransform||(0,s.getCurrentTransform)(this.ctx),E={createCanvasGraphics:O=>new Oe(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};I=new a.TilingPattern(F,$,this.ctx,E,U)}else I=this._getPattern(F[1],F[2]);return I}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(F,I,$){const U=n.Util.makeHexColor(F,I,$);this.ctx.strokeStyle=U,this.current.strokeColor=U}setFillRGBColor(F,I,$){const U=n.Util.makeHexColor(F,I,$);this.ctx.fillStyle=U,this.current.fillColor=U,this.current.patternFill=!1}_getPattern(F,I=null){let $;return this.cachedPatterns.has(F)?$=this.cachedPatterns.get(F):($=(0,a.getShadingPattern)(this.getObject(F)),this.cachedPatterns.set(F,$)),I&&($.matrix=I),$}shadingFill(F){if(!this.contentVisible)return;const I=this.ctx;this.save();const $=this._getPattern(F);I.fillStyle=$.getPattern(I,this,(0,s.getCurrentTransformInverse)(I),a.PathType.SHADING);const U=(0,s.getCurrentTransformInverse)(I);if(U){const{width:E,height:O}=I.canvas,[M,K,Y,ne]=n.Util.getAxialAlignedBoundingBox([0,0,E,O],U);this.ctx.fillRect(M,K,Y-M,ne-K)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(F,I){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(F)&&F.length===6&&this.transform(...F),this.baseTransform=(0,s.getCurrentTransform)(this.ctx),I)){const $=I[2]-I[0],U=I[3]-I[1];this.ctx.rect(I[0],I[1],$,U),this.current.updateRectMinMax((0,s.getCurrentTransform)(this.ctx),I),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(F){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const I=this.ctx;F.isolated||(0,n.info)("TODO: Support non-isolated groups."),F.knockout&&(0,n.warn)("Knockout groups not supported.");const $=(0,s.getCurrentTransform)(I);if(F.matrix&&I.transform(...F.matrix),!F.bbox)throw new Error("Bounding box is required.");let U=n.Util.getAxialAlignedBoundingBox(F.bbox,(0,s.getCurrentTransform)(I));const E=[0,0,I.canvas.width,I.canvas.height];U=n.Util.intersect(U,E)||[0,0,0,0];const O=Math.floor(U[0]),M=Math.floor(U[1]);let K=Math.max(Math.ceil(U[2])-O,1),Y=Math.max(Math.ceil(U[3])-M,1),ne=1,ue=1;K>u&&(ne=K/u,K=u),Y>u&&(ue=Y/u,Y=u),this.current.startNewPathAndClipBox([0,0,K,Y]);let fe="groupAt"+this.groupLevel;F.smask&&(fe+="_smask_"+this.smaskCounter++%2);const we=this.cachedCanvases.getCanvas(fe,K,Y),me=we.context;me.scale(1/ne,1/ue),me.translate(-O,-M),me.transform(...$),F.smask?this.smaskStack.push({canvas:we.canvas,context:me,offsetX:O,offsetY:M,scaleX:ne,scaleY:ue,subtype:F.smask.subtype,backdrop:F.smask.backdrop,transferMap:F.smask.transferMap||null,startTransformInverse:null}):(I.setTransform(1,0,0,1,0,0),I.translate(O,M),I.scale(ne,ue),I.save()),m(I,me),this.ctx=me,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(I),this.groupLevel++}endGroup(F){if(!this.contentVisible)return;this.groupLevel--;const I=this.ctx,$=this.groupStack.pop();if(this.ctx=$,this.ctx.imageSmoothingEnabled=!1,F.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const U=(0,s.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...U);const E=n.Util.getAxialAlignedBoundingBox([0,0,I.canvas.width,I.canvas.height],U);this.ctx.drawImage(I.canvas,0,0),this.ctx.restore(),this.compose(E)}}beginAnnotation(F,I,$,U,E){if(de(this,W,Nt).call(this),_(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(I)&&I.length===4){const O=I[2]-I[0],M=I[3]-I[1];if(E&&this.annotationCanvasMap){$=$.slice(),$[4]-=I[0],$[5]-=I[1],I=I.slice(),I[0]=I[1]=0,I[2]=O,I[3]=M;const[K,Y]=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(this.ctx)),{viewportScale:ne}=this,ue=Math.ceil(O*this.outputScaleX*ne),fe=Math.ceil(M*this.outputScaleY*ne);this.annotationCanvas=this.canvasFactory.create(ue,fe);const{canvas:we,context:me}=this.annotationCanvas;this.annotationCanvasMap.set(F,we),this.annotationCanvas.savedCtx=this.ctx,this.ctx=me,this.ctx.save(),this.ctx.setTransform(K,0,0,-Y,0,M*Y),_(this.ctx)}else _(this.ctx),this.ctx.rect(I[0],I[1],O,M),this.ctx.clip(),this.endPath()}this.current=new x(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...$),this.transform(...U)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),de(this,he,jt).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(F){if(!this.contentVisible)return;const I=F.count;F=this.getObject(F.data,F),F.count=I;const $=this.ctx,U=this.processingType3;if(U&&(U.compiled===void 0&&(U.compiled=C(F)),U.compiled)){U.compiled($);return}const E=this._createMaskCanvas(F),O=E.canvas;$.save(),$.setTransform(1,0,0,1,0,0),$.drawImage(O,E.offsetX,E.offsetY),$.restore(),this.compose()}paintImageMaskXObjectRepeat(F,I,$=0,U=0,E,O){if(!this.contentVisible)return;F=this.getObject(F.data,F);const M=this.ctx;M.save();const K=(0,s.getCurrentTransform)(M);M.transform(I,$,U,E,0,0);const Y=this._createMaskCanvas(F);M.setTransform(1,0,0,1,Y.offsetX-K[4],Y.offsetY-K[5]);for(let ne=0,ue=O.length;ne<ue;ne+=2){const fe=n.Util.transform(K,[I,$,U,E,O[ne],O[ne+1]]),[we,me]=n.Util.applyTransform([0,0],fe);M.drawImage(Y.canvas,we,me)}M.restore(),this.compose()}paintImageMaskXObjectGroup(F){if(!this.contentVisible)return;const I=this.ctx,$=this.current.fillColor,U=this.current.patternFill;for(const E of F){const{data:O,width:M,height:K,transform:Y}=E,ne=this.cachedCanvases.getCanvas("maskCanvas",M,K),ue=ne.context;ue.save();const fe=this.getObject(O,E);D(ue,fe),ue.globalCompositeOperation="source-in",ue.fillStyle=U?$.getPattern(ue,this,(0,s.getCurrentTransformInverse)(I),a.PathType.FILL):$,ue.fillRect(0,0,M,K),ue.restore(),I.save(),I.transform(...Y),I.scale(1,-1),T(I,ne.canvas,0,0,M,K,0,-1,1,1),I.restore()}this.compose()}paintImageXObject(F){if(!this.contentVisible)return;const I=this.getObject(F);if(!I){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(I)}paintImageXObjectRepeat(F,I,$,U){if(!this.contentVisible)return;const E=this.getObject(F);if(!E){(0,n.warn)("Dependent image isn't ready yet");return}const O=E.width,M=E.height,K=[];for(let Y=0,ne=U.length;Y<ne;Y+=2)K.push({transform:[I,0,0,$,U[Y],U[Y+1]],x:0,y:0,w:O,h:M});this.paintInlineImageXObjectGroup(E,K)}applyTransferMapsToCanvas(F){return this.current.transferMaps!=="none"&&(F.filter=this.current.transferMaps,F.drawImage(F.canvas,0,0),F.filter="none"),F.canvas}applyTransferMapsToBitmap(F){if(this.current.transferMaps==="none")return F.bitmap;const{bitmap:I,width:$,height:U}=F,E=this.cachedCanvases.getCanvas("inlineImage",$,U),O=E.context;return O.filter=this.current.transferMaps,O.drawImage(I,0,0),O.filter="none",E.canvas}paintInlineImageXObject(F){if(!this.contentVisible)return;const I=F.width,$=F.height,U=this.ctx;this.save(),l.isNodeJS||(U.filter="none"),U.scale(1/I,-1/$);let E;if(F.bitmap)E=this.applyTransferMapsToBitmap(F);else if(typeof HTMLElement=="function"&&F instanceof HTMLElement||!F.data)E=F;else{const K=this.cachedCanvases.getCanvas("inlineImage",I,$).context;S(K,F),E=this.applyTransferMapsToCanvas(K)}const O=this._scaleImage(E,(0,s.getCurrentTransformInverse)(U));U.imageSmoothingEnabled=X((0,s.getCurrentTransform)(U),F.interpolate),T(U,O.img,0,0,O.paintWidth,O.paintHeight,0,-$,I,$),this.compose(),this.restore()}paintInlineImageXObjectGroup(F,I){if(!this.contentVisible)return;const $=this.ctx;let U;if(F.bitmap)U=F.bitmap;else{const E=F.width,O=F.height,K=this.cachedCanvases.getCanvas("inlineImage",E,O).context;S(K,F),U=this.applyTransferMapsToCanvas(K)}for(const E of I)$.save(),$.transform(...E.transform),$.scale(1,-1),T($,U,E.x,E.y,E.w,E.h,0,-1,1,1),$.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(F){}markPointProps(F,I){}beginMarkedContent(F){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(F,I){F==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(I)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(F){const I=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(F);const $=this.ctx;this.pendingClip&&(I||(this.pendingClip===oe?$.clip("evenodd"):$.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),$.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const F=(0,s.getCurrentTransform)(this.ctx);if(F[1]===0&&F[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(F[0]),Math.abs(F[3]));else{const I=Math.abs(F[0]*F[3]-F[2]*F[1]),$=Math.hypot(F[0],F[2]),U=Math.hypot(F[1],F[3]);this._cachedGetSinglePixelWidth=Math.max($,U)/I}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:F}=this.current,{a:I,b:$,c:U,d:E}=this.ctx.getTransform();let O,M;if($===0&&U===0){const K=Math.abs(I),Y=Math.abs(E);if(K===Y)if(F===0)O=M=1/K;else{const ne=K*F;O=M=ne<1?1/ne:1}else if(F===0)O=1/K,M=1/Y;else{const ne=K*F,ue=Y*F;O=ne<1?1/ne:1,M=ue<1?1/ue:1}}else{const K=Math.abs(I*E-$*U),Y=Math.hypot(I,$),ne=Math.hypot(U,E);if(F===0)O=ne/K,M=Y/K;else{const ue=F*K;O=ne>ue?ne/ue:1,M=Y>ue?Y/ue:1}}this._cachedScaleForStroking[0]=O,this._cachedScaleForStroking[1]=M}return this._cachedScaleForStroking}rescaleAndStroke(F){const{ctx:I}=this,{lineWidth:$}=this.current,[U,E]=this.getScaleForStroking();if(I.lineWidth=$||1,U===1&&E===1){I.stroke();return}const O=I.getLineDash();if(F&&I.save(),I.scale(U,E),O.length>0){const M=Math.max(U,E);I.setLineDash(O.map(K=>K/M)),I.lineDashOffset/=M}I.stroke(),F&&I.restore()}isContentVisible(){for(let F=this.markedContentStack.length-1;F>=0;F--)if(!this.markedContentStack[F].visible)return!1;return!0}};W=new WeakSet,Nt=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},he=new WeakSet,jt=function(){if(this.pageColors){const F=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(F!=="none"){const I=this.ctx.filter;this.ctx.filter=F,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=I}}};let Q=Oe;e.CanvasGraphics=Q;for(const J in n.OPS)Q.prototype[J]!==void 0&&(Q.prototype[n.OPS[J]]=Q.prototype[J])},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=A;var n=t(1),s=t(6);const a={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=a;function o(T,C){if(!C)return;const x=C[2]-C[0],S=C[3]-C[1],D=new Path2D;D.rect(C[0],C[1],x,S),T.clip(D)}class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class d extends l{constructor(C){super(),this._type=C[1],this._bbox=C[2],this._colorStops=C[3],this._p0=C[4],this._p1=C[5],this._r0=C[6],this._r1=C[7],this.matrix=null}_createGradient(C){let x;this._type==="axial"?x=C.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(x=C.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const S of this._colorStops)x.addColorStop(S[0],S[1]);return x}getPattern(C,x,S,D){let m;if(D===a.STROKE||D===a.FILL){const _=x.current.getClippedPathBoundingBox(D,(0,s.getCurrentTransform)(C))||[0,0,0,0],f=Math.ceil(_[2]-_[0])||1,y=Math.ceil(_[3]-_[1])||1,p=x.cachedCanvases.getCanvas("pattern",f,y,!0),k=p.context;k.clearRect(0,0,k.canvas.width,k.canvas.height),k.beginPath(),k.rect(0,0,k.canvas.width,k.canvas.height),k.translate(-_[0],-_[1]),S=n.Util.transform(S,[1,0,0,1,_[0],_[1]]),k.transform(...x.baseTransform),this.matrix&&k.transform(...this.matrix),o(k,this._bbox),k.fillStyle=this._createGradient(k),k.fill(),m=C.createPattern(p.canvas,"no-repeat");const L=new DOMMatrix(S);m.setTransform(L)}else o(C,this._bbox),m=this._createGradient(C);return m}}function c(T,C,x,S,D,m,_,f){const y=C.coords,p=C.colors,k=T.data,L=T.width*4;let X;y[x+1]>y[S+1]&&(X=x,x=S,S=X,X=m,m=_,_=X),y[S+1]>y[D+1]&&(X=S,S=D,D=X,X=_,_=f,f=X),y[x+1]>y[S+1]&&(X=x,x=S,S=X,X=m,m=_,_=X);const N=(y[x]+C.offsetX)*C.scaleX,q=(y[x+1]+C.offsetY)*C.scaleY,te=(y[S]+C.offsetX)*C.scaleX,oe=(y[S+1]+C.offsetY)*C.scaleY,Q=(y[D]+C.offsetX)*C.scaleX,W=(y[D+1]+C.offsetY)*C.scaleY;if(q>=W)return;const pe=p[m],he=p[m+1],_e=p[m+2],Oe=p[_],J=p[_+1],F=p[_+2],I=p[f],$=p[f+1],U=p[f+2],E=Math.round(q),O=Math.round(W);let M,K,Y,ne,ue,fe,we,me;for(let Ce=E;Ce<=O;Ce++){if(Ce<oe){let ie;Ce<q?ie=0:ie=(q-Ce)/(q-oe),M=N-(N-te)*ie,K=pe-(pe-Oe)*ie,Y=he-(he-J)*ie,ne=_e-(_e-F)*ie}else{let ie;Ce>W?ie=1:oe===W?ie=0:ie=(oe-Ce)/(oe-W),M=te-(te-Q)*ie,K=Oe-(Oe-I)*ie,Y=J-(J-$)*ie,ne=F-(F-U)*ie}let Re;Ce<q?Re=0:Ce>W?Re=1:Re=(q-Ce)/(q-W),ue=N-(N-Q)*Re,fe=pe-(pe-I)*Re,we=he-(he-$)*Re,me=_e-(_e-U)*Re;const Te=Math.round(Math.min(M,ue)),ye=Math.round(Math.max(M,ue));let ae=L*Ce+Te*4;for(let ie=Te;ie<=ye;ie++)Re=(M-ie)/(M-ue),Re<0?Re=0:Re>1&&(Re=1),k[ae++]=K-(K-fe)*Re|0,k[ae++]=Y-(Y-we)*Re|0,k[ae++]=ne-(ne-me)*Re|0,k[ae++]=255}}function u(T,C,x){const S=C.coords,D=C.colors;let m,_;switch(C.type){case"lattice":const f=C.verticesPerRow,y=Math.floor(S.length/f)-1,p=f-1;for(m=0;m<y;m++){let k=m*f;for(let L=0;L<p;L++,k++)c(T,x,S[k],S[k+1],S[k+f],D[k],D[k+1],D[k+f]),c(T,x,S[k+f+1],S[k+1],S[k+f],D[k+f+1],D[k+1],D[k+f])}break;case"triangles":for(m=0,_=S.length;m<_;m+=3)c(T,x,S[m],S[m+1],S[m+2],D[m],D[m+1],D[m+2]);break;default:throw new Error("illegal figure")}}class h extends l{constructor(C){super(),this._coords=C[2],this._colors=C[3],this._figures=C[4],this._bounds=C[5],this._bbox=C[7],this._background=C[8],this.matrix=null}_createMeshCanvas(C,x,S){const f=Math.floor(this._bounds[0]),y=Math.floor(this._bounds[1]),p=Math.ceil(this._bounds[2])-f,k=Math.ceil(this._bounds[3])-y,L=Math.min(Math.ceil(Math.abs(p*C[0]*1.1)),3e3),X=Math.min(Math.ceil(Math.abs(k*C[1]*1.1)),3e3),N=p/L,q=k/X,te={coords:this._coords,colors:this._colors,offsetX:-f,offsetY:-y,scaleX:1/N,scaleY:1/q},oe=L+2*2,Q=X+2*2,W=S.getCanvas("mesh",oe,Q,!1),pe=W.context,he=pe.createImageData(L,X);if(x){const Oe=he.data;for(let J=0,F=Oe.length;J<F;J+=4)Oe[J]=x[0],Oe[J+1]=x[1],Oe[J+2]=x[2],Oe[J+3]=255}for(const Oe of this._figures)u(he,Oe,te);return pe.putImageData(he,2,2),{canvas:W.canvas,offsetX:f-2*N,offsetY:y-2*q,scaleX:N,scaleY:q}}getPattern(C,x,S,D){o(C,this._bbox);let m;if(D===a.SHADING)m=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(C));else if(m=n.Util.singularValueDecompose2dScale(x.baseTransform),this.matrix){const f=n.Util.singularValueDecompose2dScale(this.matrix);m=[m[0]*f[0],m[1]*f[1]]}const _=this._createMeshCanvas(m,D===a.SHADING?null:this._background,x.cachedCanvases);return D!==a.SHADING&&(C.setTransform(...x.baseTransform),this.matrix&&C.transform(...this.matrix)),C.translate(_.offsetX,_.offsetY),C.scale(_.scaleX,_.scaleY),C.createPattern(_.canvas,"no-repeat")}}class b extends l{getPattern(){return"hotpink"}}function A(T){switch(T[0]){case"RadialAxial":return new d(T);case"Mesh":return new h(T);case"Dummy":return new b}throw new Error(`Unknown IR type: ${T[0]}`)}const w={COLORED:1,UNCOLORED:2},v=class v{constructor(C,x,S,D,m){this.operatorList=C[2],this.matrix=C[3]||[1,0,0,1,0,0],this.bbox=C[4],this.xstep=C[5],this.ystep=C[6],this.paintType=C[7],this.tilingType=C[8],this.color=x,this.ctx=S,this.canvasGraphicsFactory=D,this.baseTransform=m}createPatternCanvas(C){const x=this.operatorList,S=this.bbox,D=this.xstep,m=this.ystep,_=this.paintType,f=this.tilingType,y=this.color,p=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+f);const k=S[0],L=S[1],X=S[2],N=S[3],q=n.Util.singularValueDecompose2dScale(this.matrix),te=n.Util.singularValueDecompose2dScale(this.baseTransform),oe=[q[0]*te[0],q[1]*te[1]],Q=this.getSizeAndScale(D,this.ctx.canvas.width,oe[0]),W=this.getSizeAndScale(m,this.ctx.canvas.height,oe[1]),pe=C.cachedCanvases.getCanvas("pattern",Q.size,W.size,!0),he=pe.context,_e=p.createCanvasGraphics(he);_e.groupLevel=C.groupLevel,this.setFillAndStrokeStyleToContext(_e,_,y);let Oe=k,J=L,F=X,I=N;return k<0&&(Oe=0,F+=Math.abs(k)),L<0&&(J=0,I+=Math.abs(L)),he.translate(-(Q.scale*Oe),-(W.scale*J)),_e.transform(Q.scale,0,0,W.scale,0,0),he.save(),this.clipBbox(_e,Oe,J,F,I),_e.baseTransform=(0,s.getCurrentTransform)(_e.ctx),_e.executeOperatorList(x),_e.endDrawing(),{canvas:pe.canvas,scaleX:Q.scale,scaleY:W.scale,offsetX:Oe,offsetY:J}}getSizeAndScale(C,x,S){C=Math.abs(C);const D=Math.max(v.MAX_PATTERN_SIZE,x);let m=Math.ceil(C*S);return m>=D?m=D:S=m/C,{scale:S,size:m}}clipBbox(C,x,S,D,m){const _=D-x,f=m-S;C.ctx.rect(x,S,_,f),C.current.updateRectMinMax((0,s.getCurrentTransform)(C.ctx),[x,S,D,m]),C.clip(),C.endPath()}setFillAndStrokeStyleToContext(C,x,S){const D=C.ctx,m=C.current;switch(x){case w.COLORED:const _=this.ctx;D.fillStyle=_.fillStyle,D.strokeStyle=_.strokeStyle,m.fillColor=_.fillStyle,m.strokeColor=_.strokeStyle;break;case w.UNCOLORED:const f=n.Util.makeHexColor(S[0],S[1],S[2]);D.fillStyle=f,D.strokeStyle=f,m.fillColor=f,m.strokeColor=f;break;default:throw new n.FormatError(`Unsupported paint type: ${x}`)}}getPattern(C,x,S,D){let m=S;D!==a.SHADING&&(m=n.Util.transform(m,x.baseTransform),this.matrix&&(m=n.Util.transform(m,this.matrix)));const _=this.createPatternCanvas(x);let f=new DOMMatrix(m);f=f.translate(_.offsetX,_.offsetY),f=f.scale(1/_.scaleX,1/_.scaleY);const y=C.createPattern(_.canvas,"repeat");return y.setTransform(f),y}};ze(v,"MAX_PATTERN_SIZE",3e3);let g=v;e.TilingPattern=g},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertBlackAndWhiteToRGBA=a,e.convertToRGBA=s,e.grayToRGBA=l;var n=t(1);function s(d){switch(d.kind){case n.ImageKind.GRAYSCALE_1BPP:return a(d);case n.ImageKind.RGB_24BPP:return o(d)}return null}function a({src:d,srcPos:c=0,dest:u,width:h,height:b,nonBlackColor:A=4294967295,inverseDecode:w=!1}){const g=n.FeatureTest.isLittleEndian?4278190080:255,[v,T]=w?[A,g]:[g,A],C=h>>3,x=h&7,S=d.length;u=new Uint32Array(u.buffer);let D=0;for(let m=0;m<b;m++){for(const f=c+C;c<f;c++){const y=c<S?d[c]:255;u[D++]=y&128?T:v,u[D++]=y&64?T:v,u[D++]=y&32?T:v,u[D++]=y&16?T:v,u[D++]=y&8?T:v,u[D++]=y&4?T:v,u[D++]=y&2?T:v,u[D++]=y&1?T:v}if(x===0)continue;const _=c<S?d[c++]:255;for(let f=0;f<x;f++)u[D++]=_&1<<7-f?T:v}return{srcPos:c,destPos:D}}function o({src:d,srcPos:c=0,dest:u,destPos:h=0,width:b,height:A}){let w=0;const g=d.length>>2,v=new Uint32Array(d.buffer,c,g);if(n.FeatureTest.isLittleEndian){for(;w<g-2;w+=3,h+=4){const T=v[w],C=v[w+1],x=v[w+2];u[h]=T|4278190080,u[h+1]=T>>>24|C<<8|4278190080,u[h+2]=C>>>16|x<<16|4278190080,u[h+3]=x>>>8|4278190080}for(let T=w*4,C=d.length;T<C;T+=3)u[h++]=d[T]|d[T+1]<<8|d[T+2]<<16|4278190080}else{for(;w<g-2;w+=3,h+=4){const T=v[w],C=v[w+1],x=v[w+2];u[h]=T|255,u[h+1]=T<<24|C>>>8|255,u[h+2]=C<<16|x>>>16|255,u[h+3]=x<<8|255}for(let T=w*4,C=d.length;T<C;T+=3)u[h++]=d[T]<<24|d[T+1]<<16|d[T+2]<<8|255}return{srcPos:c,destPos:h}}function l(d,c){if(n.FeatureTest.isLittleEndian)for(let u=0,h=d.length;u<h;u++)c[u]=d[u]*65793|4278190080;else for(let u=0,h=d.length;u<h;u++)c[u]=d[u]*16843008|255}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=null,t.workerSrc=""},(r,e,t)=>{var d,fn,u,pn,b,Et;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var n=t(1);const s={UNKNOWN:0,DATA:1,ERROR:2},a={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(w){switch(w instanceof Error||typeof w=="object"&&w!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),w.name){case"AbortException":return new n.AbortException(w.message);case"MissingPDFException":return new n.MissingPDFException(w.message);case"PasswordException":return new n.PasswordException(w.message,w.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(w.message,w.status);case"UnknownErrorException":return new n.UnknownErrorException(w.message,w.details);default:return new n.UnknownErrorException(w.message,w.toString())}}class l{constructor(g,v,T){se(this,d);se(this,u);se(this,b);this.sourceName=g,this.targetName=v,this.comObj=T,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=C=>{const x=C.data;if(x.targetName!==this.sourceName)return;if(x.stream){de(this,u,pn).call(this,x);return}if(x.callback){const D=x.callbackId,m=this.callbackCapabilities[D];if(!m)throw new Error(`Cannot resolve callback ${D}`);if(delete this.callbackCapabilities[D],x.callback===s.DATA)m.resolve(x.data);else if(x.callback===s.ERROR)m.reject(o(x.reason));else throw new Error("Unexpected callback case");return}const S=this.actionHandler[x.action];if(!S)throw new Error(`Unknown action from worker: ${x.action}`);if(x.callbackId){const D=this.sourceName,m=x.sourceName;new Promise(function(_){_(S(x.data))}).then(function(_){T.postMessage({sourceName:D,targetName:m,callback:s.DATA,callbackId:x.callbackId,data:_})},function(_){T.postMessage({sourceName:D,targetName:m,callback:s.ERROR,callbackId:x.callbackId,reason:o(_)})});return}if(x.streamId){de(this,d,fn).call(this,x);return}S(x.data)},T.addEventListener("message",this._onComObjOnMessage)}on(g,v){const T=this.actionHandler;if(T[g])throw new Error(`There is already an actionName called "${g}"`);T[g]=v}send(g,v,T){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:g,data:v},T)}sendWithPromise(g,v,T){const C=this.callbackId++,x=new n.PromiseCapability;this.callbackCapabilities[C]=x;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:g,callbackId:C,data:v},T)}catch(S){x.reject(S)}return x.promise}sendWithStream(g,v,T,C){const x=this.streamId++,S=this.sourceName,D=this.targetName,m=this.comObj;return new ReadableStream({start:_=>{const f=new n.PromiseCapability;return this.streamControllers[x]={controller:_,startCall:f,pullCall:null,cancelCall:null,isClosed:!1},m.postMessage({sourceName:S,targetName:D,action:g,streamId:x,data:v,desiredSize:_.desiredSize},C),f.promise},pull:_=>{const f=new n.PromiseCapability;return this.streamControllers[x].pullCall=f,m.postMessage({sourceName:S,targetName:D,stream:a.PULL,streamId:x,desiredSize:_.desiredSize}),f.promise},cancel:_=>{(0,n.assert)(_ instanceof Error,"cancel must have a valid reason");const f=new n.PromiseCapability;return this.streamControllers[x].cancelCall=f,this.streamControllers[x].isClosed=!0,m.postMessage({sourceName:S,targetName:D,stream:a.CANCEL,streamId:x,reason:o(_)}),f.promise}},T)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}d=new WeakSet,fn=function(g){const v=g.streamId,T=this.sourceName,C=g.sourceName,x=this.comObj,S=this,D=this.actionHandler[g.action],m={enqueue(_,f=1,y){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=f,p>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),x.postMessage({sourceName:T,targetName:C,stream:a.ENQUEUE,streamId:v,chunk:_},y)},close(){this.isCancelled||(this.isCancelled=!0,x.postMessage({sourceName:T,targetName:C,stream:a.CLOSE,streamId:v}),delete S.streamSinks[v])},error(_){(0,n.assert)(_ instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,x.postMessage({sourceName:T,targetName:C,stream:a.ERROR,streamId:v,reason:o(_)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:g.desiredSize,ready:null};m.sinkCapability.resolve(),m.ready=m.sinkCapability.promise,this.streamSinks[v]=m,new Promise(function(_){_(D(g.data,m))}).then(function(){x.postMessage({sourceName:T,targetName:C,stream:a.START_COMPLETE,streamId:v,success:!0})},function(_){x.postMessage({sourceName:T,targetName:C,stream:a.START_COMPLETE,streamId:v,reason:o(_)})})},u=new WeakSet,pn=function(g){const v=g.streamId,T=this.sourceName,C=g.sourceName,x=this.comObj,S=this.streamControllers[v],D=this.streamSinks[v];switch(g.stream){case a.START_COMPLETE:g.success?S.startCall.resolve():S.startCall.reject(o(g.reason));break;case a.PULL_COMPLETE:g.success?S.pullCall.resolve():S.pullCall.reject(o(g.reason));break;case a.PULL:if(!D){x.postMessage({sourceName:T,targetName:C,stream:a.PULL_COMPLETE,streamId:v,success:!0});break}D.desiredSize<=0&&g.desiredSize>0&&D.sinkCapability.resolve(),D.desiredSize=g.desiredSize,new Promise(function(m){var _;m((_=D.onPull)==null?void 0:_.call(D))}).then(function(){x.postMessage({sourceName:T,targetName:C,stream:a.PULL_COMPLETE,streamId:v,success:!0})},function(m){x.postMessage({sourceName:T,targetName:C,stream:a.PULL_COMPLETE,streamId:v,reason:o(m)})});break;case a.ENQUEUE:if((0,n.assert)(S,"enqueue should have stream controller"),S.isClosed)break;S.controller.enqueue(g.chunk);break;case a.CLOSE:if((0,n.assert)(S,"close should have stream controller"),S.isClosed)break;S.isClosed=!0,S.controller.close(),de(this,b,Et).call(this,S,v);break;case a.ERROR:(0,n.assert)(S,"error should have stream controller"),S.controller.error(o(g.reason)),de(this,b,Et).call(this,S,v);break;case a.CANCEL_COMPLETE:g.success?S.cancelCall.resolve():S.cancelCall.reject(o(g.reason)),de(this,b,Et).call(this,S,v);break;case a.CANCEL:if(!D)break;new Promise(function(m){var _;m((_=D.onCancel)==null?void 0:_.call(D,o(g.reason)))}).then(function(){x.postMessage({sourceName:T,targetName:C,stream:a.CANCEL_COMPLETE,streamId:v,success:!0})},function(m){x.postMessage({sourceName:T,targetName:C,stream:a.CANCEL_COMPLETE,streamId:v,reason:o(m)})}),D.sinkCapability.reject(o(g.reason)),D.isCancelled=!0,delete this.streamSinks[v];break;default:throw new Error("Unexpected stream case")}},b=new WeakSet,Et=async function(g,v){var T,C,x;await Promise.allSettled([(T=g.startCall)==null?void 0:T.promise,(C=g.pullCall)==null?void 0:C.promise,(x=g.cancelCall)==null?void 0:x.promise]),delete this.streamControllers[v]},e.MessageHandler=l},(r,e,t)=>{var a,o;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class s{constructor({parsedData:d,rawData:c}){se(this,a,void 0);se(this,o,void 0);be(this,a,d),be(this,o,c)}getRaw(){return P(this,o)}get(d){return P(this,a).get(d)??null}getAll(){return(0,n.objectFromMap)(P(this,a))}has(d){return P(this,a).has(d)}}a=new WeakMap,o=new WeakMap,e.Metadata=s},(r,e,t)=>{var d,c,u,h,b,A,$t;Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1),s=t(8);const a=Symbol("INTERNAL");class o{constructor(v,T){se(this,d,!0);this.name=v,this.intent=T}get visible(){return P(this,d)}_setVisible(v,T){v!==a&&(0,n.unreachable)("Internal method `_setVisible` called."),be(this,d,T)}}d=new WeakMap;class l{constructor(v){se(this,A);se(this,c,null);se(this,u,new Map);se(this,h,null);se(this,b,null);if(this.name=null,this.creator=null,v!==null){this.name=v.name,this.creator=v.creator,be(this,b,v.order);for(const T of v.groups)P(this,u).set(T.id,new o(T.name,T.intent));if(v.baseState==="OFF")for(const T of P(this,u).values())T._setVisible(a,!1);for(const T of v.on)P(this,u).get(T)._setVisible(a,!0);for(const T of v.off)P(this,u).get(T)._setVisible(a,!1);be(this,h,this.getHash())}}isVisible(v){if(P(this,u).size===0)return!0;if(!v)return(0,n.warn)("Optional content group not defined."),!0;if(v.type==="OCG")return P(this,u).has(v.id)?P(this,u).get(v.id).visible:((0,n.warn)(`Optional content group not found: ${v.id}`),!0);if(v.type==="OCMD"){if(v.expression)return de(this,A,$t).call(this,v.expression);if(!v.policy||v.policy==="AnyOn"){for(const T of v.ids){if(!P(this,u).has(T))return(0,n.warn)(`Optional content group not found: ${T}`),!0;if(P(this,u).get(T).visible)return!0}return!1}else if(v.policy==="AllOn"){for(const T of v.ids){if(!P(this,u).has(T))return(0,n.warn)(`Optional content group not found: ${T}`),!0;if(!P(this,u).get(T).visible)return!1}return!0}else if(v.policy==="AnyOff"){for(const T of v.ids){if(!P(this,u).has(T))return(0,n.warn)(`Optional content group not found: ${T}`),!0;if(!P(this,u).get(T).visible)return!0}return!1}else if(v.policy==="AllOff"){for(const T of v.ids){if(!P(this,u).has(T))return(0,n.warn)(`Optional content group not found: ${T}`),!0;if(P(this,u).get(T).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${v.policy}.`),!0}return(0,n.warn)(`Unknown group type ${v.type}.`),!0}setVisibility(v,T=!0){if(!P(this,u).has(v)){(0,n.warn)(`Optional content group not found: ${v}`);return}P(this,u).get(v)._setVisible(a,!!T),be(this,c,null)}get hasInitialVisibility(){return this.getHash()===P(this,h)}getOrder(){return P(this,u).size?P(this,b)?P(this,b).slice():[...P(this,u).keys()]:null}getGroups(){return P(this,u).size>0?(0,n.objectFromMap)(P(this,u)):null}getGroup(v){return P(this,u).get(v)||null}getHash(){if(P(this,c)!==null)return P(this,c);const v=new s.MurmurHash3_64;for(const[T,C]of P(this,u))v.update(`${T}:${C.visible}`);return be(this,c,v.hexdigest())}}c=new WeakMap,u=new WeakMap,h=new WeakMap,b=new WeakMap,A=new WeakSet,$t=function(v){const T=v.length;if(T<2)return!0;const C=v[0];for(let x=1;x<T;x++){const S=v[x];let D;if(Array.isArray(S))D=de(this,A,$t).call(this,S);else if(P(this,u).has(S))D=P(this,u).get(S).visible;else return(0,n.warn)(`Optional content group not found: ${S}`),!0;switch(C){case"And":if(!D)return!1;break;case"Or":if(D)return!0;break;case"Not":return!D;default:return!0}}return C==="And"},e.OptionalContentConfig=l},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var n=t(1),s=t(6);class a{constructor({length:c,initialData:u,progressiveDone:h=!1,contentDispositionFilename:b=null,disableRange:A=!1,disableStream:w=!1},g){if((0,n.assert)(g,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=h,this._contentDispositionFilename=b,(u==null?void 0:u.length)>0){const v=u instanceof Uint8Array&&u.byteLength===u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer;this._queuedChunks.push(v)}this._pdfDataRangeTransport=g,this._isStreamingSupported=!w,this._isRangeSupported=!A,this._contentLength=c,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((v,T)=>{this._onReceiveData({begin:v,chunk:T})}),this._pdfDataRangeTransport.addProgressListener((v,T)=>{this._onProgress({loaded:v,total:T})}),this._pdfDataRangeTransport.addProgressiveReadListener(v=>{this._onReceiveData({chunk:v})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:c,chunk:u}){const h=u instanceof Uint8Array&&u.byteLength===u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer;if(c===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(h):this._queuedChunks.push(h);else{const b=this._rangeReaders.some(function(A){return A._begin!==c?!1:(A._enqueue(h),!0)});(0,n.assert)(b,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var c;return((c=this._fullRequestReader)==null?void 0:c._loaded)??0}_onProgress(c){var u,h,b,A;c.total===void 0?(h=(u=this._rangeReaders[0])==null?void 0:u.onProgress)==null||h.call(u,{loaded:c.loaded}):(A=(b=this._fullRequestReader)==null?void 0:b.onProgress)==null||A.call(b,{loaded:c.loaded,total:c.total})}_onProgressiveDone(){var c;(c=this._fullRequestReader)==null||c.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(c){const u=this._rangeReaders.indexOf(c);u>=0&&this._rangeReaders.splice(u,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const c=this._queuedChunks;return this._queuedChunks=null,new o(this,c,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(c,u){if(u<=this._progressiveDataLength)return null;const h=new l(this,c,u);return this._pdfDataRangeTransport.requestDataRange(c,u),this._rangeReaders.push(h),h}cancelAllRequests(c){var u;(u=this._fullRequestReader)==null||u.cancel(c);for(const h of this._rangeReaders.slice(0))h.cancel(c);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=a;class o{constructor(c,u,h=!1,b=null){this._stream=c,this._done=h||!1,this._filename=(0,s.isPdfFile)(b)?b:null,this._queuedChunks=u||[],this._loaded=0;for(const A of this._queuedChunks)this._loaded+=A.byteLength;this._requests=[],this._headersReady=Promise.resolve(),c._fullRequestReader=this,this.onProgress=null}_enqueue(c){this._done||(this._requests.length>0?this._requests.shift().resolve({value:c,done:!1}):this._queuedChunks.push(c),this._loaded+=c.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const c=new n.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(c,u,h){this._stream=c,this._begin=u,this._end=h,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(c){if(!this._done){if(this._requests.length===0)this._queuedChunk=c;else{this._requests.shift().resolve({value:c,done:!1});for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const u=this._queuedChunk;return this._queuedChunk=null,{value:u,done:!1}}if(this._done)return{value:void 0,done:!0};const c=new n.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(s){const a=[],o={items:a,styles:Object.create(null)};function l(d){var h;if(!d)return;let c=null;const u=d.name;if(u==="#text")c=d.value;else if(t.shouldBuildText(u))(h=d==null?void 0:d.attributes)!=null&&h.textContent?c=d.attributes.textContent:d.value&&(c=d.value);else return;if(c!==null&&a.push({str:c}),!!d.children)for(const b of d.children)l(b)}return l(s),o}static shouldBuildText(s){return!(s==="textarea"||s==="input"||s==="option"||s==="select")}}e.XfaText=t},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeFilterFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var n=t(7);const s=function(c){return new Promise((u,h)=>{require$$5.readFile(c,(A,w)=>{if(A||!w){h(new Error(A));return}u(new Uint8Array(w))})})};class a extends n.BaseFilterFactory{}e.NodeFilterFactory=a;class o extends n.BaseCanvasFactory{_createCanvas(u,h){return require$$5.createCanvas(u,h)}}e.NodeCanvasFactory=o;class l extends n.BaseCMapReaderFactory{_fetchData(u,h){return s(u).then(b=>({cMapData:b,compressionType:h}))}}e.NodeCMapReaderFactory=l;class d extends n.BaseStandardFontDataFactory{_fetchData(u){return s(u)}}e.NodeStandardFontDataFactory=d},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var n=t(1),s=t(22);const a=require$$5,o=require$$5,l=require$$5,d=require$$5,c=/^file:\/\/\/[a-zA-Z]:\//;function u(x){const S=d.parse(x);return S.protocol==="file:"||S.host?S:/^[a-z]:[/\\]/i.test(x)?d.parse(`file:///${x}`):(S.host||(S.protocol="file:"),S)}class h{constructor(S){this.source=S,this.url=u(S.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&S.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var S;return((S=this._fullRequestReader)==null?void 0:S._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new T(this):new g(this),this._fullRequestReader}getRangeReader(S,D){if(D<=this._progressiveDataLength)return null;const m=this.isFsUrl?new C(this,S,D):new v(this,S,D);return this._rangeRequestReaders.push(m),m}cancelAllRequests(S){var D;(D=this._fullRequestReader)==null||D.cancel(S);for(const m of this._rangeRequestReaders.slice(0))m.cancel(S)}}e.PDFNodeStream=h;class b{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null;const D=S.source;this._contentLength=D.length,this._loaded=0,this._filename=null,this._disableRange=D.disableRange||!1,this._rangeChunkSize=D.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!D.disableStream,this._isRangeSupported=!D.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var m;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=S.length,(m=this.onProgress)==null||m.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",D=>{this._error(D)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class A{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const D=S.source;this._isStreamingSupported=!D.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var m;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=S.length,(m=this.onProgress)==null||m.call(this,{loaded:this._loaded}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",D=>{this._error(D)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function w(x,S){return{protocol:x.protocol,auth:x.auth,host:x.hostname,port:x.port,path:x.path,method:"GET",headers:S}}class g extends b{constructor(S){super(S);const D=m=>{if(m.statusCode===404){const p=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=p,this._headersCapability.reject(p);return}this._headersCapability.resolve(),this._setReadableStream(m);const _=p=>this._readableStream.headers[p.toLowerCase()],{allowRangeRequests:f,suggestedLength:y}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:S.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=f,this._contentLength=y||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(_)};this._request=null,this._url.protocol==="http:"?this._request=o.request(w(this._url,S.httpHeaders),D):this._request=l.request(w(this._url,S.httpHeaders),D),this._request.on("error",m=>{this._storedError=m,this._headersCapability.reject(m)}),this._request.end()}}class v extends A{constructor(S,D,m){super(S),this._httpHeaders={};for(const f in S.httpHeaders){const y=S.httpHeaders[f];y!==void 0&&(this._httpHeaders[f]=y)}this._httpHeaders.Range=`bytes=${D}-${m-1}`;const _=f=>{if(f.statusCode===404){const y=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=y;return}this._setReadableStream(f)};this._request=null,this._url.protocol==="http:"?this._request=o.request(w(this._url,this._httpHeaders),_):this._request=l.request(w(this._url,this._httpHeaders),_),this._request.on("error",f=>{this._storedError=f}),this._request.end()}}class T extends b{constructor(S){super(S);let D=decodeURIComponent(this._url.path);c.test(this._url.href)&&(D=D.replace(/^\//,"")),a.lstat(D,(m,_)=>{if(m){m.code==="ENOENT"&&(m=new n.MissingPDFException(`Missing PDF "${D}".`)),this._storedError=m,this._headersCapability.reject(m);return}this._contentLength=_.size,this._setReadableStream(a.createReadStream(D)),this._headersCapability.resolve()})}}class C extends A{constructor(S,D,m){super(S);let _=decodeURIComponent(this._url.path);c.test(this._url.href)&&(_=_.replace(/^\//,"")),this._setReadableStream(a.createReadStream(_,{start:D,end:m-1}))}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=d,e.extractFilenameFromHeader=l,e.validateRangeRequestCapabilities=o,e.validateResponseStatus=c;var n=t(1),s=t(23),a=t(6);function o({getResponseHeader:u,isHttp:h,rangeChunkSize:b,disableRange:A}){const w={allowRangeRequests:!1,suggestedLength:void 0},g=parseInt(u("Content-Length"),10);return!Number.isInteger(g)||(w.suggestedLength=g,g<=2*b)||A||!h||u("Accept-Ranges")!=="bytes"||(u("Content-Encoding")||"identity")!=="identity"||(w.allowRangeRequests=!0),w}function l(u){const h=u("Content-Disposition");if(h){let b=(0,s.getFilenameFromContentDispositionHeader)(h);if(b.includes("%"))try{b=decodeURIComponent(b)}catch{}if((0,a.isPdfFile)(b))return b}return null}function d(u,h){return u===404||u===0&&h.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+h+'".'):new n.UnexpectedResponseException(`Unexpected server response (${u}) while retrieving PDF "${h}".`,u)}function c(u){return u===200||u===206}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=s;var n=t(1);function s(a){let o=!0,l=d("filename\\*","i").exec(a);if(l){l=l[1];let g=b(l);return g=unescape(g),g=A(g),g=w(g),u(g)}if(l=h(a),l){const g=w(l);return u(g)}if(l=d("filename","i").exec(a),l){l=l[1];let g=b(l);return g=w(g),u(g)}function d(g,v){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',v)}function c(g,v){if(g){if(!/^[\x00-\xFF]+$/.test(v))return v;try{const T=new TextDecoder(g,{fatal:!0}),C=(0,n.stringToBytes)(v);v=T.decode(C),o=!1}catch{}}return v}function u(g){return o&&/[\x80-\xff]/.test(g)&&(g=c("utf-8",g),o&&(g=c("iso-8859-1",g))),g}function h(g){const v=[];let T;const C=d("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(T=C.exec(g))!==null;){let[,S,D,m]=T;if(S=parseInt(S,10),S in v){if(S===0)break;continue}v[S]=[D,m]}const x=[];for(let S=0;S<v.length&&S in v;++S){let[D,m]=v[S];m=b(m),D&&(m=unescape(m),S===0&&(m=A(m))),x.push(m)}return x.join("")}function b(g){if(g.startsWith('"')){const v=g.slice(1).split('\\"');for(let T=0;T<v.length;++T){const C=v[T].indexOf('"');C!==-1&&(v[T]=v[T].slice(0,C),v.length=T+1),v[T]=v[T].replaceAll(/\\(.)/g,"$1")}g=v.join('"')}return g}function A(g){const v=g.indexOf("'");if(v===-1)return g;const T=g.slice(0,v),x=g.slice(v+1).replace(/^[^']*'/,"");return c(T,x)}function w(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(v,T,C,x){if(C==="q"||C==="Q")return x=x.replaceAll("_"," "),x=x.replaceAll(/=([0-9a-fA-F]{2})/g,function(S,D){return String.fromCharCode(parseInt(D,16))}),c(T,x);try{x=atob(x)}catch{}return c(T,x)})}return""}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var n=t(1),s=t(22);const a=200,o=206;function l(b){const A=b.response;return typeof A!="string"?A:(0,n.stringToBytes)(A).buffer}class d{constructor(A,w={}){this.url=A,this.isHttp=/^https?:/i.test(A),this.httpHeaders=this.isHttp&&w.httpHeaders||Object.create(null),this.withCredentials=w.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(A,w,g){const v={begin:A,end:w};for(const T in g)v[T]=g[T];return this.request(v)}requestFull(A){return this.request(A)}request(A){const w=new XMLHttpRequest,g=this.currXhrId++,v=this.pendingRequests[g]={xhr:w};w.open("GET",this.url),w.withCredentials=this.withCredentials;for(const T in this.httpHeaders){const C=this.httpHeaders[T];C!==void 0&&w.setRequestHeader(T,C)}return this.isHttp&&"begin"in A&&"end"in A?(w.setRequestHeader("Range",`bytes=${A.begin}-${A.end-1}`),v.expectedStatus=o):v.expectedStatus=a,w.responseType="arraybuffer",A.onError&&(w.onerror=function(T){A.onError(w.status)}),w.onreadystatechange=this.onStateChange.bind(this,g),w.onprogress=this.onProgress.bind(this,g),v.onHeadersReceived=A.onHeadersReceived,v.onDone=A.onDone,v.onError=A.onError,v.onProgress=A.onProgress,w.send(null),g}onProgress(A,w){var v;const g=this.pendingRequests[A];g&&((v=g.onProgress)==null||v.call(g,w))}onStateChange(A,w){var S,D,m;const g=this.pendingRequests[A];if(!g)return;const v=g.xhr;if(v.readyState>=2&&g.onHeadersReceived&&(g.onHeadersReceived(),delete g.onHeadersReceived),v.readyState!==4||!(A in this.pendingRequests))return;if(delete this.pendingRequests[A],v.status===0&&this.isHttp){(S=g.onError)==null||S.call(g,v.status);return}const T=v.status||a;if(!(T===a&&g.expectedStatus===o)&&T!==g.expectedStatus){(D=g.onError)==null||D.call(g,v.status);return}const x=l(v);if(T===o){const _=v.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(_);g.onDone({begin:parseInt(f[1],10),chunk:x})}else x?g.onDone({begin:0,chunk:x}):(m=g.onError)==null||m.call(g,v.status)}getRequestXhr(A){return this.pendingRequests[A].xhr}isPendingRequest(A){return A in this.pendingRequests}abortRequest(A){const w=this.pendingRequests[A].xhr;delete this.pendingRequests[A],w.abort()}}class c{constructor(A){this._source=A,this._manager=new d(A.url,{httpHeaders:A.httpHeaders,withCredentials:A.withCredentials}),this._rangeChunkSize=A.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(A){const w=this._rangeRequestReaders.indexOf(A);w>=0&&this._rangeRequestReaders.splice(w,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new u(this._manager,this._source),this._fullRequestReader}getRangeReader(A,w){const g=new h(this._manager,A,w);return g.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(g),g}cancelAllRequests(A){var w;(w=this._fullRequestReader)==null||w.cancel(A);for(const g of this._rangeRequestReaders.slice(0))g.cancel(A)}}e.PDFNetworkStream=c;class u{constructor(A,w){this._manager=A;const g={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=w.url,this._fullRequestId=A.requestFull(g),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=w.disableRange||!1,this._contentLength=w.length,this._rangeChunkSize=w.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const A=this._fullRequestId,w=this._manager.getRequestXhr(A),g=C=>w.getResponseHeader(C),{allowRangeRequests:v,suggestedLength:T}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});v&&(this._isRangeSupported=!0),this._contentLength=T||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(g),this._isRangeSupported&&this._manager.abortRequest(A),this._headersReceivedCapability.resolve()}_onDone(A){if(A&&(this._requests.length>0?this._requests.shift().resolve({value:A.chunk,done:!1}):this._cachedChunks.push(A.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(A){this._storedError=(0,s.createResponseStatusError)(A,this._url),this._headersReceivedCapability.reject(this._storedError);for(const w of this._requests)w.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(A){var w;(w=this.onProgress)==null||w.call(this,{loaded:A.loaded,total:A.lengthComputable?A.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const A=new n.PromiseCapability;return this._requests.push(A),A.promise}cancel(A){this._done=!0,this._headersReceivedCapability.reject(A);for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class h{constructor(A,w,g){this._manager=A;const v={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=A.url,this._requestId=A.requestRange(w,g,v),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var A;(A=this.onClosed)==null||A.call(this,this)}_onDone(A){const w=A.chunk;this._requests.length>0?this._requests.shift().resolve({value:w,done:!1}):this._queuedChunk=w,this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(A){this._storedError=(0,s.createResponseStatusError)(A,this._url);for(const w of this._requests)w.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(A){var w;this.isStreamingSupported||(w=this.onProgress)==null||w.call(this,{loaded:A.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const w=this._queuedChunk;return this._queuedChunk=null,{value:w,done:!1}}if(this._done)return{value:void 0,done:!0};const A=new n.PromiseCapability;return this._requests.push(A),A.promise}cancel(A){this._done=!0;for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var n=t(1),s=t(22);function a(h,b,A){return{method:"GET",headers:h,signal:A.signal,mode:"cors",credentials:b?"include":"same-origin",redirect:"follow"}}function o(h){const b=new Headers;for(const A in h){const w=h[A];w!==void 0&&b.append(A,w)}return b}function l(h){return h instanceof Uint8Array?h.buffer:h instanceof ArrayBuffer?h:((0,n.warn)(`getArrayBuffer - unexpected data format: ${h}`),new Uint8Array(h).buffer)}class d{constructor(b){this.source=b,this.isHttp=/^https?:/i.test(b.url),this.httpHeaders=this.isHttp&&b.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var b;return((b=this._fullRequestReader)==null?void 0:b._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new c(this),this._fullRequestReader}getRangeReader(b,A){if(A<=this._progressiveDataLength)return null;const w=new u(this,b,A);return this._rangeRequestReaders.push(w),w}cancelAllRequests(b){var A;(A=this._fullRequestReader)==null||A.cancel(b);for(const w of this._rangeRequestReaders.slice(0))w.cancel(b)}}e.PDFFetchStream=d;class c{constructor(b){this._stream=b,this._reader=null,this._loaded=0,this._filename=null;const A=b.source;this._withCredentials=A.withCredentials||!1,this._contentLength=A.length,this._headersCapability=new n.PromiseCapability,this._disableRange=A.disableRange||!1,this._rangeChunkSize=A.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!A.disableStream,this._isRangeSupported=!A.disableRange,this._headers=o(this._stream.httpHeaders);const w=A.url;fetch(w,a(this._headers,this._withCredentials,this._abortController)).then(g=>{if(!(0,s.validateResponseStatus)(g.status))throw(0,s.createResponseStatusError)(g.status,w);this._reader=g.body.getReader(),this._headersCapability.resolve();const v=x=>g.headers.get(x),{allowRangeRequests:T,suggestedLength:C}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:v,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=T,this._contentLength=C||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(v),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var w;await this._headersCapability.promise;const{value:b,done:A}=await this._reader.read();return A?{value:b,done:A}:(this._loaded+=b.byteLength,(w=this.onProgress)==null||w.call(this,{loaded:this._loaded,total:this._contentLength}),{value:l(b),done:!1})}cancel(b){var A;(A=this._reader)==null||A.cancel(b),this._abortController.abort()}}class u{constructor(b,A,w){this._stream=b,this._reader=null,this._loaded=0;const g=b.source;this._withCredentials=g.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!g.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${A}-${w-1}`);const v=g.url;fetch(v,a(this._headers,this._withCredentials,this._abortController)).then(T=>{if(!(0,s.validateResponseStatus)(T.status))throw(0,s.createResponseStatusError)(T.status,v);this._readCapability.resolve(),this._reader=T.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var w;await this._readCapability.promise;const{value:b,done:A}=await this._reader.read();return A?{value:b,done:A}:(this._loaded+=b.byteLength,(w=this.onProgress)==null||w.call(this,{loaded:this._loaded}),{value:l(b),done:!1})}cancel(b){var A;(A=this._reader)==null||A.cancel(b),this._abortController.abort()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=g,e.updateTextLayer=v;var n=t(1),s=t(6);const a=1e5,o=30,l=.8,d=new Map;function c(T,C){let x;if(C&&n.FeatureTest.isOffscreenCanvasSupported)x=new OffscreenCanvas(T,T).getContext("2d",{alpha:!1});else{const S=document.createElement("canvas");S.width=S.height=T,x=S.getContext("2d",{alpha:!1})}return x}function u(T,C){const x=d.get(T);if(x)return x;const S=c(o,C);S.font=`${o}px ${T}`;const D=S.measureText("");let m=D.fontBoundingBoxAscent,_=Math.abs(D.fontBoundingBoxDescent);if(m){const y=m/(m+_);return d.set(T,y),S.canvas.width=S.canvas.height=0,y}S.strokeStyle="red",S.clearRect(0,0,o,o),S.strokeText("g",0,0);let f=S.getImageData(0,0,o,o).data;_=0;for(let y=f.length-1-3;y>=0;y-=4)if(f[y]>0){_=Math.ceil(y/4/o);break}S.clearRect(0,0,o,o),S.strokeText("A",0,o),f=S.getImageData(0,0,o,o).data,m=0;for(let y=0,p=f.length;y<p;y+=4)if(f[y]>0){m=o-Math.floor(y/4/o);break}if(S.canvas.width=S.canvas.height=0,m){const y=m/(m+_);return d.set(T,y),y}return d.set(T,l),l}function h(T,C,x){const S=document.createElement("span"),D={angle:0,canvasWidth:0,hasText:C.str!=="",hasEOL:C.hasEOL,fontSize:0};T._textDivs.push(S);const m=n.Util.transform(T._transform,C.transform);let _=Math.atan2(m[1],m[0]);const f=x[C.fontName];f.vertical&&(_+=Math.PI/2);const y=Math.hypot(m[2],m[3]),p=y*u(f.fontFamily,T._isOffscreenCanvasSupported);let k,L;_===0?(k=m[4],L=m[5]-p):(k=m[4]+p*Math.sin(_),L=m[5]-p*Math.cos(_));const X="calc(var(--scale-factor)*",N=S.style;T._container===T._rootContainer?(N.left=`${(100*k/T._pageWidth).toFixed(2)}%`,N.top=`${(100*L/T._pageHeight).toFixed(2)}%`):(N.left=`${X}${k.toFixed(2)}px)`,N.top=`${X}${L.toFixed(2)}px)`),N.fontSize=`${X}${y.toFixed(2)}px)`,N.fontFamily=f.fontFamily,D.fontSize=y,S.setAttribute("role","presentation"),S.textContent=C.str,S.dir=C.dir,T._fontInspectorEnabled&&(S.dataset.fontName=C.fontName),_!==0&&(D.angle=_*(180/Math.PI));let q=!1;if(C.str.length>1)q=!0;else if(C.str!==" "&&C.transform[0]!==C.transform[3]){const te=Math.abs(C.transform[0]),oe=Math.abs(C.transform[3]);te!==oe&&Math.max(te,oe)/Math.min(te,oe)>1.5&&(q=!0)}q&&(D.canvasWidth=f.vertical?C.height:C.width),T._textDivProperties.set(S,D),T._isReadableStream&&T._layoutText(S)}function b(T){const{div:C,scale:x,properties:S,ctx:D,prevFontSize:m,prevFontFamily:_}=T,{style:f}=C;let y="";if(S.canvasWidth!==0&&S.hasText){const{fontFamily:p}=f,{canvasWidth:k,fontSize:L}=S;(m!==L||_!==p)&&(D.font=`${L*x}px ${p}`,T.prevFontSize=L,T.prevFontFamily=p);const{width:X}=D.measureText(C.textContent);X>0&&(y=`scaleX(${k*x/X})`)}S.angle!==0&&(y=`rotate(${S.angle}deg) ${y}`),y.length>0&&(f.transform=y)}function A(T){if(T._canceled)return;const C=T._textDivs,x=T._capability;if(C.length>a){x.resolve();return}if(!T._isReadableStream)for(const D of C)T._layoutText(D);x.resolve()}class w{constructor({textContentSource:C,container:x,viewport:S,textDivs:D,textDivProperties:m,textContentItemsStr:_,isOffscreenCanvasSupported:f}){var X;this._textContentSource=C,this._isReadableStream=C instanceof ReadableStream,this._container=this._rootContainer=x,this._textDivs=D||[],this._textContentItemsStr=_||[],this._isOffscreenCanvasSupported=f,this._fontInspectorEnabled=!!((X=globalThis.FontInspector)!=null&&X.enabled),this._reader=null,this._textDivProperties=m||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:S.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:c(0,f)};const{pageWidth:y,pageHeight:p,pageX:k,pageY:L}=S.rawDims;this._transform=[1,0,0,-1,-k,L+p],this._pageWidth=y,this._pageHeight=p,(0,s.setLayerDimensions)(x,S),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(C,x){for(const S of C){if(S.str===void 0){if(S.type==="beginMarkedContentProps"||S.type==="beginMarkedContent"){const D=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),S.id!==null&&this._container.setAttribute("id",`${S.id}`),D.append(this._container)}else S.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(S.str),h(this,S,x)}}_layoutText(C){const x=this._layoutTextParams.properties=this._textDivProperties.get(C);if(this._layoutTextParams.div=C,b(this._layoutTextParams),x.hasText&&this._container.append(C),x.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this._container.append(S)}}_render(){const C=new n.PromiseCapability;let x=Object.create(null);if(this._isReadableStream){const S=()=>{this._reader.read().then(({value:D,done:m})=>{if(m){C.resolve();return}Object.assign(x,D.styles),this._processItems(D.items,x),S()},C.reject)};this._reader=this._textContentSource.getReader(),S()}else if(this._textContentSource){const{items:S,styles:D}=this._textContentSource;this._processItems(S,D),C.resolve()}else throw new Error('No "textContentSource" parameter specified.');C.promise.then(()=>{x=null,A(this)},this._capability.reject)}}e.TextLayerRenderTask=w;function g(T){!T.textContentSource&&(T.textContent||T.textContentStream)&&((0,s.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),T.textContentSource=T.textContent||T.textContentStream);const{container:C,viewport:x}=T,S=getComputedStyle(C),D=S.getPropertyValue("visibility"),m=parseFloat(S.getPropertyValue("--scale-factor"));D==="visible"&&(!m||Math.abs(m-x.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const _=new w(T);return _._render(),_}function v({container:T,viewport:C,textDivs:x,textDivProperties:S,isOffscreenCanvasSupported:D,mustRotate:m=!0,mustRescale:_=!0}){if(m&&(0,s.setLayerDimensions)(T,{rotation:C.rotation}),_){const f=c(0,D),p={prevFontSize:null,prevFontFamily:null,div:null,scale:C.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:f};for(const k of x)p.properties=S.get(k),p.div=k,b(p)}}},(r,e,t)=>{var u,h,b,A,w,g,v,T,C,x,S,Ut,m,mn,f,Bt,p,Vt;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var n=t(1),s=t(4),a=t(5),o=t(28),l=t(33),d=t(6);const L=class L{constructor(N){se(this,S);se(this,m);se(this,f);se(this,p);se(this,u,void 0);se(this,h,!1);se(this,b,null);se(this,A,this.pointerup.bind(this));se(this,w,this.pointerdown.bind(this));se(this,g,new Map);se(this,v,!1);se(this,T,!1);se(this,C,!1);se(this,x,void 0);L._initialized||(L._initialized=!0,o.FreeTextEditor.initialize(N.l10n),l.InkEditor.initialize(N.l10n)),N.uiManager.registerEditorTypes([o.FreeTextEditor,l.InkEditor]),be(this,x,N.uiManager),this.pageIndex=N.pageIndex,this.div=N.div,be(this,u,N.accessibilityManager),be(this,b,N.annotationLayer),this.viewport=N.viewport,P(this,x).addLayer(this)}get isEmpty(){return P(this,g).size===0}updateToolbar(N){P(this,x).updateToolbar(N)}updateMode(N=P(this,x).getMode()){de(this,p,Vt).call(this),N===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),P(this,x).unselectAll(),N!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",N===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",N===n.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(N){if(!N&&P(this,x).getMode()!==n.AnnotationEditorType.INK)return;if(!N){for(const te of P(this,g).values())if(te.isEmpty()){te.setInBackground();return}}de(this,f,Bt).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(N){P(this,x).setEditingState(N)}addCommands(N){P(this,x).addCommands(N)}enable(){this.div.style.pointerEvents="auto";const N=new Set;for(const te of P(this,g).values())te.enableEditing(),te.annotationElementId&&N.add(te.annotationElementId);if(!P(this,b))return;const q=P(this,b).getEditableAnnotations();for(const te of q){if(te.hide(),P(this,x).isDeletedAnnotationElement(te.data.id)||N.has(te.data.id))continue;const oe=this.deserialize(te);oe&&(this.addOrRebuild(oe),oe.enableEditing())}}disable(){var q;be(this,C,!0),this.div.style.pointerEvents="none";const N=new Set;for(const te of P(this,g).values()){if(te.disableEditing(),!te.annotationElementId||te.serialize()!==null){N.add(te.annotationElementId);continue}(q=this.getEditableAnnotation(te.annotationElementId))==null||q.show(),te.remove()}if(P(this,b)){const te=P(this,b).getEditableAnnotations();for(const oe of te){const{id:Q}=oe.data;N.has(Q)||P(this,x).isDeletedAnnotationElement(Q)||oe.show()}}de(this,p,Vt).call(this),this.isEmpty&&(this.div.hidden=!0),be(this,C,!1)}getEditableAnnotation(N){var q;return((q=P(this,b))==null?void 0:q.getEditableAnnotation(N))||null}setActiveEditor(N){P(this,x).getActive()!==N&&P(this,x).setActiveEditor(N)}enableClick(){this.div.addEventListener("pointerdown",P(this,w)),this.div.addEventListener("pointerup",P(this,A))}disableClick(){this.div.removeEventListener("pointerdown",P(this,w)),this.div.removeEventListener("pointerup",P(this,A))}attach(N){P(this,g).set(N.id,N);const{annotationElementId:q}=N;q&&P(this,x).isDeletedAnnotationElement(q)&&P(this,x).removeDeletedAnnotationElement(N)}detach(N){var q;P(this,g).delete(N.id),(q=P(this,u))==null||q.removePointerInTextLayer(N.contentDiv),!P(this,C)&&N.annotationElementId&&P(this,x).addDeletedAnnotationElement(N)}remove(N){this.detach(N),P(this,x).removeEditor(N),N.div.style.display="none",setTimeout(()=>{N.div.style.display="",N.div.remove(),N.isAttachedToDOM=!1,document.activeElement===document.body&&P(this,x).focusMainContainer()},0),P(this,T)||this.addInkEditorIfNeeded(!1)}add(N){if(de(this,S,Ut).call(this,N),P(this,x).addEditor(N),this.attach(N),!N.isAttachedToDOM){const q=N.render();this.div.append(q),N.isAttachedToDOM=!0}this.moveEditorInDOM(N),N.onceAdded(),P(this,x).addToAnnotationStorage(N)}moveEditorInDOM(N){var q;(q=P(this,u))==null||q.moveElementInDOM(this.div,N.div,N.contentDiv,!0)}addOrRebuild(N){N.needsToBeRebuilt()?N.rebuild():this.add(N)}getNextId(){return P(this,x).getId()}deserialize(N){switch(N.annotationType??N.annotationEditorType){case n.AnnotationEditorType.FREETEXT:return o.FreeTextEditor.deserialize(N,this,P(this,x));case n.AnnotationEditorType.INK:return l.InkEditor.deserialize(N,this,P(this,x))}return null}setSelected(N){P(this,x).setSelected(N)}toggleSelected(N){P(this,x).toggleSelected(N)}isSelected(N){return P(this,x).isSelected(N)}unselect(N){P(this,x).unselect(N)}pointerup(N){const{isMac:q}=n.FeatureTest.platform;if(!(N.button!==0||N.ctrlKey&&q)&&N.target===this.div&&P(this,v)){if(be(this,v,!1),!P(this,h)){be(this,h,!0);return}de(this,f,Bt).call(this,N)}}pointerdown(N){const{isMac:q}=n.FeatureTest.platform;if(N.button!==0||N.ctrlKey&&q||N.target!==this.div)return;be(this,v,!0);const te=P(this,x).getActive();be(this,h,!te||te.isEmpty())}drop(N){const q=N.dataTransfer.getData("text/plain"),te=P(this,x).getEditor(q);if(!te)return;N.preventDefault(),N.dataTransfer.dropEffect="move",de(this,S,Ut).call(this,te);const oe=this.div.getBoundingClientRect(),Q=N.clientX-oe.x,W=N.clientY-oe.y;te.translate(Q-te.startX,W-te.startY),this.moveEditorInDOM(te),te.div.focus()}dragover(N){N.preventDefault()}destroy(){var N,q;((N=P(this,x).getActive())==null?void 0:N.parent)===this&&P(this,x).setActiveEditor(null);for(const te of P(this,g).values())(q=P(this,u))==null||q.removePointerInTextLayer(te.contentDiv),te.setParent(null),te.isAttachedToDOM=!1,te.div.remove();this.div=null,P(this,g).clear(),P(this,x).removeLayer(this)}render({viewport:N}){this.viewport=N,(0,d.setLayerDimensions)(this.div,N),(0,a.bindEvents)(this,this.div,["dragover","drop"]);for(const q of P(this,x).getEditors(this.pageIndex))this.add(q);this.updateMode()}update({viewport:N}){P(this,x).commitOrRemove(),this.viewport=N,(0,d.setLayerDimensions)(this.div,{rotation:N.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:N,pageHeight:q}=this.viewport.rawDims;return[N,q]}};u=new WeakMap,h=new WeakMap,b=new WeakMap,A=new WeakMap,w=new WeakMap,g=new WeakMap,v=new WeakMap,T=new WeakMap,C=new WeakMap,x=new WeakMap,S=new WeakSet,Ut=function(N){var q;N.parent!==this&&(N.annotationElementId&&(P(this,x).addDeletedAnnotationElement(N.annotationElementId),s.AnnotationEditor.deleteAnnotationElement(N),N.annotationElementId=null),this.attach(N),(q=N.parent)==null||q.detach(N),N.setParent(this),N.div&&N.isAttachedToDOM&&(N.div.remove(),this.div.append(N.div)))},m=new WeakSet,mn=function(N){switch(P(this,x).getMode()){case n.AnnotationEditorType.FREETEXT:return new o.FreeTextEditor(N);case n.AnnotationEditorType.INK:return new l.InkEditor(N)}return null},f=new WeakSet,Bt=function(N){const q=this.getNextId(),te=de(this,m,mn).call(this,{parent:this,id:q,x:N.offsetX,y:N.offsetY,uiManager:P(this,x)});return te&&this.add(te),te},p=new WeakSet,Vt=function(){be(this,T,!0);for(const N of P(this,g).values())N.isEmpty()&&N.remove();be(this,T,!1)},ze(L,"_initialized",!1);let c=L;e.AnnotationEditorLayer=c},(r,e,t)=>{var d,c,u,h,b,A,w,g,v,T,gn,x,_n,D,yn,_,mt,y,Zt,k,bn,X,qt;Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var n=t(1),s=t(5),a=t(4),o=t(29);const q=class q extends a.AnnotationEditor{constructor(Q){super({...Q,name:"freeTextEditor"});se(this,T);se(this,x);se(this,D);se(this,_);se(this,y);se(this,k);se(this,X);se(this,d,this.editorDivBlur.bind(this));se(this,c,this.editorDivFocus.bind(this));se(this,u,this.editorDivInput.bind(this));se(this,h,this.editorDivKeydown.bind(this));se(this,b,void 0);se(this,A,"");se(this,w,`${this.id}-editor`);se(this,g,void 0);se(this,v,null);be(this,b,Q.color||q._defaultColor||a.AnnotationEditor._defaultLineColor),be(this,g,Q.fontSize||q._defaultFontSize)}static get _keyboardManager(){return(0,n.shadow)(this,"_keyboardManager",new s.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],q.prototype.commitOrRemove,!0],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],q.prototype.commitOrRemove]]))}static initialize(Q){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(pe=>[pe,Q.get(pe)]));const W=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(W.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Q,W){switch(Q){case n.AnnotationEditorParamsType.FREETEXT_SIZE:q._defaultFontSize=W;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:q._defaultColor=W;break}}updateParams(Q,W){switch(Q){case n.AnnotationEditorParamsType.FREETEXT_SIZE:de(this,T,gn).call(this,W);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:de(this,x,_n).call(this,W);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,q._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,q._defaultColor||a.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,P(this,g)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,P(this,b)]]}getInitialTranslation(){const Q=this.parentScale;return[-q._internalPadding*Q,-(q._internalPadding+P(this,g))*Q]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",P(this,h)),this.editorDiv.addEventListener("focus",P(this,c)),this.editorDiv.addEventListener("blur",P(this,d)),this.editorDiv.addEventListener("input",P(this,u)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",P(this,w)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",P(this,h)),this.editorDiv.removeEventListener("focus",P(this,c)),this.editorDiv.removeEventListener("blur",P(this,d)),this.editorDiv.removeEventListener("input",P(this,u)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Q){super.focusin(Q),Q.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){if(this.width){de(this,X,qt).call(this);return}this.enableEditMode(),this.editorDiv.focus()}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Q=P(this,A),W=be(this,A,de(this,D,yn).call(this).trimEnd());if(Q===W)return;const pe=he=>{if(be(this,A,he),!he){this.remove();return}de(this,y,Zt).call(this),this.rebuild(),de(this,_,mt).call(this)};this.addCommands({cmd:()=>{pe(W)},undo:()=>{pe(Q)},mustExec:!1}),de(this,_,mt).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(Q){this.enableEditMode(),this.editorDiv.focus()}keydown(Q){Q.target===this.div&&Q.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(Q){q._keyboardManager.exec(this,Q)}editorDivFocus(Q){this.isEditing=!0}editorDivBlur(Q){this.isEditing=!1}editorDivInput(Q){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Q,W;this.width&&(Q=this.x,W=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",P(this,w)),this.enableEditing(),q._l10nPromise.get("editor_free_text2_aria_label").then(he=>{var _e;return(_e=this.editorDiv)==null?void 0:_e.setAttribute("aria-label",he)}),q._l10nPromise.get("free_text2_default_content").then(he=>{var _e;return(_e=this.editorDiv)==null?void 0:_e.setAttribute("default-content",he)}),this.editorDiv.contentEditable=!0;const{style:pe}=this.editorDiv;if(pe.fontSize=`calc(${P(this,g)}px * var(--scale-factor))`,pe.color=P(this,b),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,s.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[he,_e]=this.parentDimensions;if(this.annotationElementId){const[Oe]=this.getInitialTranslation();this.setAt(Q*he,W*_e,Oe,Oe)}else this.setAt(Q*he,W*_e,this.width*he,this.height*_e);de(this,y,Zt).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Q,W,pe){let he=null;if(Q instanceof o.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Oe,fontColor:J},rect:F,rotation:I,id:$},textContent:U,parent:{page:{pageNumber:E}}}=Q;if(!U||U.length===0)return null;he=Q={annotationType:n.AnnotationEditorType.FREETEXT,color:Array.from(J),fontSize:Oe,value:U.join(`
`),pageIndex:E-1,rect:F,rotation:I,id:$,deleted:!1}}const _e=super.deserialize(Q,W,pe);return be(_e,g,Q.fontSize),be(_e,b,n.Util.makeHexColor(...Q.color)),be(_e,A,Q.value),_e.annotationElementId=Q.id||null,be(_e,v,he),_e}serialize(Q=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const W=q._internalPadding*this.parentScale,pe=this.getRect(W,W),he=a.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:P(this,b)),_e={annotationType:n.AnnotationEditorType.FREETEXT,color:he,fontSize:P(this,g),value:P(this,A),pageIndex:this.pageIndex,rect:pe,rotation:this.rotation};return Q?_e:this.annotationElementId&&!de(this,k,bn).call(this,_e)?null:(_e.id=this.annotationElementId,_e)}};d=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap,b=new WeakMap,A=new WeakMap,w=new WeakMap,g=new WeakMap,v=new WeakMap,T=new WeakSet,gn=function(Q){const W=he=>{this.editorDiv.style.fontSize=`calc(${he}px * var(--scale-factor))`,this.translate(0,-(he-P(this,g))*this.parentScale),be(this,g,he),de(this,_,mt).call(this)},pe=P(this,g);this.addCommands({cmd:()=>{W(Q)},undo:()=>{W(pe)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},x=new WeakSet,_n=function(Q){const W=P(this,b);this.addCommands({cmd:()=>{be(this,b,this.editorDiv.style.color=Q)},undo:()=>{be(this,b,this.editorDiv.style.color=W)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},D=new WeakSet,yn=function(){const Q=this.editorDiv.getElementsByTagName("div");if(Q.length===0)return this.editorDiv.innerText;const W=[];for(const pe of Q)W.push(pe.innerText.replace(/\r\n?|\n/,""));return W.join(`
`)},_=new WeakSet,mt=function(){const[Q,W]=this.parentDimensions;let pe;if(this.isAttachedToDOM)pe=this.div.getBoundingClientRect();else{const{currentLayer:he,div:_e}=this,Oe=_e.style.display;_e.style.display="hidden",he.div.append(this.div),pe=_e.getBoundingClientRect(),_e.remove(),_e.style.display=Oe}this.width=pe.width/Q,this.height=pe.height/W},y=new WeakSet,Zt=function(){if(this.editorDiv.replaceChildren(),!!P(this,A))for(const Q of P(this,A).split(`
`)){const W=document.createElement("div");W.append(Q?document.createTextNode(Q):document.createElement("br")),this.editorDiv.append(W)}},k=new WeakSet,bn=function(Q){const{value:W,fontSize:pe,color:he,rect:_e,pageIndex:Oe}=P(this,v);return Q.value!==W||Q.fontSize!==pe||Q.rect.some((J,F)=>Math.abs(J-_e[F])>=1)||Q.color.some((J,F)=>J!==he[F])||Q.pageIndex!==Oe},X=new WeakSet,qt=function(Q=!1){if(!this.annotationElementId)return;if(de(this,_,mt).call(this),!Q&&(this.width===0||this.height===0)){setTimeout(()=>de(this,X,qt).call(this,!0),0);return}const W=q._internalPadding*this.parentScale;P(this,v).rect=this.getRect(W,W)},ze(q,"_freeTextDefaultContent",""),ze(q,"_l10nPromise"),ze(q,"_internalPadding",0),ze(q,"_defaultColor",null),ze(q,"_defaultFontSize",10),ze(q,"_type","freetext");let l=q;e.FreeTextEditor=l},(r,e,t)=>{var J,st,I,vn,U,E,O,M,K,Y,ne,ue,fe,we,me,Ce,Re,Te,ye,ae,ie,Ht,Ae,zt,Me,Kt,Ne,De,V,H,ee,ge,Fe,je,Ve,Ze,Gt,We,Wt;Object.defineProperty(e,"__esModule",{value:!0}),e.InkAnnotationElement=e.FreeTextAnnotationElement=e.AnnotationLayer=void 0;var n=t(1),s=t(6),a=t(3),o=t(30),l=t(31);const d=1e3,c=9,u=new WeakSet;function h(Le){return{width:Le[2]-Le[0],height:Le[3]-Le[1]}}class b{static create(Z){switch(Z.data.annotationType){case n.AnnotationType.LINK:return new w(Z);case n.AnnotationType.TEXT:return new g(Z);case n.AnnotationType.WIDGET:switch(Z.data.fieldType){case"Tx":return new T(Z);case"Btn":return Z.data.radioButton?new S(Z):Z.data.checkBox?new x(Z):new D(Z);case"Ch":return new m(Z);case"Sig":return new C(Z)}return new v(Z);case n.AnnotationType.POPUP:return new _(Z);case n.AnnotationType.FREETEXT:return new y(Z);case n.AnnotationType.LINE:return new p(Z);case n.AnnotationType.SQUARE:return new k(Z);case n.AnnotationType.CIRCLE:return new L(Z);case n.AnnotationType.POLYLINE:return new X(Z);case n.AnnotationType.CARET:return new q(Z);case n.AnnotationType.INK:return new te(Z);case n.AnnotationType.POLYGON:return new N(Z);case n.AnnotationType.HIGHLIGHT:return new oe(Z);case n.AnnotationType.UNDERLINE:return new Q(Z);case n.AnnotationType.SQUIGGLY:return new W(Z);case n.AnnotationType.STRIKEOUT:return new pe(Z);case n.AnnotationType.STAMP:return new he(Z);case n.AnnotationType.FILEATTACHMENT:return new _e(Z);default:return new A(Z)}}}class A{constructor(Z,{isRenderable:j=!1,ignoreBorder:R=!1,createQuadrilaterals:B=!1}={}){this.isRenderable=j,this.data=Z.data,this.layer=Z.layer,this.linkService=Z.linkService,this.downloadManager=Z.downloadManager,this.imageResourcesPath=Z.imageResourcesPath,this.renderForms=Z.renderForms,this.svgFactory=Z.svgFactory,this.annotationStorage=Z.annotationStorage,this.enableScripting=Z.enableScripting,this.hasJSActions=Z.hasJSActions,this._fieldObjects=Z.fieldObjects,this.parent=Z.parent,j&&(this.container=this._createContainer(R)),B&&(this.quadrilaterals=this._createQuadrilaterals(R))}_createContainer(Z){const{data:j,parent:{page:R,viewport:B}}=this,G=document.createElement("section");G.setAttribute("data-annotation-id",j.id),G.style.zIndex=this.parent.zIndex++,this.data.popupRef&&G.setAttribute("aria-haspopup","dialog"),j.noRotate&&G.classList.add("norotate");const{pageWidth:re,pageHeight:ce,pageX:Ee,pageY:Pe}=B.rawDims;if(!j.rect||this instanceof _){const{rotation:$e}=j;return!j.hasOwnCanvas&&$e!==0&&this.setRotation($e,G),G}const{width:le,height:ke}=h(j.rect),Se=n.Util.normalizeRect([j.rect[0],R.view[3]-j.rect[1]+R.view[1],j.rect[2],R.view[3]-j.rect[3]+R.view[1]]);if(!Z&&j.borderStyle.width>0){G.style.borderWidth=`${j.borderStyle.width}px`;const $e=j.borderStyle.horizontalCornerRadius,Be=j.borderStyle.verticalCornerRadius;if($e>0||Be>0){const He=`calc(${$e}px * var(--scale-factor)) / calc(${Be}px * var(--scale-factor))`;G.style.borderRadius=He}else if(this instanceof S){const He=`calc(${le}px * var(--scale-factor)) / calc(${ke}px * var(--scale-factor))`;G.style.borderRadius=He}switch(j.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:G.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:G.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:G.style.borderBottomStyle="solid";break}const qe=j.borderColor||null;qe?G.style.borderColor=n.Util.makeHexColor(qe[0]|0,qe[1]|0,qe[2]|0):G.style.borderWidth=0}G.style.left=`${100*(Se[0]-Ee)/re}%`,G.style.top=`${100*(Se[1]-Pe)/ce}%`;const{rotation:Ie}=j;return j.hasOwnCanvas||Ie===0?(G.style.width=`${100*le/re}%`,G.style.height=`${100*ke/ce}%`):this.setRotation(Ie,G),G}setRotation(Z,j=this.container){const{pageWidth:R,pageHeight:B}=this.parent.viewport.rawDims,{width:G,height:re}=h(this.data.rect);let ce,Ee;Z%180===0?(ce=100*G/R,Ee=100*re/B):(ce=100*re/R,Ee=100*G/B),j.style.width=`${ce}%`,j.style.height=`${Ee}%`,j.setAttribute("data-main-rotation",(360-Z)%360)}get _commonActions(){const Z=(j,R,B)=>{const G=B.detail[j];B.target.style[R]=o.ColorConverters[`${G[0]}_HTML`](G.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:j=>{const R=j.detail.display%2===1;this.container.style.visibility=R?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:R,print:j.detail.display===0||j.detail.display===3})},print:j=>{this.annotationStorage.setValue(this.data.id,{print:j.detail.print})},hidden:j=>{this.container.style.visibility=j.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:j.detail.hidden})},focus:j=>{setTimeout(()=>j.target.focus({preventScroll:!1}),0)},userName:j=>{j.target.title=j.detail.userName},readonly:j=>{j.detail.readonly?j.target.setAttribute("readonly",""):j.target.removeAttribute("readonly")},required:j=>{this._setRequired(j.target,j.detail.required)},bgColor:j=>{Z("bgColor","backgroundColor",j)},fillColor:j=>{Z("fillColor","backgroundColor",j)},fgColor:j=>{Z("fgColor","color",j)},textColor:j=>{Z("textColor","color",j)},borderColor:j=>{Z("borderColor","borderColor",j)},strokeColor:j=>{Z("strokeColor","borderColor",j)},rotation:j=>{const R=j.detail.rotation;this.setRotation(R),this.annotationStorage.setValue(this.data.id,{rotation:R})}})}_dispatchEventFromSandbox(Z,j){const R=this._commonActions;for(const B of Object.keys(j.detail)){const G=Z[B]||R[B];G==null||G(j)}}_setDefaultPropertiesFromJS(Z){if(!this.enableScripting)return;const j=this.annotationStorage.getRawValue(this.data.id);if(!j)return;const R=this._commonActions;for(const[B,G]of Object.entries(j)){const re=R[B];if(re){const ce={detail:{[B]:G},target:Z};re(ce),delete j[B]}}}_createQuadrilaterals(Z=!1){if(!this.data.quadPoints)return null;const j=[],R=this.data.rect;let B=null;for(const G of this.data.quadPoints)this.data.rect=[G[2].x,G[2].y,G[1].x,G[1].y],j.push(this._createContainer(Z)),B||(B=this.data.rect);return this.data.rect=R,this.firstQuadRect=B,j}_createPopup(){const{container:Z,data:j}=this;Z.setAttribute("aria-haspopup","dialog");const R=new _({data:{color:j.color,titleObj:j.titleObj,modificationDate:j.modificationDate,contentsObj:j.contentsObj,richText:j.richText,parentRect:this.firstQuadRect||j.rect,borderStyle:0,id:`popup_${j.id}`,rotation:j.rotation},parent:this.parent,elements:[this]});this.parent.div.append(R.render())}_renderQuadrilaterals(Z){for(const j of this.quadrilaterals)j.classList.add(Z);return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Z,j=null){const R=[];if(this._fieldObjects){const B=this._fieldObjects[Z];if(B)for(const{page:G,id:re,exportValues:ce}of B){if(G===-1||re===j)continue;const Ee=typeof ce=="string"?ce:null,Pe=document.querySelector(`[data-element-id="${re}"]`);if(Pe&&!u.has(Pe)){(0,n.warn)(`_getElementsByName - element not allowed: ${re}`);continue}R.push({id:re,exportValue:Ee,domElement:Pe})}return R}for(const B of document.getElementsByName(Z)){const{exportValue:G}=B,re=B.getAttribute("data-element-id");re!==j&&u.has(B)&&R.push({id:re,exportValue:G,domElement:B})}return R}show(){var Z;this.container&&(this.container.hidden=!1),(Z=this.popup)==null||Z.maybeShow()}hide(){var Z;this.container&&(this.container.hidden=!0),(Z=this.popup)==null||Z.forceHide()}getElementsToTriggerPopup(){return this.quadrilaterals||this.container}addHighlightArea(){const Z=this.getElementsToTriggerPopup();if(Array.isArray(Z))for(const j of Z)j.classList.add("highlightArea");else Z.classList.add("highlightArea")}}class w extends A{constructor(j,R=null){super(j,{isRenderable:!0,ignoreBorder:!!(R!=null&&R.ignoreBorder),createQuadrilaterals:!0});se(this,J);se(this,I);this.isTooltipOnly=j.data.isTooltipOnly}render(){const{data:j,linkService:R}=this,B=document.createElement("a");B.setAttribute("data-element-id",j.id);let G=!1;return j.url?(R.addLinkAttributes(B,j.url,j.newWindow),G=!0):j.action?(this._bindNamedAction(B,j.action),G=!0):j.attachment?(this._bindAttachment(B,j.attachment),G=!0):j.setOCGState?(de(this,I,vn).call(this,B,j.setOCGState),G=!0):j.dest?(this._bindLink(B,j.dest),G=!0):(j.actions&&(j.actions.Action||j.actions["Mouse Up"]||j.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(B,j),G=!0),j.resetForm?(this._bindResetFormAction(B,j.resetForm),G=!0):this.isTooltipOnly&&!G&&(this._bindLink(B,""),G=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((re,ce)=>{const Ee=ce===0?B:B.cloneNode();return re.append(Ee),re}):(this.container.classList.add("linkAnnotation"),G&&this.container.append(B),this.container)}_bindLink(j,R){j.href=this.linkService.getDestinationHash(R),j.onclick=()=>(R&&this.linkService.goToDestination(R),!1),(R||R==="")&&de(this,J,st).call(this)}_bindNamedAction(j,R){j.href=this.linkService.getAnchorUrl(""),j.onclick=()=>(this.linkService.executeNamedAction(R),!1),de(this,J,st).call(this)}_bindAttachment(j,R){j.href=this.linkService.getAnchorUrl(""),j.onclick=()=>{var B;return(B=this.downloadManager)==null||B.openOrDownloadData(this.container,R.content,R.filename),!1},de(this,J,st).call(this)}_bindJSAction(j,R){j.href=this.linkService.getAnchorUrl("");const B=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const G of Object.keys(R.actions)){const re=B.get(G);re&&(j[re]=()=>{var ce;return(ce=this.linkService.eventBus)==null||ce.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R.id,name:G}}),!1})}j.onclick||(j.onclick=()=>!1),de(this,J,st).call(this)}_bindResetFormAction(j,R){const B=j.onclick;if(B||(j.href=this.linkService.getAnchorUrl("")),de(this,J,st).call(this),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),B||(j.onclick=()=>!1);return}j.onclick=()=>{var ke;B==null||B();const{fields:G,refs:re,include:ce}=R,Ee=[];if(G.length!==0||re.length!==0){const Se=new Set(re);for(const Ie of G){const $e=this._fieldObjects[Ie]||[];for(const{id:Be}of $e)Se.add(Be)}for(const Ie of Object.values(this._fieldObjects))for(const $e of Ie)Se.has($e.id)===ce&&Ee.push($e)}else for(const Se of Object.values(this._fieldObjects))Ee.push(...Se);const Pe=this.annotationStorage,le=[];for(const Se of Ee){const{id:Ie}=Se;switch(le.push(Ie),Se.type){case"text":{const Be=Se.defaultValue||"";Pe.setValue(Ie,{value:Be});break}case"checkbox":case"radiobutton":{const Be=Se.defaultValue===Se.exportValues;Pe.setValue(Ie,{value:Be});break}case"combobox":case"listbox":{const Be=Se.defaultValue||"";Pe.setValue(Ie,{value:Be});break}default:continue}const $e=document.querySelector(`[data-element-id="${Ie}"]`);if($e){if(!u.has($e)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${Ie}`);continue}}else continue;$e.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((ke=this.linkService.eventBus)==null||ke.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:le,name:"ResetForm"}})),!1}}}J=new WeakSet,st=function(){this.container.setAttribute("data-internal-link","")},I=new WeakSet,vn=function(j,R){j.href=this.linkService.getAnchorUrl(""),j.onclick=()=>(this.linkService.executeSetOCGState(R),!1),de(this,J,st).call(this)};class g extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j})}render(){this.container.classList.add("textAnnotation");const Z=document.createElement("img");return Z.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Z.alt="[{{type}} Annotation]",Z.dataset.l10nId="text_annotation_type",Z.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(Z),this.container}}class v extends A{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(Z){var j;this.data.hasOwnCanvas&&(((j=Z.previousSibling)==null?void 0:j.nodeName)==="CANVAS"&&(Z.previousSibling.hidden=!0),Z.hidden=!1)}_getKeyModifier(Z){const{isWin:j,isMac:R}=n.FeatureTest.platform;return j&&Z.ctrlKey||R&&Z.metaKey}_setEventListener(Z,j,R,B){j.includes("mouse")?Z.addEventListener(j,G=>{var re;(re=this.linkService.eventBus)==null||re.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:R,value:B(G),shift:G.shiftKey,modifier:this._getKeyModifier(G)}})}):Z.addEventListener(j,G=>{var re;(re=this.linkService.eventBus)==null||re.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:R,value:B(G)}})})}_setEventListeners(Z,j,R){var B;for(const[G,re]of j)(re==="Action"||(B=this.data.actions)!=null&&B[re])&&this._setEventListener(Z,G,re,R)}_setBackgroundColor(Z){const j=this.data.backgroundColor||null;Z.style.backgroundColor=j===null?"transparent":n.Util.makeHexColor(j[0],j[1],j[2])}_setTextStyle(Z){const j=["left","center","right"],{fontColor:R}=this.data.defaultAppearanceData,B=this.data.defaultAppearanceData.fontSize||c,G=Z.style;let re;const ce=2,Ee=Pe=>Math.round(10*Pe)/10;if(this.data.multiLine){const Pe=Math.abs(this.data.rect[3]-this.data.rect[1]-ce),le=Math.round(Pe/(n.LINE_FACTOR*B))||1,ke=Pe/le;re=Math.min(B,Ee(ke/n.LINE_FACTOR))}else{const Pe=Math.abs(this.data.rect[3]-this.data.rect[1]-ce);re=Math.min(B,Ee(Pe/n.LINE_FACTOR))}G.fontSize=`calc(${re}px * var(--scale-factor))`,G.color=n.Util.makeHexColor(R[0],R[1],R[2]),this.data.textAlignment!==null&&(G.textAlign=j[this.data.textAlignment])}_setRequired(Z,j){j?Z.setAttribute("required",!0):Z.removeAttribute("required"),Z.setAttribute("aria-required",j)}}class T extends v{constructor(Z){const j=Z.renderForms||!Z.data.hasAppearance&&!!Z.data.fieldValue;super(Z,{isRenderable:j})}setPropertyOnSiblings(Z,j,R,B){const G=this.annotationStorage;for(const re of this._getElementsByName(Z.name,Z.id))re.domElement&&(re.domElement[j]=R),G.setValue(re.id,{[B]:R})}render(){var B,G;const Z=this.annotationStorage,j=this.data.id;this.container.classList.add("textWidgetAnnotation");let R=null;if(this.renderForms){const re=Z.getValue(j,{value:this.data.fieldValue});let ce=re.value||"";const Ee=Z.getValue(j,{charLimit:this.data.maxLen}).charLimit;Ee&&ce.length>Ee&&(ce=ce.slice(0,Ee));let Pe=re.formattedValue||((B=this.data.textContent)==null?void 0:B.join(`
`))||null;Pe&&this.data.comb&&(Pe=Pe.replaceAll(/\s+/g,""));const le={userValue:ce,formattedValue:Pe,lastCommittedValue:null,commitKey:1};this.data.multiLine?(R=document.createElement("textarea"),R.textContent=Pe??ce,this.data.doNotScroll&&(R.style.overflowY="hidden")):(R=document.createElement("input"),R.type="text",R.setAttribute("value",Pe??ce),this.data.doNotScroll&&(R.style.overflowX="hidden")),this.data.hasOwnCanvas&&(R.hidden=!0),u.add(R),R.setAttribute("data-element-id",j),R.disabled=this.data.readOnly,R.name=this.data.baseFieldName||this.data.fieldName,R.tabIndex=d,this._setRequired(R,this.data.required),Ee&&(R.maxLength=Ee),R.addEventListener("input",Se=>{Z.setValue(j,{value:Se.target.value}),this.setPropertyOnSiblings(R,"value",Se.target.value,"value"),le.formattedValue=null}),R.addEventListener("resetform",Se=>{const Ie=this.data.defaultFieldValue??"";R.value=le.userValue=Ie,le.formattedValue=null});let ke=Se=>{const{formattedValue:Ie}=le;Ie!=null&&(Se.target.value=Ie),Se.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){R.addEventListener("focus",Ie=>{const{target:$e}=Ie;le.userValue&&($e.value=le.userValue),le.lastCommittedValue=$e.value,le.commitKey=1}),R.addEventListener("updatefromsandbox",Ie=>{this.showElementAndHideCanvas(Ie.target);const $e={value(Be){le.userValue=Be.detail.value??"",Z.setValue(j,{value:le.userValue.toString()}),Be.target.value=le.userValue},formattedValue(Be){const{formattedValue:qe}=Be.detail;le.formattedValue=qe,qe!=null&&Be.target!==document.activeElement&&(Be.target.value=qe),Z.setValue(j,{formattedValue:qe})},selRange(Be){Be.target.setSelectionRange(...Be.detail.selRange)},charLimit:Be=>{var Ke;const{charLimit:qe}=Be.detail,{target:He}=Be;if(qe===0){He.removeAttribute("maxLength");return}He.setAttribute("maxLength",qe);let Ge=le.userValue;!Ge||Ge.length<=qe||(Ge=Ge.slice(0,qe),He.value=le.userValue=Ge,Z.setValue(j,{value:Ge}),(Ke=this.linkService.eventBus)==null||Ke.dispatch("dispatcheventinsandbox",{source:this,detail:{id:j,name:"Keystroke",value:Ge,willCommit:!0,commitKey:1,selStart:He.selectionStart,selEnd:He.selectionEnd}}))}};this._dispatchEventFromSandbox($e,Ie)}),R.addEventListener("keydown",Ie=>{var qe;le.commitKey=1;let $e=-1;if(Ie.key==="Escape"?$e=0:Ie.key==="Enter"&&!this.data.multiLine?$e=2:Ie.key==="Tab"&&(le.commitKey=3),$e===-1)return;const{value:Be}=Ie.target;le.lastCommittedValue!==Be&&(le.lastCommittedValue=Be,le.userValue=Be,(qe=this.linkService.eventBus)==null||qe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:j,name:"Keystroke",value:Be,willCommit:!0,commitKey:$e,selStart:Ie.target.selectionStart,selEnd:Ie.target.selectionEnd}}))});const Se=ke;ke=null,R.addEventListener("blur",Ie=>{var Be;if(!Ie.relatedTarget)return;const{value:$e}=Ie.target;le.userValue=$e,le.lastCommittedValue!==$e&&((Be=this.linkService.eventBus)==null||Be.dispatch("dispatcheventinsandbox",{source:this,detail:{id:j,name:"Keystroke",value:$e,willCommit:!0,commitKey:le.commitKey,selStart:Ie.target.selectionStart,selEnd:Ie.target.selectionEnd}})),Se(Ie)}),(G=this.data.actions)!=null&&G.Keystroke&&R.addEventListener("beforeinput",Ie=>{var Je;le.lastCommittedValue=null;const{data:$e,target:Be}=Ie,{value:qe,selectionStart:He,selectionEnd:Ge}=Be;let Ke=He,Ye=Ge;switch(Ie.inputType){case"deleteWordBackward":{const tt=qe.substring(0,He).match(/\w*[^\w]*$/);tt&&(Ke-=tt[0].length);break}case"deleteWordForward":{const tt=qe.substring(He).match(/^[^\w]*\w*/);tt&&(Ye+=tt[0].length);break}case"deleteContentBackward":He===Ge&&(Ke-=1);break;case"deleteContentForward":He===Ge&&(Ye+=1);break}Ie.preventDefault(),(Je=this.linkService.eventBus)==null||Je.dispatch("dispatcheventinsandbox",{source:this,detail:{id:j,name:"Keystroke",value:qe,change:$e||"",willCommit:!1,selStart:Ke,selEnd:Ye}})}),this._setEventListeners(R,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Ie=>Ie.target.value)}if(ke&&R.addEventListener("blur",ke),this.data.comb){const Ie=(this.data.rect[2]-this.data.rect[0])/Ee;R.classList.add("comb"),R.style.letterSpacing=`calc(${Ie}px * var(--scale-factor) - 1ch)`}}else R=document.createElement("div"),R.textContent=this.data.fieldValue,R.style.verticalAlign="middle",R.style.display="table-cell";return this._setTextStyle(R),this._setBackgroundColor(R),this._setDefaultPropertiesFromJS(R),this.container.append(R),this.container}}class C extends v{constructor(Z){super(Z,{isRenderable:!!Z.data.hasOwnCanvas})}}class x extends v{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){const Z=this.annotationStorage,j=this.data,R=j.id;let B=Z.getValue(R,{value:j.exportValue===j.fieldValue}).value;typeof B=="string"&&(B=B!=="Off",Z.setValue(R,{value:B})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const G=document.createElement("input");return u.add(G),G.setAttribute("data-element-id",R),G.disabled=j.readOnly,this._setRequired(G,this.data.required),G.type="checkbox",G.name=j.baseFieldName||j.fieldName,B&&G.setAttribute("checked",!0),G.setAttribute("exportValue",j.exportValue),G.tabIndex=d,G.addEventListener("change",re=>{const{name:ce,checked:Ee}=re.target;for(const Pe of this._getElementsByName(ce,R)){const le=Ee&&Pe.exportValue===j.exportValue;Pe.domElement&&(Pe.domElement.checked=le),Z.setValue(Pe.id,{value:le})}Z.setValue(R,{value:Ee})}),G.addEventListener("resetform",re=>{const ce=j.defaultFieldValue||"Off";re.target.checked=ce===j.exportValue}),this.enableScripting&&this.hasJSActions&&(G.addEventListener("updatefromsandbox",re=>{const ce={value(Ee){Ee.target.checked=Ee.detail.value!=="Off",Z.setValue(R,{value:Ee.target.checked})}};this._dispatchEventFromSandbox(ce,re)}),this._setEventListeners(G,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],re=>re.target.checked)),this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class S extends v{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const Z=this.annotationStorage,j=this.data,R=j.id;let B=Z.getValue(R,{value:j.fieldValue===j.buttonValue}).value;typeof B=="string"&&(B=B!==j.buttonValue,Z.setValue(R,{value:B}));const G=document.createElement("input");if(u.add(G),G.setAttribute("data-element-id",R),G.disabled=j.readOnly,this._setRequired(G,this.data.required),G.type="radio",G.name=j.baseFieldName||j.fieldName,B&&G.setAttribute("checked",!0),G.tabIndex=d,G.addEventListener("change",re=>{const{name:ce,checked:Ee}=re.target;for(const Pe of this._getElementsByName(ce,R))Z.setValue(Pe.id,{value:!1});Z.setValue(R,{value:Ee})}),G.addEventListener("resetform",re=>{const ce=j.defaultFieldValue;re.target.checked=ce!=null&&ce===j.buttonValue}),this.enableScripting&&this.hasJSActions){const re=j.buttonValue;G.addEventListener("updatefromsandbox",ce=>{const Ee={value:Pe=>{const le=re===Pe.detail.value;for(const ke of this._getElementsByName(Pe.target.name)){const Se=le&&ke.id===R;ke.domElement&&(ke.domElement.checked=Se),Z.setValue(ke.id,{value:Se})}}};this._dispatchEventFromSandbox(Ee,ce)}),this._setEventListeners(G,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ce=>ce.target.checked)}return this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class D extends w{constructor(Z){super(Z,{ignoreBorder:Z.data.hasAppearance})}render(){const Z=super.render();Z.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(Z.title=this.data.alternativeText);const j=Z.lastChild;return this.enableScripting&&this.hasJSActions&&j&&(this._setDefaultPropertiesFromJS(j),j.addEventListener("updatefromsandbox",R=>{this._dispatchEventFromSandbox({},R)})),Z}}class m extends v{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const Z=this.annotationStorage,j=this.data.id,R=Z.getValue(j,{value:this.data.fieldValue}),B=document.createElement("select");u.add(B),B.setAttribute("data-element-id",j),B.disabled=this.data.readOnly,this._setRequired(B,this.data.required),B.name=this.data.baseFieldName||this.data.fieldName,B.tabIndex=d;let G=this.data.combo&&this.data.options.length>0;this.data.combo||(B.size=this.data.options.length,this.data.multiSelect&&(B.multiple=!0)),B.addEventListener("resetform",le=>{const ke=this.data.defaultFieldValue;for(const Se of B.options)Se.selected=Se.value===ke});for(const le of this.data.options){const ke=document.createElement("option");ke.textContent=le.displayValue,ke.value=le.exportValue,R.value.includes(le.exportValue)&&(ke.setAttribute("selected",!0),G=!1),B.append(ke)}let re=null;if(G){const le=document.createElement("option");le.value=" ",le.setAttribute("hidden",!0),le.setAttribute("selected",!0),B.prepend(le),re=()=>{le.remove(),B.removeEventListener("input",re),re=null},B.addEventListener("input",re)}const ce=le=>{const ke=le?"value":"textContent",{options:Se,multiple:Ie}=B;return Ie?Array.prototype.filter.call(Se,$e=>$e.selected).map($e=>$e[ke]):Se.selectedIndex===-1?null:Se[Se.selectedIndex][ke]};let Ee=ce(!1);const Pe=le=>{const ke=le.target.options;return Array.prototype.map.call(ke,Se=>({displayValue:Se.textContent,exportValue:Se.value}))};return this.enableScripting&&this.hasJSActions?(B.addEventListener("updatefromsandbox",le=>{const ke={value(Se){re==null||re();const Ie=Se.detail.value,$e=new Set(Array.isArray(Ie)?Ie:[Ie]);for(const Be of B.options)Be.selected=$e.has(Be.value);Z.setValue(j,{value:ce(!0)}),Ee=ce(!1)},multipleSelection(Se){B.multiple=!0},remove(Se){const Ie=B.options,$e=Se.detail.remove;Ie[$e].selected=!1,B.remove($e),Ie.length>0&&Array.prototype.findIndex.call(Ie,qe=>qe.selected)===-1&&(Ie[0].selected=!0),Z.setValue(j,{value:ce(!0),items:Pe(Se)}),Ee=ce(!1)},clear(Se){for(;B.length!==0;)B.remove(0);Z.setValue(j,{value:null,items:[]}),Ee=ce(!1)},insert(Se){const{index:Ie,displayValue:$e,exportValue:Be}=Se.detail.insert,qe=B.children[Ie],He=document.createElement("option");He.textContent=$e,He.value=Be,qe?qe.before(He):B.append(He),Z.setValue(j,{value:ce(!0),items:Pe(Se)}),Ee=ce(!1)},items(Se){const{items:Ie}=Se.detail;for(;B.length!==0;)B.remove(0);for(const $e of Ie){const{displayValue:Be,exportValue:qe}=$e,He=document.createElement("option");He.textContent=Be,He.value=qe,B.append(He)}B.options.length>0&&(B.options[0].selected=!0),Z.setValue(j,{value:ce(!0),items:Pe(Se)}),Ee=ce(!1)},indices(Se){const Ie=new Set(Se.detail.indices);for(const $e of Se.target.options)$e.selected=Ie.has($e.index);Z.setValue(j,{value:ce(!0)}),Ee=ce(!1)},editable(Se){Se.target.disabled=!Se.detail.editable}};this._dispatchEventFromSandbox(ke,le)}),B.addEventListener("input",le=>{var Se;const ke=ce(!0);Z.setValue(j,{value:ke}),le.preventDefault(),(Se=this.linkService.eventBus)==null||Se.dispatch("dispatcheventinsandbox",{source:this,detail:{id:j,name:"Keystroke",value:Ee,changeEx:ke,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(B,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],le=>le.target.value)):B.addEventListener("input",function(le){Z.setValue(j,{value:ce(!0)})}),this.data.combo&&this._setTextStyle(B),this._setBackgroundColor(B),this._setDefaultPropertiesFromJS(B),this.container.append(B),this.container}}class _ extends A{constructor(Z){var G,re,ce;const{data:j,elements:R}=Z,B=!!((G=j.titleObj)!=null&&G.str||(re=j.contentsObj)!=null&&re.str||(ce=j.richText)!=null&&ce.str);super(Z,{isRenderable:B}),this.elements=R}render(){this.container.classList.add("popupAnnotation");const Z=new f({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),j=[];for(const R of this.elements)R.popup=Z,j.push(R.data.id),R.addHighlightArea();return this.container.setAttribute("aria-controls",j.join(",")),this.container}}class f{constructor({container:Z,color:j,elements:R,titleObj:B,modificationDate:G,contentsObj:re,richText:ce,parent:Ee,rect:Pe,parentRect:le,open:ke}){se(this,ie);se(this,Ae);se(this,Me);se(this,U,null);se(this,E,de(this,Me,Kt).bind(this));se(this,O,de(this,Ae,zt).bind(this));se(this,M,de(this,ie,Ht).bind(this));se(this,K,null);se(this,Y,null);se(this,ne,null);se(this,ue,null);se(this,fe,null);se(this,we,null);se(this,me,!1);se(this,Ce,null);se(this,Re,null);se(this,Te,null);se(this,ye,null);se(this,ae,!1);be(this,Y,Z),be(this,ye,B),be(this,ne,re),be(this,Te,ce),be(this,fe,Ee),be(this,K,j),be(this,Re,Pe),be(this,we,le),be(this,ue,R);const Se=s.PDFDateString.toDateObject(G);Se&&be(this,U,Ee.l10n.get("annotation_date_string",{date:Se.toLocaleDateString(),time:Se.toLocaleTimeString()})),this.trigger=R.flatMap(Ie=>Ie.getElementsToTriggerPopup());for(const Ie of this.trigger)Ie.addEventListener("click",P(this,M)),Ie.addEventListener("mouseenter",P(this,O)),Ie.addEventListener("mouseleave",P(this,E));P(this,Y).hidden=!0,ke&&de(this,ie,Ht).call(this)}render(){if(P(this,Ce))return;const{page:{view:Z},viewport:{rawDims:{pageWidth:j,pageHeight:R,pageX:B,pageY:G}}}=P(this,fe),re=be(this,Ce,document.createElement("div"));if(re.className="popup",P(this,K)){const Ke=re.style.outlineColor=n.Util.makeHexColor(...P(this,K));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?re.style.backgroundColor=`color-mix(in srgb, ${Ke} 30%, white)`:re.style.backgroundColor=n.Util.makeHexColor(...P(this,K).map(Je=>Math.floor(.7*(255-Je)+Je)))}const ce=document.createElement("span");ce.className="header";const Ee=document.createElement("h1");if(ce.append(Ee),{dir:Ee.dir,str:Ee.textContent}=P(this,ye),re.append(ce),P(this,U)){const Ke=document.createElement("span");Ke.classList.add("popupDate"),P(this,U).then(Ye=>{Ke.textContent=Ye}),ce.append(Ke)}const Pe=P(this,ne),le=P(this,Te);if(le!=null&&le.str&&(!(Pe!=null&&Pe.str)||Pe.str===le.str))l.XfaLayer.render({xfaHtml:le.html,intent:"richText",div:re}),re.lastChild.classList.add("richText","popupContent");else{const Ke=this._formatContents(Pe);re.append(Ke)}let ke=!!P(this,we),Se=ke?P(this,we):P(this,Re);for(const Ke of P(this,ue))if(!Se||n.Util.intersect(Ke.data.rect,Se)!==null){Se=Ke.data.rect,ke=!0;break}const Ie=n.Util.normalizeRect([Se[0],Z[3]-Se[1]+Z[1],Se[2],Z[3]-Se[3]+Z[1]]),$e=5,Be=ke?Se[2]-Se[0]+$e:0,qe=Ie[0]+Be,He=Ie[1],{style:Ge}=P(this,Y);Ge.left=`${100*(qe-B)/j}%`,Ge.top=`${100*(He-G)/R}%`,P(this,Y).append(re)}_formatContents({str:Z,dir:j}){const R=document.createElement("p");R.classList.add("popupContent"),R.dir=j;const B=Z.split(/(?:\r\n?|\n)/);for(let G=0,re=B.length;G<re;++G){const ce=B[G];R.append(document.createTextNode(ce)),G<re-1&&R.append(document.createElement("br"))}return R}forceHide(){be(this,ae,this.isVisible),P(this,ae)&&(P(this,Y).hidden=!0)}maybeShow(){P(this,ae)&&(be(this,ae,!1),P(this,Y).hidden=!1)}get isVisible(){return P(this,Y).hidden===!1}}U=new WeakMap,E=new WeakMap,O=new WeakMap,M=new WeakMap,K=new WeakMap,Y=new WeakMap,ne=new WeakMap,ue=new WeakMap,fe=new WeakMap,we=new WeakMap,me=new WeakMap,Ce=new WeakMap,Re=new WeakMap,Te=new WeakMap,ye=new WeakMap,ae=new WeakMap,ie=new WeakSet,Ht=function(){be(this,me,!P(this,me)),P(this,me)?(de(this,Ae,zt).call(this),P(this,Y).addEventListener("click",P(this,M))):(de(this,Me,Kt).call(this),P(this,Y).removeEventListener("click",P(this,M)))},Ae=new WeakSet,zt=function(){P(this,Ce)||this.render(),this.isVisible?P(this,me)&&P(this,Y).classList.add("focused"):(P(this,Y).hidden=!1,P(this,Y).style.zIndex=parseInt(P(this,Y).style.zIndex)+1e3)},Me=new WeakSet,Kt=function(){P(this,Y).classList.remove("focused"),!P(this,me)&&(P(this,Y).hidden=!0,P(this,Y).style.zIndex=parseInt(P(this,Y).style.zIndex)-1e3)};class y extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0}),this.textContent=Z.data.textContent,this.annotationEditorType=n.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const Z=document.createElement("div");Z.classList.add("annotationTextContent"),Z.setAttribute("role","comment");for(const j of this.textContent){const R=document.createElement("span");R.textContent=j,Z.append(R)}this.container.append(Z)}return this.data.popupRef||this._createPopup(),this.container}}e.FreeTextAnnotationElement=y;class p extends A{constructor(j){var B,G,re;const R=!!(j.data.popupRef||(B=j.data.titleObj)!=null&&B.str||(G=j.data.contentsObj)!=null&&G.str||(re=j.data.richText)!=null&&re.str);super(j,{isRenderable:R,ignoreBorder:!0});se(this,Ne,null)}render(){this.container.classList.add("lineAnnotation");const j=this.data,{width:R,height:B}=h(j.rect),G=this.svgFactory.create(R,B,!0),re=be(this,Ne,this.svgFactory.createElement("svg:line"));return re.setAttribute("x1",j.rect[2]-j.lineCoordinates[0]),re.setAttribute("y1",j.rect[3]-j.lineCoordinates[1]),re.setAttribute("x2",j.rect[2]-j.lineCoordinates[2]),re.setAttribute("y2",j.rect[3]-j.lineCoordinates[3]),re.setAttribute("stroke-width",j.borderStyle.width||1),re.setAttribute("stroke","transparent"),re.setAttribute("fill","transparent"),G.append(re),this.container.append(G),j.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return P(this,Ne)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ne=new WeakMap;class k extends A{constructor(j){var B,G,re;const R=!!(j.data.popupRef||(B=j.data.titleObj)!=null&&B.str||(G=j.data.contentsObj)!=null&&G.str||(re=j.data.richText)!=null&&re.str);super(j,{isRenderable:R,ignoreBorder:!0});se(this,De,null)}render(){this.container.classList.add("squareAnnotation");const j=this.data,{width:R,height:B}=h(j.rect),G=this.svgFactory.create(R,B,!0),re=j.borderStyle.width,ce=be(this,De,this.svgFactory.createElement("svg:rect"));return ce.setAttribute("x",re/2),ce.setAttribute("y",re/2),ce.setAttribute("width",R-re),ce.setAttribute("height",B-re),ce.setAttribute("stroke-width",re||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),G.append(ce),this.container.append(G),j.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return P(this,De)}addHighlightArea(){this.container.classList.add("highlightArea")}}De=new WeakMap;class L extends A{constructor(j){var B,G,re;const R=!!(j.data.popupRef||(B=j.data.titleObj)!=null&&B.str||(G=j.data.contentsObj)!=null&&G.str||(re=j.data.richText)!=null&&re.str);super(j,{isRenderable:R,ignoreBorder:!0});se(this,V,null)}render(){this.container.classList.add("circleAnnotation");const j=this.data,{width:R,height:B}=h(j.rect),G=this.svgFactory.create(R,B,!0),re=j.borderStyle.width,ce=be(this,V,this.svgFactory.createElement("svg:ellipse"));return ce.setAttribute("cx",R/2),ce.setAttribute("cy",B/2),ce.setAttribute("rx",R/2-re/2),ce.setAttribute("ry",B/2-re/2),ce.setAttribute("stroke-width",re||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),G.append(ce),this.container.append(G),j.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return P(this,V)}addHighlightArea(){this.container.classList.add("highlightArea")}}V=new WeakMap;class X extends A{constructor(j){var B,G,re;const R=!!(j.data.popupRef||(B=j.data.titleObj)!=null&&B.str||(G=j.data.contentsObj)!=null&&G.str||(re=j.data.richText)!=null&&re.str);super(j,{isRenderable:R,ignoreBorder:!0});se(this,H,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const j=this.data,{width:R,height:B}=h(j.rect),G=this.svgFactory.create(R,B,!0);let re=[];for(const Ee of j.vertices){const Pe=Ee.x-j.rect[0],le=j.rect[3]-Ee.y;re.push(Pe+","+le)}re=re.join(" ");const ce=be(this,H,this.svgFactory.createElement(this.svgElementName));return ce.setAttribute("points",re),ce.setAttribute("stroke-width",j.borderStyle.width||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),G.append(ce),this.container.append(G),j.popupRef||this._createPopup(ce,j),this.container}getElementsToTriggerPopup(){return P(this,H)}addHighlightArea(){this.container.classList.add("highlightArea")}}H=new WeakMap;class N extends X{constructor(Z){super(Z),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class q extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class te extends A{constructor(j){var B,G,re;const R=!!(j.data.popupRef||(B=j.data.titleObj)!=null&&B.str||(G=j.data.contentsObj)!=null&&G.str||(re=j.data.richText)!=null&&re.str);super(j,{isRenderable:R,ignoreBorder:!0});se(this,ee,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=n.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const j=this.data,{width:R,height:B}=h(j.rect),G=this.svgFactory.create(R,B,!0);for(const re of j.inkLists){let ce=[];for(const Pe of re){const le=Pe.x-j.rect[0],ke=j.rect[3]-Pe.y;ce.push(`${le},${ke}`)}ce=ce.join(" ");const Ee=this.svgFactory.createElement(this.svgElementName);P(this,ee).push(Ee),Ee.setAttribute("points",ce),Ee.setAttribute("stroke-width",j.borderStyle.width||1),Ee.setAttribute("stroke","transparent"),Ee.setAttribute("fill","transparent"),j.popupRef||this._createPopup(Ee,j),G.append(Ee)}return this.container.append(G),this.container}getElementsToTriggerPopup(){return P(this,ee)}addHighlightArea(){this.container.classList.add("highlightArea")}}ee=new WeakMap,e.InkAnnotationElement=te;class oe extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class Q extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class W extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class pe extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class he extends A{constructor(Z){var R,B,G;const j=!!(Z.data.popupRef||(R=Z.data.titleObj)!=null&&R.str||(B=Z.data.contentsObj)!=null&&B.str||(G=Z.data.richText)!=null&&G.str);super(Z,{isRenderable:j,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class _e extends A{constructor(j){var G;super(j,{isRenderable:!0});se(this,ge,null);const{filename:R,content:B}=this.data.file;this.filename=(0,s.getFilenameFromUrl)(R,!0),this.content=B,(G=this.linkService.eventBus)==null||G.dispatch("fileattachmentannotation",{source:this,filename:R,content:B})}render(){var R,B;this.container.classList.add("fileAttachmentAnnotation");let j;return this.data.hasAppearance?j=document.createElement("div"):(j=document.createElement("img"),j.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),j.classList.add("popupTriggerArea"),j.addEventListener("dblclick",this._download.bind(this)),be(this,ge,j),!this.data.popupRef&&((R=this.data.titleObj)!=null&&R.str||(B=this.data.contentsObj)!=null&&B.str||this.data.richText)&&this._createPopup(),this.container.append(j),this.container}getElementsToTriggerPopup(){return P(this,ge)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var j;(j=this.downloadManager)==null||j.openOrDownloadData(this.container,this.content,this.filename)}}ge=new WeakMap;class Oe{constructor({div:Z,accessibilityManager:j,annotationCanvasMap:R,l10n:B,page:G,viewport:re}){se(this,Ze);se(this,We);se(this,Fe,null);se(this,je,null);se(this,Ve,new Map);this.div=Z,be(this,Fe,j),be(this,je,R),this.l10n=B,this.page=G,this.viewport=re,this.zIndex=0;const{NullL10n:ce}=t(32);this.l10n||(this.l10n=ce)}async render(Z){const{annotations:j}=Z,R=this.div;(0,s.setLayerDimensions)(R,this.viewport);const B=new Map,G={data:null,layer:R,linkService:Z.linkService,downloadManager:Z.downloadManager,imageResourcesPath:Z.imageResourcesPath||"",renderForms:Z.renderForms!==!1,svgFactory:new s.DOMSVGFactory,annotationStorage:Z.annotationStorage||new a.AnnotationStorage,enableScripting:Z.enableScripting===!0,hasJSActions:Z.hasJSActions,fieldObjects:Z.fieldObjects,parent:this,elements:null};for(const re of j){if(re.noHTML)continue;const ce=re.annotationType===n.AnnotationType.POPUP;if(ce){const le=B.get(re.id);if(!le)continue;G.elements=le}else{const{width:le,height:ke}=h(re.rect);if(le<=0||ke<=0)continue}G.data=re;const Ee=b.create(G);if(!Ee.isRenderable)continue;if(!ce&&re.popupRef){const le=B.get(re.popupRef);le?le.push(Ee):B.set(re.popupRef,[Ee])}Ee.annotationEditorType>0&&P(this,Ve).set(Ee.data.id,Ee);const Pe=Ee.render();if(re.hidden&&(Pe.style.visibility="hidden"),Array.isArray(Pe))for(const le of Pe)de(this,Ze,Gt).call(this,le,re.id);else de(this,Ze,Gt).call(this,Pe,re.id)}de(this,We,Wt).call(this),await this.l10n.translate(R)}update({viewport:Z}){const j=this.div;this.viewport=Z,(0,s.setLayerDimensions)(j,{rotation:Z.rotation}),de(this,We,Wt).call(this),j.hidden=!1}getEditableAnnotations(){return Array.from(P(this,Ve).values())}getEditableAnnotation(Z){return P(this,Ve).get(Z)}}Fe=new WeakMap,je=new WeakMap,Ve=new WeakMap,Ze=new WeakSet,Gt=function(Z,j){var B;const R=Z.firstChild||Z;R.id=`${s.AnnotationPrefix}${j}`,this.div.append(Z),(B=P(this,Fe))==null||B.moveElementInDOM(this.div,Z,R,!1)},We=new WeakSet,Wt=function(){if(!P(this,je))return;const Z=this.div;for(const[j,R]of P(this,je)){const B=Z.querySelector(`[data-annotation-id="${j}"]`);if(!B)continue;const{firstChild:G}=B;G?G.nodeName==="CANVAS"?G.replaceWith(R):G.before(R):B.append(R)}P(this,je).clear()},e.AnnotationLayer=Oe},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([a,o,l,d]){return["G",1-Math.min(1,.3*a+.59*l+.11*o+d)]}static G_CMYK([a]){return["CMYK",0,0,0,1-a]}static G_RGB([a]){return["RGB",a,a,a]}static G_HTML([a]){const o=t(a);return`#${o}${o}${o}`}static RGB_G([a,o,l]){return["G",.3*a+.59*o+.11*l]}static RGB_HTML([a,o,l]){const d=t(a),c=t(o),u=t(l);return`#${d}${c}${u}`}static T_HTML(){return"#00000000"}static CMYK_RGB([a,o,l,d]){return["RGB",1-Math.min(1,a+d),1-Math.min(1,l+d),1-Math.min(1,o+d)]}static CMYK_HTML(a){const o=this.CMYK_RGB(a).slice(1);return this.RGB_HTML(o)}static RGB_CMYK([a,o,l]){const d=1-a,c=1-o,u=1-l,h=Math.min(d,c,u);return["CMYK",d,c,u,h]}}e.ColorConverters=n},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var n=t(19);class s{static setupStorage(o,l,d,c,u){const h=c.getValue(l,{value:null});switch(d.name){case"textarea":if(h.value!==null&&(o.textContent=h.value),u==="print")break;o.addEventListener("input",b=>{c.setValue(l,{value:b.target.value})});break;case"input":if(d.attributes.type==="radio"||d.attributes.type==="checkbox"){if(h.value===d.attributes.xfaOn?o.setAttribute("checked",!0):h.value===d.attributes.xfaOff&&o.removeAttribute("checked"),u==="print")break;o.addEventListener("change",b=>{c.setValue(l,{value:b.target.checked?b.target.getAttribute("xfaOn"):b.target.getAttribute("xfaOff")})})}else{if(h.value!==null&&o.setAttribute("value",h.value),u==="print")break;o.addEventListener("input",b=>{c.setValue(l,{value:b.target.value})})}break;case"select":if(h.value!==null)for(const b of d.children)b.attributes.value===h.value&&(b.attributes.selected=!0);o.addEventListener("input",b=>{const A=b.target.options,w=A.selectedIndex===-1?"":A[A.selectedIndex].value;c.setValue(l,{value:w})});break}}static setAttributes({html:o,element:l,storage:d=null,intent:c,linkService:u}){const{attributes:h}=l,b=o instanceof HTMLAnchorElement;h.type==="radio"&&(h.name=`${h.name}-${c}`);for(const[A,w]of Object.entries(h))if(w!=null)switch(A){case"class":w.length&&o.setAttribute(A,w.join(" "));break;case"dataId":break;case"id":o.setAttribute("data-element-id",w);break;case"style":Object.assign(o.style,w);break;case"textContent":o.textContent=w;break;default:(!b||A!=="href"&&A!=="newWindow")&&o.setAttribute(A,w)}b&&u.addLinkAttributes(o,h.href,h.newWindow),d&&h.dataId&&this.setupStorage(o,h.dataId,l,d)}static render(o){var g;const l=o.annotationStorage,d=o.linkService,c=o.xfaHtml,u=o.intent||"display",h=document.createElement(c.name);c.attributes&&this.setAttributes({html:h,element:c,intent:u,linkService:d});const b=[[c,-1,h]],A=o.div;if(A.append(h),o.viewport){const v=`matrix(${o.viewport.transform.join(",")})`;A.style.transform=v}u!=="richText"&&A.setAttribute("class","xfaLayer xfaFont");const w=[];for(;b.length>0;){const[v,T,C]=b.at(-1);if(T+1===v.children.length){b.pop();continue}const x=v.children[++b.at(-1)[1]];if(x===null)continue;const{name:S}=x;if(S==="#text"){const m=document.createTextNode(x.value);w.push(m),C.append(m);continue}let D;if((g=x==null?void 0:x.attributes)!=null&&g.xmlns?D=document.createElementNS(x.attributes.xmlns,S):D=document.createElement(S),C.append(D),x.attributes&&this.setAttributes({html:D,element:x,storage:l,intent:u,linkService:d}),x.children&&x.children.length>0)b.push([x,-1,D]);else if(x.value){const m=document.createTextNode(x.value);n.XfaText.shouldBuildText(S)&&w.push(m),D.append(m)}}for(const v of A.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))v.setAttribute("readOnly",!0);return{textDivs:w}}static update(o){const l=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=l,o.div.hidden=!1}}e.XfaLayer=s},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullL10n=void 0,e.getL10nFallback=n;const t={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};t.print_progress_percent="{{progress}}%";function n(o,l){switch(o){case"find_match_count":o=`find_match_count[${l.total===1?"one":"other"}]`;break;case"find_match_count_limit":o=`find_match_count_limit[${l.limit===1?"one":"other"}]`;break}return t[o]||""}function s(o,l){return l?o.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(d,c)=>c in l?l[c]:"{{"+c+"}}"):o}const a={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(o,l=null,d=n(o,l)){return s(d,l)},async translate(o){}};e.NullL10n=a},(r,e,t)=>{var c,u,h,b,A,w,g,v,T,C,x,S,D,m,_,f,y,An,k,wn,X,En,q,Sn,oe,Yt,W,Tn,he,Xt,Oe,Pn,F,Cn,$,xn,E,On,M,kn,Y,rt,ue,Jt,we,St,Ce,Tt,Te,lt,ae,Qt,ve,Pt,xe,In,Ue,en,De,Rn,H,Fn,ge,tn,je,Ct,Ze,ct,We,nn;Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0;var n=t(1),s=t(4),a=t(29),o=t(5);const l=16,Le=class Le extends s.AnnotationEditor{constructor(R){super({...R,name:"inkEditor"});se(this,y);se(this,k);se(this,X);se(this,q);se(this,oe);se(this,W);se(this,he);se(this,Oe);se(this,F);se(this,$);se(this,E);se(this,M);se(this,Y);se(this,ue);se(this,we);se(this,Ce);se(this,Te);se(this,ae);se(this,ve);se(this,H);se(this,ge);se(this,je);se(this,Ze);se(this,We);se(this,c,0);se(this,u,0);se(this,h,0);se(this,b,this.canvasContextMenu.bind(this));se(this,A,this.canvasPointermove.bind(this));se(this,w,this.canvasPointerleave.bind(this));se(this,g,this.canvasPointerup.bind(this));se(this,v,this.canvasPointerdown.bind(this));se(this,T,new Path2D);se(this,C,!1);se(this,x,!1);se(this,S,!1);se(this,D,null);se(this,m,0);se(this,_,0);se(this,f,null);this.color=R.color||null,this.thickness=R.thickness||null,this.opacity=R.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(R){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(B=>[B,R.get(B)]))}static updateDefaultParams(R,B){switch(R){case n.AnnotationEditorParamsType.INK_THICKNESS:Le._defaultThickness=B;break;case n.AnnotationEditorParamsType.INK_COLOR:Le._defaultColor=B;break;case n.AnnotationEditorParamsType.INK_OPACITY:Le._defaultOpacity=B/100;break}}updateParams(R,B){switch(R){case n.AnnotationEditorParamsType.INK_THICKNESS:de(this,y,An).call(this,B);break;case n.AnnotationEditorParamsType.INK_COLOR:de(this,k,wn).call(this,B);break;case n.AnnotationEditorParamsType.INK_OPACITY:de(this,X,En).call(this,B);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,Le._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,Le._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(Le._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Le._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||Le._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Le._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(de(this,we,St).call(this),de(this,Ce,Tt).call(this)),this.isAttachedToDOM||(this.parent.add(this),de(this,Te,lt).call(this)),de(this,Ze,ct).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,P(this,D).disconnect(),be(this,D,null),super.remove())}setParent(R){!this.parent&&R?this._uiManager.removeShouldRescale(this):this.parent&&R===null&&this._uiManager.addShouldRescale(this),super.setParent(R)}onScaleChanging(){const[R,B]=this.parentDimensions,G=this.width*R,re=this.height*B;this.setDimensions(G,re)}enableEditMode(){P(this,C)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",P(this,v)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",P(this,v)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){P(this,C)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),be(this,C,!0),this.div.classList.add("disabled"),de(this,Ze,ct).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(R){super.focusin(R),this.enableEditMode()}canvasPointerdown(R){R.button!==0||!this.isInEditMode()||P(this,C)||(this.setInForeground(),R.preventDefault(),R.type!=="mouse"&&this.div.focus(),de(this,W,Tn).call(this,R.offsetX,R.offsetY))}canvasContextMenu(R){R.preventDefault()}canvasPointermove(R){R.preventDefault(),de(this,he,Xt).call(this,R.offsetX,R.offsetY)}canvasPointerup(R){R.preventDefault(),de(this,ue,Jt).call(this,R)}canvasPointerleave(R){de(this,ue,Jt).call(this,R)}render(){if(this.div)return this.div;let R,B;this.width&&(R=this.x,B=this.y),super.render(),Le._l10nPromise.get("editor_ink2_aria_label").then(Pe=>{var le;return(le=this.div)==null?void 0:le.setAttribute("aria-label",Pe)});const[G,re,ce,Ee]=de(this,q,Sn).call(this);if(this.setAt(G,re,0,0),this.setDims(ce,Ee),de(this,we,St).call(this),this.width){const[Pe,le]=this.parentDimensions;this.setAt(R*Pe,B*le,this.width*Pe,this.height*le),be(this,S,!0),de(this,Te,lt).call(this),this.setDims(this.width*Pe,this.height*le),de(this,Y,rt).call(this),de(this,We,nn).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return de(this,Ce,Tt).call(this),this.div}setDimensions(R,B){const G=Math.round(R),re=Math.round(B);if(P(this,m)===G&&P(this,_)===re)return;be(this,m,G),be(this,_,re),this.canvas.style.visibility="hidden",P(this,c)&&Math.abs(P(this,c)-R/B)>.01&&(B=Math.ceil(R/P(this,c)),this.setDims(R,B));const[ce,Ee]=this.parentDimensions;this.width=R/ce,this.height=B/Ee,P(this,C)&&de(this,ae,Qt).call(this,R,B),de(this,Te,lt).call(this),de(this,Y,rt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(R,B,G){var He,Ge,Ke;if(R instanceof a.InkAnnotationElement)return null;const re=super.deserialize(R,B,G);re.thickness=R.thickness,re.color=n.Util.makeHexColor(...R.color),re.opacity=R.opacity;const[ce,Ee]=re.pageDimensions,Pe=re.width*ce,le=re.height*Ee,ke=re.parentScale,Se=R.thickness/2;be(re,c,Pe/le),be(re,C,!0),be(re,m,Math.round(Pe)),be(re,_,Math.round(le));const{paths:Ie,rect:$e,rotation:Be}=R;for(let{bezier:Ye}of Ie){Ye=de(He=Le,De,Rn).call(He,Ye,$e,Be);const Je=[];re.paths.push(Je);let tt=ke*(Ye[0]-Se),ut=ke*(Ye[1]-Se);for(let nt=2,xt=Ye.length;nt<xt;nt+=6){const Ot=ke*(Ye[nt]-Se),_t=ke*(Ye[nt+1]-Se),yt=ke*(Ye[nt+2]-Se),Dn=ke*(Ye[nt+3]-Se),rn=ke*(Ye[nt+4]-Se),sn=ke*(Ye[nt+5]-Se);Je.push([[tt,ut],[Ot,_t],[yt,Dn],[rn,sn]]),tt=rn,ut=sn}const gt=de(this,xe,In).call(this,Je);re.bezierPath2D.push(gt)}const qe=de(Ge=re,ge,tn).call(Ge);return be(re,h,Math.max(l,qe[2]-qe[0])),be(re,u,Math.max(l,qe[3]-qe[1])),de(Ke=re,ae,Qt).call(Ke,Pe,le),re}serialize(){if(this.isEmpty())return null;const R=this.getRect(0,0),B=s.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:B,thickness:this.thickness,opacity:this.opacity,paths:de(this,H,Fn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,R),pageIndex:this.pageIndex,rect:R,rotation:this.rotation}}};c=new WeakMap,u=new WeakMap,h=new WeakMap,b=new WeakMap,A=new WeakMap,w=new WeakMap,g=new WeakMap,v=new WeakMap,T=new WeakMap,C=new WeakMap,x=new WeakMap,S=new WeakMap,D=new WeakMap,m=new WeakMap,_=new WeakMap,f=new WeakMap,y=new WeakSet,An=function(R){const B=this.thickness;this.addCommands({cmd:()=>{this.thickness=R,de(this,Ze,ct).call(this)},undo:()=>{this.thickness=B,de(this,Ze,ct).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},k=new WeakSet,wn=function(R){const B=this.color;this.addCommands({cmd:()=>{this.color=R,de(this,Y,rt).call(this)},undo:()=>{this.color=B,de(this,Y,rt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},X=new WeakSet,En=function(R){R/=100;const B=this.opacity;this.addCommands({cmd:()=>{this.opacity=R,de(this,Y,rt).call(this)},undo:()=>{this.opacity=B,de(this,Y,rt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},q=new WeakSet,Sn=function(){const{parentRotation:R,parentDimensions:[B,G]}=this;switch(R){case 90:return[0,G,G,B];case 180:return[B,G,B,G];case 270:return[B,0,G,B];default:return[0,0,B,G]}},oe=new WeakSet,Yt=function(){const{ctx:R,color:B,opacity:G,thickness:re,parentScale:ce,scaleFactor:Ee}=this;R.lineWidth=re*ce/Ee,R.lineCap="round",R.lineJoin="round",R.miterLimit=10,R.strokeStyle=`${B}${(0,o.opacityToHex)(G)}`},W=new WeakSet,Tn=function(R,B){this.canvas.addEventListener("contextmenu",P(this,b)),this.canvas.addEventListener("pointerleave",P(this,w)),this.canvas.addEventListener("pointermove",P(this,A)),this.canvas.addEventListener("pointerup",P(this,g)),this.canvas.removeEventListener("pointerdown",P(this,v)),this.isEditing=!0,P(this,S)||(be(this,S,!0),de(this,Te,lt).call(this),this.thickness||(this.thickness=Le._defaultThickness),this.color||(this.color=Le._defaultColor||s.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Le._defaultOpacity)),this.currentPath.push([R,B]),be(this,x,!1),de(this,oe,Yt).call(this),be(this,f,()=>{de(this,$,xn).call(this),P(this,f)&&window.requestAnimationFrame(P(this,f))}),window.requestAnimationFrame(P(this,f))},he=new WeakSet,Xt=function(R,B){const[G,re]=this.currentPath.at(-1);if(this.currentPath.length>1&&R===G&&B===re)return;const ce=this.currentPath;let Ee=P(this,T);if(ce.push([R,B]),be(this,x,!0),ce.length<=2){Ee.moveTo(...ce[0]),Ee.lineTo(R,B);return}ce.length===3&&(be(this,T,Ee=new Path2D),Ee.moveTo(...ce[0])),de(this,E,On).call(this,Ee,...ce.at(-3),...ce.at(-2),R,B)},Oe=new WeakSet,Pn=function(){if(this.currentPath.length===0)return;const R=this.currentPath.at(-1);P(this,T).lineTo(...R)},F=new WeakSet,Cn=function(R,B){be(this,f,null),R=Math.min(Math.max(R,0),this.canvas.width),B=Math.min(Math.max(B,0),this.canvas.height),de(this,he,Xt).call(this,R,B),de(this,Oe,Pn).call(this);let G;if(this.currentPath.length!==1)G=de(this,M,kn).call(this);else{const le=[R,B];G=[[le,le.slice(),le.slice(),le]]}const re=P(this,T),ce=this.currentPath;this.currentPath=[],be(this,T,new Path2D);const Ee=()=>{this.allRawPaths.push(ce),this.paths.push(G),this.bezierPath2D.push(re),this.rebuild()},Pe=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(de(this,we,St).call(this),de(this,Ce,Tt).call(this)),de(this,Ze,ct).call(this))};this.addCommands({cmd:Ee,undo:Pe,mustExec:!0})},$=new WeakSet,xn=function(){if(!P(this,x))return;be(this,x,!1);const R=Math.ceil(this.thickness*this.parentScale),B=this.currentPath.slice(-3),G=B.map(Ee=>Ee[0]),re=B.map(Ee=>Ee[1]);Math.min(...G)-R,Math.max(...G)+R,Math.min(...re)-R,Math.max(...re)+R;const{ctx:ce}=this;ce.save(),ce.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Ee of this.bezierPath2D)ce.stroke(Ee);ce.stroke(P(this,T)),ce.restore()},E=new WeakSet,On=function(R,B,G,re,ce,Ee,Pe){const le=(B+re)/2,ke=(G+ce)/2,Se=(re+Ee)/2,Ie=(ce+Pe)/2;R.bezierCurveTo(le+2*(re-le)/3,ke+2*(ce-ke)/3,Se+2*(re-Se)/3,Ie+2*(ce-Ie)/3,Se,Ie)},M=new WeakSet,kn=function(){const R=this.currentPath;if(R.length<=2)return[[R[0],R[0],R.at(-1),R.at(-1)]];const B=[];let G,[re,ce]=R[0];for(G=1;G<R.length-2;G++){const[$e,Be]=R[G],[qe,He]=R[G+1],Ge=($e+qe)/2,Ke=(Be+He)/2,Ye=[re+2*($e-re)/3,ce+2*(Be-ce)/3],Je=[Ge+2*($e-Ge)/3,Ke+2*(Be-Ke)/3];B.push([[re,ce],Ye,Je,[Ge,Ke]]),[re,ce]=[Ge,Ke]}const[Ee,Pe]=R[G],[le,ke]=R[G+1],Se=[re+2*(Ee-re)/3,ce+2*(Pe-ce)/3],Ie=[le+2*(Ee-le)/3,ke+2*(Pe-ke)/3];return B.push([[re,ce],Se,Ie,[le,ke]]),B},Y=new WeakSet,rt=function(){if(this.isEmpty()){de(this,ve,Pt).call(this);return}de(this,oe,Yt).call(this);const{canvas:R,ctx:B}=this;B.setTransform(1,0,0,1,0,0),B.clearRect(0,0,R.width,R.height),de(this,ve,Pt).call(this);for(const G of this.bezierPath2D)B.stroke(G)},ue=new WeakSet,Jt=function(R){this.canvas.removeEventListener("pointerleave",P(this,w)),this.canvas.removeEventListener("pointermove",P(this,A)),this.canvas.removeEventListener("pointerup",P(this,g)),this.canvas.addEventListener("pointerdown",P(this,v)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",P(this,b))},10),de(this,F,Cn).call(this,R.offsetX,R.offsetY),this.addToAnnotationStorage(),this.setInBackground()},we=new WeakSet,St=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Le._l10nPromise.get("editor_ink_canvas_aria_label").then(R=>{var B;return(B=this.canvas)==null?void 0:B.setAttribute("aria-label",R)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Ce=new WeakSet,Tt=function(){be(this,D,new ResizeObserver(R=>{const B=R[0].contentRect;B.width&&B.height&&this.setDimensions(B.width,B.height)})),P(this,D).observe(this.div)},Te=new WeakSet,lt=function(){if(!P(this,S))return;const[R,B]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*R),this.canvas.height=Math.ceil(this.height*B),de(this,ve,Pt).call(this)},ae=new WeakSet,Qt=function(R,B){const G=de(this,je,Ct).call(this),re=(R-G)/P(this,h),ce=(B-G)/P(this,u);this.scaleFactor=Math.min(re,ce)},ve=new WeakSet,Pt=function(){const R=de(this,je,Ct).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+R,this.translationY*this.scaleFactor+R)},xe=new WeakSet,In=function(R){const B=new Path2D;for(let G=0,re=R.length;G<re;G++){const[ce,Ee,Pe,le]=R[G];G===0&&B.moveTo(...ce),B.bezierCurveTo(Ee[0],Ee[1],Pe[0],Pe[1],le[0],le[1])}return B},Ue=new WeakSet,en=function(R,B,G){const[re,ce,Ee,Pe]=B;switch(G){case 0:for(let le=0,ke=R.length;le<ke;le+=2)R[le]+=re,R[le+1]=Pe-R[le+1];break;case 90:for(let le=0,ke=R.length;le<ke;le+=2){const Se=R[le];R[le]=R[le+1]+re,R[le+1]=Se+ce}break;case 180:for(let le=0,ke=R.length;le<ke;le+=2)R[le]=Ee-R[le],R[le+1]+=ce;break;case 270:for(let le=0,ke=R.length;le<ke;le+=2){const Se=R[le];R[le]=Ee-R[le+1],R[le+1]=Pe-Se}break;default:throw new Error("Invalid rotation")}return R},De=new WeakSet,Rn=function(R,B,G){const[re,ce,Ee,Pe]=B;switch(G){case 0:for(let le=0,ke=R.length;le<ke;le+=2)R[le]-=re,R[le+1]=Pe-R[le+1];break;case 90:for(let le=0,ke=R.length;le<ke;le+=2){const Se=R[le];R[le]=R[le+1]-ce,R[le+1]=Se-re}break;case 180:for(let le=0,ke=R.length;le<ke;le+=2)R[le]=Ee-R[le],R[le+1]-=ce;break;case 270:for(let le=0,ke=R.length;le<ke;le+=2){const Se=R[le];R[le]=Pe-R[le+1],R[le+1]=Ee-Se}break;default:throw new Error("Invalid rotation")}return R},H=new WeakSet,Fn=function(R,B,G,re){var ke,Se;const ce=[],Ee=this.thickness/2,Pe=R*B+Ee,le=R*G+Ee;for(const Ie of this.paths){const $e=[],Be=[];for(let qe=0,He=Ie.length;qe<He;qe++){const[Ge,Ke,Ye,Je]=Ie[qe],tt=R*Ge[0]+Pe,ut=R*Ge[1]+le,gt=R*Ke[0]+Pe,nt=R*Ke[1]+le,xt=R*Ye[0]+Pe,Ot=R*Ye[1]+le,_t=R*Je[0]+Pe,yt=R*Je[1]+le;qe===0&&($e.push(tt,ut),Be.push(tt,ut)),$e.push(gt,nt,xt,Ot,_t,yt),Be.push(gt,nt),qe===He-1&&Be.push(_t,yt)}ce.push({bezier:de(ke=Le,Ue,en).call(ke,$e,re,this.rotation),points:de(Se=Le,Ue,en).call(Se,Be,re,this.rotation)})}return ce},ge=new WeakSet,tn=function(){let R=1/0,B=-1/0,G=1/0,re=-1/0;for(const ce of this.paths)for(const[Ee,Pe,le,ke]of ce){const Se=n.Util.bezierBoundingBox(...Ee,...Pe,...le,...ke);R=Math.min(R,Se[0]),G=Math.min(G,Se[1]),B=Math.max(B,Se[2]),re=Math.max(re,Se[3])}return[R,G,B,re]},je=new WeakSet,Ct=function(){return P(this,C)?Math.ceil(this.thickness*this.parentScale):0},Ze=new WeakSet,ct=function(R=!1){if(this.isEmpty())return;if(!P(this,C)){de(this,Y,rt).call(this);return}const B=de(this,ge,tn).call(this),G=de(this,je,Ct).call(this);be(this,h,Math.max(l,B[2]-B[0])),be(this,u,Math.max(l,B[3]-B[1]));const re=Math.ceil(G+P(this,h)*this.scaleFactor),ce=Math.ceil(G+P(this,u)*this.scaleFactor),[Ee,Pe]=this.parentDimensions;this.width=re/Ee,this.height=ce/Pe,be(this,c,re/ce),de(this,We,nn).call(this);const le=this.translationX,ke=this.translationY;this.translationX=-B[0],this.translationY=-B[1],de(this,Te,lt).call(this),de(this,Y,rt).call(this),be(this,m,re),be(this,_,ce),this.setDims(re,ce);const Se=R?G/this.scaleFactor/2:0;this.translate(le-this.translationX-Se,ke-this.translationY-Se)},We=new WeakSet,nn=function(){const{style:R}=this.div;P(this,c)>=1?(R.minHeight=`${l}px`,R.minWidth=`${Math.round(P(this,c)*l)}px`):(R.minWidth=`${l}px`,R.minHeight=`${Math.round(l/P(this,c))}px`)},se(Le,xe),se(Le,Ue),se(Le,De),ze(Le,"_defaultColor",null),ze(Le,"_defaultOpacity",1),ze(Le,"_defaultThickness",1),ze(Le,"_l10nPromise"),ze(Le,"_type","ink");let d=Le;e.InkEditor=d},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var n=t(6),s=t(1),a=t(10);const o={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},l="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/1999/xlink",c=["butt","round","square"],u=["miter","round","bevel"],h=function(D,m="",_=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!_)return URL.createObjectURL(new Blob([D],{type:m}));const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let y=`data:${m};base64,`;for(let p=0,k=D.length;p<k;p+=3){const L=D[p]&255,X=D[p+1]&255,N=D[p+2]&255,q=L>>2,te=(L&3)<<4|X>>4,oe=p+1<k?(X&15)<<2|N>>6:64,Q=p+2<k?N&63:64;y+=f[q]+f[te]+f[oe]+f[Q]}return y},b=function(){const D=new Uint8Array([137,80,78,71,13,10,26,10]),m=12,_=new Int32Array(256);for(let N=0;N<256;N++){let q=N;for(let te=0;te<8;te++)q&1?q=3988292384^q>>1&2147483647:q=q>>1&2147483647;_[N]=q}function f(N,q,te){let oe=-1;for(let Q=q;Q<te;Q++){const W=(oe^N[Q])&255,pe=_[W];oe=oe>>>8^pe}return oe^-1}function y(N,q,te,oe){let Q=oe;const W=q.length;te[Q]=W>>24&255,te[Q+1]=W>>16&255,te[Q+2]=W>>8&255,te[Q+3]=W&255,Q+=4,te[Q]=N.charCodeAt(0)&255,te[Q+1]=N.charCodeAt(1)&255,te[Q+2]=N.charCodeAt(2)&255,te[Q+3]=N.charCodeAt(3)&255,Q+=4,te.set(q,Q),Q+=q.length;const pe=f(te,oe+4,Q);te[Q]=pe>>24&255,te[Q+1]=pe>>16&255,te[Q+2]=pe>>8&255,te[Q+3]=pe&255}function p(N,q,te){let oe=1,Q=0;for(let W=q;W<te;++W)oe=(oe+(N[W]&255))%65521,Q=(Q+oe)%65521;return Q<<16|oe}function k(N){if(!a.isNodeJS)return L(N);try{let q;parseInt(process.versions.node)>=8?q=N:q=Buffer.from(N);const te=require$$5.deflateSync(q,{level:9});return te instanceof Uint8Array?te:new Uint8Array(te)}catch(q){(0,s.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+q)}return L(N)}function L(N){let q=N.length;const te=65535,oe=Math.ceil(q/te),Q=new Uint8Array(2+q+oe*5+4);let W=0;Q[W++]=120,Q[W++]=156;let pe=0;for(;q>te;)Q[W++]=0,Q[W++]=255,Q[W++]=255,Q[W++]=0,Q[W++]=0,Q.set(N.subarray(pe,pe+te),W),W+=te,pe+=te,q-=te;Q[W++]=1,Q[W++]=q&255,Q[W++]=q>>8&255,Q[W++]=~q&65535&255,Q[W++]=(~q&65535)>>8&255,Q.set(N.subarray(pe),W),W+=N.length-pe;const he=p(N,0,N.length);return Q[W++]=he>>24&255,Q[W++]=he>>16&255,Q[W++]=he>>8&255,Q[W++]=he&255,Q}function X(N,q,te,oe){const Q=N.width,W=N.height;let pe,he,_e;const Oe=N.data;switch(q){case s.ImageKind.GRAYSCALE_1BPP:he=0,pe=1,_e=Q+7>>3;break;case s.ImageKind.RGB_24BPP:he=2,pe=8,_e=Q*3;break;case s.ImageKind.RGBA_32BPP:he=6,pe=8,_e=Q*4;break;default:throw new Error("invalid format")}const J=new Uint8Array((1+_e)*W);let F=0,I=0;for(let K=0;K<W;++K)J[F++]=0,J.set(Oe.subarray(I,I+_e),F),I+=_e,F+=_e;if(q===s.ImageKind.GRAYSCALE_1BPP&&oe){F=0;for(let K=0;K<W;K++){F++;for(let Y=0;Y<_e;Y++)J[F++]^=255}}const $=new Uint8Array([Q>>24&255,Q>>16&255,Q>>8&255,Q&255,W>>24&255,W>>16&255,W>>8&255,W&255,pe,he,0,0,0]),U=k(J),E=D.length+m*3+$.length+U.length,O=new Uint8Array(E);let M=0;return O.set(D,M),M+=D.length,y("IHDR",$,O,M),M+=m+$.length,y("IDATA",U,O,M),M+=m+U.length,y("IEND",new Uint8Array(0),O,M),h(O,"image/png",te)}return function(q,te,oe){const Q=q.kind===void 0?s.ImageKind.GRAYSCALE_1BPP:q.kind;return X(q,Q,te,oe)}}();class A{constructor(){this.fontSizeScale=1,this.fontWeight=o.fontWeight,this.fontSize=0,this.textMatrix=s.IDENTITY_MATRIX,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=s.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=o.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(m,_){this.x=m,this.y=_}}function w(D){let m=[];const _=[];for(const f of D){if(f.fn==="save"){m.push({fnId:92,fn:"group",items:[]}),_.push(m),m=m.at(-1).items;continue}f.fn==="restore"?m=_.pop():m.push(f)}return m}function g(D){if(Number.isInteger(D))return D.toString();const m=D.toFixed(10);let _=m.length-1;if(m[_]!=="0")return m;do _--;while(m[_]==="0");return m.substring(0,m[_]==="."?_:_+1)}function v(D){if(D[4]===0&&D[5]===0){if(D[1]===0&&D[2]===0)return D[0]===1&&D[3]===1?"":`scale(${g(D[0])} ${g(D[3])})`;if(D[0]===D[3]&&D[1]===-D[2]){const m=Math.acos(D[0])*180/Math.PI;return`rotate(${g(m)})`}}else if(D[0]===1&&D[1]===0&&D[2]===0&&D[3]===1)return`translate(${g(D[4])} ${g(D[5])})`;return`matrix(${g(D[0])} ${g(D[1])} ${g(D[2])} ${g(D[3])} ${g(D[4])} ${g(D[5])})`}let T=0,C=0,x=0;class S{constructor(m,_,f=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new A,this.transformMatrix=s.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=m,this.objs=_,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!f,this._operatorIdMapping=[];for(const y in s.OPS)this._operatorIdMapping[s.OPS[y]]=y}getObject(m,_=null){return typeof m=="string"?m.startsWith("g_")?this.commonObjs.get(m):this.objs.get(m):_}save(){this.transformStack.push(this.transformMatrix);const m=this.current;this.extraStack.push(m),this.current=m.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(m){this.save(),this.executeOpTree(m),this.restore()}loadDependencies(m){const _=m.fnArray,f=m.argsArray;for(let y=0,p=_.length;y<p;y++)if(_[y]===s.OPS.dependency)for(const k of f[y]){const L=k.startsWith("g_")?this.commonObjs:this.objs,X=new Promise(N=>{L.get(k,N)});this.current.dependencies.push(X)}return Promise.all(this.current.dependencies)}transform(m,_,f,y,p,k){const L=[m,_,f,y,p,k];this.transformMatrix=s.Util.transform(this.transformMatrix,L),this.tgrp=null}getSVG(m,_){this.viewport=_;const f=this._initialize(_);return this.loadDependencies(m).then(()=>(this.transformMatrix=s.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(m)),f))}convertOpList(m){const _=this._operatorIdMapping,f=m.argsArray,y=m.fnArray,p=[];for(let k=0,L=y.length;k<L;k++){const X=y[k];p.push({fnId:X,fn:_[X],args:f[k]})}return w(p)}executeOpTree(m){for(const _ of m){const f=_.fn,y=_.fnId,p=_.args;switch(y|0){case s.OPS.beginText:this.beginText();break;case s.OPS.dependency:break;case s.OPS.setLeading:this.setLeading(p);break;case s.OPS.setLeadingMoveText:this.setLeadingMoveText(p[0],p[1]);break;case s.OPS.setFont:this.setFont(p);break;case s.OPS.showText:this.showText(p[0]);break;case s.OPS.showSpacedText:this.showText(p[0]);break;case s.OPS.endText:this.endText();break;case s.OPS.moveText:this.moveText(p[0],p[1]);break;case s.OPS.setCharSpacing:this.setCharSpacing(p[0]);break;case s.OPS.setWordSpacing:this.setWordSpacing(p[0]);break;case s.OPS.setHScale:this.setHScale(p[0]);break;case s.OPS.setTextMatrix:this.setTextMatrix(p[0],p[1],p[2],p[3],p[4],p[5]);break;case s.OPS.setTextRise:this.setTextRise(p[0]);break;case s.OPS.setTextRenderingMode:this.setTextRenderingMode(p[0]);break;case s.OPS.setLineWidth:this.setLineWidth(p[0]);break;case s.OPS.setLineJoin:this.setLineJoin(p[0]);break;case s.OPS.setLineCap:this.setLineCap(p[0]);break;case s.OPS.setMiterLimit:this.setMiterLimit(p[0]);break;case s.OPS.setFillRGBColor:this.setFillRGBColor(p[0],p[1],p[2]);break;case s.OPS.setStrokeRGBColor:this.setStrokeRGBColor(p[0],p[1],p[2]);break;case s.OPS.setStrokeColorN:this.setStrokeColorN(p);break;case s.OPS.setFillColorN:this.setFillColorN(p);break;case s.OPS.shadingFill:this.shadingFill(p[0]);break;case s.OPS.setDash:this.setDash(p[0],p[1]);break;case s.OPS.setRenderingIntent:this.setRenderingIntent(p[0]);break;case s.OPS.setFlatness:this.setFlatness(p[0]);break;case s.OPS.setGState:this.setGState(p[0]);break;case s.OPS.fill:this.fill();break;case s.OPS.eoFill:this.eoFill();break;case s.OPS.stroke:this.stroke();break;case s.OPS.fillStroke:this.fillStroke();break;case s.OPS.eoFillStroke:this.eoFillStroke();break;case s.OPS.clip:this.clip("nonzero");break;case s.OPS.eoClip:this.clip("evenodd");break;case s.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case s.OPS.paintImageXObject:this.paintImageXObject(p[0]);break;case s.OPS.paintInlineImageXObject:this.paintInlineImageXObject(p[0]);break;case s.OPS.paintImageMaskXObject:this.paintImageMaskXObject(p[0]);break;case s.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(p[0],p[1]);break;case s.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case s.OPS.closePath:this.closePath();break;case s.OPS.closeStroke:this.closeStroke();break;case s.OPS.closeFillStroke:this.closeFillStroke();break;case s.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case s.OPS.nextLine:this.nextLine();break;case s.OPS.transform:this.transform(p[0],p[1],p[2],p[3],p[4],p[5]);break;case s.OPS.constructPath:this.constructPath(p[0],p[1]);break;case s.OPS.endPath:this.endPath();break;case 92:this.group(_.items);break;default:(0,s.warn)(`Unimplemented operator ${f}`);break}}}setWordSpacing(m){this.current.wordSpacing=m}setCharSpacing(m){this.current.charSpacing=m}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(m,_,f,y,p,k){const L=this.current;L.textMatrix=L.lineMatrix=[m,_,f,y,p,k],L.textMatrixScale=Math.hypot(m,_),L.x=L.lineX=0,L.y=L.lineY=0,L.xcoords=[],L.ycoords=[],L.tspan=this.svgFactory.createElement("svg:tspan"),L.tspan.setAttributeNS(null,"font-family",L.fontFamily),L.tspan.setAttributeNS(null,"font-size",`${g(L.fontSize)}px`),L.tspan.setAttributeNS(null,"y",g(-L.y)),L.txtElement=this.svgFactory.createElement("svg:text"),L.txtElement.append(L.tspan)}beginText(){const m=this.current;m.x=m.lineX=0,m.y=m.lineY=0,m.textMatrix=s.IDENTITY_MATRIX,m.lineMatrix=s.IDENTITY_MATRIX,m.textMatrixScale=1,m.tspan=this.svgFactory.createElement("svg:tspan"),m.txtElement=this.svgFactory.createElement("svg:text"),m.txtgrp=this.svgFactory.createElement("svg:g"),m.xcoords=[],m.ycoords=[]}moveText(m,_){const f=this.current;f.x=f.lineX+=m,f.y=f.lineY+=_,f.xcoords=[],f.ycoords=[],f.tspan=this.svgFactory.createElement("svg:tspan"),f.tspan.setAttributeNS(null,"font-family",f.fontFamily),f.tspan.setAttributeNS(null,"font-size",`${g(f.fontSize)}px`),f.tspan.setAttributeNS(null,"y",g(-f.y))}showText(m){const _=this.current,f=_.font,y=_.fontSize;if(y===0)return;const p=_.fontSizeScale,k=_.charSpacing,L=_.wordSpacing,X=_.fontDirection,N=_.textHScale*X,q=f.vertical,te=q?1:-1,oe=f.defaultVMetrics,Q=y*_.fontMatrix[0];let W=0;for(const _e of m){if(_e===null){W+=X*L;continue}else if(typeof _e=="number"){W+=te*_e*y/1e3;continue}const Oe=(_e.isSpace?L:0)+k,J=_e.fontChar;let F,I,$=_e.width;if(q){let E;const O=_e.vmetric||oe;E=_e.vmetric?O[1]:$*.5,E=-E*Q;const M=O[2]*Q;$=O?-O[0]:$,F=E/p,I=(W+M)/p}else F=W/p,I=0;(_e.isInFont||f.missingFile)&&(_.xcoords.push(_.x+F),q&&_.ycoords.push(-_.y+I),_.tspan.textContent+=J);let U;q?U=$*Q-Oe*X:U=$*Q+Oe*X,W+=U}_.tspan.setAttributeNS(null,"x",_.xcoords.map(g).join(" ")),q?_.tspan.setAttributeNS(null,"y",_.ycoords.map(g).join(" ")):_.tspan.setAttributeNS(null,"y",g(-_.y)),q?_.y-=W:_.x+=W*N,_.tspan.setAttributeNS(null,"font-family",_.fontFamily),_.tspan.setAttributeNS(null,"font-size",`${g(_.fontSize)}px`),_.fontStyle!==o.fontStyle&&_.tspan.setAttributeNS(null,"font-style",_.fontStyle),_.fontWeight!==o.fontWeight&&_.tspan.setAttributeNS(null,"font-weight",_.fontWeight);const pe=_.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;if(pe===s.TextRenderingMode.FILL||pe===s.TextRenderingMode.FILL_STROKE?(_.fillColor!==o.fillColor&&_.tspan.setAttributeNS(null,"fill",_.fillColor),_.fillAlpha<1&&_.tspan.setAttributeNS(null,"fill-opacity",_.fillAlpha)):_.textRenderingMode===s.TextRenderingMode.ADD_TO_PATH?_.tspan.setAttributeNS(null,"fill","transparent"):_.tspan.setAttributeNS(null,"fill","none"),pe===s.TextRenderingMode.STROKE||pe===s.TextRenderingMode.FILL_STROKE){const _e=1/(_.textMatrixScale||1);this._setStrokeAttributes(_.tspan,_e)}let he=_.textMatrix;_.textRise!==0&&(he=he.slice(),he[5]+=_.textRise),_.txtElement.setAttributeNS(null,"transform",`${v(he)} scale(${g(N)}, -1)`),_.txtElement.setAttributeNS(l,"xml:space","preserve"),_.txtElement.append(_.tspan),_.txtgrp.append(_.txtElement),this._ensureTransformGroup().append(_.txtElement)}setLeadingMoveText(m,_){this.setLeading(-_),this.moveText(m,_)}addFontStyle(m){if(!m.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const _=h(m.data,m.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${m.loadedName}"; src: url(${_}); }
`}setFont(m){const _=this.current,f=this.commonObjs.get(m[0]);let y=m[1];_.font=f,this.embedFonts&&!f.missingFile&&!this.embeddedFonts[f.loadedName]&&(this.addFontStyle(f),this.embeddedFonts[f.loadedName]=f),_.fontMatrix=f.fontMatrix||s.FONT_IDENTITY_MATRIX;let p="normal";f.black?p="900":f.bold&&(p="bold");const k=f.italic?"italic":"normal";y<0?(y=-y,_.fontDirection=-1):_.fontDirection=1,_.fontSize=y,_.fontFamily=f.loadedName,_.fontWeight=p,_.fontStyle=k,_.tspan=this.svgFactory.createElement("svg:tspan"),_.tspan.setAttributeNS(null,"y",g(-_.y)),_.xcoords=[],_.ycoords=[]}endText(){var _;const m=this.current;m.textRenderingMode&s.TextRenderingMode.ADD_TO_PATH_FLAG&&((_=m.txtElement)!=null&&_.hasChildNodes())&&(m.element=m.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(m){m>0&&(this.current.lineWidth=m)}setLineCap(m){this.current.lineCap=c[m]}setLineJoin(m){this.current.lineJoin=u[m]}setMiterLimit(m){this.current.miterLimit=m}setStrokeAlpha(m){this.current.strokeAlpha=m}setStrokeRGBColor(m,_,f){this.current.strokeColor=s.Util.makeHexColor(m,_,f)}setFillAlpha(m){this.current.fillAlpha=m}setFillRGBColor(m,_,f){this.current.fillColor=s.Util.makeHexColor(m,_,f),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(m){this.current.strokeColor=this._makeColorN_Pattern(m)}setFillColorN(m){this.current.fillColor=this._makeColorN_Pattern(m)}shadingFill(m){const{width:_,height:f}=this.viewport,y=s.Util.inverseTransform(this.transformMatrix),[p,k,L,X]=s.Util.getAxialAlignedBoundingBox([0,0,_,f],y),N=this.svgFactory.createElement("svg:rect");N.setAttributeNS(null,"x",p),N.setAttributeNS(null,"y",k),N.setAttributeNS(null,"width",L-p),N.setAttributeNS(null,"height",X-k),N.setAttributeNS(null,"fill",this._makeShadingPattern(m)),this.current.fillAlpha<1&&N.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(N)}_makeColorN_Pattern(m){return m[0]==="TilingPattern"?this._makeTilingPattern(m):this._makeShadingPattern(m)}_makeTilingPattern(m){const _=m[1],f=m[2],y=m[3]||s.IDENTITY_MATRIX,[p,k,L,X]=m[4],N=m[5],q=m[6],te=m[7],oe=`shading${x++}`,[Q,W,pe,he]=s.Util.normalizeRect([...s.Util.applyTransform([p,k],y),...s.Util.applyTransform([L,X],y)]),[_e,Oe]=s.Util.singularValueDecompose2dScale(y),J=N*_e,F=q*Oe,I=this.svgFactory.createElement("svg:pattern");I.setAttributeNS(null,"id",oe),I.setAttributeNS(null,"patternUnits","userSpaceOnUse"),I.setAttributeNS(null,"width",J),I.setAttributeNS(null,"height",F),I.setAttributeNS(null,"x",`${Q}`),I.setAttributeNS(null,"y",`${W}`);const $=this.svg,U=this.transformMatrix,E=this.current.fillColor,O=this.current.strokeColor,M=this.svgFactory.create(pe-Q,he-W);if(this.svg=M,this.transformMatrix=y,te===2){const K=s.Util.makeHexColor(..._);this.current.fillColor=K,this.current.strokeColor=K}return this.executeOpTree(this.convertOpList(f)),this.svg=$,this.transformMatrix=U,this.current.fillColor=E,this.current.strokeColor=O,I.append(M.childNodes[0]),this.defs.append(I),`url(#${oe})`}_makeShadingPattern(m){switch(typeof m=="string"&&(m=this.objs.get(m)),m[0]){case"RadialAxial":const _=`shading${x++}`,f=m[3];let y;switch(m[1]){case"axial":const p=m[4],k=m[5];y=this.svgFactory.createElement("svg:linearGradient"),y.setAttributeNS(null,"id",_),y.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),y.setAttributeNS(null,"x1",p[0]),y.setAttributeNS(null,"y1",p[1]),y.setAttributeNS(null,"x2",k[0]),y.setAttributeNS(null,"y2",k[1]);break;case"radial":const L=m[4],X=m[5],N=m[6],q=m[7];y=this.svgFactory.createElement("svg:radialGradient"),y.setAttributeNS(null,"id",_),y.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),y.setAttributeNS(null,"cx",X[0]),y.setAttributeNS(null,"cy",X[1]),y.setAttributeNS(null,"r",q),y.setAttributeNS(null,"fx",L[0]),y.setAttributeNS(null,"fy",L[1]),y.setAttributeNS(null,"fr",N);break;default:throw new Error(`Unknown RadialAxial type: ${m[1]}`)}for(const p of f){const k=this.svgFactory.createElement("svg:stop");k.setAttributeNS(null,"offset",p[0]),k.setAttributeNS(null,"stop-color",p[1]),y.append(k)}return this.defs.append(y),`url(#${_})`;case"Mesh":return(0,s.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${m[0]}`)}}setDash(m,_){this.current.dashArray=m,this.current.dashPhase=_}constructPath(m,_){const f=this.current;let y=f.x,p=f.y,k=[],L=0;for(const X of m)switch(X|0){case s.OPS.rectangle:y=_[L++],p=_[L++];const N=_[L++],q=_[L++],te=y+N,oe=p+q;k.push("M",g(y),g(p),"L",g(te),g(p),"L",g(te),g(oe),"L",g(y),g(oe),"Z");break;case s.OPS.moveTo:y=_[L++],p=_[L++],k.push("M",g(y),g(p));break;case s.OPS.lineTo:y=_[L++],p=_[L++],k.push("L",g(y),g(p));break;case s.OPS.curveTo:y=_[L+4],p=_[L+5],k.push("C",g(_[L]),g(_[L+1]),g(_[L+2]),g(_[L+3]),g(y),g(p)),L+=6;break;case s.OPS.curveTo2:k.push("C",g(y),g(p),g(_[L]),g(_[L+1]),g(_[L+2]),g(_[L+3])),y=_[L+2],p=_[L+3],L+=4;break;case s.OPS.curveTo3:y=_[L+2],p=_[L+3],k.push("C",g(_[L]),g(_[L+1]),g(y),g(p),g(y),g(p)),L+=4;break;case s.OPS.closePath:k.push("Z");break}k=k.join(" "),f.path&&m.length>0&&m[0]!==s.OPS.rectangle&&m[0]!==s.OPS.moveTo?k=f.path.getAttributeNS(null,"d")+k:(f.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(f.path)),f.path.setAttributeNS(null,"d",k),f.path.setAttributeNS(null,"fill","none"),f.element=f.path,f.setCurrentPoint(y,p)}endPath(){const m=this.current;if(m.path=null,!this.pendingClip)return;if(!m.element){this.pendingClip=null;return}const _=`clippath${T++}`,f=this.svgFactory.createElement("svg:clipPath");f.setAttributeNS(null,"id",_),f.setAttributeNS(null,"transform",v(this.transformMatrix));const y=m.element.cloneNode(!0);if(this.pendingClip==="evenodd"?y.setAttributeNS(null,"clip-rule","evenodd"):y.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,f.append(y),this.defs.append(f),m.activeClipUrl){m.clipGroup=null;for(const p of this.extraStack)p.clipGroup=null;f.setAttributeNS(null,"clip-path",m.activeClipUrl)}m.activeClipUrl=`url(#${_})`,this.tgrp=null}clip(m){this.pendingClip=m}closePath(){const m=this.current;if(m.path){const _=`${m.path.getAttributeNS(null,"d")}Z`;m.path.setAttributeNS(null,"d",_)}}setLeading(m){this.current.leading=-m}setTextRise(m){this.current.textRise=m}setTextRenderingMode(m){this.current.textRenderingMode=m}setHScale(m){this.current.textHScale=m/100}setRenderingIntent(m){}setFlatness(m){}setGState(m){for(const[_,f]of m)switch(_){case"LW":this.setLineWidth(f);break;case"LC":this.setLineCap(f);break;case"LJ":this.setLineJoin(f);break;case"ML":this.setMiterLimit(f);break;case"D":this.setDash(f[0],f[1]);break;case"RI":this.setRenderingIntent(f);break;case"FL":this.setFlatness(f);break;case"Font":this.setFont(f);break;case"CA":this.setStrokeAlpha(f);break;case"ca":this.setFillAlpha(f);break;default:(0,s.warn)(`Unimplemented graphic state operator ${_}`);break}}fill(){const m=this.current;m.element&&(m.element.setAttributeNS(null,"fill",m.fillColor),m.element.setAttributeNS(null,"fill-opacity",m.fillAlpha),this.endPath())}stroke(){const m=this.current;m.element&&(this._setStrokeAttributes(m.element),m.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(m,_=1){const f=this.current;let y=f.dashArray;_!==1&&y.length>0&&(y=y.map(function(p){return _*p})),m.setAttributeNS(null,"stroke",f.strokeColor),m.setAttributeNS(null,"stroke-opacity",f.strokeAlpha),m.setAttributeNS(null,"stroke-miterlimit",g(f.miterLimit)),m.setAttributeNS(null,"stroke-linecap",f.lineCap),m.setAttributeNS(null,"stroke-linejoin",f.lineJoin),m.setAttributeNS(null,"stroke-width",g(_*f.lineWidth)+"px"),m.setAttributeNS(null,"stroke-dasharray",y.map(g).join(" ")),m.setAttributeNS(null,"stroke-dashoffset",g(_*f.dashPhase)+"px")}eoFill(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const m=this.svgFactory.createElement("svg:rect");m.setAttributeNS(null,"x","0"),m.setAttributeNS(null,"y","0"),m.setAttributeNS(null,"width","1px"),m.setAttributeNS(null,"height","1px"),m.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(m)}paintImageXObject(m){const _=this.getObject(m);if(!_){(0,s.warn)(`Dependent image with object ID ${m} is not ready yet`);return}this.paintInlineImageXObject(_)}paintInlineImageXObject(m,_){const f=m.width,y=m.height,p=b(m,this.forceDataSchema,!!_),k=this.svgFactory.createElement("svg:rect");k.setAttributeNS(null,"x","0"),k.setAttributeNS(null,"y","0"),k.setAttributeNS(null,"width",g(f)),k.setAttributeNS(null,"height",g(y)),this.current.element=k,this.clip("nonzero");const L=this.svgFactory.createElement("svg:image");L.setAttributeNS(d,"xlink:href",p),L.setAttributeNS(null,"x","0"),L.setAttributeNS(null,"y",g(-y)),L.setAttributeNS(null,"width",g(f)+"px"),L.setAttributeNS(null,"height",g(y)+"px"),L.setAttributeNS(null,"transform",`scale(${g(1/f)} ${g(-1/y)})`),_?_.append(L):this._ensureTransformGroup().append(L)}paintImageMaskXObject(m){const _=this.getObject(m.data,m);if(_.bitmap){(0,s.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const f=this.current,y=_.width,p=_.height,k=f.fillColor;f.maskId=`mask${C++}`;const L=this.svgFactory.createElement("svg:mask");L.setAttributeNS(null,"id",f.maskId);const X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x","0"),X.setAttributeNS(null,"y","0"),X.setAttributeNS(null,"width",g(y)),X.setAttributeNS(null,"height",g(p)),X.setAttributeNS(null,"fill",k),X.setAttributeNS(null,"mask",`url(#${f.maskId})`),this.defs.append(L),this._ensureTransformGroup().append(X),this.paintInlineImageXObject(_,L)}paintFormXObjectBegin(m,_){if(Array.isArray(m)&&m.length===6&&this.transform(m[0],m[1],m[2],m[3],m[4],m[5]),_){const f=_[2]-_[0],y=_[3]-_[1],p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",_[0]),p.setAttributeNS(null,"y",_[1]),p.setAttributeNS(null,"width",g(f)),p.setAttributeNS(null,"height",g(y)),this.current.element=p,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(m){const _=this.svgFactory.create(m.width,m.height),f=this.svgFactory.createElement("svg:defs");_.append(f),this.defs=f;const y=this.svgFactory.createElement("svg:g");return y.setAttributeNS(null,"transform",v(m.transform)),_.append(y),this.svg=y,_}_ensureClipGroup(){if(!this.current.clipGroup){const m=this.svgFactory.createElement("svg:g");m.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(m),this.current.clipGroup=m}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",v(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}e.SVGGraphics=S}],__webpack_module_cache__={};function __w_pdfjs_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var r=__webpack_exports__;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(r,"AnnotationEditorLayer",{enumerable:!0,get:function(){return a.AnnotationEditorLayer}}),Object.defineProperty(r,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(r,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(r,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(r,"AnnotationLayer",{enumerable:!0,get:function(){return l.AnnotationLayer}}),Object.defineProperty(r,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(r,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(r,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(r,"GlobalWorkerOptions",{enumerable:!0,get:function(){return d.GlobalWorkerOptions}}),Object.defineProperty(r,"ImageKind",{enumerable:!0,get:function(){return e.ImageKind}}),Object.defineProperty(r,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(r,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(r,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(r,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(r,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(r,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(r,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(r,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(r,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(r,"PromiseCapability",{enumerable:!0,get:function(){return e.PromiseCapability}}),Object.defineProperty(r,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),r.SVGGraphics=void 0,Object.defineProperty(r,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(r,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(r,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(r,"XfaLayer",{enumerable:!0,get:function(){return c.XfaLayer}}),Object.defineProperty(r,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(r,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(r,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(r,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(r,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(r,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(r,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(r,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(r,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(r,"normalizeUnicode",{enumerable:!0,get:function(){return e.normalizeUnicode}}),Object.defineProperty(r,"renderTextLayer",{enumerable:!0,get:function(){return s.renderTextLayer}}),Object.defineProperty(r,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(r,"updateTextLayer",{enumerable:!0,get:function(){return s.updateTextLayer}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(2),n=__w_pdfjs_require__(6),s=__w_pdfjs_require__(26),a=__w_pdfjs_require__(27),o=__w_pdfjs_require__(5),l=__w_pdfjs_require__(29),d=__w_pdfjs_require__(14),c=__w_pdfjs_require__(31);const u=__w_pdfjs_require__(34).SVGGraphics;r.SVGGraphics=u})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let r=0;r<256;++r)byteToHex.push((r+256).toString(16).slice(1));function unsafeStringify(r,e=0){return(byteToHex[r[e+0]]+byteToHex[r[e+1]]+byteToHex[r[e+2]]+byteToHex[r[e+3]]+"-"+byteToHex[r[e+4]]+byteToHex[r[e+5]]+"-"+byteToHex[r[e+6]]+byteToHex[r[e+7]]+"-"+byteToHex[r[e+8]]+byteToHex[r[e+9]]+"-"+byteToHex[r[e+10]]+byteToHex[r[e+11]]+byteToHex[r[e+12]]+byteToHex[r[e+13]]+byteToHex[r[e+14]]+byteToHex[r[e+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(r,e,t){if(native.randomUUID&&!e&&!r)return native.randomUUID();r=r||{};const n=r.random||(r.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return unsafeStringify(n)}async function process_file(r,e,t,n,s,a,o){const l=e.name,d=e.size,c=new Date;let u;pdfExports.GlobalWorkerOptions.workerSrc="/Users/tommasogiovannini/VSCode Projects/james/node_modules/pdfjs-dist/build/pdf.worker.js";const h=s,b=a,A=new RecursiveCharacterTextSplitter({chunkSize:h,chunkOverlap:b}),w=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);let v=(await w.auth.getUser()).data.user.id;console.log("userID",v);let T;if(console.log("isUrl",o),o===!0){console.log("isUrl",o);const D=new FileReader;D.onload=async function(m){const _=m.target.result,f={pageContent:_.toString(),metadata:{file_sha1:u,file_size:d,file_name:l,chunk_size:s,chunk_overlap:a,date:c}};T=await A.splitDocuments([f]),console.log("splittedDocuments",T[0].user_id),u=await computeSHA1FromContent(_);const y=[];for(const X of T){const N={pageContent:X.pageContent,metadata:{file_sha1:u,file_size:d,file_name:l,chunk_size:s,chunk_overlap:a,date:c}};y.push(N)}const p=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),k=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",v),new SupabaseVectorStore(k,{client:p,queryName:"insert",tableName:"documents"}).addDocuments(y)},await D.readAsText(e)}else if(n===".pdf"){console.log("isPdf");const D=new File([e],l,{type:e.type});u=await computeSHA1FromFile(D);const m=await fetchFileAsArrayBuffer(D),_=await pdfExports.getDocument({data:m}).promise,f=await extractTextFromPDF(_);console.log("pdfText",f);const y={pageContent:f,metadata:{file_sha1:u,file_size:d,file_name:l,chunk_size:s,chunk_overlap:a,date:c}};T=await A.splitDocuments([y]),console.log("splittedDocuments",T);const p=[];for(const N of T){const q={pageContent:N.pageContent,metadata:{file_sha1:u,file_size:d,file_name:l,chunk_size:s,chunk_overlap:a,date:c}};p.push(q)}const k=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),L=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",v);let X=new SupabaseVectorStore(L,{client:k,queryName:"insert",tableName:"documents"});console.log("docs Metadata",p[0].user_id),X.addDocuments(p)}else{const D=new File([e],l,{type:e.type});u=await computeSHA1FromFile(D);const _=await new t(D).load();T=await A.splitDocuments(_)}const C=[];for(const D of T){const m={pageContent:D.pageContent,metadata:{file_sha1:u,file_size:d,file_name:l,chunk_size:s,chunk_overlap:a,date:c}};C.push(m)}const x=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",v);let S=new SupabaseVectorStore(x,{client:w,tableName:"documents",queryName:"insert"});console.log("docsWithMetadata",C);try{S.addDocuments(C)}catch(D){console.log("error",D)}}async function extractTextFromPDF(r){let e="";for(let t=1;t<=r.numPages;t++){const a=(await(await r.getPage(t)).getTextContent()).items.map(o=>o.str).join(" ");e+=a+" "}return e}async function fetchFileAsArrayBuffer(r){return await(await fetch(URL.createObjectURL(r))).arrayBuffer()}class BaseDocumentLoader{async loadAndSplit(e=new RecursiveCharacterTextSplitter){const t=await this.load();return e.splitDocuments(t)}}class TextLoader extends BaseDocumentLoader{constructor(e){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:e})}async parse(e){return[e]}async load(){let e,t;if(typeof this.filePathOrBlob=="string"){const{readFile:s}=await TextLoader.imports();e=await s(this.filePathOrBlob,"utf8"),t={source:this.filePathOrBlob}}else e=await this.filePathOrBlob.text(),t={source:"blob",blobType:this.filePathOrBlob.type};const n=await this.parse(e);return n.forEach((s,a)=>{if(typeof s!="string")throw new Error(`Expected string, at position ${a} got ${typeof s}`)}),n.map((s,a)=>new Document({pageContent:s,metadata:n.length===1?t:{...t,line:a+1}}))}static async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]);return{readFile:e}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv$1()}'. See https://<link to docs> for alternatives.`)}}}function processTxt(r,e){return process_file(r,e,TextLoader,".txt",500,0)}class BufferLoader extends BaseDocumentLoader{constructor(e){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:e})}async load(){let e,t;if(typeof this.filePathOrBlob=="string"){const{readFile:n}=await BufferLoader.imports();e=await n(this.filePathOrBlob),t={source:this.filePathOrBlob}}else e=await this.filePathOrBlob.arrayBuffer().then(n=>Buffer.from(n)),t={source:"blob",blobType:this.filePathOrBlob.type};return this.parse(e,t)}static async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]);return{readFile:e}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv$1()}'. See https://<link to docs> for alternatives.`)}}}class PDFLoader extends BufferLoader{constructor(e,{splitPages:t=!0,pdfjs:n=PDFLoaderImports}={}){super(e),Object.defineProperty(this,"splitPages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pdfjs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.splitPages=t,this.pdfjs=n}async parse(e,t){const{getDocument:n,version:s}=await this.pdfjs(),a=await n({data:new Uint8Array(e.buffer),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,o=await a.getMetadata().catch(()=>null),l=[];for(let d=1;d<=a.numPages;d+=1){const u=await(await a.getPage(d)).getTextContent();if(u.items.length===0)continue;const h=u.items.map(b=>b.str).join(`
`);l.push(new Document({pageContent:h,metadata:{...t,pdf:{version:s,info:o==null?void 0:o.info,metadata:o==null?void 0:o.metadata,totalPages:a.numPages},loc:{pageNumber:d}}}))}return this.splitPages?l:l.length===0?[]:[new Document({pageContent:l.map(d=>d.pageContent).join(`

`),metadata:{...t,pdf:{version:s,info:o==null?void 0:o.info,metadata:o==null?void 0:o.metadata,totalPages:a.numPages}}})]}}async function PDFLoaderImports(){try{const{default:r}=await __vitePreload(()=>import("./pdf.0b80fffa.js").then(n=>n.p),["_app/immutable/chunks/pdf.0b80fffa.js","_app/immutable/chunks/public.816bc6b5.js"]),{getDocument:e,version:t}=r;return{getDocument:e,version:t}}catch(r){throw console.error(r),new Error("Failed to load pdf-parse. Please install it with eg. `npm install pdf-parse`.")}}function process_pdf(r,e){return process_file(r,e,PDFLoader,".pdf",500,0)}class UnstructuredLoader extends BaseDocumentLoader{constructor(e,t={}){super(),Object.defineProperty(this,"filePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:"https://api.unstructured.io/general/v0/general"}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strategy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof t=="string"?(this.filePath=t,this.apiUrl=e):(this.filePath=e,this.apiKey=t.apiKey,this.apiUrl=t.apiUrl??this.apiUrl,this.strategy=t.strategy??"hi_res")}async _partition(){const{readFile:e,basename:t}=await this.imports(),n=await e(this.filePath),s=t(this.filePath),a=new FormData;a.append("files",new Blob([n]),s),a.append("strategy",this.strategy);const o={"UNSTRUCTURED-API-KEY":this.apiKey??""},l=await fetch(this.apiUrl,{method:"POST",body:a,headers:o});if(!l.ok)throw new Error(`Failed to partition file ${this.filePath} with error ${l.status} and message ${await l.text()}`);const d=await l.json();if(!Array.isArray(d))throw new Error(`Expected partitioning request to return an array, but got ${d}`);return d.filter(c=>typeof c.text=="string")}async load(){const e=await this._partition(),t=[];for(const n of e){const{metadata:s,text:a}=n;t.push(new Document({pageContent:a,metadata:{...s,category:n.type}}))}return t}async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]),{basename:t}=await __vitePreload(()=>import("./__vite-browser-external_node_path.042c5bd1.js"),[]);return{readFile:e,basename:t}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv$1()}'. See https://<link to docs> for alternatives.`)}}}const fs=new Proxy({},{get(r,e){throw new Error(`Module "fs" has been externalized for browser compatibility. Cannot access "fs.${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal_fs=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"}));async function processHtml(r,e){return process_file(r,e,UnstructuredLoader,".html")}async function getHtml(r){try{const t=`/api?${new URLSearchParams({url:r}).toString()}`,n=await fetch(t,{method:"GET"});return n.status===200?await n.text():null}catch{return null}}class CustomFile extends Blob{constructor(e,t){super(e,t),this.name=t.name,this.lastModifiedDate=new Date}}function createHtmlFile(r,e){const t=slugify(r)+".html";return new CustomFile([e],{type:"text/html",name:t})}function slugify(r){return r=r.normalize("NFKD").replace(/[\u0300-\u036f]/g,""),r=r.replace(/[^\w\s-]/g,"").trim().toLowerCase(),r=r.replace(/[-\s]+/g,"-"),r}const file_processors={".txt":processTxt,".pdf":process_pdf,".html":processHtml};async function file_uploader(r,e,t,n){Array.isArray(n)||(n=[n]),console.log(n);for(const s of n)await filter_file(s,r)}async function file_already_exists(r,e){const t=computeSHA1FromContent(e);let n=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const{data:s,error:a}=await n.from("documents").select("id").eq("metadata->>file_sha1",t);return a?(console.log(`Error retrieving data: ${a.message}`),!1):s.length>0}async function filter_file(r,e,t){if(await file_already_exists(e,r))return console.log(`😎 ${r.name} is already in the database.`),!1;if(r.size<1)return console.log(`💨 ${r.name} is empty.`),!1;{const n=`.${r.name.split(".").pop()}`;if(console.log(r.name,n),n in file_processors){let s=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const a=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});let o=new SupabaseVectorStore(a,{client:s,tableName:"documents"});return await file_processors[n](o,r),console.log(`✅ ${r.name}`),!0}else return console.log(`❌ ${r.name} is not a valid file type.`),!1}}async function url_uploader(r,e,t,n){const s=await getHtml(n);console.log(s);const a=createHtmlFile(n,s);console.log(a),await process_file(t,a,UnstructuredLoader,".html",500,0,!0)}class BaseCallbackHandlerMethodsClass{}class BaseCallbackHandler extends BaseCallbackHandlerMethodsClass{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent)}copy(){return new this.constructor(this)}toJSON(){return Serializable.prototype.toJSON.call(this)}toJSONNotImplemented(){return Serializable.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:v4()}),Object.assign(this,e)}}return new t}}var ansiStyles={exports:{}};ansiStyles.exports;(function(r){const t=(a=0)=>o=>`\x1B[${38+a};5;${o}m`,n=(a=0)=>(o,l,d)=>`\x1B[${38+a};2;${o};${l};${d}m`;function s(){const a=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[l,d]of Object.entries(o)){for(const[c,u]of Object.entries(d))o[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},d[c]=o[c],a.set(u[0],u[1]);Object.defineProperty(o,l,{value:d,enumerable:!1})}return Object.defineProperty(o,"codes",{value:a,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=t(),o.color.ansi16m=n(),o.bgColor.ansi256=t(10),o.bgColor.ansi16m=n(10),Object.defineProperties(o,{rgbToAnsi256:{value:(l,d,c)=>l===d&&d===c?l<8?16:l>248?231:Math.round((l-8)/247*24)+232:16+36*Math.round(l/255*5)+6*Math.round(d/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:l=>{const d=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(l.toString(16));if(!d)return[0,0,0];let{colorString:c}=d.groups;c.length===3&&(c=c.split("").map(h=>h+h).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:l=>o.rgbToAnsi256(...o.hexToRgb(l)),enumerable:!1}}),o}Object.defineProperty(r,"exports",{enumerable:!0,get:s})})(ansiStyles);var ansiStylesExports=ansiStyles.exports;const styles=getDefaultExportFromCjs(ansiStylesExports);class BaseTracer extends BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,s,a,o,l){var b;const d=this._getExecutionOrder(s),c=Date.now(),u=l?{...a,metadata:l}:a,h={id:n,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:c}],inputs:{prompts:t},execution_order:d,child_runs:[],child_execution_order:d,run_type:"llm",extra:u??{},tags:o||[]};this._startTrace(h),await((b=this.onLLMStart)==null?void 0:b.call(this,h))}async handleChatModelStart(e,t,n,s,a,o,l){var b;const d=this._getExecutionOrder(s),c=Date.now(),u=l?{...a,metadata:l}:a,h={id:n,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:c}],inputs:{messages:t},execution_order:d,child_runs:[],child_execution_order:d,run_type:"llm",extra:u??{},tags:o||[]};this._startTrace(h),await((b=this.onLLMStart)==null?void 0:b.call(this,h))}async handleLLMEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:n.end_time}),await((s=this.onLLMEnd)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleLLMError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:n.end_time}),await((s=this.onLLMError)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleChainStart(e,t,n,s,a,o){var u;const l=this._getExecutionOrder(s),d=Date.now(),c={id:n,name:e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:d}],inputs:t,execution_order:l,child_execution_order:l,run_type:"chain",child_runs:[],extra:o?{metadata:o}:{},tags:a||[]};this._startTrace(c),await((u=this.onChainStart)==null?void 0:u.call(this,c))}async handleChainEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")throw new Error("No chain run to end.");n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:n.end_time}),await((s=this.onChainEnd)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleChainError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")throw new Error("No chain run to end.");n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:n.end_time}),await((s=this.onChainError)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleToolStart(e,t,n,s,a,o){var u;const l=this._getExecutionOrder(s),d=Date.now(),c={id:n,name:e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:d}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:o?{metadata:o}:{},tags:a||[]};this._startTrace(c),await((u=this.onToolStart)==null?void 0:u.call(this,c))}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:n.end_time}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:n.end_time}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n)}async handleAgentAction(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:Date.now(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:Date.now(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:Date.now(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n){var a;const s=this.runMap.get(n);!s||(s==null?void 0:s.run_type)!=="llm"||(s.events.push({name:"new_token",time:Date.now(),kwargs:{token:e,idx:t}}),await((a=this.onLLMNewToken)==null?void 0:a.call(this,s)))}}function wrap(r,e){return`${r.open}${e}${r.close}`}function tryJsonStringify(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function elapsed(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color}=styles;class ConsoleCallbackHandler extends BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,o)=>{const l=`${s.execution_order}:${s.run_type}:${s.name}`;return a===o.length-1?wrap(styles.bold,l):l}).join(" > ");return wrap(color.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.green,"[chain/start]")} [${t}] Entering Chain run with input: ${tryJsonStringify(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.cyan,"[chain/end]")} [${t}] [${elapsed(e)}] Exiting Chain run with output: ${tryJsonStringify(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.red,"[chain/error]")} [${t}] [${elapsed(e)}] Chain run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${wrap(color.green,"[llm/start]")} [${t}] Entering LLM run with input: ${tryJsonStringify(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.cyan,"[llm/end]")} [${t}] [${elapsed(e)}] Exiting LLM run with output: ${tryJsonStringify(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.red,"[llm/error]")} [${t}] [${elapsed(e)}] LLM run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onToolStart(e){var n;const t=this.getBreadcrumbs(e);console.log(`${wrap(color.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(n=e.inputs.input)==null?void 0:n.trim()}"`)}onToolEnd(e){var n,s;const t=this.getBreadcrumbs(e);console.log(`${wrap(color.cyan,"[tool/end]")} [${t}] [${elapsed(e)}] Exiting Tool run with output: "${(s=(n=e.outputs)==null?void 0:n.output)==null?void 0:s.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${wrap(color.red,"[tool/error]")} [${t}] [${elapsed(e)}] Tool run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${wrap(color.blue,"[agent/action]")} [${n}] Agent selected action: ${tryJsonStringify(t.actions[t.actions.length-1],"[action]")}`)}}const STATUS_NO_RETRY=[400,401,403,404,405,406,407,408,409];class AsyncCaller{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in _default$1?_default$1.default:_default$1;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>pRetry$1(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt(n){var a;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.message.startsWith("AbortError")||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const s=(a=n==null?void 0:n.response)==null?void 0:a.status;if(s&&STATUS_NO_RETRY.includes(+s))throw n},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var o;(o=e.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}const isBrowser=()=>typeof window<"u"&&typeof window.document<"u",isWebWorker=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",isJsDom=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno=()=>typeof Deno<"u",isNode=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!isDeno(),getEnv=()=>{let r;return isBrowser()?r="browser":isNode()?r="node":isWebWorker()?r="webworker":isJsDom()?r="jsdom":isDeno()?r="deno":r="other",r};let runtimeEnvironment;async function getRuntimeEnvironment(){return runtimeEnvironment===void 0&&(runtimeEnvironment={library:"langsmith",runtime:getEnv()}),runtimeEnvironment}function getEnvironmentVariable(r){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[r]:void 0}catch{return}}const isLocalhost=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},raiseForStatus=async(r,e)=>{const t=await r.text();if(!r.ok)throw new Error(`Failed to ${e}: ${r.status} ${r.statusText} ${t}`)};class Client{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=Client.getDefaultClientConfig();this.apiUrl=e.apiUrl??t.apiUrl,this.apiKey=e.apiKey??t.apiKey,this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new AsyncCaller(e.callerOptions??{})}static getDefaultClientConfig(){return{apiUrl:getEnvironmentVariable("LANGCHAIN_ENDPOINT")??"http://localhost:1984",apiKey:getEnvironmentVariable("LANGCHAIN_API_KEY")}}validateApiKeyIfHosted(){if(!isLocalhost(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);return a.json()}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},n=e.extra??{},s=await getRuntimeEnvironment(),a=e.project_name;delete e.project_name;const o={session_name:a,...e,extra:{...e.extra,runtime:{...s,...n.runtime}}},l=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)});await raiseForStatus(l,"create run")}async updateRun(e,t){const n={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await raiseForStatus(s,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async _loadChildRuns(e){const t=await this.listRuns({id:e.child_run_ids}),n={},s={};t.sort((a,o)=>a.execution_order-o.execution_order);for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=n[e.id]||[];for(const a in n)a!==e.id&&(s[a].child_runs=n[a]);return e}async listRuns({projectId:e,projectName:t,executionOrder:n,runType:s,error:a,id:o,limit:l,offset:d}){const c=new URLSearchParams;let u=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");u=(await this.readProject({projectName:t})).id}if(u&&c.append("session",u),n&&c.append("execution_order",n.toString()),s&&c.append("run_type",s),a!==void 0&&c.append("error",a.toString()),o!==void 0)for(const h of o)c.append("id",h);return l!==void 0&&c.append("limit",l.toString()),d!==void 0&&c.append("offset",d.toString()),this._get("/runs",c)}async deleteRun(e){const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await raiseForStatus(t,"delete run")}async createProject({projectName:e,projectExtra:t,upsert:n}){const s=n?"?upsert=true":"",a=`${this.apiUrl}/sessions${s}`,o={name:e};t!==void 0&&(o.extra=t);const l=await this.caller.call(fetch,a,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)}),d=await l.json();if(!l.ok)throw new Error(`Failed to create session ${e}: ${l.status} ${l.statusText}`);return d}async readProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this._get(n,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async listProjects(){return this._get("/sessions")}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e;const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await raiseForStatus(s,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:o,name:l}){const d=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(b=>{c.append("input_keys",b)}),s.forEach(b=>{c.append("output_keys",b)}),a&&c.append("description",a),o&&c.append("data_type",o),l&&c.append("name",l);const u=await this.caller.call(fetch,d,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok){const b=await u.json();throw b.detail&&b.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}return await u.json()}async createDataset(e,{description:t,dataType:n}={}){const s={name:e,description:t};n&&(s.data_type=n);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok){const l=await a.json();throw l.detail&&l.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${a.status} ${a.statusText}`)}return await a.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async listDatasets({limit:e=100,offset:t=0}={}){const n="/datasets",s=new URLSearchParams({limit:e.toString(),offset:t.toString()}),a=await this._get(n,s);if(!Array.isArray(a))throw new Error(`Expected ${n} to return an array, but got ${a}`);return a}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to delete ${n}: ${a.status} ${a.statusText}`);await a.json()}async createExample(e,t,{datasetId:n,datasetName:s,createdAt:a}){let o=n;if(o===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:s})).id);const d={dataset_id:o,inputs:e,outputs:t,created_at:(a||new Date).toISOString()},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async listExamples({datasetId:e,datasetName:t,limit:n,offset:s}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const o=await this._get("/examples",new URLSearchParams({dataset:a,limit:(n==null?void 0:n.toString())??"100",offset:(s==null?void 0:s.toString())??"0"}));if(!Array.isArray(o))throw new Error(`Expected /examples to return an array, but got ${o}`);return o}async deleteExample(e){const t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s}={loadChildRuns:!1}){let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);let o;a.reference_example_id!==null&&a.reference_example_id!==void 0&&(o=await this.readExample(a.reference_example_id));const l=await t.evaluateRun(a,o);let d=n??{};return l.evaluatorInfo&&(d={...d,...l.evaluatorInfo}),await this.createFeedback(a.id,l.key,{score:l.score,value:l.value,comment:l.comment,correction:l.correction,sourceInfo:d,feedbackSourceType:"MODEL"})}async createFeedback(e,t,{score:n,value:s,correction:a,comment:o,sourceInfo:l,feedbackSourceType:d="API"}){let c;if(d==="API")c={type:"api",metadata:l??{}};else if(d==="MODEL")c={type:"model",metadata:l??{}};else throw new Error(`Unknown feedback source type ${d}`);const u={id:v4(),run_id:e,key:t,score:n,value:s,correction:a,comment:o,feedback_source:c},h=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!h.ok)throw new Error(`Failed to create feedback for run ${e}: ${h.status} ${h.statusText}`);return await h.json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async listFeedback({runIds:e,limit:t,offset:n}={}){const s=new URLSearchParams;return e&&s.append("run",e.join(",")),t!==void 0&&s.append("limit",t.toString()),n!==void 0&&s.append("offset",n.toString()),await this._get("/feedback",s)}}class LangChainTracer extends BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??getEnvironmentVariable$1("LANGCHAIN_PROJECT")??getEnvironmentVariable$1("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new Client({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await getRuntimeEnvironment$1()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events};await this.client.updateRun(e.id,t)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}function getBufferString(r,e="Human",t="AI"){const n=[];for(const s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s}`);const o=s.name?`${s.name}, `:"";n.push(`${a}: ${o}${s.content}`)}return n.join(`
`)}class LangChainTracerV1 extends BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:getEnvironmentVariable$1("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=getEnvironmentVariable$1("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},n=await this.persistSession(t);return this.session=n,n}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var a;const t=this.session??await this.loadDefaultSession(),n=e.serialized;let s;if(e.run_type==="llm"){const o=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(d=>getBufferString(d));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,prompts:o,response:e.outputs}}else if(e.run_type==="chain"){const o=await Promise.all(e.child_runs.map(d=>this.convertV2RunToRun(d)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:o.filter(d=>d.type==="llm"),child_chain_runs:o.filter(d=>d.type==="chain"),child_tool_runs:o.filter(d=>d.type==="tool")}}else if(e.run_type==="tool"){const o=await Promise.all(e.child_runs.map(d=>this.convertV2RunToRun(d)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(a=e.outputs)==null?void 0:a.output,action:JSON.stringify(n),child_llm_runs:o.filter(d=>d.type==="llm"),child_chain_runs:o.filter(d=>d.type==="chain"),child_tool_runs:o.filter(d=>d.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return s}async persistRun(e){let t,n;e.run_type!==void 0?n=await this.convertV2RunToRun(e):n=e,n.type==="llm"?t=`${this.endpoint}/llm-runs`:n.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const s=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(n)});s.ok||console.error(`Failed to persist run: ${s.status} ${s.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,n=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return n.ok?{id:(await n.json()).id,...e}:(console.error(`Failed to persist session: ${n.status} ${n.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let n;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),n={id:1,start_time:Date.now()},this.session=n,n;const s=await t.json();return s.length===0?(n={id:1,start_time:Date.now()},this.session=n,n):([n]=s,this.session=n,n)}}async function getTracingCallbackHandler(r){const e=new LangChainTracerV1;return r?await e.loadSession(r):await e.loadDefaultSession(),e}async function getTracingV2CallbackHandler(){return new LangChainTracer}let queue;function createQueue(){const r="default"in _default$1?_default$1.default:_default$1;return new r({autoStart:!0,concurrency:1})}async function consumeCallback(r,e){e===!0?await r():(typeof queue>"u"&&(queue=createQueue()),queue.add(r))}function parseCallbackConfigArg(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}class BaseCallbackManager{setHandler(e){return this.setHandlers([e])}}class BaseRunManager{constructor(e,t,n,s,a,o,l,d){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:l}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:d})}async handleText(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}}class CallbackManagerForLLMRun extends BaseRunManager{async handleLLMNewToken(e,t={prompt:0,completion:0}){await Promise.all(this.handlers.map(n=>consumeCallback(async()=>{var s;if(!n.ignoreLLM)try{await((s=n.handleLLMNewToken)==null?void 0:s.call(n,e,t,this.runId,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${a}`)}},n.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}}class CallbackManagerForChainRun extends BaseRunManager{getChild(e){const t=new CallbackManager(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreChain)try{await((n=t.handleChainError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${s}`)}},t.awaitHandlers)))}async handleChainEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreChain)try{await((n=t.handleChainEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${s}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}}class CallbackManagerForToolRun extends BaseRunManager{getChild(e){const t=new CallbackManager(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}}class CallbackManager extends BaseCallbackManager{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,n=void 0,s=void 0,a=void 0){return Promise.all(t.map(async o=>{const l=v4();return await Promise.all(this.handlers.map(d=>consumeCallback(async()=>{var c;if(!d.ignoreLLM)try{await((c=d.handleLLMStart)==null?void 0:c.call(d,e,[o],l,this._parentRunId,a,this.tags,this.metadata))}catch(u){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${u}`)}},d.awaitHandlers))),new CallbackManagerForLLMRun(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0){return Promise.all(t.map(async o=>{const l=v4();return await Promise.all(this.handlers.map(d=>consumeCallback(async()=>{var c,u;if(!d.ignoreLLM)try{if(d.handleChatModelStart)await((c=d.handleChatModelStart)==null?void 0:c.call(d,e,[o],l,this._parentRunId,a,this.tags,this.metadata));else if(d.handleLLMStart){const h=getBufferString(o);await((u=d.handleLLMStart)==null?void 0:u.call(d,e,[h],l,this._parentRunId,a,this.tags,this.metadata))}}catch(h){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${h}`)}},d.awaitHandlers))),new CallbackManagerForLLMRun(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=v4()){return await Promise.all(this.handlers.map(s=>consumeCallback(async()=>{var a;if(!s.ignoreChain)try{await((a=s.handleChainStart)==null?void 0:a.call(s,e,t,n,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${s.constructor.name}, handleChainStart: ${o}`)}},s.awaitHandlers))),new CallbackManagerForChainRun(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=v4()){return await Promise.all(this.handlers.map(s=>consumeCallback(async()=>{var a;if(!s.ignoreAgent)try{await((a=s.handleToolStart)==null?void 0:a.call(s,e,t,n,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${s.constructor.name}, handleToolStart: ${o}`)}},s.awaitHandlers))),new CallbackManagerForToolRun(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new CallbackManager(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);n.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);n.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)n.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:v4()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static async configure(e,t,n,s,a,o,l){let d;(e||t)&&(Array.isArray(e)||!e?(d=new CallbackManager,d.setHandlers((e==null?void 0:e.map(ensureHandler))??[],!0)):d=e,d=d.copy(Array.isArray(t)?t.map(ensureHandler):t==null?void 0:t.handlers,!1));const c=getEnvironmentVariable$1("LANGCHAIN_VERBOSE")||(l==null?void 0:l.verbose),u=getEnvironmentVariable$1("LANGCHAIN_TRACING_V2")??!1,h=u||(getEnvironmentVariable$1("LANGCHAIN_TRACING")??!1);if(c||h){if(d||(d=new CallbackManager),c&&!d.handlers.some(b=>b.name===ConsoleCallbackHandler.prototype.name)){const b=new ConsoleCallbackHandler;d.addHandler(b,!0)}if(h&&!d.handlers.some(b=>b.name==="langchain_tracer"))if(u)d.addHandler(await getTracingV2CallbackHandler(),!0);else{const b=getEnvironmentVariable$1("LANGCHAIN_PROJECT")&&getEnvironmentVariable$1("LANGCHAIN_SESSION");d.addHandler(await getTracingCallbackHandler(b),!0)}}return(n||s)&&d&&(d.addTags(n??[]),d.addTags(s??[],!1)),(a||o)&&d&&(d.addMetadata(a??{}),d.addMetadata(o??{},!1)),d}}function ensureHandler(r){return"name"in r?r:BaseCallbackHandler.fromMethods(r)}const getModelNameForTiktoken=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r,getModelContextSize=r=>{switch(getModelNameForTiktoken(r)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},calculateMaxTokens=async({prompt:r,modelName:e})=>{let t;try{t=(await encodingForModel(e)).encode(r).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(r.length/4)}return getModelContextSize(e)-t},getVerbosity=()=>!1;class BaseLangChain extends Serializable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??getVerbosity(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class BaseLanguageModel extends BaseLangChain{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new AsyncCaller$1(n??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await encodingForModel("modelName"in this?getModelNameForTiktoken(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return this._encoding&&(t=this._encoding.encode(e).length),t}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:n,...s}=e;if(n&&n!=="base_chat_model")throw new Error(`Cannot load LLM with model ${n}`);const a={openai:(await __vitePreload(()=>import("./openai.855d6e09.js"),["_app/immutable/chunks/openai.855d6e09.js","_app/immutable/chunks/prompt-layer.00daf386.js"])).ChatOpenAI}[t];if(a===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new a(s)}}class BaseChain extends BaseLangChain{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,n){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:s,callbackManager:a,...o}=e;super({...o,callbacks:a??o.callbacks}),this.memory=s}else super({verbose:t,callbacks:n}),this.memory=e}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}serialize(){throw new Error("Method not implemented.")}async run(e,t){const n=this.inputKeys.filter(d=>{var c;return!((c=this.memory)!=null&&c.memoryKeys.includes(d))});if(!(n.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const a=n.length?{[n[0]]:e}:{},o=await this.call(a,t),l=Object.keys(o);if(l.length===1)return o[l[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async call(e,t,n){const s={...e};if(s.timeout&&!s.signal&&(s.signal=AbortSignal.timeout(s.timeout),delete s.timeout),this.memory!=null){const c=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[u,h]of Object.entries(c))s[u]=h}const a=parseCallbackConfigArg(t),o=await CallbackManager.configure(a.callbacks,this.callbacks,a.tags||n,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l=await(o==null?void 0:o.handleChainStart(this.toJSON(),s));let d;try{d=await(e.signal?Promise.race([this._call(s,l),new Promise((c,u)=>{var h;(h=e.signal)==null||h.addEventListener("abort",()=>{u(new Error("AbortError"))})})]):this._call(s,l))}catch(c){throw await(l==null?void 0:l.handleChainError(c)),c}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),d),await(l==null?void 0:l.handleChainEnd(d)),Object.defineProperty(d,RUN_KEY,{value:l?{runId:l==null?void 0:l.runId}:void 0,configurable:!0}),d}async apply(e,t){return Promise.all(e.map(async(n,s)=>this.call(n,t==null?void 0:t[s])))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:n}=await __vitePreload(()=>Promise.resolve().then(()=>llm_chain),void 0);return n.deserialize(e)}case"sequential_chain":{const{SequentialChain:n}=await __vitePreload(()=>import("./sequential_chain.e8e24e79.js"),[]);return n.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:n}=await __vitePreload(()=>import("./sequential_chain.e8e24e79.js"),[]);return n.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:n}=await __vitePreload(()=>Promise.resolve().then(()=>combine_docs_chain),void 0);return n.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:n}=await __vitePreload(()=>Promise.resolve().then(()=>combine_docs_chain),void 0);return n.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:n}=await __vitePreload(()=>Promise.resolve().then(()=>combine_docs_chain),void 0);return n.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:n}=await __vitePreload(()=>import("./vector_db_qa.c501c376.js"),[]);return n.deserialize(e,t)}case"api_chain":{const{APIChain:n}=await __vitePreload(()=>import("./api_chain.e3b1d8b5.js"),[]);return n.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class StringPromptValue extends BasePromptValue{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new HumanMessage(this.value)]}}class BasePromptTemplate extends Serializable{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:{}});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},n={};for(const[a,o]of Object.entries(t))typeof o=="string"?n[a]=o:n[a]=await o();return{...n,...e}}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await __vitePreload(()=>Promise.resolve().then(()=>prompt),void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await __vitePreload(()=>Promise.resolve().then(()=>prompt),void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await __vitePreload(()=>import("./few_shot.3a39d1da.js"),[]);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class BaseStringPromptTemplate extends BasePromptTemplate{async formatPromptValue(e){const t=await this.format(e);return new StringPromptValue(t)}}class BaseLLMOutputParser extends Serializable{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}}class BaseOutputParser extends BaseLLMOutputParser{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class NoOpOutputParser extends BaseOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class LLMChain extends BaseChain{get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new NoOpOutputParser,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e);for(const n of this.llm.callKeys)n in e&&delete t[n];return t}async _getFinalOutput(e,t,n){let s;return this.outputParser?s=await this.outputParser.parseResultWithPrompt(e,t,n==null?void 0:n.getChild()):s=e[0].text,s}call(e,t){return super.call(e,t)}async _call(e,t){const n={...e},s={...this.llmKwargs};for(const l of this.llm.callKeys)l in e&&(s[l]=e[l],delete n[l]);const a=await this.prompt.formatPromptValue(n),{generations:o}=await this.llm.generatePrompt([a],s,t==null?void 0:t.getChild());return{[this.outputKey]:await this._getFinalOutput(o[0],a,t)}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:n}=e;if(!t)throw new Error("LLMChain must have llm");if(!n)throw new Error("LLMChain must have prompt");return new LLMChain({llm:await BaseLanguageModel.deserialize(t),prompt:await BasePromptTemplate.deserialize(n)})}serialize(){return{_type:`${this._chainType()}_chain`,llm:this.llm.serialize(),prompt:this.prompt.serialize()}}}const llm_chain=Object.freeze(Object.defineProperty({__proto__:null,LLMChain},Symbol.toStringTag,{value:"Module"})),parseFString=r=>{const e=r.split(""),t=[],n=(a,o)=>{for(let l=o;l<e.length;l+=1)if(a.includes(e[l]))return l;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const a=n("}",s);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,a).join("")}),s=a+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const a=n("{}",s),o=(a<0?e.slice(s):e.slice(s,a)).join("");t.push({type:"literal",text:o}),s=a<0?e.length:a}}return t},interpolateFString=(r,e)=>parseFString(r).reduce((t,n)=>{if(n.type==="variable"){if(n.name in e)return t+e[n.name];throw new Error(`Missing value for input ${n.name}`)}return t+n.text},""),DEFAULT_FORMATTER_MAPPING={"f-string":interpolateFString,jinja2:(r,e)=>""},DEFAULT_PARSER_MAPPING={"f-string":parseFString,jinja2:r=>[]},renderTemplate=(r,e,t)=>DEFAULT_FORMATTER_MAPPING[e](r,t),parseTemplate=(r,e)=>DEFAULT_PARSER_MAPPING[e](r),checkValidTemplate=(r,e,t)=>{if(!(e in DEFAULT_FORMATTER_MAPPING)){const n=Object.keys(DEFAULT_FORMATTER_MAPPING);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{const n=t.reduce((s,a)=>(s[a]="foo",s),{});renderTemplate(r,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};class PromptTemplate extends BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),checkValidTemplate(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return renderTemplate(this.template,this.templateFormat,t)}static fromExamples(e,t,n,s=`

`,a=""){const o=[a,...e,t].join(s);return new PromptTemplate({inputVariables:n,template:o})}static fromTemplate(e,{templateFormat:t="f-string",...n}={}){const s=new Set;return parseTemplate(e,t).forEach(a=>{a.type==="variable"&&s.add(a.name)}),new PromptTemplate({inputVariables:[...s],templateFormat:t,template:e,...n})}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(n=>!(n in e)),t.partialVariables={...this.partialVariables??{},...e},new PromptTemplate(t)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new PromptTemplate({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const prompt=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate},Symbol.toStringTag,{value:"Module"}));class StuffDocumentsChain extends BaseChain{get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...n}=e,a=t.map(({pageContent:o})=>o).join(`

`);return{...n,[this.documentVariableName]:a}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t==null?void 0:t.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new StuffDocumentsChain({llmChain:await LLMChain.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class MapReduceDocumentsChain extends BaseChain{get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...s}=e;let a=n,o=[];for(let c=0;c<this.maxIterations;c+=1){const u=a.map(w=>({[this.documentVariableName]:w.pageContent,...s}));if(c!==0||!this.ensureMapStep){const w=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:a,...s}));if(await this.combineDocumentChain.llmChain.llm.getNumTokens(w)<this.maxTokens)break}const b=await this.llmChain.apply(u,t?Array.from({length:u.length},(w,g)=>t.getChild(`map_${g+1}`)):void 0),{outputKey:A}=this.llmChain;this.returnIntermediateSteps&&(o=o.concat(b.map(w=>w[A]))),a=b.map(w=>({pageContent:w[A],metadata:{}}))}const l={[this.combineDocumentChain.inputKey]:a,...s},d=await this.combineDocumentChain.call(l,t==null?void 0:t.getChild("combine_documents"));return this.returnIntermediateSteps?{...d,intermediateSteps:o}:d}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new MapReduceDocumentsChain({llmChain:await LLMChain.deserialize(e.llm_chain),combineDocumentChain:await StuffDocumentsChain.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class RefineDocumentsChain extends BaseChain{get defaultDocumentPrompt(){return new PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const n={page_content:e.pageContent,...e.metadata},s={};return this.documentPrompt.inputVariables.forEach(l=>{s[l]=n[l]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...s})},...t}}async _constructRefineInputs(e,t){const n={page_content:e.pageContent,...e.metadata},s={};this.documentPrompt.inputVariables.forEach(l=>{s[l]=n[l]});const a={[this.documentVariableName]:await this.documentPrompt.format({...s})};return{[this.initialResponseName]:t,...a}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...s}=e,a=n,o=await this._constructInitialInputs(a[0],s);let l=await this.llmChain.predict({...o},t==null?void 0:t.getChild("answer"));for(let d=1;d<a.length;d+=1){const u={...await this._constructRefineInputs(a[d],l),...s};l=await this.refineLLMChain.predict({...u},t==null?void 0:t.getChild("refine"))}return{[this.outputKey]:l}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const n=e.refine_llm_chain;if(!n)throw new Error("Missing refine_llm_chain");return new RefineDocumentsChain({llmChain:await LLMChain.deserialize(t),refineLLMChain:await LLMChain.deserialize(n)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const combine_docs_chain=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain,RefineDocumentsChain,StuffDocumentsChain},Symbol.toStringTag,{value:"Module"}));class BaseMessagePromptTemplate extends Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}}class ChatPromptValue extends BasePromptValue{constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class BaseMessageStringPromptTemplate extends BaseMessagePromptTemplate{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class BaseChatPromptTemplate extends BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new ChatPromptValue(t)}}class HumanMessagePromptTemplate extends BaseMessageStringPromptTemplate{async format(e){return new HumanMessage(await this.prompt.format(e))}static fromTemplate(e){return new this(PromptTemplate.fromTemplate(e))}}class SystemMessagePromptTemplate extends BaseMessageStringPromptTemplate{async format(e){return new SystemMessage(await this.prompt.format(e))}static fromTemplate(e){return new this(PromptTemplate.fromTemplate(e))}}class ChatPromptTemplate extends BaseChatPromptTemplate{get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)for(const l of o.inputVariables)t.add(l);const n=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),s=new Set([...n].filter(o=>!t.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const a=new Set([...t].filter(o=>!n.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let n=[];for(const s of this.promptMessages){const a=s.inputVariables.reduce((l,d)=>{if(!(d in t))throw new Error(`Missing value for input variable \`${d}\``);return l[d]=t[d],l},{}),o=await s.formatMessages(a);n=n.concat(o)}return n}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(n=>!(n in e)),t.partialVariables={...this.partialVariables??{},...e},new ChatPromptTemplate(t)}static fromPromptMessages(e){const t=e.reduce((a,o)=>a.concat(o instanceof ChatPromptTemplate?o.promptMessages:[o]),[]),n=e.reduce((a,o)=>o instanceof ChatPromptTemplate?Object.assign(a,o.partialVariables):a,Object.create(null)),s=new Set;for(const a of t)for(const o of a.inputVariables)o in n||s.add(o);return new ChatPromptTemplate({inputVariables:[...s],promptMessages:t,partialVariables:n})}}class BasePromptSelector{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class ConditionalPromptSelector extends BasePromptSelector{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,n]of this.conditionals)if(t(e))return n;return this.defaultPrompt}}function isChatModel(r){return r._modelType()==="base_chat_model"}const DEFAULT_QA_PROMPT=new PromptTemplate({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),system_template=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,messages=[SystemMessagePromptTemplate.fromTemplate(system_template),HumanMessagePromptTemplate.fromTemplate("{question}")],CHAT_PROMPT=ChatPromptTemplate.fromPromptMessages(messages),QA_PROMPT_SELECTOR=new ConditionalPromptSelector(DEFAULT_QA_PROMPT,[[isChatModel,CHAT_PROMPT]]);function loadQAStuffChain(r,e={}){const{prompt:t=QA_PROMPT_SELECTOR.getPrompt(r),verbose:n}=e,s=new LLMChain({prompt:t,llm:r,verbose:n});return new StuffDocumentsChain({llmChain:s,verbose:n})}var util;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const o of s)a[o]=o;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(l=>typeof s[s[l]]!="number"),o={};for(const l of a)o[l]=s[l];return r.objectValues(o)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&a.push(o);return a},r.find=(s,a)=>{for(const o of s)if(a(o))return o},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(util||(util={}));var objectUtil;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(objectUtil||(objectUtil={}));const ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=r=>{switch(typeof r){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(r)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(r)?ZodParsedType.array:r===null?ZodParsedType.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?ZodParsedType.promise:typeof Map<"u"&&r instanceof Map?ZodParsedType.map:typeof Set<"u"&&r instanceof Set?ZodParsedType.set:typeof Date<"u"&&r instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let l=n,d=0;for(;d<o.path.length;){const c=o.path[d];d===o.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(t(o))):l[c]=l[c]||{_errors:[]},l=l[c],d++}}};return s(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}ZodError.create=r=>new ZodError(r);const errorMap=(r,e)=>{let t;switch(r.code){case ZodIssueCode.invalid_type:r.received===ZodParsedType.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case ZodIssueCode.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,util.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:t=`Unrecognized key(s) in object: ${util.joinValues(r.keys,", ")}`;break;case ZodIssueCode.invalid_union:t="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${util.joinValues(r.options)}`;break;case ZodIssueCode.invalid_enum_value:t=`Invalid enum value. Expected ${util.joinValues(r.options)}, received '${r.received}'`;break;case ZodIssueCode.invalid_arguments:t="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:t="Invalid function return type";break;case ZodIssueCode.invalid_date:t="Invalid date";break;case ZodIssueCode.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:util.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case ZodIssueCode.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case ZodIssueCode.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case ZodIssueCode.custom:t="Invalid input";break;case ZodIssueCode.invalid_intersection_types:t="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case ZodIssueCode.not_finite:t="Number must be finite";break;default:t=e.defaultError,util.assertNever(r)}return{message:t}};let overrideErrorMap=errorMap;function setErrorMap(r){overrideErrorMap=r}function getErrorMap(){return overrideErrorMap}const makeIssue=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],o={...s,path:a};let l="";const d=n.filter(c=>!!c).slice().reverse();for(const c of d)l=c(o,{data:e,defaultError:l}).message;return{...s,path:a,message:s.message||l}},EMPTY_PATH=[];function addIssueToContext(r,e){const t=makeIssue({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,getErrorMap(),errorMap].filter(n=>!!n)});r.common.issues.push(t)}class ParseStatus{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return INVALID;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t)n.push({key:await s.key,value:await s.value});return ParseStatus.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:o}=s;if(a.status==="aborted"||o.status==="aborted")return INVALID;a.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),(typeof o.value<"u"||s.alwaysSet)&&(n[a.value]=o.value)}return{status:e.value,value:n}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=r=>({status:"dirty",value:r}),OK=r=>({status:"valid",value:r}),isAborted=r=>r.status==="aborted",isDirty=r=>r.status==="dirty",isValid=r=>r.status==="valid",isAsync=r=>typeof Promise<"u"&&r instanceof Promise;var errorUtil;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(r,e)=>{if(isValid(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ZodError(r.common.issues);return this._error=t,this._error}}};function processCreateParams(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,l)=>o.code!=="invalid_type"?{message:l.defaultError}:typeof l.data>"u"?{message:n??l.defaultError}:{message:t??l.defaultError},description:s}}class ZodType{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(isAsync(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},a=this._parseSync({data:e,path:s.path,parent:s});return handleResult(s,a)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(isAsync(s)?s:Promise.resolve(s));return handleResult(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const o=e(s),l=()=>a.addIssue({code:ZodIssueCode.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(d=>d?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:t,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:t,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[a-z][a-z0-9]*$/,ulidRegex=/[0-9A-HJKMNP-TV-Z]{26}/,uuidRegex=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,emailRegex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,emojiRegex=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,ipv4Regex=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,datetimeRegex=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function isValidIP(r,e){return!!((e==="v4"||!e)&&ipv4Regex.test(r)||(e==="v6"||!e)&&ipv6Regex.test(r))}class ZodString extends ZodType{constructor(){super(...arguments),this._regex=(e,t,n)=>this.refinement(s=>e.test(s),{validation:t,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(n)}),this.nonempty=e=>this.min(1,errorUtil.errToObj(e)),this.trim=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ZodParsedType.string){const a=this._getOrReturnCtx(e);return addIssueToContext(a,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:a.parsedType}),INVALID}const n=new ParseStatus;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,l=e.data.length<a.value;(o||l)&&(s=this._getOrReturnCtx(e,s),o?addIssueToContext(s,{code:ZodIssueCode.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):l&&addIssueToContext(s,{code:ZodIssueCode.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")emailRegex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"email",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")emojiRegex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"emoji",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")uuidRegex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"uuid",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")cuidRegex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"cuid",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")cuid2Regex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")ulidRegex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"ulid",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"url",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"regex",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?datetimeRegex(a).test(e.data)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="ip"?isValidIP(e.data,a.version)||(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{validation:"ip",code:ZodIssueCode.invalid_string,message:a.message}),n.dirty()):util.assertNever(a);return{status:n.value,value:e.data}}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...errorUtil.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...errorUtil.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...errorUtil.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...errorUtil.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ZodString.create=r=>{var e;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...processCreateParams(r)})};function floatSafeRemainder(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return a%o/Math.pow(10,s)}class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ZodParsedType.number){const a=this._getOrReturnCtx(e);return addIssueToContext(a,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:a.parsedType}),INVALID}let n;const s=new ParseStatus;for(const a of this._def.checks)a.kind==="int"?util.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?floatSafeRemainder(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.not_finite,message:a.message}),s.dirty()):util.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,n,s){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:errorUtil.toString(s)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ZodNumber.create=r=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...processCreateParams(r)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==ZodParsedType.bigint){const a=this._getOrReturnCtx(e);return addIssueToContext(a,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:a.parsedType}),INVALID}let n;const s=new ParseStatus;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),addIssueToContext(n,{code:ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):util.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,n,s){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:errorUtil.toString(s)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ZodBigInt.create=r=>{var e;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...processCreateParams(r)})};class ZodBoolean extends ZodType{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ZodParsedType.boolean){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:n.parsedType}),INVALID}return OK(e.data)}}ZodBoolean.create=r=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...processCreateParams(r)});class ZodDate extends ZodType{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ZodParsedType.date){const a=this._getOrReturnCtx(e);return addIssueToContext(a,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:a.parsedType}),INVALID}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return addIssueToContext(a,{code:ZodIssueCode.invalid_date}),INVALID}const n=new ParseStatus;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),addIssueToContext(s,{code:ZodIssueCode.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):util.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ZodDate.create=r=>new ZodDate({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(r)});class ZodSymbol extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.symbol){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:n.parsedType}),INVALID}return OK(e.data)}}ZodSymbol.create=r=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(r)});class ZodUndefined extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.undefined){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:n.parsedType}),INVALID}return OK(e.data)}}ZodUndefined.create=r=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(r)});class ZodNull extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.null){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:n.parsedType}),INVALID}return OK(e.data)}}ZodNull.create=r=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(r)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}}ZodAny.create=r=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(r)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}}ZodUnknown.create=r=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(r)});class ZodNever extends ZodType{_parse(e){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:t.parsedType}),INVALID}}ZodNever.create=r=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(r)});class ZodVoid extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.undefined){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:n.parsedType}),INVALID}return OK(e.data)}}ZodVoid.create=r=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(r)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==ZodParsedType.array)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:t.parsedType}),INVALID;if(s.exactLength!==null){const o=t.data.length>s.exactLength.value,l=t.data.length<s.exactLength.value;(o||l)&&(addIssueToContext(t,{code:o?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:l?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,l)=>s.type._parseAsync(new ParseInputLazyPath(t,o,t.path,l)))).then(o=>ParseStatus.mergeArray(n,o));const a=[...t.data].map((o,l)=>s.type._parseSync(new ParseInputLazyPath(t,o,t.path,l)));return ParseStatus.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:errorUtil.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}ZodArray.create=(r,e)=>new ZodArray({type:r,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(e)});function deepPartialify(r){if(r instanceof ZodObject){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=ZodOptional.create(deepPartialify(n))}return new ZodObject({...r._def,shape:()=>e})}else return r instanceof ZodArray?new ZodArray({...r._def,type:deepPartialify(r.element)}):r instanceof ZodOptional?ZodOptional.create(deepPartialify(r.unwrap())):r instanceof ZodNullable?ZodNullable.create(deepPartialify(r.unwrap())):r instanceof ZodTuple?ZodTuple.create(r.items.map(e=>deepPartialify(e))):r}class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ZodParsedType.object){const c=this._getOrReturnCtx(e);return addIssueToContext(c,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:c.parsedType}),INVALID}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip"))for(const c in s.data)o.includes(c)||l.push(c);const d=[];for(const c of o){const u=a[c],h=s.data[c];d.push({key:{status:"valid",value:c},value:u._parse(new ParseInputLazyPath(s,h,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof ZodNever){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of l)d.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")l.length>0&&(addIssueToContext(s,{code:ZodIssueCode.unrecognized_keys,keys:l}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of l){const h=s.data[u];d.push({key:{status:"valid",value:u},value:c._parse(new ParseInputLazyPath(s,h,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of d){const h=await u.key;c.push({key:h,value:await u.value,alwaysSet:u.alwaysSet})}return c}).then(c=>ParseStatus.mergeObjectSync(n,c)):ParseStatus.mergeObjectSync(n,d)}get shape(){return this._def.shape()}strict(e){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,o,l;const d=(o=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&o!==void 0?o:n.defaultError;return t.code==="unrecognized_keys"?{message:(l=errorUtil.errToObj(e).message)!==null&&l!==void 0?l:d}:{message:d}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};return util.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return util.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){const t={};return util.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new ZodObject({...this._def,shape:()=>t})}required(e){const t={};return util.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ZodOptional;)a=a._def.innerType;t[n]=a}}),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(util.objectKeys(this.shape))}}ZodObject.create=(r,e)=>new ZodObject({shape:()=>r,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(e)});ZodObject.strictCreate=(r,e)=>new ZodObject({shape:()=>r,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(e)});ZodObject.lazycreate=(r,e)=>new ZodObject({shape:r,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(e)});class ZodUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const l of a)if(l.result.status==="valid")return l.result;for(const l of a)if(l.result.status==="dirty")return t.common.issues.push(...l.ctx.common.issues),l.result;const o=a.map(l=>new ZodError(l.ctx.common.issues));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:o}),INVALID}if(t.common.async)return Promise.all(n.map(async a=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let a;const o=[];for(const d of n){const c={...t,common:{...t.common,issues:[]},parent:null},u=d._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const l=o.map(d=>new ZodError(d));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:l}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(r,e)=>new ZodUnion({options:r,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(e)});const getDiscriminator=r=>r instanceof ZodLazy?getDiscriminator(r.schema):r instanceof ZodEffects?getDiscriminator(r.innerType()):r instanceof ZodLiteral?[r.value]:r instanceof ZodEnum?r.options:r instanceof ZodNativeEnum?Object.keys(r.enum):r instanceof ZodDefault?getDiscriminator(r._def.innerType):r instanceof ZodUndefined?[void 0]:r instanceof ZodNull?[null]:null;class ZodDiscriminatedUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.object)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:t.parsedType}),INVALID;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const o=getDiscriminator(a.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const l of o){if(s.has(l))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(l)}`);s.set(l,a)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...processCreateParams(n)})}}function mergeValues(r,e){const t=getParsedType(r),n=getParsedType(e);if(r===e)return{valid:!0,data:r};if(t===ZodParsedType.object&&n===ZodParsedType.object){const s=util.objectKeys(e),a=util.objectKeys(r).filter(l=>s.indexOf(l)!==-1),o={...r,...e};for(const l of a){const d=mergeValues(r[l],e[l]);if(!d.valid)return{valid:!1};o[l]=d.data}return{valid:!0,data:o}}else if(t===ZodParsedType.array&&n===ZodParsedType.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const o=r[a],l=e[a],d=mergeValues(o,l);if(!d.valid)return{valid:!1};s.push(d.data)}return{valid:!0,data:s}}else return t===ZodParsedType.date&&n===ZodParsedType.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,o)=>{if(isAborted(a)||isAborted(o))return INVALID;const l=mergeValues(a.value,o.value);return l.valid?((isDirty(a)||isDirty(o))&&t.dirty(),{status:t.value,value:l.data}):(addIssueToContext(n,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,o])=>s(a,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}ZodIntersection.create=(r,e,t)=>new ZodIntersection({left:r,right:e,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(t)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ZodParsedType.array)return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:n.parsedType}),INVALID;if(n.data.length<this._def.items.length)return addIssueToContext(n,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&n.data.length>this._def.items.length&&(addIssueToContext(n,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((o,l)=>{const d=this._def.items[l]||this._def.rest;return d?d._parse(new ParseInputLazyPath(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>ParseStatus.mergeArray(t,o)):ParseStatus.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}ZodTuple.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:r,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(e)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ZodParsedType.object)return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:n.parsedType}),INVALID;const s=[],a=this._def.keyType,o=this._def.valueType;for(const l in n.data)s.push({key:a._parse(new ParseInputLazyPath(n,l,n.path,l)),value:o._parse(new ParseInputLazyPath(n,n.data[l],n.path,l))});return n.common.async?ParseStatus.mergeObjectAsync(t,s):ParseStatus.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof ZodType?new ZodRecord({keyType:e,valueType:t,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(n)}):new ZodRecord({keyType:ZodString.create(),valueType:e,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(t)})}}class ZodMap extends ZodType{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ZodParsedType.map)return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:n.parsedType}),INVALID;const s=this._def.keyType,a=this._def.valueType,o=[...n.data.entries()].map(([l,d],c)=>({key:s._parse(new ParseInputLazyPath(n,l,n.path,[c,"key"])),value:a._parse(new ParseInputLazyPath(n,d,n.path,[c,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const d of o){const c=await d.key,u=await d.value;if(c.status==="aborted"||u.status==="aborted")return INVALID;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),l.set(c.value,u.value)}return{status:t.value,value:l}})}else{const l=new Map;for(const d of o){const c=d.key,u=d.value;if(c.status==="aborted"||u.status==="aborted")return INVALID;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),l.set(c.value,u.value)}return{status:t.value,value:l}}}}ZodMap.create=(r,e,t)=>new ZodMap({valueType:e,keyType:r,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(t)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ZodParsedType.set)return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:n.parsedType}),INVALID;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(addIssueToContext(n,{code:ZodIssueCode.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(addIssueToContext(n,{code:ZodIssueCode.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function o(d){const c=new Set;for(const u of d){if(u.status==="aborted")return INVALID;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const l=[...n.data.values()].map((d,c)=>a._parse(new ParseInputLazyPath(n,d,n.path,c)));return n.common.async?Promise.all(l).then(d=>o(d)):o(l)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ZodSet.create=(r,e)=>new ZodSet({valueType:r,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(e)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.function)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:t.parsedType}),INVALID;function n(l,d){return makeIssue({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(c=>!!c),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:d}})}function s(l,d){return makeIssue({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(c=>!!c),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:d}})}const a={errorMap:t.common.contextualErrorMap},o=t.data;return this._def.returns instanceof ZodPromise?OK(async(...l)=>{const d=new ZodError([]),c=await this._def.args.parseAsync(l,a).catch(b=>{throw d.addIssue(n(l,b)),d}),u=await o(...c);return await this._def.returns._def.type.parseAsync(u,a).catch(b=>{throw d.addIssue(s(u,b)),d})}):OK((...l)=>{const d=this._def.args.safeParse(l,a);if(!d.success)throw new ZodError([n(l,d.error)]);const c=o(...d.data),u=this._def.returns.safeParse(c,a);if(!u.success)throw new ZodError([s(c,u.error)]);return u.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(n)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ZodLazy.create=(r,e)=>new ZodLazy({getter:r,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(e)});class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}ZodLiteral.create=(r,e)=>new ZodLiteral({value:r,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(e)});function createZodEnum(r,e){return new ZodEnum({values:r,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(e)})}class ZodEnum extends ZodType{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return addIssueToContext(t,{expected:util.joinValues(n),received:t.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),n=this._def.values;return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_enum_value,options:n}),INVALID}return OK(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return ZodEnum.create(e)}exclude(e){return ZodEnum.create(this.options.filter(t=>!e.includes(t)))}}ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{_parse(e){const t=util.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ZodParsedType.string&&n.parsedType!==ZodParsedType.number){const s=util.objectValues(t);return addIssueToContext(n,{expected:util.joinValues(s),received:n.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(t.indexOf(e.data)===-1){const s=util.objectValues(t);return addIssueToContext(n,{received:n.data,code:ZodIssueCode.invalid_enum_value,options:s}),INVALID}return OK(e.data)}get enum(){return this._def.values}}ZodNativeEnum.create=(r,e)=>new ZodNativeEnum({values:r,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(e)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.promise&&t.common.async===!1)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:t.parsedType}),INVALID;const n=t.parsedType===ZodParsedType.promise?t.data:Promise.resolve(t.data);return OK(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ZodPromise.create=(r,e)=>new ZodPromise({type:r,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(e)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null;if(s.type==="preprocess"){const o=s.transform(n.data);return n.common.async?Promise.resolve(o).then(l=>this._def.schema._parseAsync({data:l,path:n.path,parent:n})):this._def.schema._parseSync({data:o,path:n.path,parent:n})}const a={addIssue:o=>{addIssueToContext(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="refinement"){const o=l=>{const d=s.refinement(l,a);if(n.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?INVALID:(l.status==="dirty"&&t.dirty(),o(l.value),{status:t.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?INVALID:(l.status==="dirty"&&t.dirty(),o(l.value).then(()=>({status:t.value,value:l.value}))))}if(s.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!isValid(o))return o;const l=s.transform(o.value,a);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>isValid(o)?Promise.resolve(s.transform(o.value,a)).then(l=>({status:t.value,value:l})):o);util.assertNever(s)}}ZodEffects.create=(r,e,t)=>new ZodEffects({schema:r,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:e,...processCreateParams(t)});ZodEffects.createWithPreprocess=(r,e,t)=>new ZodEffects({schema:e,effect:{type:"preprocess",transform:r},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(t)});class ZodOptional extends ZodType{_parse(e){return this._getType(e)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodOptional.create=(r,e)=>new ZodOptional({innerType:r,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(e)});class ZodNullable extends ZodType{_parse(e){return this._getType(e)===ZodParsedType.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodNullable.create=(r,e)=>new ZodNullable({innerType:r,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(e)});class ZodDefault extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===ZodParsedType.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ZodDefault.create=(r,e)=>new ZodDefault({innerType:r,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...processCreateParams(e)});class ZodCatch extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return isAsync(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ZodError(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ZodError(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(r,e)=>new ZodCatch({innerType:r,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...processCreateParams(e)});class ZodNaN extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.nan){const n=this._getOrReturnCtx(e);return addIssueToContext(n,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:n.parsedType}),INVALID}return{status:"valid",value:e.data}}}ZodNaN.create=r=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(r)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?INVALID:a.status==="dirty"?(t.dirty(),DIRTY(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?INVALID:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}const custom=(r,e={},t)=>r?ZodAny.create().superRefine((n,s)=>{var a,o;if(!r(n)){const l=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,d=(o=(a=l.fatal)!==null&&a!==void 0?a:t)!==null&&o!==void 0?o:!0,c=typeof l=="string"?{message:l}:l;s.addIssue({code:"custom",...c,fatal:d})}}):ZodAny.create(),late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(r,e={message:`Input not instance of ${r.name}`})=>custom(t=>t instanceof r,e),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:r=>ZodString.create({...r,coerce:!0}),number:r=>ZodNumber.create({...r,coerce:!0}),boolean:r=>ZodBoolean.create({...r,coerce:!0}),bigint:r=>ZodBigInt.create({...r,coerce:!0}),date:r=>ZodDate.create({...r,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap,getErrorMap,makeIssue,EMPTY_PATH,addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid,isAsync,get util(){return util},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson,ZodError});const lib=Object.freeze(Object.defineProperty({__proto__:null,BRAND,DIRTY,EMPTY_PATH,INVALID,NEVER,OK,ParseStatus,Schema:ZodType,ZodAny,ZodArray,ZodBigInt,ZodBoolean,ZodBranded,ZodCatch,ZodDate,ZodDefault,ZodDiscriminatedUnion,ZodEffects,ZodEnum,ZodError,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},ZodFunction,ZodIntersection,ZodIssueCode,ZodLazy,ZodLiteral,ZodMap,ZodNaN,ZodNativeEnum,ZodNever,ZodNull,ZodNullable,ZodNumber,ZodObject,ZodOptional,ZodParsedType,ZodPipeline,ZodPromise,ZodRecord,ZodSchema:ZodType,ZodSet,ZodString,ZodSymbol,ZodTransformer:ZodEffects,ZodTuple,ZodType,ZodUndefined,ZodUnion,ZodUnknown,ZodVoid,addIssueToContext,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,coerce,custom,date:dateType,default:z,defaultErrorMap:errorMap,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,getErrorMap,getParsedType,instanceof:instanceOfType,intersection:intersectionType,isAborted,isAsync,isDirty,isValid,late,lazy:lazyType,literal:literalType,makeIssue,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,get objectUtil(){return objectUtil},oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,quotelessJson,record:recordType,set:setType,setErrorMap,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,get util(){return util},void:voidType,z},Symbol.toStringTag,{value:"Module"}));var zodToJsonSchema$2={},zodToJsonSchema$1={},parseDef={};const require$$0=getAugmentedNamespace(lib);var any={};Object.defineProperty(any,"__esModule",{value:!0});any.parseAnyDef=void 0;function parseAnyDef(){return{}}any.parseAnyDef=parseAnyDef;var array={},errorMessages={};Object.defineProperty(errorMessages,"__esModule",{value:!0});errorMessages.setResponseValueAndErrors=errorMessages.addErrorMessage=void 0;function addErrorMessage(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage=Object.assign(Object.assign({},r.errorMessage),{[e]:t}))}errorMessages.addErrorMessage=addErrorMessage;function setResponseValueAndErrors(r,e,t,n,s){r[e]=t,addErrorMessage(r,e,n,s)}errorMessages.setResponseValueAndErrors=setResponseValueAndErrors;var hasRequiredArray;function requireArray(){if(hasRequiredArray)return array;hasRequiredArray=1,Object.defineProperty(array,"__esModule",{value:!0}),array.parseArrayDef=void 0;const r=require$$0,e=errorMessages,t=requireParseDef();function n(s,a){var o,l;const d={type:"array"};return((l=(o=s.type)===null||o===void 0?void 0:o._def)===null||l===void 0?void 0:l.typeName)!==r.ZodFirstPartyTypeKind.ZodAny&&(d.items=(0,t.parseDef)(s.type._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"items"]}))),s.minLength&&(0,e.setResponseValueAndErrors)(d,"minItems",s.minLength.value,s.minLength.message,a),s.maxLength&&(0,e.setResponseValueAndErrors)(d,"maxItems",s.maxLength.value,s.maxLength.message,a),s.exactLength&&((0,e.setResponseValueAndErrors)(d,"minItems",s.exactLength.value,s.exactLength.message,a),(0,e.setResponseValueAndErrors)(d,"maxItems",s.exactLength.value,s.exactLength.message,a)),d}return array.parseArrayDef=n,array}var bigint={};Object.defineProperty(bigint,"__esModule",{value:!0});bigint.parseBigintDef=void 0;const errorMessages_1$2=errorMessages;function parseBigintDef(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?(0,errorMessages_1$2.setResponseValueAndErrors)(t,"minimum",n.value,n.message,e):(0,errorMessages_1$2.setResponseValueAndErrors)(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),(0,errorMessages_1$2.setResponseValueAndErrors)(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?(0,errorMessages_1$2.setResponseValueAndErrors)(t,"maximum",n.value,n.message,e):(0,errorMessages_1$2.setResponseValueAndErrors)(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),(0,errorMessages_1$2.setResponseValueAndErrors)(t,"maximum",n.value,n.message,e));break;case"multipleOf":(0,errorMessages_1$2.setResponseValueAndErrors)(t,"multipleOf",n.value,n.message,e);break}return t}bigint.parseBigintDef=parseBigintDef;var boolean={};Object.defineProperty(boolean,"__esModule",{value:!0});boolean.parseBooleanDef=void 0;function parseBooleanDef(){return{type:"boolean"}}boolean.parseBooleanDef=parseBooleanDef;var branded={},hasRequiredBranded;function requireBranded(){if(hasRequiredBranded)return branded;hasRequiredBranded=1,Object.defineProperty(branded,"__esModule",{value:!0}),branded.parseBrandedDef=void 0;const r=requireParseDef();function e(t,n){return(0,r.parseDef)(t.type._def,n)}return branded.parseBrandedDef=e,branded}var _catch={},hasRequired_catch;function require_catch(){if(hasRequired_catch)return _catch;hasRequired_catch=1,Object.defineProperty(_catch,"__esModule",{value:!0}),_catch.parseCatchDef=void 0;const r=requireParseDef(),e=(t,n)=>(0,r.parseDef)(t.innerType._def,n);return _catch.parseCatchDef=e,_catch}var date={};Object.defineProperty(date,"__esModule",{value:!0});date.parseDateDef=void 0;const errorMessages_1$1=errorMessages;function parseDateDef(r,e){return e.dateStrategy=="integer"?integerDateParser(r,e):{type:"string",format:"date-time"}}date.parseDateDef=parseDateDef;const integerDateParser=(r,e)=>{const t={type:"integer",format:"unix-time"};for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"&&(0,errorMessages_1$1.setResponseValueAndErrors)(t,"minimum",n.value,n.message,e);break;case"max":e.target==="jsonSchema7"&&(0,errorMessages_1$1.setResponseValueAndErrors)(t,"maximum",n.value,n.message,e);break}return t};var _default={},hasRequired_default;function require_default(){if(hasRequired_default)return _default;hasRequired_default=1,Object.defineProperty(_default,"__esModule",{value:!0}),_default.parseDefaultDef=void 0;const r=requireParseDef();function e(t,n){return Object.assign(Object.assign({},(0,r.parseDef)(t.innerType._def,n)),{default:t.defaultValue()})}return _default.parseDefaultDef=e,_default}var effects={},hasRequiredEffects;function requireEffects(){if(hasRequiredEffects)return effects;hasRequiredEffects=1,Object.defineProperty(effects,"__esModule",{value:!0}),effects.parseEffectsDef=void 0;const r=requireParseDef();function e(t,n){return n.effectStrategy==="input"?(0,r.parseDef)(t.schema._def,n):{}}return effects.parseEffectsDef=e,effects}var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});_enum.parseEnumDef=void 0;function parseEnumDef(r){return{type:"string",enum:r.values}}_enum.parseEnumDef=parseEnumDef;var intersection={},hasRequiredIntersection;function requireIntersection(){if(hasRequiredIntersection)return intersection;hasRequiredIntersection=1;var r=commonjsGlobal&&commonjsGlobal.__rest||function(s,a){var o={};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&a.indexOf(l)<0&&(o[l]=s[l]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(s);d<l.length;d++)a.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(s,l[d])&&(o[l[d]]=s[l[d]]);return o};Object.defineProperty(intersection,"__esModule",{value:!0}),intersection.parseIntersectionDef=void 0;const e=requireParseDef(),t=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function n(s,a){const o=[(0,e.parseDef)(s.left._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"allOf","0"]})),(0,e.parseDef)(s.right._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"allOf","1"]}))].filter(c=>!!c);let l=a.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const d=[];return o.forEach(c=>{if(t(c))d.push(...c.allOf),c.unevaluatedProperties===void 0&&(l=void 0);else{let u=c;"additionalProperties"in c&&c.additionalProperties===!1?u=r(c,["additionalProperties"]):l=void 0,d.push(u)}}),d.length?Object.assign({allOf:d},l):void 0}return intersection.parseIntersectionDef=n,intersection}var literal={};Object.defineProperty(literal,"__esModule",{value:!0});literal.parseLiteralDef=void 0;function parseLiteralDef(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}literal.parseLiteralDef=parseLiteralDef;var map$1={},hasRequiredMap;function requireMap(){if(hasRequiredMap)return map$1;hasRequiredMap=1,Object.defineProperty(map$1,"__esModule",{value:!0}),map$1.parseMapDef=void 0;const r=requireParseDef();function e(t,n){const s=(0,r.parseDef)(t.keyType._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"items","items","0"]}))||{},a=(0,r.parseDef)(t.valueType._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[s,a],minItems:2,maxItems:2}}}return map$1.parseMapDef=e,map$1}var nativeEnum={};Object.defineProperty(nativeEnum,"__esModule",{value:!0});nativeEnum.parseNativeEnumDef=void 0;function parseNativeEnumDef(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}nativeEnum.parseNativeEnumDef=parseNativeEnumDef;var never={};Object.defineProperty(never,"__esModule",{value:!0});never.parseNeverDef=void 0;function parseNeverDef(){return{not:{}}}never.parseNeverDef=parseNeverDef;var _null$1={};Object.defineProperty(_null$1,"__esModule",{value:!0});_null$1.parseNullDef=void 0;function parseNullDef(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}_null$1.parseNullDef=parseNullDef;var nullable={},union={},hasRequiredUnion;function requireUnion(){return hasRequiredUnion||(hasRequiredUnion=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.parseUnionDef=r.primitiveMappings=void 0;const e=requireParseDef();r.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function t(s,a){if(a.target==="openApi3")return n(s,a);const o=s.options instanceof Map?Array.from(s.options.values()):s.options;if(o.every(l=>l._def.typeName in r.primitiveMappings&&(!l._def.checks||!l._def.checks.length))){const l=o.reduce((d,c)=>{const u=r.primitiveMappings[c._def.typeName];return u&&!d.includes(u)?[...d,u]:d},[]);return{type:l.length>1?l:l[0]}}else if(o.every(l=>l._def.typeName==="ZodLiteral"&&!l.description)){const l=o.reduce((d,c)=>{const u=typeof c._def.value;switch(u){case"string":case"number":case"boolean":return[...d,u];case"bigint":return[...d,"integer"];case"object":if(c._def.value===null)return[...d,"null"];case"symbol":case"undefined":case"function":default:return d}},[]);if(l.length===o.length){const d=l.filter((c,u,h)=>h.indexOf(c)===u);return{type:d.length>1?d:d[0],enum:o.reduce((c,u)=>c.includes(u._def.value)?c:[...c,u._def.value],[])}}}else if(o.every(l=>l._def.typeName==="ZodEnum"))return{type:"string",enum:o.reduce((l,d)=>[...l,...d._def.values.filter(c=>!l.includes(c))],[])};return n(s,a)}r.parseUnionDef=t;const n=(s,a)=>{const o=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((l,d)=>(0,e.parseDef)(l._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"anyOf",`${d}`]}))).filter(l=>!!l&&(!a.strictUnions||typeof l=="object"&&Object.keys(l).length>0));return o.length?{anyOf:o}:void 0}}(union)),union}var hasRequiredNullable;function requireNullable(){if(hasRequiredNullable)return nullable;hasRequiredNullable=1,Object.defineProperty(nullable,"__esModule",{value:!0}),nullable.parseNullableDef=void 0;const r=requireParseDef(),e=requireUnion();function t(n,s){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return s.target==="openApi3"?{type:e.primitiveMappings[n.innerType._def.typeName],nullable:!0}:{type:[e.primitiveMappings[n.innerType._def.typeName],"null"]};if(s.target==="openApi3"){const o=(0,r.parseDef)(n.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath]}));return o&&Object.assign(Object.assign({},o),{nullable:!0})}const a=(0,r.parseDef)(n.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"anyOf","0"]}));return a&&{anyOf:[a,{type:"null"}]}}return nullable.parseNullableDef=t,nullable}var number={};Object.defineProperty(number,"__esModule",{value:!0});number.parseNumberDef=void 0;const errorMessages_1=errorMessages;function parseNumberDef(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",(0,errorMessages_1.addErrorMessage)(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?(0,errorMessages_1.setResponseValueAndErrors)(t,"minimum",n.value,n.message,e):(0,errorMessages_1.setResponseValueAndErrors)(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),(0,errorMessages_1.setResponseValueAndErrors)(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?(0,errorMessages_1.setResponseValueAndErrors)(t,"maximum",n.value,n.message,e):(0,errorMessages_1.setResponseValueAndErrors)(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),(0,errorMessages_1.setResponseValueAndErrors)(t,"maximum",n.value,n.message,e));break;case"multipleOf":(0,errorMessages_1.setResponseValueAndErrors)(t,"multipleOf",n.value,n.message,e);break}return t}number.parseNumberDef=parseNumberDef;var object={},hasRequiredObject;function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,Object.defineProperty(object,"__esModule",{value:!0}),object.parseObjectDef=object.parseObjectDefX=void 0;const r=requireParseDef();function e(n,s){var a,o;Object.keys(n.shape()).reduce((d,c)=>{let u=n.shape()[c];const h=u.isOptional();h||(u=Object.assign({},u._def.innerSchema));const b=(0,r.parseDef)(u._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return b!==void 0&&(d.properties[c]=b,h||(d.required||(d.required=[]),d.required.push(c))),d},{type:"object",properties:{},additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":(a=(0,r.parseDef)(n.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&a!==void 0?a:!0});const l=Object.assign(Object.assign({type:"object"},Object.entries(n.shape()).reduce((d,[c,u])=>{if(u===void 0||u._def===void 0)return d;const h=(0,r.parseDef)(u._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return h===void 0?d:{properties:Object.assign(Object.assign({},d.properties),{[c]:h}),required:u.isOptional()?d.required:[...d.required,c]}},{properties:{},required:[]})),{additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":(o=(0,r.parseDef)(n.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&o!==void 0?o:!0});return l.required.length||delete l.required,l}object.parseObjectDefX=e;function t(n,s){var a;const o=Object.assign(Object.assign({type:"object"},Object.entries(n.shape()).reduce((l,[d,c])=>{if(c===void 0||c._def===void 0)return l;const u=(0,r.parseDef)(c._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",d],propertyPath:[...s.currentPath,"properties",d]}));return u===void 0?l:{properties:Object.assign(Object.assign({},l.properties),{[d]:u}),required:c.isOptional()?l.required:[...l.required,d]}},{properties:{},required:[]})),{additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":(a=(0,r.parseDef)(n.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&a!==void 0?a:!0});return o.required.length||delete o.required,o}return object.parseObjectDef=t,object}var optional={},hasRequiredOptional;function requireOptional(){if(hasRequiredOptional)return optional;hasRequiredOptional=1,Object.defineProperty(optional,"__esModule",{value:!0}),optional.parseOptionalDef=void 0;const r=requireParseDef(),e=(t,n)=>{var s;if(n.currentPath.toString()===((s=n.propertyPath)===null||s===void 0?void 0:s.toString()))return(0,r.parseDef)(t.innerType._def,n);const a=(0,r.parseDef)(t.innerType._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"anyOf","1"]}));return a?{anyOf:[{not:{}},a]}:{}};return optional.parseOptionalDef=e,optional}var pipeline={},hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline;hasRequiredPipeline=1,Object.defineProperty(pipeline,"__esModule",{value:!0}),pipeline.parsePipelineDef=void 0;const r=requireParseDef(),e=(t,n)=>{if(n.pipeStrategy==="input")return(0,r.parseDef)(t.in._def,n);const s=(0,r.parseDef)(t.in._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"allOf","0"]})),a=(0,r.parseDef)(t.out._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"allOf",s?"1":"0"]}));return{allOf:[s,a].filter(o=>o!==void 0)}};return pipeline.parsePipelineDef=e,pipeline}var promise={},hasRequiredPromise;function requirePromise(){if(hasRequiredPromise)return promise;hasRequiredPromise=1,Object.defineProperty(promise,"__esModule",{value:!0}),promise.parsePromiseDef=void 0;const r=requireParseDef();function e(t,n){return(0,r.parseDef)(t.type._def,n)}return promise.parsePromiseDef=e,promise}var record={},string={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.parseStringDef=r.emojiPattern=r.ulidPattern=r.cuid2Pattern=r.cuidPattern=r.emailPattern=void 0;const e=errorMessages;r.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',r.cuidPattern="^c[^\\s-]{8,}$",r.cuid2Pattern="^[a-z][a-z0-9]*$",r.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",r.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u";function t(o,l){const d={type:"string"};if(o.checks)for(const c of o.checks)switch(c.kind){case"min":(0,e.setResponseValueAndErrors)(d,"minLength",typeof d.minLength=="number"?Math.max(d.minLength,c.value):c.value,c.message,l);break;case"max":(0,e.setResponseValueAndErrors)(d,"maxLength",typeof d.maxLength=="number"?Math.min(d.maxLength,c.value):c.value,c.message,l);break;case"email":switch(l.emailStrategy){case"format:email":s(d,"email",c.message,l);break;case"format:idn-email":s(d,"idn-email",c.message,l);break;case"pattern:zod":a(d,r.emailPattern,c.message,l);break}break;case"url":s(d,"uri",c.message,l);break;case"uuid":s(d,"uuid",c.message,l);break;case"regex":a(d,c.regex.source,c.message,l);break;case"cuid":a(d,r.cuidPattern,c.message,l);break;case"cuid2":a(d,r.cuid2Pattern,c.message,l);break;case"startsWith":a(d,"^"+n(c.value),c.message,l);break;case"endsWith":a(d,n(c.value)+"$",c.message,l);break;case"datetime":s(d,"date-time",c.message,l);break;case"length":(0,e.setResponseValueAndErrors)(d,"minLength",typeof d.minLength=="number"?Math.max(d.minLength,c.value):c.value,c.message,l),(0,e.setResponseValueAndErrors)(d,"maxLength",typeof d.maxLength=="number"?Math.min(d.maxLength,c.value):c.value,c.message,l);break;case"includes":{a(d,n(c.value),c.message,l);break}case"ip":{c.version!=="v6"&&s(d,"ipv4",c.message,l),c.version!=="v4"&&s(d,"ipv6",c.message,l);break}case"emoji":a(d,r.emojiPattern,c.message,l);break;case"ulid":{a(d,r.ulidPattern,c.message,l);break}}return d}r.parseStringDef=t;const n=o=>Array.from(o).map(l=>/[a-zA-Z0-9]/.test(l)?l:`\\${l}`).join(""),s=(o,l,d,c)=>{var u;o.format||!((u=o.anyOf)===null||u===void 0)&&u.some(h=>h.format)?(o.anyOf||(o.anyOf=[]),o.format&&(o.anyOf.push(Object.assign({format:o.format},o.errorMessage&&c.errorMessages&&{errorMessage:{format:o.errorMessage.format}})),delete o.format,o.errorMessage&&(delete o.errorMessage.format,Object.keys(o.errorMessage).length===0&&delete o.errorMessage)),o.anyOf.push(Object.assign({format:l},d&&c.errorMessages&&{errorMessage:{format:d}}))):(0,e.setResponseValueAndErrors)(o,"format",l,d,c)},a=(o,l,d,c)=>{var u;o.pattern||!((u=o.allOf)===null||u===void 0)&&u.some(h=>h.pattern)?(o.allOf||(o.allOf=[]),o.pattern&&(o.allOf.push(Object.assign({pattern:o.pattern},o.errorMessage&&c.errorMessages&&{errorMessage:{pattern:o.errorMessage.pattern}})),delete o.pattern,o.errorMessage&&(delete o.errorMessage.pattern,Object.keys(o.errorMessage).length===0&&delete o.errorMessage)),o.allOf.push(Object.assign({pattern:l},d&&c.errorMessages&&{errorMessage:{pattern:d}}))):(0,e.setResponseValueAndErrors)(o,"pattern",l,d,c)}})(string);var hasRequiredRecord;function requireRecord(){if(hasRequiredRecord)return record;hasRequiredRecord=1,Object.defineProperty(record,"__esModule",{value:!0}),record.parseRecordDef=void 0;const r=require$$0,e=requireParseDef(),t=string;function n(s,a){var o,l,d,c,u;if(a.target==="openApi3"&&((o=s.keyType)===null||o===void 0?void 0:o._def.typeName)===r.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((b,A)=>{var w;return Object.assign(Object.assign({},b),{[A]:(w=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"properties",A]})))!==null&&w!==void 0?w:{}})},{}),additionalProperties:!1};const h={type:"object",additionalProperties:(l=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"additionalProperties"]})))!==null&&l!==void 0?l:{}};if(a.target==="openApi3")return h;if(((d=s.keyType)===null||d===void 0?void 0:d._def.typeName)===r.ZodFirstPartyTypeKind.ZodString&&(!((c=s.keyType._def.checks)===null||c===void 0)&&c.length)){const b=Object.entries((0,t.parseStringDef)(s.keyType._def,a)).reduce((A,[w,g])=>w==="type"?A:Object.assign(Object.assign({},A),{[w]:g}),{});return Object.assign(Object.assign({},h),{propertyNames:b})}else if(((u=s.keyType)===null||u===void 0?void 0:u._def.typeName)===r.ZodFirstPartyTypeKind.ZodEnum)return Object.assign(Object.assign({},h),{propertyNames:{enum:s.keyType._def.values}});return h}return record.parseRecordDef=n,record}var set$1={},hasRequiredSet;function requireSet(){if(hasRequiredSet)return set$1;hasRequiredSet=1,Object.defineProperty(set$1,"__esModule",{value:!0}),set$1.parseSetDef=void 0;const r=errorMessages,e=requireParseDef();function t(n,s){const o={type:"array",uniqueItems:!0,items:(0,e.parseDef)(n.valueType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"items"]}))};return n.minSize&&(0,r.setResponseValueAndErrors)(o,"minItems",n.minSize.value,n.minSize.message,s),n.maxSize&&(0,r.setResponseValueAndErrors)(o,"maxItems",n.maxSize.value,n.maxSize.message,s),o}return set$1.parseSetDef=t,set$1}var tuple={},hasRequiredTuple;function requireTuple(){if(hasRequiredTuple)return tuple;hasRequiredTuple=1,Object.defineProperty(tuple,"__esModule",{value:!0}),tuple.parseTupleDef=void 0;const r=requireParseDef();function e(t,n){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((s,a)=>(0,r.parseDef)(s._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"items",`${a}`]}))).reduce((s,a)=>a===void 0?s:[...s,a],[]),additionalItems:(0,r.parseDef)(t.rest._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"additionalItems"]}))}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((s,a)=>(0,r.parseDef)(s._def,Object.assign(Object.assign({},n),{currentPath:[...n.currentPath,"items",`${a}`]}))).reduce((s,a)=>a===void 0?s:[...s,a],[])}}return tuple.parseTupleDef=e,tuple}var _undefined={};Object.defineProperty(_undefined,"__esModule",{value:!0});_undefined.parseUndefinedDef=void 0;function parseUndefinedDef(){return{not:{}}}_undefined.parseUndefinedDef=parseUndefinedDef;var unknown={};Object.defineProperty(unknown,"__esModule",{value:!0});unknown.parseUnknownDef=void 0;function parseUnknownDef(){return{}}unknown.parseUnknownDef=parseUnknownDef;var hasRequiredParseDef;function requireParseDef(){if(hasRequiredParseDef)return parseDef;hasRequiredParseDef=1,Object.defineProperty(parseDef,"__esModule",{value:!0}),parseDef.parseDef=void 0;const r=require$$0,e=any,t=requireArray(),n=bigint,s=boolean,a=requireBranded(),o=require_catch(),l=date,d=require_default(),c=requireEffects(),u=_enum,h=requireIntersection(),b=literal,A=requireMap(),w=nativeEnum,g=never,v=_null$1,T=requireNullable(),C=number,x=requireObject(),S=requireOptional(),D=requirePipeline(),m=requirePromise(),_=requireRecord(),f=requireSet(),y=string,p=requireTuple(),k=_undefined,L=requireUnion(),X=unknown;function N(W,pe,he=!1){const _e=pe.seen.get(W);if(_e&&!he){const F=q(_e,pe);if(F!==void 0)return F}const Oe={def:W,path:pe.currentPath,jsonSchema:void 0};pe.seen.set(W,Oe);const J=oe(W,W.typeName,pe);return J&&Q(W,pe,J),Oe.jsonSchema=J,J}parseDef.parseDef=N;const q=(W,pe)=>{switch(pe.$refStrategy){case"root":return{$ref:W.path.length===0?"":W.path.length===1?`${W.path[0]}/`:W.path.join("/")};case"relative":return{$ref:te(pe.currentPath,W.path)};case"none":return W.path.length<pe.currentPath.length&&W.path.every((he,_e)=>pe.currentPath[_e]===he)?(console.warn(`Recursive reference detected at ${pe.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return W.path.length<pe.currentPath.length&&W.path.every((he,_e)=>pe.currentPath[_e]===he)?(console.warn(`Recursive reference detected at ${pe.currentPath.join("/")}! Defaulting to any`),{}):W.jsonSchema}},te=(W,pe)=>{let he=0;for(;he<W.length&&he<pe.length&&W[he]===pe[he];he++);return[(W.length-he).toString(),...pe.slice(he)].join("/")},oe=(W,pe,he)=>{switch(pe){case r.ZodFirstPartyTypeKind.ZodString:return(0,y.parseStringDef)(W,he);case r.ZodFirstPartyTypeKind.ZodNumber:return(0,C.parseNumberDef)(W,he);case r.ZodFirstPartyTypeKind.ZodObject:return(0,x.parseObjectDef)(W,he);case r.ZodFirstPartyTypeKind.ZodBigInt:return(0,n.parseBigintDef)(W,he);case r.ZodFirstPartyTypeKind.ZodBoolean:return(0,s.parseBooleanDef)();case r.ZodFirstPartyTypeKind.ZodDate:return(0,l.parseDateDef)(W,he);case r.ZodFirstPartyTypeKind.ZodUndefined:return(0,k.parseUndefinedDef)();case r.ZodFirstPartyTypeKind.ZodNull:return(0,v.parseNullDef)(he);case r.ZodFirstPartyTypeKind.ZodArray:return(0,t.parseArrayDef)(W,he);case r.ZodFirstPartyTypeKind.ZodUnion:case r.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,L.parseUnionDef)(W,he);case r.ZodFirstPartyTypeKind.ZodIntersection:return(0,h.parseIntersectionDef)(W,he);case r.ZodFirstPartyTypeKind.ZodTuple:return(0,p.parseTupleDef)(W,he);case r.ZodFirstPartyTypeKind.ZodRecord:return(0,_.parseRecordDef)(W,he);case r.ZodFirstPartyTypeKind.ZodLiteral:return(0,b.parseLiteralDef)(W,he);case r.ZodFirstPartyTypeKind.ZodEnum:return(0,u.parseEnumDef)(W);case r.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,w.parseNativeEnumDef)(W);case r.ZodFirstPartyTypeKind.ZodNullable:return(0,T.parseNullableDef)(W,he);case r.ZodFirstPartyTypeKind.ZodOptional:return(0,S.parseOptionalDef)(W,he);case r.ZodFirstPartyTypeKind.ZodMap:return(0,A.parseMapDef)(W,he);case r.ZodFirstPartyTypeKind.ZodSet:return(0,f.parseSetDef)(W,he);case r.ZodFirstPartyTypeKind.ZodLazy:return N(W.getter()._def,he);case r.ZodFirstPartyTypeKind.ZodPromise:return(0,m.parsePromiseDef)(W,he);case r.ZodFirstPartyTypeKind.ZodNaN:case r.ZodFirstPartyTypeKind.ZodNever:return(0,g.parseNeverDef)();case r.ZodFirstPartyTypeKind.ZodEffects:return(0,c.parseEffectsDef)(W,he);case r.ZodFirstPartyTypeKind.ZodAny:return(0,e.parseAnyDef)();case r.ZodFirstPartyTypeKind.ZodUnknown:return(0,X.parseUnknownDef)();case r.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(W,he);case r.ZodFirstPartyTypeKind.ZodBranded:return(0,a.parseBrandedDef)(W,he);case r.ZodFirstPartyTypeKind.ZodCatch:return(0,o.parseCatchDef)(W,he);case r.ZodFirstPartyTypeKind.ZodPipeline:return(0,D.parsePipelineDef)(W,he);case r.ZodFirstPartyTypeKind.ZodFunction:case r.ZodFirstPartyTypeKind.ZodVoid:case r.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(_e=>{})()}},Q=(W,pe,he)=>(W.description&&(he.description=W.description,pe.markdownDescription&&(he.markdownDescription=W.description)),he);return parseDef}var Refs={},Options={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultOptions=r.defaultOptions=void 0,r.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"};const e=t=>typeof t=="string"?Object.assign(Object.assign({},r.defaultOptions),{name:t}):Object.assign(Object.assign({},r.defaultOptions),t);r.getDefaultOptions=e})(Options);Object.defineProperty(Refs,"__esModule",{value:!0});Refs.getRefs=void 0;const Options_1=Options,getRefs=r=>{const e=(0,Options_1.getDefaultOptions)(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return Object.assign(Object.assign({},e),{currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))})};Refs.getRefs=getRefs;Object.defineProperty(zodToJsonSchema$1,"__esModule",{value:!0});zodToJsonSchema$1.zodToJsonSchema=void 0;const parseDef_1=requireParseDef(),Refs_1=Refs,zodToJsonSchema=(r,e)=>{var t;const n=(0,Refs_1.getRefs)(e),s=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((d,[c,u])=>{var h;return Object.assign(Object.assign({},d),{[c]:(h=(0,parseDef_1.parseDef)(u._def,Object.assign(Object.assign({},n),{currentPath:[...n.basePath,n.definitionPath,c]}),!0))!==null&&h!==void 0?h:{}})},{}):void 0,a=typeof e=="string"?e:e==null?void 0:e.name,o=(t=(0,parseDef_1.parseDef)(r._def,a===void 0?n:Object.assign(Object.assign({},n),{currentPath:[...n.basePath,n.definitionPath,a]}),!1))!==null&&t!==void 0?t:{},l=a===void 0?s?Object.assign(Object.assign({},o),{[n.definitionPath]:s}):o:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:Object.assign(Object.assign({},s),{[a]:o})};return n.target==="jsonSchema7"?l.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),l};zodToJsonSchema$1.zodToJsonSchema=zodToJsonSchema;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.zodToJsonSchema=void 0;const e=zodToJsonSchema$1;Object.defineProperty(r,"zodToJsonSchema",{enumerable:!0,get:function(){return e.zodToJsonSchema}}),r.default=e.zodToJsonSchema})(zodToJsonSchema$2);/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function isNothing(r){return typeof r>"u"||r===null}function isObject(r){return typeof r=="object"&&r!==null}function toArray(r){return Array.isArray(r)?r:isNothing(r)?[]:[r]}function extend(r,e){var t,n,s,a;if(e)for(a=Object.keys(e),t=0,n=a.length;t<n;t+=1)s=a[t],r[s]=e[s];return r}function repeat(r,e){var t="",n;for(n=0;n<e;n+=1)t+=r;return t}function isNegativeZero(r){return r===0&&Number.NEGATIVE_INFINITY===1/r}var isNothing_1=isNothing,isObject_1=isObject,toArray_1=toArray,repeat_1=repeat,isNegativeZero_1=isNegativeZero,extend_1=extend,common={isNothing:isNothing_1,isObject:isObject_1,toArray:toArray_1,repeat:repeat_1,isNegativeZero:isNegativeZero_1,extend:extend_1};function formatError(r,e){var t="",n=r.reason||"(unknown reason)";return r.mark?(r.mark.name&&(t+='in "'+r.mark.name+'" '),t+="("+(r.mark.line+1)+":"+(r.mark.column+1)+")",!e&&r.mark.snippet&&(t+=`

`+r.mark.snippet),n+" "+t):n}function YAMLException$1(r,e){Error.call(this),this.name="YAMLException",this.reason=r,this.mark=e,this.message=formatError(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}YAMLException$1.prototype=Object.create(Error.prototype);YAMLException$1.prototype.constructor=YAMLException$1;YAMLException$1.prototype.toString=function r(e){return this.name+": "+formatError(this,e)};var exception=YAMLException$1,TYPE_CONSTRUCTOR_OPTIONS=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(r){var e={};return r!==null&&Object.keys(r).forEach(function(t){r[t].forEach(function(n){e[String(n)]=t})}),e}function Type$1(r,e){if(e=e||{},Object.keys(e).forEach(function(t){if(TYPE_CONSTRUCTOR_OPTIONS.indexOf(t)===-1)throw new exception('Unknown option "'+t+'" is met in definition of "'+r+'" YAML type.')}),this.options=e,this.tag=r,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=compileStyleAliases(e.styleAliases||null),YAML_NODE_KINDS.indexOf(this.kind)===-1)throw new exception('Unknown kind "'+this.kind+'" is specified for "'+r+'" YAML type.')}var type=Type$1;function compileList(r,e){var t=[];return r[e].forEach(function(n){var s=t.length;t.forEach(function(a,o){a.tag===n.tag&&a.kind===n.kind&&a.multi===n.multi&&(s=o)}),t[s]=n}),t}function compileMap(){var r={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function n(s){s.multi?(r.multi[s.kind].push(s),r.multi.fallback.push(s)):r[s.kind][s.tag]=r.fallback[s.tag]=s}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(n);return r}function Schema$1(r){return this.extend(r)}Schema$1.prototype.extend=function r(e){var t=[],n=[];if(e instanceof type)n.push(e);else if(Array.isArray(e))n=n.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit));else throw new exception("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(a){if(!(a instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new exception("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new exception("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(a){if(!(a instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Schema$1.prototype);return s.implicit=(this.implicit||[]).concat(t),s.explicit=(this.explicit||[]).concat(n),s.compiledImplicit=compileList(s,"implicit"),s.compiledExplicit=compileList(s,"explicit"),s.compiledTypeMap=compileMap(s.compiledImplicit,s.compiledExplicit),s};var schema=Schema$1,str=new type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(r){return r!==null?r:""}}),seq=new type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(r){return r!==null?r:[]}}),map=new type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(r){return r!==null?r:{}}}),failsafe=new schema({explicit:[str,seq,map]});function resolveYamlNull(r){if(r===null)return!0;var e=r.length;return e===1&&r==="~"||e===4&&(r==="null"||r==="Null"||r==="NULL")}function constructYamlNull(){return null}function isNull(r){return r===null}var _null=new type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function resolveYamlBoolean(r){if(r===null)return!1;var e=r.length;return e===4&&(r==="true"||r==="True"||r==="TRUE")||e===5&&(r==="false"||r==="False"||r==="FALSE")}function constructYamlBoolean(r){return r==="true"||r==="True"||r==="TRUE"}function isBoolean(r){return Object.prototype.toString.call(r)==="[object Boolean]"}var bool=new type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(r){return r?"true":"false"},uppercase:function(r){return r?"TRUE":"FALSE"},camelcase:function(r){return r?"True":"False"}},defaultStyle:"lowercase"});function isHexCode(r){return 48<=r&&r<=57||65<=r&&r<=70||97<=r&&r<=102}function isOctCode(r){return 48<=r&&r<=55}function isDecCode(r){return 48<=r&&r<=57}function resolveYamlInteger(r){if(r===null)return!1;var e=r.length,t=0,n=!1,s;if(!e)return!1;if(s=r[t],(s==="-"||s==="+")&&(s=r[++t]),s==="0"){if(t+1===e)return!0;if(s=r[++t],s==="b"){for(t++;t<e;t++)if(s=r[t],s!=="_"){if(s!=="0"&&s!=="1")return!1;n=!0}return n&&s!=="_"}if(s==="x"){for(t++;t<e;t++)if(s=r[t],s!=="_"){if(!isHexCode(r.charCodeAt(t)))return!1;n=!0}return n&&s!=="_"}if(s==="o"){for(t++;t<e;t++)if(s=r[t],s!=="_"){if(!isOctCode(r.charCodeAt(t)))return!1;n=!0}return n&&s!=="_"}}if(s==="_")return!1;for(;t<e;t++)if(s=r[t],s!=="_"){if(!isDecCode(r.charCodeAt(t)))return!1;n=!0}return!(!n||s==="_")}function constructYamlInteger(r){var e=r,t=1,n;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),n=e[0],(n==="-"||n==="+")&&(n==="-"&&(t=-1),e=e.slice(1),n=e[0]),e==="0")return 0;if(n==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function isInteger(r){return Object.prototype.toString.call(r)==="[object Number]"&&r%1===0&&!common.isNegativeZero(r)}var int=new type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(r){return r>=0?"0b"+r.toString(2):"-0b"+r.toString(2).slice(1)},octal:function(r){return r>=0?"0o"+r.toString(8):"-0o"+r.toString(8).slice(1)},decimal:function(r){return r.toString(10)},hexadecimal:function(r){return r>=0?"0x"+r.toString(16).toUpperCase():"-0x"+r.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(r){return!(r===null||!YAML_FLOAT_PATTERN.test(r)||r[r.length-1]==="_")}function constructYamlFloat(r){var e,t;return e=r.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(r,e){var t;if(isNaN(r))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===r)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===r)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(r))return"-0.0";return t=r.toString(10),SCIENTIFIC_WITHOUT_DOT.test(t)?t.replace("e",".e"):t}function isFloat(r){return Object.prototype.toString.call(r)==="[object Number]"&&(r%1!==0||common.isNegativeZero(r))}var float=new type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),json=failsafe.extend({implicit:[_null,bool,int,float]}),core=json,YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(r){return r===null?!1:YAML_DATE_REGEXP.exec(r)!==null||YAML_TIMESTAMP_REGEXP.exec(r)!==null}function constructYamlTimestamp(r){var e,t,n,s,a,o,l,d=0,c=null,u,h,b;if(e=YAML_DATE_REGEXP.exec(r),e===null&&(e=YAML_TIMESTAMP_REGEXP.exec(r)),e===null)throw new Error("Date resolve error");if(t=+e[1],n=+e[2]-1,s=+e[3],!e[4])return new Date(Date.UTC(t,n,s));if(a=+e[4],o=+e[5],l=+e[6],e[7]){for(d=e[7].slice(0,3);d.length<3;)d+="0";d=+d}return e[9]&&(u=+e[10],h=+(e[11]||0),c=(u*60+h)*6e4,e[9]==="-"&&(c=-c)),b=new Date(Date.UTC(t,n,s,a,o,l,d)),c&&b.setTime(b.getTime()-c),b}function representYamlTimestamp(r){return r.toISOString()}var timestamp=new type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp});function resolveYamlMerge(r){return r==="<<"||r===null}var merge=new type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge}),BASE64_MAP=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function resolveYamlBinary(r){if(r===null)return!1;var e,t,n=0,s=r.length,a=BASE64_MAP;for(t=0;t<s;t++)if(e=a.indexOf(r.charAt(t)),!(e>64)){if(e<0)return!1;n+=6}return n%8===0}function constructYamlBinary(r){var e,t,n=r.replace(/[\r\n=]/g,""),s=n.length,a=BASE64_MAP,o=0,l=[];for(e=0;e<s;e++)e%4===0&&e&&(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)),o=o<<6|a.indexOf(n.charAt(e));return t=s%4*6,t===0?(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)):t===18?(l.push(o>>10&255),l.push(o>>2&255)):t===12&&l.push(o>>4&255),new Uint8Array(l)}function representYamlBinary(r){var e="",t=0,n,s,a=r.length,o=BASE64_MAP;for(n=0;n<a;n++)n%3===0&&n&&(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]),t=(t<<8)+r[n];return s=a%3,s===0?(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]):s===2?(e+=o[t>>10&63],e+=o[t>>4&63],e+=o[t<<2&63],e+=o[64]):s===1&&(e+=o[t>>2&63],e+=o[t<<4&63],e+=o[64],e+=o[64]),e}function isBinary(r){return Object.prototype.toString.call(r)==="[object Uint8Array]"}var binary=new type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),_hasOwnProperty$3=Object.prototype.hasOwnProperty,_toString$2=Object.prototype.toString;function resolveYamlOmap(r){if(r===null)return!0;var e=[],t,n,s,a,o,l=r;for(t=0,n=l.length;t<n;t+=1){if(s=l[t],o=!1,_toString$2.call(s)!=="[object Object]")return!1;for(a in s)if(_hasOwnProperty$3.call(s,a))if(!o)o=!0;else return!1;if(!o)return!1;if(e.indexOf(a)===-1)e.push(a);else return!1}return!0}function constructYamlOmap(r){return r!==null?r:[]}var omap=new type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),_toString$1=Object.prototype.toString;function resolveYamlPairs(r){if(r===null)return!0;var e,t,n,s,a,o=r;for(a=new Array(o.length),e=0,t=o.length;e<t;e+=1){if(n=o[e],_toString$1.call(n)!=="[object Object]"||(s=Object.keys(n),s.length!==1))return!1;a[e]=[s[0],n[s[0]]]}return!0}function constructYamlPairs(r){if(r===null)return[];var e,t,n,s,a,o=r;for(a=new Array(o.length),e=0,t=o.length;e<t;e+=1)n=o[e],s=Object.keys(n),a[e]=[s[0],n[s[0]]];return a}var pairs=new type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),_hasOwnProperty$2=Object.prototype.hasOwnProperty;function resolveYamlSet(r){if(r===null)return!0;var e,t=r;for(e in t)if(_hasOwnProperty$2.call(t,e)&&t[e]!==null)return!1;return!0}function constructYamlSet(r){return r!==null?r:{}}var set=new type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet});core.extend({implicit:[timestamp,merge],explicit:[binary,omap,pairs,set]});function simpleEscapeSequence(r){return r===48?"\0":r===97?"\x07":r===98?"\b":r===116||r===9?"	":r===110?`
`:r===118?"\v":r===102?"\f":r===114?"\r":r===101?"\x1B":r===32?" ":r===34?'"':r===47?"/":r===92?"\\":r===78?"":r===95?" ":r===76?"\u2028":r===80?"\u2029":""}var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256);for(var i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);var object_hash={exports:{}};(function(r,e){(function(t){r.exports=t()})(function(){return function t(n,s,a){function o(c,u){if(!s[c]){if(!n[c]){var h=typeof commonjsRequire=="function"&&commonjsRequire;if(!u&&h)return h(c,!0);if(l)return l(c,!0);throw new Error("Cannot find module '"+c+"'")}u=s[c]={exports:{}},n[c][0].call(u.exports,function(b){var A=n[c][1][b];return o(A||b)},u,u.exports,t,n,s,a)}return s[c].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,d=0;d<a.length;d++)o(a[d]);return o}({1:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){var w=t("crypto");function g(m,_){_=C(m,_);var f;return(f=_.algorithm!=="passthrough"?w.createHash(_.algorithm):new D).write===void 0&&(f.write=f.update,f.end=f.update),S(_,f).dispatch(m),f.update||f.end(""),f.digest?f.digest(_.encoding==="buffer"?void 0:_.encoding):(m=f.read(),_.encoding!=="buffer"?m.toString(_.encoding):m)}(s=n.exports=g).sha1=function(m){return g(m)},s.keys=function(m){return g(m,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},s.MD5=function(m){return g(m,{algorithm:"md5",encoding:"hex"})},s.keysMD5=function(m){return g(m,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var v=w.getHashes?w.getHashes().slice():["sha1","md5"],T=(v.push("passthrough"),["buffer","hex","binary","base64"]);function C(m,_){var f={};if(f.algorithm=(_=_||{}).algorithm||"sha1",f.encoding=_.encoding||"hex",f.excludeValues=!!_.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=_.ignoreUnknown===!0,f.respectType=_.respectType!==!1,f.respectFunctionNames=_.respectFunctionNames!==!1,f.respectFunctionProperties=_.respectFunctionProperties!==!1,f.unorderedArrays=_.unorderedArrays===!0,f.unorderedSets=_.unorderedSets!==!1,f.unorderedObjects=_.unorderedObjects!==!1,f.replacer=_.replacer||void 0,f.excludeKeys=_.excludeKeys||void 0,m===void 0)throw new Error("Object argument required.");for(var y=0;y<v.length;++y)v[y].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=v[y]);if(v.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+v.join(", "));if(T.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+T.join(", "));return f}function x(m){if(typeof m=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(m))!=null}function S(m,_,f){f=f||[];function y(p){return _.update?_.update(p,"utf8"):_.write(p,"utf8")}return{dispatch:function(p){return this["_"+((p=m.replacer?m.replacer(p):p)===null?"null":typeof p)](p)},_object:function(p){var k,L=Object.prototype.toString.call(p),X=/\[object (.*)\]/i.exec(L);if(X=(X=X?X[1]:"unknown:["+L+"]").toLowerCase(),0<=(L=f.indexOf(p)))return this.dispatch("[CIRCULAR:"+L+"]");if(f.push(p),l!==void 0&&l.isBuffer&&l.isBuffer(p))return y("buffer:"),y(p);if(X==="object"||X==="function"||X==="asyncfunction")return L=Object.keys(p),m.unorderedObjects&&(L=L.sort()),m.respectType===!1||x(p)||L.splice(0,0,"prototype","__proto__","constructor"),m.excludeKeys&&(L=L.filter(function(N){return!m.excludeKeys(N)})),y("object:"+L.length+":"),k=this,L.forEach(function(N){k.dispatch(N),y(":"),m.excludeValues||k.dispatch(p[N]),y(",")});if(!this["_"+X]){if(m.ignoreUnknown)return y("["+X+"]");throw new Error('Unknown object type "'+X+'"')}this["_"+X](p)},_array:function(p,N){N=N!==void 0?N:m.unorderedArrays!==!1;var L=this;if(y("array:"+p.length+":"),!N||p.length<=1)return p.forEach(function(q){return L.dispatch(q)});var X=[],N=p.map(function(q){var te=new D,oe=f.slice();return S(m,te,oe).dispatch(q),X=X.concat(oe.slice(f.length)),te.read().toString()});return f=f.concat(X),N.sort(),this._array(N,!1)},_date:function(p){return y("date:"+p.toJSON())},_symbol:function(p){return y("symbol:"+p.toString())},_error:function(p){return y("error:"+p.toString())},_boolean:function(p){return y("bool:"+p.toString())},_string:function(p){y("string:"+p.length+":"),y(p.toString())},_function:function(p){y("fn:"),x(p)?this.dispatch("[native]"):this.dispatch(p.toString()),m.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(p.name)),m.respectFunctionProperties&&this._object(p)},_number:function(p){return y("number:"+p.toString())},_xml:function(p){return y("xml:"+p.toString())},_null:function(){return y("Null")},_undefined:function(){return y("Undefined")},_regexp:function(p){return y("regex:"+p.toString())},_uint8array:function(p){return y("uint8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint8clampedarray:function(p){return y("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(p))},_int8array:function(p){return y("int8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint16array:function(p){return y("uint16array:"),this.dispatch(Array.prototype.slice.call(p))},_int16array:function(p){return y("int16array:"),this.dispatch(Array.prototype.slice.call(p))},_uint32array:function(p){return y("uint32array:"),this.dispatch(Array.prototype.slice.call(p))},_int32array:function(p){return y("int32array:"),this.dispatch(Array.prototype.slice.call(p))},_float32array:function(p){return y("float32array:"),this.dispatch(Array.prototype.slice.call(p))},_float64array:function(p){return y("float64array:"),this.dispatch(Array.prototype.slice.call(p))},_arraybuffer:function(p){return y("arraybuffer:"),this.dispatch(new Uint8Array(p))},_url:function(p){return y("url:"+p.toString())},_map:function(p){return y("map:"),p=Array.from(p),this._array(p,m.unorderedSets!==!1)},_set:function(p){return y("set:"),p=Array.from(p),this._array(p,m.unorderedSets!==!1)},_file:function(p){return y("file:"),this.dispatch([p.name,p.size,p.type,p.lastModfied])},_blob:function(){if(m.ignoreUnknown)return y("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return y("domwindow")},_bigint:function(p){return y("bigint:"+p.toString())},_process:function(){return y("process")},_timer:function(){return y("timer")},_pipe:function(){return y("pipe")},_tcp:function(){return y("tcp")},_udp:function(){return y("udp")},_tty:function(){return y("tty")},_statwatcher:function(){return y("statwatcher")},_securecontext:function(){return y("securecontext")},_connection:function(){return y("connection")},_zlib:function(){return y("zlib")},_context:function(){return y("context")},_nodescript:function(){return y("nodescript")},_httpparser:function(){return y("httpparser")},_dataview:function(){return y("dataview")},_signal:function(){return y("signal")},_fsevent:function(){return y("fsevent")},_tlswrap:function(){return y("tlswrap")}}}function D(){return{buf:"",write:function(m){this.buf+=m},end:function(m){this.buf+=m},read:function(){return this.buf}}}s.writeToStream=function(m,_,f){return f===void 0&&(f=_,_={}),S(_=C(m,_),f).dispatch(m)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){(function(w){var g=typeof Uint8Array<"u"?Uint8Array:Array,v="+".charCodeAt(0),T="/".charCodeAt(0),C="0".charCodeAt(0),x="a".charCodeAt(0),S="A".charCodeAt(0),D="-".charCodeAt(0),m="_".charCodeAt(0);function _(f){return f=f.charCodeAt(0),f===v||f===D?62:f===T||f===m?63:f<C?-1:f<C+10?f-C+26+26:f<S+26?f-S:f<x+26?f-x+26:void 0}w.toByteArray=function(f){var y,p;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var k=f.length,k=f.charAt(k-2)==="="?2:f.charAt(k-1)==="="?1:0,L=new g(3*f.length/4-k),X=0<k?f.length-4:f.length,N=0;function q(te){L[N++]=te}for(y=0;y<X;y+=4,0)q((16711680&(p=_(f.charAt(y))<<18|_(f.charAt(y+1))<<12|_(f.charAt(y+2))<<6|_(f.charAt(y+3))))>>16),q((65280&p)>>8),q(255&p);return k==2?q(255&(p=_(f.charAt(y))<<2|_(f.charAt(y+1))>>4)):k==1&&(q((p=_(f.charAt(y))<<10|_(f.charAt(y+1))<<4|_(f.charAt(y+2))>>2)>>8&255),q(255&p)),L},w.fromByteArray=function(f){var y,p,k,L,X=f.length%3,N="";function q(te){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(te)}for(y=0,k=f.length-X;y<k;y+=3)p=(f[y]<<16)+(f[y+1]<<8)+f[y+2],N+=q((L=p)>>18&63)+q(L>>12&63)+q(L>>6&63)+q(63&L);switch(X){case 1:N=(N+=q((p=f[f.length-1])>>2))+q(p<<4&63)+"==";break;case 2:N=(N=(N+=q((p=(f[f.length-2]<<8)+f[f.length-1])>>10))+q(p>>4&63))+q(p<<2&63)+"="}return N}})(s===void 0?this.base64js={}:s)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,s){(function(a,o,v,d,c,u,h,b,A){var w=t("base64-js"),g=t("ieee754");function v(E,O,M){if(!(this instanceof v))return new v(E,O,M);var K,Y,ne,ue,fe=typeof E;if(O==="base64"&&fe=="string")for(E=(ue=E).trim?ue.trim():ue.replace(/^\s+|\s+$/g,"");E.length%4!=0;)E+="=";if(fe=="number")K=Q(E);else if(fe=="string")K=v.byteLength(E,O);else{if(fe!="object")throw new Error("First argument needs to be a number, array or string.");K=Q(E.length)}if(v._useTypedArrays?Y=v._augment(new Uint8Array(K)):((Y=this).length=K,Y._isBuffer=!0),v._useTypedArrays&&typeof E.byteLength=="number")Y._set(E);else if(W(ue=E)||v.isBuffer(ue)||ue&&typeof ue=="object"&&typeof ue.length=="number")for(ne=0;ne<K;ne++)v.isBuffer(E)?Y[ne]=E.readUInt8(ne):Y[ne]=E[ne];else if(fe=="string")Y.write(E,0,O);else if(fe=="number"&&!v._useTypedArrays&&!M)for(ne=0;ne<K;ne++)Y[ne]=0;return Y}function T(E,O,M,K){return v._charsWritten=Oe(function(Y){for(var ne=[],ue=0;ue<Y.length;ue++)ne.push(255&Y.charCodeAt(ue));return ne}(O),E,M,K)}function C(E,O,M,K){return v._charsWritten=Oe(function(Y){for(var ne,ue,fe=[],we=0;we<Y.length;we++)ue=Y.charCodeAt(we),ne=ue>>8,ue=ue%256,fe.push(ue),fe.push(ne);return fe}(O),E,M,K)}function x(E,O,M){var K="";M=Math.min(E.length,M);for(var Y=O;Y<M;Y++)K+=String.fromCharCode(E[Y]);return K}function S(E,O,M,ne){ne||(U(typeof M=="boolean","missing or invalid endian"),U(O!=null,"missing offset"),U(O+1<E.length,"Trying to read beyond buffer length"));var Y,ne=E.length;if(!(ne<=O))return M?(Y=E[O],O+1<ne&&(Y|=E[O+1]<<8)):(Y=E[O]<<8,O+1<ne&&(Y|=E[O+1])),Y}function D(E,O,M,ne){ne||(U(typeof M=="boolean","missing or invalid endian"),U(O!=null,"missing offset"),U(O+3<E.length,"Trying to read beyond buffer length"));var Y,ne=E.length;if(!(ne<=O))return M?(O+2<ne&&(Y=E[O+2]<<16),O+1<ne&&(Y|=E[O+1]<<8),Y|=E[O],O+3<ne&&(Y+=E[O+3]<<24>>>0)):(O+1<ne&&(Y=E[O+1]<<16),O+2<ne&&(Y|=E[O+2]<<8),O+3<ne&&(Y|=E[O+3]),Y+=E[O]<<24>>>0),Y}function m(E,O,M,K){if(K||(U(typeof M=="boolean","missing or invalid endian"),U(O!=null,"missing offset"),U(O+1<E.length,"Trying to read beyond buffer length")),!(E.length<=O))return K=S(E,O,M,!0),32768&K?-1*(65535-K+1):K}function _(E,O,M,K){if(K||(U(typeof M=="boolean","missing or invalid endian"),U(O!=null,"missing offset"),U(O+3<E.length,"Trying to read beyond buffer length")),!(E.length<=O))return K=D(E,O,M,!0),2147483648&K?-1*(4294967295-K+1):K}function f(E,O,M,K){return K||(U(typeof M=="boolean","missing or invalid endian"),U(O+3<E.length,"Trying to read beyond buffer length")),g.read(E,O,M,23,4)}function y(E,O,M,K){return K||(U(typeof M=="boolean","missing or invalid endian"),U(O+7<E.length,"Trying to read beyond buffer length")),g.read(E,O,M,52,8)}function p(E,O,M,K,Y){if(Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+1<E.length,"trying to write beyond buffer length"),F(O,65535)),Y=E.length,!(Y<=M))for(var ne=0,ue=Math.min(Y-M,2);ne<ue;ne++)E[M+ne]=(O&255<<8*(K?ne:1-ne))>>>8*(K?ne:1-ne)}function k(E,O,M,K,Y){if(Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+3<E.length,"trying to write beyond buffer length"),F(O,4294967295)),Y=E.length,!(Y<=M))for(var ne=0,ue=Math.min(Y-M,4);ne<ue;ne++)E[M+ne]=O>>>8*(K?ne:3-ne)&255}function L(E,O,M,K,Y){Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+1<E.length,"Trying to write beyond buffer length"),I(O,32767,-32768)),E.length<=M||p(E,0<=O?O:65535+O+1,M,K,Y)}function X(E,O,M,K,Y){Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+3<E.length,"Trying to write beyond buffer length"),I(O,2147483647,-2147483648)),E.length<=M||k(E,0<=O?O:4294967295+O+1,M,K,Y)}function N(E,O,M,K,Y){Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+3<E.length,"Trying to write beyond buffer length"),$(O,34028234663852886e22,-34028234663852886e22)),E.length<=M||g.write(E,O,M,K,23,4)}function q(E,O,M,K,Y){Y||(U(O!=null,"missing value"),U(typeof K=="boolean","missing or invalid endian"),U(M!=null,"missing offset"),U(M+7<E.length,"Trying to write beyond buffer length"),$(O,17976931348623157e292,-17976931348623157e292)),E.length<=M||g.write(E,O,M,K,52,8)}s.Buffer=v,s.SlowBuffer=v,s.INSPECT_MAX_BYTES=50,v.poolSize=8192,v._useTypedArrays=function(){try{var E=new ArrayBuffer(0),O=new Uint8Array(E);return O.foo=function(){return 42},O.foo()===42&&typeof O.subarray=="function"}catch{return!1}}(),v.isEncoding=function(E){switch(String(E).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.isBuffer=function(E){return!(E==null||!E._isBuffer)},v.byteLength=function(E,O){var M;switch(E+="",O||"utf8"){case"hex":M=E.length/2;break;case"utf8":case"utf-8":M=he(E).length;break;case"ascii":case"binary":case"raw":M=E.length;break;case"base64":M=_e(E).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=2*E.length;break;default:throw new Error("Unknown encoding")}return M},v.concat=function(E,O){if(U(W(E),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),E.length===0)return new v(0);if(E.length===1)return E[0];if(typeof O!="number")for(Y=O=0;Y<E.length;Y++)O+=E[Y].length;for(var M=new v(O),K=0,Y=0;Y<E.length;Y++){var ne=E[Y];ne.copy(M,K),K+=ne.length}return M},v.prototype.write=function(E,O,M,K){isFinite(O)?isFinite(M)||(K=M,M=void 0):(we=K,K=O,O=M,M=we),O=Number(O)||0;var Y,ne,ue,fe,we=this.length-O;switch((!M||we<(M=Number(M)))&&(M=we),K=String(K||"utf8").toLowerCase()){case"hex":Y=function(me,Ce,Re,Te){Re=Number(Re)||0;var ye=me.length-Re;(!Te||ye<(Te=Number(Te)))&&(Te=ye),U((ye=Ce.length)%2==0,"Invalid hex string"),ye/2<Te&&(Te=ye/2);for(var ae=0;ae<Te;ae++){var ie=parseInt(Ce.substr(2*ae,2),16);U(!isNaN(ie),"Invalid hex string"),me[Re+ae]=ie}return v._charsWritten=2*ae,ae}(this,E,O,M);break;case"utf8":case"utf-8":ne=this,ue=O,fe=M,Y=v._charsWritten=Oe(he(E),ne,ue,fe);break;case"ascii":case"binary":Y=T(this,E,O,M);break;case"base64":ne=this,ue=O,fe=M,Y=v._charsWritten=Oe(_e(E),ne,ue,fe);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Y=C(this,E,O,M);break;default:throw new Error("Unknown encoding")}return Y},v.prototype.toString=function(E,O,M){var K,Y,ne,ue,fe=this;if(E=String(E||"utf8").toLowerCase(),O=Number(O)||0,(M=M!==void 0?Number(M):fe.length)===O)return"";switch(E){case"hex":K=function(we,me,Ce){var Re=we.length;(!me||me<0)&&(me=0),(!Ce||Ce<0||Re<Ce)&&(Ce=Re);for(var Te="",ye=me;ye<Ce;ye++)Te+=pe(we[ye]);return Te}(fe,O,M);break;case"utf8":case"utf-8":K=function(we,me,Ce){var Re="",Te="";Ce=Math.min(we.length,Ce);for(var ye=me;ye<Ce;ye++)we[ye]<=127?(Re+=J(Te)+String.fromCharCode(we[ye]),Te=""):Te+="%"+we[ye].toString(16);return Re+J(Te)}(fe,O,M);break;case"ascii":case"binary":K=x(fe,O,M);break;case"base64":Y=fe,ue=M,K=(ne=O)===0&&ue===Y.length?w.fromByteArray(Y):w.fromByteArray(Y.slice(ne,ue));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":K=function(we,me,Ce){for(var Re=we.slice(me,Ce),Te="",ye=0;ye<Re.length;ye+=2)Te+=String.fromCharCode(Re[ye]+256*Re[ye+1]);return Te}(fe,O,M);break;default:throw new Error("Unknown encoding")}return K},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},v.prototype.copy=function(E,O,M,K){if(O=O||0,(K=K||K===0?K:this.length)!==(M=M||0)&&E.length!==0&&this.length!==0){U(M<=K,"sourceEnd < sourceStart"),U(0<=O&&O<E.length,"targetStart out of bounds"),U(0<=M&&M<this.length,"sourceStart out of bounds"),U(0<=K&&K<=this.length,"sourceEnd out of bounds"),K>this.length&&(K=this.length);var Y=(K=E.length-O<K-M?E.length-O+M:K)-M;if(Y<100||!v._useTypedArrays)for(var ne=0;ne<Y;ne++)E[ne+O]=this[ne+M];else E._set(this.subarray(M,M+Y),O)}},v.prototype.slice=function(E,O){var M=this.length;if(E=oe(E,M,0),O=oe(O,M,M),v._useTypedArrays)return v._augment(this.subarray(E,O));for(var K=O-E,Y=new v(K,void 0,!0),ne=0;ne<K;ne++)Y[ne]=this[ne+E];return Y},v.prototype.get=function(E){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(E)},v.prototype.set=function(E,O){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(E,O)},v.prototype.readUInt8=function(E,O){if(O||(U(E!=null,"missing offset"),U(E<this.length,"Trying to read beyond buffer length")),!(E>=this.length))return this[E]},v.prototype.readUInt16LE=function(E,O){return S(this,E,!0,O)},v.prototype.readUInt16BE=function(E,O){return S(this,E,!1,O)},v.prototype.readUInt32LE=function(E,O){return D(this,E,!0,O)},v.prototype.readUInt32BE=function(E,O){return D(this,E,!1,O)},v.prototype.readInt8=function(E,O){if(O||(U(E!=null,"missing offset"),U(E<this.length,"Trying to read beyond buffer length")),!(E>=this.length))return 128&this[E]?-1*(255-this[E]+1):this[E]},v.prototype.readInt16LE=function(E,O){return m(this,E,!0,O)},v.prototype.readInt16BE=function(E,O){return m(this,E,!1,O)},v.prototype.readInt32LE=function(E,O){return _(this,E,!0,O)},v.prototype.readInt32BE=function(E,O){return _(this,E,!1,O)},v.prototype.readFloatLE=function(E,O){return f(this,E,!0,O)},v.prototype.readFloatBE=function(E,O){return f(this,E,!1,O)},v.prototype.readDoubleLE=function(E,O){return y(this,E,!0,O)},v.prototype.readDoubleBE=function(E,O){return y(this,E,!1,O)},v.prototype.writeUInt8=function(E,O,M){M||(U(E!=null,"missing value"),U(O!=null,"missing offset"),U(O<this.length,"trying to write beyond buffer length"),F(E,255)),O>=this.length||(this[O]=E)},v.prototype.writeUInt16LE=function(E,O,M){p(this,E,O,!0,M)},v.prototype.writeUInt16BE=function(E,O,M){p(this,E,O,!1,M)},v.prototype.writeUInt32LE=function(E,O,M){k(this,E,O,!0,M)},v.prototype.writeUInt32BE=function(E,O,M){k(this,E,O,!1,M)},v.prototype.writeInt8=function(E,O,M){M||(U(E!=null,"missing value"),U(O!=null,"missing offset"),U(O<this.length,"Trying to write beyond buffer length"),I(E,127,-128)),O>=this.length||(0<=E?this.writeUInt8(E,O,M):this.writeUInt8(255+E+1,O,M))},v.prototype.writeInt16LE=function(E,O,M){L(this,E,O,!0,M)},v.prototype.writeInt16BE=function(E,O,M){L(this,E,O,!1,M)},v.prototype.writeInt32LE=function(E,O,M){X(this,E,O,!0,M)},v.prototype.writeInt32BE=function(E,O,M){X(this,E,O,!1,M)},v.prototype.writeFloatLE=function(E,O,M){N(this,E,O,!0,M)},v.prototype.writeFloatBE=function(E,O,M){N(this,E,O,!1,M)},v.prototype.writeDoubleLE=function(E,O,M){q(this,E,O,!0,M)},v.prototype.writeDoubleBE=function(E,O,M){q(this,E,O,!1,M)},v.prototype.fill=function(E,O,M){if(O=O||0,M=M||this.length,U(typeof(E=typeof(E=E||0)=="string"?E.charCodeAt(0):E)=="number"&&!isNaN(E),"value is not a number"),U(O<=M,"end < start"),M!==O&&this.length!==0){U(0<=O&&O<this.length,"start out of bounds"),U(0<=M&&M<=this.length,"end out of bounds");for(var K=O;K<M;K++)this[K]=E}},v.prototype.inspect=function(){for(var E=[],O=this.length,M=0;M<O;M++)if(E[M]=pe(this[M]),M===s.INSPECT_MAX_BYTES){E[M+1]="...";break}return"<Buffer "+E.join(" ")+">"},v.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(v._useTypedArrays)return new v(this).buffer;for(var E=new Uint8Array(this.length),O=0,M=E.length;O<M;O+=1)E[O]=this[O];return E.buffer};var te=v.prototype;function oe(E,O,M){return typeof E!="number"?M:O<=(E=~~E)?O:0<=E||0<=(E+=O)?E:0}function Q(E){return(E=~~Math.ceil(+E))<0?0:E}function W(E){return(Array.isArray||function(O){return Object.prototype.toString.call(O)==="[object Array]"})(E)}function pe(E){return E<16?"0"+E.toString(16):E.toString(16)}function he(E){for(var O=[],M=0;M<E.length;M++){var K=E.charCodeAt(M);if(K<=127)O.push(E.charCodeAt(M));else for(var Y=M,ne=(55296<=K&&K<=57343&&M++,encodeURIComponent(E.slice(Y,M+1)).substr(1).split("%")),ue=0;ue<ne.length;ue++)O.push(parseInt(ne[ue],16))}return O}function _e(E){return w.toByteArray(E)}function Oe(E,O,M,K){for(var Y=0;Y<K&&!(Y+M>=O.length||Y>=E.length);Y++)O[Y+M]=E[Y];return Y}function J(E){try{return decodeURIComponent(E)}catch{return String.fromCharCode(65533)}}function F(E,O){U(typeof E=="number","cannot write a non-number as a number"),U(0<=E,"specified a negative value for writing an unsigned value"),U(E<=O,"value is larger than maximum value for type"),U(Math.floor(E)===E,"value has a fractional component")}function I(E,O,M){U(typeof E=="number","cannot write a non-number as a number"),U(E<=O,"value larger than maximum allowed value"),U(M<=E,"value smaller than minimum allowed value"),U(Math.floor(E)===E,"value has a fractional component")}function $(E,O,M){U(typeof E=="number","cannot write a non-number as a number"),U(E<=O,"value larger than maximum allowed value"),U(M<=E,"value smaller than minimum allowed value")}function U(E,O){if(!E)throw new Error(O||"Failed assertion")}v._augment=function(E){return E._isBuffer=!0,E._get=E.get,E._set=E.set,E.get=te.get,E.set=te.set,E.write=te.write,E.toString=te.toString,E.toLocaleString=te.toString,E.toJSON=te.toJSON,E.copy=te.copy,E.slice=te.slice,E.readUInt8=te.readUInt8,E.readUInt16LE=te.readUInt16LE,E.readUInt16BE=te.readUInt16BE,E.readUInt32LE=te.readUInt32LE,E.readUInt32BE=te.readUInt32BE,E.readInt8=te.readInt8,E.readInt16LE=te.readInt16LE,E.readInt16BE=te.readInt16BE,E.readInt32LE=te.readInt32LE,E.readInt32BE=te.readInt32BE,E.readFloatLE=te.readFloatLE,E.readFloatBE=te.readFloatBE,E.readDoubleLE=te.readDoubleLE,E.readDoubleBE=te.readDoubleBE,E.writeUInt8=te.writeUInt8,E.writeUInt16LE=te.writeUInt16LE,E.writeUInt16BE=te.writeUInt16BE,E.writeUInt32LE=te.writeUInt32LE,E.writeUInt32BE=te.writeUInt32BE,E.writeInt8=te.writeInt8,E.writeInt16LE=te.writeInt16LE,E.writeInt16BE=te.writeInt16BE,E.writeInt32LE=te.writeInt32LE,E.writeInt32BE=te.writeInt32BE,E.writeFloatLE=te.writeFloatLE,E.writeFloatBE=te.writeFloatBE,E.writeDoubleLE=te.writeDoubleLE,E.writeDoubleBE=te.writeDoubleBE,E.fill=te.fill,E.inspect=te.inspect,E.toArrayBuffer=te.toArrayBuffer,E}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,s){(function(a,o,w,d,c,u,h,b,A){var w=t("buffer").Buffer,g=4,v=new w(g);v.fill(0),n.exports={hash:function(T,C,x,S){for(var D=C(function(p,k){p.length%g!=0&&(L=p.length+(g-p.length%g),p=w.concat([p,v],L));for(var L,X=[],N=k?p.readInt32BE:p.readInt32LE,q=0;q<p.length;q+=g)X.push(N.call(p,q));return X}(T=w.isBuffer(T)?T:new w(T),S),8*T.length),C=S,m=new w(x),_=C?m.writeInt32BE:m.writeInt32LE,f=0;f<D.length;f++)_.call(m,D[f],4*f,!0);return m}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,s){(function(a,o,w,d,c,u,h,b,A){var w=t("buffer").Buffer,g=t("./sha"),v=t("./sha256"),T=t("./rng"),C={sha1:g,sha256:v,md5:t("./md5")},x=64,S=new w(x);function D(p,k){var L=C[p=p||"sha1"],X=[];return L||m("algorithm:",p,"is not yet supported"),{update:function(N){return w.isBuffer(N)||(N=new w(N)),X.push(N),N.length,this},digest:function(N){var q=w.concat(X),q=k?function(te,oe,Q){w.isBuffer(oe)||(oe=new w(oe)),w.isBuffer(Q)||(Q=new w(Q)),oe.length>x?oe=te(oe):oe.length<x&&(oe=w.concat([oe,S],x));for(var W=new w(x),pe=new w(x),he=0;he<x;he++)W[he]=54^oe[he],pe[he]=92^oe[he];return Q=te(w.concat([W,Q])),te(w.concat([pe,Q]))}(L,k,q):L(q);return X=null,N?q.toString(N):q}}}function m(){var p=[].slice.call(arguments).join(" ");throw new Error([p,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}S.fill(0),s.createHash=function(p){return D(p)},s.createHmac=D,s.randomBytes=function(p,k){if(!k||!k.call)return new w(T(p));try{k.call(this,void 0,new w(T(p)))}catch(L){k(L)}};var _,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],y=function(p){s[p]=function(){m("sorry,",p,"is not implemented yet")}};for(_ in f)y(f[_])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){var w=t("./helpers");function g(m,_){m[_>>5]|=128<<_%32,m[14+(_+64>>>9<<4)]=_;for(var f=1732584193,y=-271733879,p=-1732584194,k=271733878,L=0;L<m.length;L+=16){var X=f,N=y,q=p,te=k,f=T(f,y,p,k,m[L+0],7,-680876936),k=T(k,f,y,p,m[L+1],12,-389564586),p=T(p,k,f,y,m[L+2],17,606105819),y=T(y,p,k,f,m[L+3],22,-1044525330);f=T(f,y,p,k,m[L+4],7,-176418897),k=T(k,f,y,p,m[L+5],12,1200080426),p=T(p,k,f,y,m[L+6],17,-1473231341),y=T(y,p,k,f,m[L+7],22,-45705983),f=T(f,y,p,k,m[L+8],7,1770035416),k=T(k,f,y,p,m[L+9],12,-1958414417),p=T(p,k,f,y,m[L+10],17,-42063),y=T(y,p,k,f,m[L+11],22,-1990404162),f=T(f,y,p,k,m[L+12],7,1804603682),k=T(k,f,y,p,m[L+13],12,-40341101),p=T(p,k,f,y,m[L+14],17,-1502002290),f=C(f,y=T(y,p,k,f,m[L+15],22,1236535329),p,k,m[L+1],5,-165796510),k=C(k,f,y,p,m[L+6],9,-1069501632),p=C(p,k,f,y,m[L+11],14,643717713),y=C(y,p,k,f,m[L+0],20,-373897302),f=C(f,y,p,k,m[L+5],5,-701558691),k=C(k,f,y,p,m[L+10],9,38016083),p=C(p,k,f,y,m[L+15],14,-660478335),y=C(y,p,k,f,m[L+4],20,-405537848),f=C(f,y,p,k,m[L+9],5,568446438),k=C(k,f,y,p,m[L+14],9,-1019803690),p=C(p,k,f,y,m[L+3],14,-187363961),y=C(y,p,k,f,m[L+8],20,1163531501),f=C(f,y,p,k,m[L+13],5,-1444681467),k=C(k,f,y,p,m[L+2],9,-51403784),p=C(p,k,f,y,m[L+7],14,1735328473),f=x(f,y=C(y,p,k,f,m[L+12],20,-1926607734),p,k,m[L+5],4,-378558),k=x(k,f,y,p,m[L+8],11,-2022574463),p=x(p,k,f,y,m[L+11],16,1839030562),y=x(y,p,k,f,m[L+14],23,-35309556),f=x(f,y,p,k,m[L+1],4,-1530992060),k=x(k,f,y,p,m[L+4],11,1272893353),p=x(p,k,f,y,m[L+7],16,-155497632),y=x(y,p,k,f,m[L+10],23,-1094730640),f=x(f,y,p,k,m[L+13],4,681279174),k=x(k,f,y,p,m[L+0],11,-358537222),p=x(p,k,f,y,m[L+3],16,-722521979),y=x(y,p,k,f,m[L+6],23,76029189),f=x(f,y,p,k,m[L+9],4,-640364487),k=x(k,f,y,p,m[L+12],11,-421815835),p=x(p,k,f,y,m[L+15],16,530742520),f=S(f,y=x(y,p,k,f,m[L+2],23,-995338651),p,k,m[L+0],6,-198630844),k=S(k,f,y,p,m[L+7],10,1126891415),p=S(p,k,f,y,m[L+14],15,-1416354905),y=S(y,p,k,f,m[L+5],21,-57434055),f=S(f,y,p,k,m[L+12],6,1700485571),k=S(k,f,y,p,m[L+3],10,-1894986606),p=S(p,k,f,y,m[L+10],15,-1051523),y=S(y,p,k,f,m[L+1],21,-2054922799),f=S(f,y,p,k,m[L+8],6,1873313359),k=S(k,f,y,p,m[L+15],10,-30611744),p=S(p,k,f,y,m[L+6],15,-1560198380),y=S(y,p,k,f,m[L+13],21,1309151649),f=S(f,y,p,k,m[L+4],6,-145523070),k=S(k,f,y,p,m[L+11],10,-1120210379),p=S(p,k,f,y,m[L+2],15,718787259),y=S(y,p,k,f,m[L+9],21,-343485551),f=D(f,X),y=D(y,N),p=D(p,q),k=D(k,te)}return Array(f,y,p,k)}function v(m,_,f,y,p,k){return D((_=D(D(_,m),D(y,k)))<<p|_>>>32-p,f)}function T(m,_,f,y,p,k,L){return v(_&f|~_&y,m,_,p,k,L)}function C(m,_,f,y,p,k,L){return v(_&y|f&~y,m,_,p,k,L)}function x(m,_,f,y,p,k,L){return v(_^f^y,m,_,p,k,L)}function S(m,_,f,y,p,k,L){return v(f^(_|~y),m,_,p,k,L)}function D(m,_){var f=(65535&m)+(65535&_);return(m>>16)+(_>>16)+(f>>16)<<16|65535&f}n.exports=function(m){return w.hash(m,g,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){n.exports=function(w){for(var g,v=new Array(w),T=0;T<w;T++)!(3&T)&&(g=4294967296*Math.random()),v[T]=g>>>((3&T)<<3)&255;return v}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){var w=t("./helpers");function g(C,x){C[x>>5]|=128<<24-x%32,C[15+(x+64>>9<<4)]=x;for(var S,D,m,_=Array(80),f=1732584193,y=-271733879,p=-1732584194,k=271733878,L=-1009589776,X=0;X<C.length;X+=16){for(var N=f,q=y,te=p,oe=k,Q=L,W=0;W<80;W++){_[W]=W<16?C[X+W]:T(_[W-3]^_[W-8]^_[W-14]^_[W-16],1);var pe=v(v(T(f,5),(pe=y,D=p,m=k,(S=W)<20?pe&D|~pe&m:!(S<40)&&S<60?pe&D|pe&m|D&m:pe^D^m)),v(v(L,_[W]),(S=W)<20?1518500249:S<40?1859775393:S<60?-1894007588:-899497514)),L=k,k=p,p=T(y,30),y=f,f=pe}f=v(f,N),y=v(y,q),p=v(p,te),k=v(k,oe),L=v(L,Q)}return Array(f,y,p,k,L)}function v(C,x){var S=(65535&C)+(65535&x);return(C>>16)+(x>>16)+(S>>16)<<16|65535&S}function T(C,x){return C<<x|C>>>32-x}n.exports=function(C){return w.hash(C,g,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){function w(x,S){var D=(65535&x)+(65535&S);return(x>>16)+(S>>16)+(D>>16)<<16|65535&D}function g(x,S){var D,m=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),_=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);x[S>>5]|=128<<24-S%32,x[15+(S+64>>9<<4)]=S;for(var y,p,k=0;k<x.length;k+=16){for(var L=_[0],X=_[1],N=_[2],q=_[3],te=_[4],oe=_[5],Q=_[6],W=_[7],pe=0;pe<64;pe++)f[pe]=pe<16?x[pe+k]:w(w(w((p=f[pe-2],T(p,17)^T(p,19)^C(p,10)),f[pe-7]),(p=f[pe-15],T(p,7)^T(p,18)^C(p,3))),f[pe-16]),D=w(w(w(w(W,T(p=te,6)^T(p,11)^T(p,25)),te&oe^~te&Q),m[pe]),f[pe]),y=w(T(y=L,2)^T(y,13)^T(y,22),L&X^L&N^X&N),W=Q,Q=oe,oe=te,te=w(q,D),q=N,N=X,X=L,L=w(D,y);_[0]=w(L,_[0]),_[1]=w(X,_[1]),_[2]=w(N,_[2]),_[3]=w(q,_[3]),_[4]=w(te,_[4]),_[5]=w(oe,_[5]),_[6]=w(Q,_[6]),_[7]=w(W,_[7])}return _}var v=t("./helpers"),T=function(x,S){return x>>>S|x<<32-S},C=function(x,S){return x>>>S};n.exports=function(x){return v.hash(x,g,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){s.read=function(w,g,v,T,k){var x,S,D=8*k-T-1,m=(1<<D)-1,_=m>>1,f=-7,y=v?k-1:0,p=v?-1:1,k=w[g+y];for(y+=p,x=k&(1<<-f)-1,k>>=-f,f+=D;0<f;x=256*x+w[g+y],y+=p,f-=8);for(S=x&(1<<-f)-1,x>>=-f,f+=T;0<f;S=256*S+w[g+y],y+=p,f-=8);if(x===0)x=1-_;else{if(x===m)return S?NaN:1/0*(k?-1:1);S+=Math.pow(2,T),x-=_}return(k?-1:1)*S*Math.pow(2,x-T)},s.write=function(w,g,v,T,C,L){var S,D,m=8*L-C-1,_=(1<<m)-1,f=_>>1,y=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=T?0:L-1,k=T?1:-1,L=g<0||g===0&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(D=isNaN(g)?1:0,S=_):(S=Math.floor(Math.log(g)/Math.LN2),g*(T=Math.pow(2,-S))<1&&(S--,T*=2),2<=(g+=1<=S+f?y/T:y*Math.pow(2,1-f))*T&&(S++,T/=2),_<=S+f?(D=0,S=_):1<=S+f?(D=(g*T-1)*Math.pow(2,C),S+=f):(D=g*Math.pow(2,f-1)*Math.pow(2,C),S=0));8<=C;w[v+p]=255&D,p+=k,D/=256,C-=8);for(S=S<<C|D,m+=C;0<m;w[v+p]=255&S,p+=k,S/=256,m-=8);w[v+p-k]|=128*L}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,s){(function(a,o,l,d,c,u,h,b,A){var w,g,v;function T(){}(a=n.exports={}).nextTick=(g=typeof window<"u"&&window.setImmediate,v=typeof window<"u"&&window.postMessage&&window.addEventListener,g?function(C){return window.setImmediate(C)}:v?(w=[],window.addEventListener("message",function(C){var x=C.source;x!==window&&x!==null||C.data!=="process-tick"||(C.stopPropagation(),0<w.length&&w.shift()())},!0),function(C){w.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),a.title="browser",a.browser=!0,a.env={},a.argv=[],a.on=T,a.addListener=T,a.once=T,a.off=T,a.removeListener=T,a.removeAllListeners=T,a.emit=T,a.binding=function(C){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(object_hash);var object_hashExports=object_hash.exports;const hash=getDefaultExportFromCjs(object_hashExports),getCacheKey=(...r)=>hash(r.join("_")),GLOBAL_MAP=new Map;class InMemoryCache extends BaseCache{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(getCacheKey(e,t))??null)}async update(e,t,n){this.cache.set(getCacheKey(e,t),n)}static global(){return new InMemoryCache(GLOBAL_MAP)}}class BaseLLM extends BaseLanguageModel{constructor({cache:e,concurrency:t,...n}){super(t?{maxConcurrency:t,...n}:n),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="object"?this.cache=e:e?this.cache=InMemoryCache.global():this.cache=void 0}async generatePrompt(e,t,n){const s=e.map(a=>a.toString());return this.generate(s,t,n)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let n=0;n<e.generations.length;n+=1){const s=e.generations[n];if(n===0)t.push({generations:[s],llmOutput:e.llmOutput});else{const a=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[s],llmOutput:a})}}return t}async _generateUncached(e,t,n){const s=await CallbackManager.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this==null?void 0:this.invocationParams(t)},o=await(s==null?void 0:s.handleLLMStart(this.toJSON(),e,void 0,void 0,a));let l;try{l=await this._generate(e,t,o==null?void 0:o[0])}catch(u){throw await Promise.all((o??[]).map(h=>h==null?void 0:h.handleLLMError(u))),u}const d=this._flattenLLMResult(l);await Promise.all((o??[]).map((u,h)=>u==null?void 0:u.handleLLMEnd(d[h])));const c=(o==null?void 0:o.map(u=>u.runId))||void 0;return Object.defineProperty(l,RUN_KEY,{value:c?{runIds:c}:void 0,configurable:!0}),l}async generate(e,t,n){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let s;Array.isArray(t)?s={stop:t}:t!=null&&t.timeout&&!t.signal?s={...t,signal:AbortSignal.timeout(t.timeout)}:s=t??{};const a={tags:s.tags,metadata:s.metadata,callbacks:s.callbacks??n};if(delete s.tags,delete s.metadata,delete s.callbacks,!this.cache)return this._generateUncached(e,s,a);const{cache:o}=this,l=this.serialize();l.stop=s.stop??l.stop;const d=`${Object.entries(l).sort()}`,c=[],u=await Promise.all(e.map(async(b,A)=>{const w=await o.lookup(b,d);return w||c.push(A),w}));let h={};if(c.length>0){const b=await this._generateUncached(c.map(A=>e[A]),s,a);await Promise.all(b.generations.map(async(A,w)=>{const g=c[w];return u[g]=A,o.update(e[g],d,A)})),h=b.llmOutput??{}}return{generations:u,llmOutput:h}}async call(e,t,n){const{generations:s}=await this.generate([e],t??{},n);return s[0][0].text}async predict(e,t,n){return this.call(e,t,n)}async predictMessages(e,t,n){const s=getBufferString(e),a=await this.call(s,t,n);return new AIMessage(a)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static async deserialize(e){const{_type:t,_model:n,...s}=e;if(n&&n!=="base_llm")throw new Error(`Cannot load LLM with model ${n}`);const a={openai:(await __vitePreload(()=>import("./openai.564ba7e6.js"),["_app/immutable/chunks/openai.564ba7e6.js","_app/immutable/chunks/prompt-layer.00daf386.js"])).OpenAI}[t];if(a===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new a(s)}}class LLM extends BaseLLM{async _generate(e,t,n){return{generations:await Promise.all(e.map((a,o)=>this._call(a,{...t,promptIndex:o},n).then(l=>[{text:l}])))}}}class HuggingFaceInference extends LLM{get lc_secrets(){return{apiKey:"HUGGINGFACEHUB_API_KEY"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt2"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=(e==null?void 0:e.model)??this.model,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.topK=(e==null?void 0:e.topK)??this.topK,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.apiKey=(e==null?void 0:e.apiKey)??getEnvironmentVariable$1("HUGGINGFACEHUB_API_KEY"),!this.apiKey)throw new Error("Please set an API key for HuggingFace Hub in the environment variable HUGGINGFACEHUB_API_KEY or in the apiKey field of the HuggingFaceInference constructor.")}_llmType(){return"hf"}async _call(e,t){const{HfInference:n}=await HuggingFaceInference.imports(),s=new n(this.apiKey);return(await this.caller.callWithOptions({signal:t.signal},s.textGeneration.bind(s),{model:this.model,parameters:{return_full_text:!1,temperature:this.temperature,max_new_tokens:this.maxTokens,top_p:this.topP,top_k:this.topK,repetition_penalty:this.frequencyPenalty},inputs:e})).generated_text}static async imports(){try{const{HfInference:e}=await __vitePreload(()=>Promise.resolve().then(()=>index),void 0);return{HfInference:e}}catch{throw new Error("Please install huggingface as a dependency with, e.g. `yarn add @huggingface/inference`")}}}async function chatWithDoc(r,e,t,n,s){const a=s;console.log("model",t);const o=new HuggingFaceInference({apiKey:r,model:"tiiuae/falcon-7b-instruct",maxTokens:5e3}),l=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);let d=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});const u=await new SupabaseVectorStore(d,{client:l,tableName:"documents"}).similaritySearch(a);console.log(u.length),console.log(u);try{let{data:A,error:w}=await l.from("documents").select("content");w&&console.error("Error fetching data:",w.message),A.length===0&&console.log("No data found in the table.");const g=A[0].content;console.log("contentValue",g)}catch(A){console.error("Error fetching data:",A.message)}const b=await loadQAStuffChain(o).call({input_documents:u,question:a});return console.log("result",b),console.log(b.text),b.text}async function getDocuments(r){const n=(await r.from("documents").select("name:metadata->>file_name, size:metadata->>file_size",{count:"exact"})).data.reduce((s,a)=>(s.find(l=>l.name===a.name)||s.push(a),s),[]);return n.sort((s,a)=>parseInt(a.size)-parseInt(s.size)),n}function brain(r,e){r.from("documents").select("name:metadata->>file_name, size:metadata->>file_size",{count:"exact"}).then(t=>{const s=t.data.reduce((d,c)=>(d.find(h=>h.name===c.name)||d.push(c),d),[]);s.sort((d,c)=>parseInt(c.size)-parseInt(d.size));const a=s.length,o=s.reduce((d,c)=>d+parseInt(c.size),0),l=document.getElementById("displayText");l.innerHTML=`
        <p>Total Documents: ${a}</p>
        <p>Total Size (bytes): ${o}</p>
      `,s.forEach(d=>{`${d.name}`,l.innerHTML+=`
        <p><strong>${d.name}</strong> (${d.size} bytes) <button data-doc-name="${d.name}" onclick="handleDeleteDocument(event)">❌</button></p>
      `})}).catch(t=>{console.error("Error:",t)})}async function deleteDocument(r,e){try{return(await r.from("documents").delete().match({"metadata->>file_name":e})).error==null}catch(t){return console.error("Error:",t),!1}}const{console:console_1$2}=globals,file$4="src/lib/AuthCheck.svelte";function create_catch_block(r){let e,t,n=r[5].message+"",s;const a={c:function(){e=element("p"),t=text("Error: "),s=text(n),this.h()},l:function(l){e=claim_element(l,"P",{class:!0});var d=children(e);t=claim_text(d,"Error: "),s=claim_text(d,n),d.forEach(detach_dev),this.h()},h:function(){attr_dev(e,"class","text-center text-danger"),add_location(e,file$4,42,2,839)},m:function(l,d){insert_hydration_dev(l,e,d),append_hydration_dev(e,t),append_hydration_dev(e,s)},p:noop$1,i:noop$1,o:noop$1,d:function(l){l&&detach_dev(e)}};return dispatch_dev("SvelteRegisterBlock",{block:a,id:create_catch_block.name,type:"catch",source:"(31:0) {:catch error}",ctx:r}),a}function create_then_block(r){let e,t,n,s;const a=[create_if_block$2,create_else_block],o=[];function l(c,u){var h;return(h=c[4])!=null&&h.user?0:1}e=l(r),t=o[e]=a[e](r);const d={c:function(){t.c(),n=empty$1()},l:function(u){t.l(u),n=empty$1()},m:function(u,h){o[e].m(u,h),insert_hydration_dev(u,n,h),s=!0},p:function(u,h){t.p(u,h)},i:function(u){s||(transition_in(t),s=!0)},o:function(u){transition_out(t),s=!1},d:function(u){u&&detach_dev(n),o[e].d(u)}};return dispatch_dev("SvelteRegisterBlock",{block:d,id:create_then_block.name,type:"then",source:"(19:0) {:then session}",ctx:r}),d}function create_else_block(r){let e,t="You must be signed in to view this page",n,s,a,o="Login",l,d,c="Register";const u={c:function(){e=element("p"),e.textContent=t,n=space(),s=element("div"),a=element("a"),a.textContent=o,l=space(),d=element("a"),d.textContent=c,this.h()},l:function(b){e=claim_element(b,"P",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-b4gom2"&&(e.textContent=t),n=claim_space(b),s=claim_element(b,"DIV",{class:!0});var A=children(s);a=claim_element(A,"A",{href:!0,class:!0,"data-svelte-h":!0}),get_svelte_dataset(a)!=="svelte-f0ojl5"&&(a.textContent=o),l=claim_space(A),d=claim_element(A,"A",{href:!0,class:!0,"data-svelte-h":!0}),get_svelte_dataset(d)!=="svelte-ruuhj7"&&(d.textContent=c),A.forEach(detach_dev),this.h()},h:function(){attr_dev(e,"class","text-center text-danger"),add_location(e,file$4,33,4,559),attr_dev(a,"href","/login"),attr_dev(a,"class","btn btn-primary"),add_location(a,file$4,37,6,687),attr_dev(d,"href","/register"),attr_dev(d,"class","btn btn-secondary"),add_location(d,file$4,38,6,744),attr_dev(s,"class","auth-buttons"),add_location(s,file$4,36,4,654)},m:function(b,A){insert_hydration_dev(b,e,A),insert_hydration_dev(b,n,A),insert_hydration_dev(b,s,A),append_hydration_dev(s,a),append_hydration_dev(s,l),append_hydration_dev(s,d)},p:noop$1,i:noop$1,o:noop$1,d:function(b){b&&(detach_dev(e),detach_dev(n),detach_dev(s))}};return dispatch_dev("SvelteRegisterBlock",{block:u,id:create_else_block.name,type:"else",source:"(22:2) {:else}",ctx:r}),u}function create_if_block$2(r){let e;const t=r[2].default,n=create_slot(t,r,r[1],null),s={c:function(){n&&n.c()},l:function(o){n&&n.l(o)},m:function(o,l){n&&n.m(o,l),e=!0},p:function(o,l){n&&n.p&&(!e||l&2)&&update_slot_base(n,t,o,o[1],e?get_slot_changes(t,o[1],l,null):get_all_dirty_from_scope(o[1]),null)},i:function(o){e||(transition_in(n,o),e=!0)},o:function(o){transition_out(n,o),e=!1},d:function(o){n&&n.d(o)}};return dispatch_dev("SvelteRegisterBlock",{block:s,id:create_if_block$2.name,type:"if",source:"(20:2) {#if session?.user}",ctx:r}),s}function create_pending_block(r){let e,t="Loading...";const n={c:function(){e=element("p"),e.textContent=t,this.h()},l:function(a){e=claim_element(a,"P",{"data-svelte-h":!0}),get_svelte_dataset(e)!=="svelte-qdsr2u"&&(e.textContent=t),this.h()},h:function(){add_location(e,file$4,28,2,476)},m:function(a,o){insert_hydration_dev(a,e,o)},p:noop$1,i:noop$1,o:noop$1,d:function(a){a&&detach_dev(e)}};return dispatch_dev("SvelteRegisterBlock",{block:n,id:create_pending_block.name,type:"pending",source:"(17:25)    <p>Loading...</p> {:then session}",ctx:r}),n}function create_fragment$4(r){let e,t,n={ctx:r,current:null,token:null,hasCatch:!0,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:4,error:5,blocks:[,,,]};handle_promise(r[0](),n);const s={c:function(){e=empty$1(),n.block.c()},l:function(o){e=empty$1(),n.block.l(o)},m:function(o,l){insert_hydration_dev(o,e,l),n.block.m(o,n.anchor=l),n.mount=()=>e.parentNode,n.anchor=e,t=!0},p:function(o,[l]){r=o,update_await_block_branch(n,r,l)},i:function(o){t||(transition_in(n.block),t=!0)},o:function(o){for(let l=0;l<3;l+=1){const d=n.blocks[l];transition_out(d)}t=!1},d:function(o){o&&detach_dev(e),n.block.d(o),n.token=null,n=null}};return dispatch_dev("SvelteRegisterBlock",{block:s,id:create_fragment$4.name,type:"component",source:"",ctx:r}),s}function instance$4(r,e,t){let{$$slots:n={},$$scope:s}=e;validate_slots("AuthCheck",n,["default"]);const a=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),o=async()=>{const{data:{session:d},error:c}=await a.auth.getSession();return c?(console.log(c),null):d},l=[];return Object.keys(e).forEach(d=>{!~l.indexOf(d)&&d.slice(0,2)!=="$$"&&d!=="slot"&&console_1$2.warn(`<AuthCheck> was created with unknown prop '${d}'`)}),r.$$set=d=>{"$$scope"in d&&t(1,s=d.$$scope)},r.$capture_state=()=>({createClient,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,supabaseClient:a,getSessionData:o}),[o,s,n]}class AuthCheck extends SvelteComponentDev{constructor(e){super(e),init(this,e,instance$4,create_fragment$4,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"AuthCheck",options:e,id:create_fragment$4.name})}}const file$3="src/routes/insert.svelte";function create_if_block$1(r){let e,t;const n={c:function(){e=element("div"),t=text(r[1]),this.h()},l:function(a){e=claim_element(a,"DIV",{class:!0});var o=children(e);t=claim_text(o,r[1]),o.forEach(detach_dev),this.h()},h:function(){attr_dev(e,"class","text-red-500 mb-4"),add_location(e,file$3,65,4,1816)},m:function(a,o){insert_hydration_dev(a,e,o),append_hydration_dev(e,t)},p:function(a,o){o&2&&set_data_dev(t,a[1])},d:function(a){a&&detach_dev(e)}};return dispatch_dev("SvelteRegisterBlock",{block:n,id:create_if_block$1.name,type:"if",source:"(65:2) {#if error}",ctx:r}),n}function create_fragment$3(r){let e,t,n="Insert Data Page",s,a,o,l,d="Upload Files",c,u,h,b,A,w="Upload Files",g,v,T,C="Add the URL to the database",x,S,D,m,_,f="Add URL",y,p,k=r[1]&&create_if_block$1(r);const L={c:function(){e=element("div"),t=element("h1"),t.textContent=n,s=space(),k&&k.c(),a=space(),o=element("div"),l=element("label"),l.textContent=d,c=space(),u=element("div"),h=element("input"),b=space(),A=element("button"),A.textContent=w,g=space(),v=element("div"),T=element("label"),T.textContent=C,x=space(),S=element("div"),D=element("textarea"),m=space(),_=element("button"),_.textContent=f,this.h()},l:function(N){e=claim_element(N,"DIV",{class:!0});var q=children(e);t=claim_element(q,"H1",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-1jf55pk"&&(t.textContent=n),s=claim_space(q),k&&k.l(q),a=claim_space(q),o=claim_element(q,"DIV",{class:!0});var te=children(o);l=claim_element(te,"LABEL",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(l)!=="svelte-qb0qet"&&(l.textContent=d),c=claim_space(te),u=claim_element(te,"DIV",{class:!0});var oe=children(u);h=claim_element(oe,"INPUT",{type:!0,class:!0}),b=claim_space(oe),A=claim_element(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(A)!=="svelte-tt1zro"&&(A.textContent=w),oe.forEach(detach_dev),te.forEach(detach_dev),g=claim_space(q),v=claim_element(q,"DIV",{class:!0});var Q=children(v);T=claim_element(Q,"LABEL",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(T)!=="svelte-123a26r"&&(T.textContent=C),x=claim_space(Q),S=claim_element(Q,"DIV",{class:!0});var W=children(S);D=claim_element(W,"TEXTAREA",{class:!0,rows:!0}),children(D).forEach(detach_dev),m=claim_space(W),_=claim_element(W,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(_)!=="svelte-1y9apbx"&&(_.textContent=f),W.forEach(detach_dev),Q.forEach(detach_dev),q.forEach(detach_dev),this.h()},h:function(){attr_dev(t,"class","text-4xl font-bold mb-8"),add_location(t,file$3,62,2,1715),attr_dev(l,"class","label mb-2 text-lg font-bold"),add_location(l,file$3,70,4,1927),attr_dev(h,"type","file"),h.multiple=!0,attr_dev(h,"class","input input-accent mr-4"),add_location(h,file$3,72,6,2034),attr_dev(A,"class","btn btn-primary text-lg font-bold"),add_location(A,file$3,78,6,2160),attr_dev(u,"class","flex items-center"),add_location(u,file$3,71,4,1996),attr_dev(o,"class","w-full mb-8"),add_location(o,file$3,69,2,1897),attr_dev(T,"class","label mb-2 text-lg font-bold"),add_location(T,file$3,89,4,2379),attr_dev(D,"class","textarea textarea-accent resize-none flex-grow text-lg font-bold"),attr_dev(D,"rows","1"),add_location(D,file$3,93,6,2513),attr_dev(_,"class","btn btn-primary text-lg font-bold ml-4"),add_location(_,file$3,98,6,2661),attr_dev(S,"class","flex items-center"),add_location(S,file$3,92,4,2475),attr_dev(v,"class","w-full"),add_location(v,file$3,88,2,2354),attr_dev(e,"class","p-8 flex flex-col items-center h-screen"),add_location(e,file$3,61,0,1659)},m:function(N,q){insert_hydration_dev(N,e,q),append_hydration_dev(e,t),append_hydration_dev(e,s),k&&k.m(e,null),append_hydration_dev(e,a),append_hydration_dev(e,o),append_hydration_dev(o,l),append_hydration_dev(o,c),append_hydration_dev(o,u),append_hydration_dev(u,h),append_hydration_dev(u,b),append_hydration_dev(u,A),append_hydration_dev(e,g),append_hydration_dev(e,v),append_hydration_dev(v,T),append_hydration_dev(v,x),append_hydration_dev(v,S),append_hydration_dev(S,D),set_input_value(D,r[0]),append_hydration_dev(S,m),append_hydration_dev(S,_),y||(p=[listen_dev(h,"change",r[2],!1,!1,!1,!1),listen_dev(A,"click",r[5],!1,!1,!1,!1),listen_dev(D,"input",r[6]),listen_dev(_,"click",r[7],!1,!1,!1,!1)],y=!0)},p:function(N,[q]){N[1]?k?k.p(N,q):(k=create_if_block$1(N),k.c(),k.m(e,a)):k&&(k.d(1),k=null),q&1&&set_input_value(D,N[0])},i:noop$1,o:noop$1,d:function(N){N&&detach_dev(e),k&&k.d(),y=!1,run_all(p)}};return dispatch_dev("SvelteRegisterBlock",{block:L,id:create_fragment$3.name,type:"component",source:"",ctx:r}),L}function instance$3(r,e,t){let{$$slots:n={},$$scope:s}=e;validate_slots("Insert",n,[]);let a,o,l,d,c,u="";async function h(C){d=C.target.files[0]}onMount(()=>{a=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),l=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY}),o=new SupabaseVectorStore(l,{client:a,tableName:"documents"})});async function b(){try{await file_uploader(a,PUBLIC_HUGGINGFACE_API_KEY,o,d),t(1,u="")}catch(C){t(1,u=C.message)}}async function A(){try{await url_uploader(a,PUBLIC_HUGGINGFACE_API_KEY,o,c),t(1,u="")}catch(C){t(1,u=C.message)}}const w=[];Object.keys(e).forEach(C=>{!~w.indexOf(C)&&C.slice(0,2)!=="$$"&&C!=="slot"&&console.warn(`<Insert> was created with unknown prop '${C}'`)});const g=()=>b();function v(){c=this.value,t(0,c)}const T=()=>A();return r.$capture_state=()=>({file_uploader,url_uploader,createClient,SupabaseVectorStore,HuggingFaceInferenceEmbeddings,onMount,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,PUBLIC_HUGGINGFACE_API_KEY,supabase:a,vector:o,embeddings:l,files:d,url:c,error:u,upload:h,handleFileUpload:b,handleUrlUpload:A}),r.$inject_state=C=>{"supabase"in C&&(a=C.supabase),"vector"in C&&(o=C.vector),"embeddings"in C&&(l=C.embeddings),"files"in C&&(d=C.files),"url"in C&&t(0,c=C.url),"error"in C&&t(1,u=C.error)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[c,u,h,b,A,g,v,T]}class Insert extends SvelteComponentDev{constructor(e){super(e),init(this,e,instance$3,create_fragment$3,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"Insert",options:e,id:create_fragment$3.name})}}const ask_svelte_svelte_type_style_lang="",file$2="src/routes/ask.svelte";function create_fragment$2(r){let e,t,n,s="Configuration",a,o,l="Choose your model and temperature for asking questions.",d,c,u,h="Model",b,A,w,g="tiiuae/falcon-7b-instruct",v,T="meta-llama/Llama-2-70b-chat-hf",C,x="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",S,D,m,_="Temperature",f,y,p,k,L,X,N,q,te="Ask AI Page",oe,Q,W,pe="Your Question",he,_e,Oe,J,F="Ask the AI",I,$,U,E="Generated Text:",O,M,K,Y,ne;const ue={c:function(){e=element("div"),t=element("div"),n=element("h2"),n.textContent=s,a=space(),o=element("p"),o.textContent=l,d=space(),c=element("div"),u=element("label"),u.textContent=h,b=space(),A=element("select"),w=element("option"),w.textContent=g,v=element("option"),v.textContent=T,C=element("option"),C.textContent=x,S=space(),D=element("div"),m=element("label"),m.textContent=_,f=space(),y=element("input"),p=space(),k=element("span"),L=text(r[1]),X=space(),N=element("div"),q=element("h1"),q.textContent=te,oe=space(),Q=element("div"),W=element("label"),W.textContent=pe,he=space(),_e=element("textarea"),Oe=space(),J=element("button"),J.textContent=F,I=space(),$=element("div"),U=element("p"),U.textContent=E,O=space(),M=element("div"),K=text(r[3]),this.h()},l:function(we){e=claim_element(we,"DIV",{class:!0});var me=children(e);t=claim_element(me,"DIV",{class:!0});var Ce=children(t);n=claim_element(Ce,"H2",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(n)!=="svelte-1ali85g"&&(n.textContent=s),a=claim_space(Ce),o=claim_element(Ce,"P",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(o)!=="svelte-1xczfp8"&&(o.textContent=l),d=claim_space(Ce),c=claim_element(Ce,"DIV",{class:!0});var Re=children(c);u=claim_element(Re,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),get_svelte_dataset(u)!=="svelte-6cjlpw"&&(u.textContent=h),b=claim_space(Re),A=claim_element(Re,"SELECT",{id:!0,class:!0});var Te=children(A);w=claim_element(Te,"OPTION",{"data-svelte-h":!0}),get_svelte_dataset(w)!=="svelte-2e4awe"&&(w.textContent=g),v=claim_element(Te,"OPTION",{"data-svelte-h":!0}),get_svelte_dataset(v)!=="svelte-ejnk6e"&&(v.textContent=T),C=claim_element(Te,"OPTION",{"data-svelte-h":!0}),get_svelte_dataset(C)!=="svelte-1jx7lkk"&&(C.textContent=x),Te.forEach(detach_dev),Re.forEach(detach_dev),S=claim_space(Ce),D=claim_element(Ce,"DIV",{class:!0});var ye=children(D);m=claim_element(ye,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),get_svelte_dataset(m)!=="svelte-11sobei"&&(m.textContent=_),f=claim_space(ye),y=claim_element(ye,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0,class:!0}),p=claim_space(ye),k=claim_element(ye,"SPAN",{class:!0});var ae=children(k);L=claim_text(ae,r[1]),ae.forEach(detach_dev),ye.forEach(detach_dev),Ce.forEach(detach_dev),X=claim_space(me),N=claim_element(me,"DIV",{class:!0});var ie=children(N);q=claim_element(ie,"H1",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(q)!=="svelte-1m9568"&&(q.textContent=te),oe=claim_space(ie),Q=claim_element(ie,"DIV",{class:!0});var ve=children(Q);W=claim_element(ve,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),get_svelte_dataset(W)!=="svelte-20y8o"&&(W.textContent=pe),he=claim_space(ve),_e=claim_element(ve,"TEXTAREA",{id:!0,class:!0}),children(_e).forEach(detach_dev),ve.forEach(detach_dev),Oe=claim_space(ie),J=claim_element(ie,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(J)!=="svelte-hvko4i"&&(J.textContent=F),I=claim_space(ie),$=claim_element(ie,"DIV",{class:!0});var Ae=children($);U=claim_element(Ae,"P",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(U)!=="svelte-1th80ox"&&(U.textContent=E),O=claim_space(Ae),M=claim_element(Ae,"DIV",{id:!0,class:!0});var xe=children(M);K=claim_text(xe,r[3]),xe.forEach(detach_dev),Ae.forEach(detach_dev),ie.forEach(detach_dev),me.forEach(detach_dev),this.h()},h:function(){attr_dev(n,"class","text-2xl font-bold mb-4"),add_location(n,file$2,52,4,1757),attr_dev(o,"class","mb-4"),add_location(o,file$2,53,4,1816),attr_dev(u,"for","model"),attr_dev(u,"class","s-NxPPOnB08NvG"),add_location(u,file$2,55,6,1929),w.__value="tiiuae/falcon-7b-instruct",set_input_value(w,w.__value),add_location(w,file$2,57,8,2043),v.__value="meta-llama/Llama-2-70b-chat-hf",set_input_value(v,v.__value),add_location(v,file$2,60,8,2148),C.__value="OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",set_input_value(C,C.__value),add_location(C,file$2,63,8,2263),attr_dev(A,"id","model"),attr_dev(A,"class","input input-primary"),r[0]===void 0&&add_render_callback(()=>r[5].call(A)),add_location(A,file$2,56,6,1968),attr_dev(c,"class","form-control s-NxPPOnB08NvG"),add_location(c,file$2,54,4,1896),attr_dev(m,"for","temperature"),attr_dev(m,"class","s-NxPPOnB08NvG"),add_location(m,file$2,69,6,2471),attr_dev(y,"type","range"),attr_dev(y,"id","temperature"),attr_dev(y,"min","0.1"),attr_dev(y,"max","1.0"),attr_dev(y,"step","0.2"),attr_dev(y,"class","input input-primary"),add_location(y,file$2,70,6,2522),attr_dev(k,"class","text-sm ml-2 s-NxPPOnB08NvG"),add_location(k,file$2,79,6,2714),attr_dev(D,"class","form-control mt-4 s-NxPPOnB08NvG"),add_location(D,file$2,68,4,2433),attr_dev(t,"class","col-span-3 bg-gray-800 rounded-lg p-4"),add_location(t,file$2,51,2,1701),attr_dev(q,"class","text-4xl font-bold mb-8"),add_location(q,file$2,85,4,2850),attr_dev(W,"for","question"),attr_dev(W,"class","label s-NxPPOnB08NvG"),add_location(W,file$2,87,6,2945),attr_dev(_e,"id","question"),attr_dev(_e,"class","textarea textarea-primary"),add_location(_e,file$2,88,6,3009),attr_dev(Q,"class","form-control mb-4 s-NxPPOnB08NvG"),add_location(Q,file$2,86,4,2907),attr_dev(J,"class","btn btn-primary mb-4"),add_location(J,file$2,94,4,3137),attr_dev(U,"class","text-xl mb-2"),add_location(U,file$2,100,6,3331),attr_dev(M,"id","displayTextContainer"),attr_dev(M,"class","text-gray-200 s-NxPPOnB08NvG"),add_location(M,file$2,101,6,3381),attr_dev($,"class","bg-gray-800 p-4 rounded-lg"),add_location($,file$2,99,4,3284),attr_dev(N,"class","col-span-9"),add_location(N,file$2,84,2,2821),attr_dev(e,"class","grid grid-cols-12 min-h-screen gap-4 bg-gray-900 text-white p-8"),add_location(e,file$2,49,0,1588)},m:function(we,me){insert_hydration_dev(we,e,me),append_hydration_dev(e,t),append_hydration_dev(t,n),append_hydration_dev(t,a),append_hydration_dev(t,o),append_hydration_dev(t,d),append_hydration_dev(t,c),append_hydration_dev(c,u),append_hydration_dev(c,b),append_hydration_dev(c,A),append_hydration_dev(A,w),append_hydration_dev(A,v),append_hydration_dev(A,C),select_option(A,r[0],!0),append_hydration_dev(t,S),append_hydration_dev(t,D),append_hydration_dev(D,m),append_hydration_dev(D,f),append_hydration_dev(D,y),set_input_value(y,r[1]),append_hydration_dev(D,p),append_hydration_dev(D,k),append_hydration_dev(k,L),append_hydration_dev(e,X),append_hydration_dev(e,N),append_hydration_dev(N,q),append_hydration_dev(N,oe),append_hydration_dev(N,Q),append_hydration_dev(Q,W),append_hydration_dev(Q,he),append_hydration_dev(Q,_e),set_input_value(_e,r[2]),append_hydration_dev(N,Oe),append_hydration_dev(N,J),append_hydration_dev(N,I),append_hydration_dev(N,$),append_hydration_dev($,U),append_hydration_dev($,O),append_hydration_dev($,M),append_hydration_dev(M,K),Y||(ne=[listen_dev(A,"change",r[5]),listen_dev(y,"change",r[6]),listen_dev(y,"input",r[6]),listen_dev(_e,"input",r[7]),listen_dev(J,"click",r[8],!1,!1,!1,!1)],Y=!0)},p:function(we,[me]){me&1&&select_option(A,we[0]),me&2&&set_input_value(y,we[1]),me&2&&set_data_dev(L,we[1]),me&4&&set_input_value(_e,we[2]),me&8&&set_data_dev(K,we[3])},i:noop$1,o:noop$1,d:function(we){we&&detach_dev(e),Y=!1,run_all(ne)}};return dispatch_dev("SvelteRegisterBlock",{block:ue,id:create_fragment$2.name,type:"component",source:"",ctx:r}),ue}function instance$2(r,e,t){let{$$slots:n={},$$scope:s}=e;validate_slots("Ask",n,[]);let a,o,l,d="tiiuae/falcon-7b-instruct",c=.2,u="",h="";async function b(){const C=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);l=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY}),o=new SupabaseVectorStore(l,{client:C,tableName:"documents"});let x=await chatWithDoc(PUBLIC_HUGGINGFACE_API_KEY,o,d,c,u);t(3,h=x)}const A=[];Object.keys(e).forEach(C=>{!~A.indexOf(C)&&C.slice(0,2)!=="$$"&&C!=="slot"&&console.warn(`<Ask> was created with unknown prop '${C}'`)});function w(){d=select_value(this),t(0,d)}function g(){c=to_number(this.value),t(1,c)}function v(){u=this.value,t(2,u)}const T=()=>b();return r.$capture_state=()=>({chatWithDoc,onMount,createClient,SupabaseVectorStore,HuggingFaceInferenceEmbeddings,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,PUBLIC_HUGGINGFACE_API_KEY,OpenAIEmbeddings,supabase:a,vector:o,embeddings:l,model:d,temperature:c,question:u,responseText:h,getAIResponse:b}),r.$inject_state=C=>{"supabase"in C&&(a=C.supabase),"vector"in C&&(o=C.vector),"embeddings"in C&&(l=C.embeddings),"model"in C&&t(0,d=C.model),"temperature"in C&&t(1,c=C.temperature),"question"in C&&t(2,u=C.question),"responseText"in C&&t(3,h=C.responseText)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[d,c,u,h,b,w,g,v,T]}class Ask extends SvelteComponentDev{constructor(e){super(e),init(this,e,instance$2,create_fragment$2,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"Ask",options:e,id:create_fragment$2.name})}}const{console:console_1$1}=globals,file$1="src/routes/forget.svelte";function get_each_context(r,e,t){const n=r.slice();return n[5]=e[t],n}function create_each_block(r){let e,t,n,s,a=r[5].name+"",o,l,d=r[5].size+"",c,u,h,b,A,w,g,v;function T(){return r[2](r[5])}const C={c:function(){e=element("div"),t=element("div"),n=element("p"),s=element("strong"),o=text(a),l=text(" ("),c=text(d),u=text(" bytes)"),h=space(),b=element("button"),A=element("i"),w=space(),this.h()},l:function(S){e=claim_element(S,"DIV",{class:!0});var D=children(e);t=claim_element(D,"DIV",{});var m=children(t);n=claim_element(m,"P",{class:!0});var _=children(n);s=claim_element(_,"STRONG",{});var f=children(s);o=claim_text(f,a),f.forEach(detach_dev),l=claim_text(_," ("),c=claim_text(_,d),u=claim_text(_," bytes)"),_.forEach(detach_dev),m.forEach(detach_dev),h=claim_space(D),b=claim_element(D,"BUTTON",{class:!0});var y=children(b);A=claim_element(y,"I",{class:!0}),children(A).forEach(detach_dev),y.forEach(detach_dev),w=claim_space(D),D.forEach(detach_dev),this.h()},h:function(){add_location(s,file$1,60,12,1906),attr_dev(n,"class","text-lg"),add_location(n,file$1,59,10,1874),add_location(t,file$1,58,8,1858),attr_dev(A,"class","fas fa-trash"),add_location(A,file$1,67,10,2124),attr_dev(b,"class","btn btn-error"),add_location(b,file$1,63,8,2001),attr_dev(e,"class","bg-gray-800 p-4 rounded-lg flex items-center justify-between"),add_location(e,file$1,57,6,1775)},m:function(S,D){insert_hydration_dev(S,e,D),append_hydration_dev(e,t),append_hydration_dev(t,n),append_hydration_dev(n,s),append_hydration_dev(s,o),append_hydration_dev(n,l),append_hydration_dev(n,c),append_hydration_dev(n,u),append_hydration_dev(e,h),append_hydration_dev(e,b),append_hydration_dev(b,A),append_hydration_dev(e,w),g||(v=listen_dev(b,"click",T,!1,!1,!1,!1),g=!0)},p:function(S,D){r=S,D&1&&a!==(a=r[5].name+"")&&set_data_dev(o,a),D&1&&d!==(d=r[5].size+"")&&set_data_dev(c,d)},d:function(S){S&&detach_dev(e),g=!1,v()}};return dispatch_dev("SvelteRegisterBlock",{block:C,id:create_each_block.name,type:"each",source:"(57:4) {#each documents as document}",ctx:r}),C}function create_fragment$1(r){let e,t,n="Forget Data Page",s,a,o=ensure_array_like_dev(r[0]),l=[];for(let c=0;c<o.length;c+=1)l[c]=create_each_block(get_each_context(r,o,c));const d={c:function(){e=element("div"),t=element("h1"),t.textContent=n,s=space(),a=element("div");for(let u=0;u<l.length;u+=1)l[u].c();this.h()},l:function(u){e=claim_element(u,"DIV",{class:!0});var h=children(e);t=claim_element(h,"H1",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-ew6ckg"&&(t.textContent=n),s=claim_space(h),a=claim_element(h,"DIV",{class:!0});var b=children(a);for(let A=0;A<l.length;A+=1)l[A].l(b);b.forEach(detach_dev),h.forEach(detach_dev),this.h()},h:function(){attr_dev(t,"class","text-4xl font-bold mb-8"),add_location(t,file$1,54,2,1651),attr_dev(a,"class","space-y-4"),add_location(a,file$1,55,2,1711),attr_dev(e,"class","p-8"),add_location(e,file$1,53,0,1631)},m:function(u,h){insert_hydration_dev(u,e,h),append_hydration_dev(e,t),append_hydration_dev(e,s),append_hydration_dev(e,a);for(let b=0;b<l.length;b+=1)l[b]&&l[b].m(a,null)},p:function(u,[h]){if(h&3){o=ensure_array_like_dev(u[0]);let b;for(b=0;b<o.length;b+=1){const A=get_each_context(u,o,b);l[b]?l[b].p(A,h):(l[b]=create_each_block(A),l[b].c(),l[b].m(a,null))}for(;b<l.length;b+=1)l[b].d(1);l.length=o.length}},i:noop$1,o:noop$1,d:function(u){u&&detach_dev(e),destroy_each(l,u)}};return dispatch_dev("SvelteRegisterBlock",{block:d,id:create_fragment$1.name,type:"component",source:"",ctx:r}),d}function instance$1(r,e,t){let{$$slots:n={},$$scope:s}=e;validate_slots("Forget",n,[]);let a,o,l=[];onMount(async()=>{a=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),o=new SupabaseVectorStore(new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY}),{client:a,tableName:"documents"}),t(0,l=await getDocuments(a))});async function d(h){const b=h.split("/"),A=b[b.length-1];await deleteDocument(a,A)?t(0,l=l.filter(g=>g.name!==A)):console.error(`Error deleting ${A}`)}const c=[];Object.keys(e).forEach(h=>{!~c.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console_1$1.warn(`<Forget> was created with unknown prop '${h}'`)});const u=h=>d(h.name);return r.$capture_state=()=>({onMount,createClient,SupabaseVectorStore,HuggingFaceInferenceEmbeddings,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,PUBLIC_HUGGINGFACE_API_KEY,getDocuments,deleteDocument,supabase:a,vector:o,documents:l,handleDeleteDocument:d}),r.$inject_state=h=>{"supabase"in h&&(a=h.supabase),"vector"in h&&(o=h.vector),"documents"in h&&t(0,l=h.documents)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[l,d,u]}class Forget extends SvelteComponentDev{constructor(e){super(e),init(this,e,instance$1,create_fragment$1,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"Forget",options:e,id:create_fragment$1.name})}}const{console:console_1}=globals,file="src/routes/+page.svelte";function create_if_block_2(r){let e,t;e=new Forget({$$inline:!0});const n={c:function(){create_component(e.$$.fragment)},l:function(a){claim_component(e.$$.fragment,a)},m:function(a,o){mount_component(e,a,o),t=!0},i:function(a){t||(transition_in(e.$$.fragment,a),t=!0)},o:function(a){transition_out(e.$$.fragment,a),t=!1},d:function(a){destroy_component(e,a)}};return dispatch_dev("SvelteRegisterBlock",{block:n,id:create_if_block_2.name,type:"if",source:"(106:35) ",ctx:r}),n}function create_if_block_1(r){let e,t;e=new Ask({$$inline:!0});const n={c:function(){create_component(e.$$.fragment)},l:function(a){claim_component(e.$$.fragment,a)},m:function(a,o){mount_component(e,a,o),t=!0},i:function(a){t||(transition_in(e.$$.fragment,a),t=!0)},o:function(a){transition_out(e.$$.fragment,a),t=!1},d:function(a){destroy_component(e,a)}};return dispatch_dev("SvelteRegisterBlock",{block:n,id:create_if_block_1.name,type:"if",source:"(104:49) ",ctx:r}),n}function create_if_block(r){let e,t;e=new Insert({$$inline:!0});const n={c:function(){create_component(e.$$.fragment)},l:function(a){claim_component(e.$$.fragment,a)},m:function(a,o){mount_component(e,a,o),t=!0},i:function(a){t||(transition_in(e.$$.fragment,a),t=!0)},o:function(a){transition_out(e.$$.fragment,a),t=!1},d:function(a){destroy_component(e,a)}};return dispatch_dev("SvelteRegisterBlock",{block:n,id:create_if_block.name,type:"if",source:'(102:6) {#if $mode === \\"Add Knowledge\\"}',ctx:r}),n}function create_default_slot(r){let e,t,n,s,a,o,l,d="🧠🧠 James 🧠🧠",c,u,h=`He will remember everything you tell him and answer your questions.
        (Please let me know if I have to discipline him. He's still learning,
        and any feedback is welcome!)`,b,A,w,g,v,T,C,x="Add Knowledge",S,D,m="Chat with your Brain",_,f,y="Forget",p,k,L=`/* Add your CSS styles here to match the Streamlit app's appearance */
    /* Example: .app-title { font-size: 24px; } */

    /* Custom styles for the app container and header */
    .app-container {
      padding: 24px;
      border-radius: 8px;
    }

    .app-header {
      text-align: center;
      margin-bottom: 24px;
    }

    /* Custom styles for navigation links */
    .text-blue-500 {
      color: #3b82f6;
    }

    .text-blue-500:hover {
      color: #2563eb;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: #fff;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .btn-secondary:hover {
      background-color: #525b62;
    }`,X,N,q;const te=[create_if_block,create_if_block_1,create_if_block_2],oe=[];function Q(pe,he){return pe[0]==="Add Knowledge"?0:pe[0]==="Chat with your Brain"?1:pe[0]==="Forget"?2:-1}~(w=Q(r))&&(g=oe[w]=te[w](r));const W={c:function(){e=element("div"),t=element("div"),n=element("button"),s=element("i"),a=space(),o=element("div"),l=element("h1"),l.textContent=d,c=space(),u=element("p"),u.textContent=h,b=space(),A=element("div"),g&&g.c(),v=space(),T=element("div"),C=element("a"),C.textContent=x,S=space(),D=element("a"),D.textContent=m,_=space(),f=element("a"),f.textContent=y,p=space(),k=element("style"),k.textContent=L,this.h()},l:function(he){e=claim_element(he,"DIV",{class:!0});var _e=children(e);t=claim_element(_e,"DIV",{class:!0});var Oe=children(t);n=claim_element(Oe,"BUTTON",{class:!0});var J=children(n);s=claim_element(J,"I",{class:!0}),children(s).forEach(detach_dev),J.forEach(detach_dev),Oe.forEach(detach_dev),a=claim_space(_e),o=claim_element(_e,"DIV",{class:!0});var F=children(o);l=claim_element(F,"H1",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(l)!=="svelte-ngxor5"&&(l.textContent=d),c=claim_space(F),u=claim_element(F,"P",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(u)!=="svelte-1apk2rh"&&(u.textContent=h),F.forEach(detach_dev),b=claim_space(_e),A=claim_element(_e,"DIV",{class:!0});var I=children(A);g&&g.l(I),I.forEach(detach_dev),v=claim_space(_e),T=claim_element(_e,"DIV",{class:!0});var $=children(T);C=claim_element($,"A",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(C)!=="svelte-1csc6x5"&&(C.textContent=x),S=claim_space($),D=claim_element($,"A",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(D)!=="svelte-1mhqcqx"&&(D.textContent=m),_=claim_space($),f=claim_element($,"A",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(f)!=="svelte-12w6ws7"&&(f.textContent=y),$.forEach(detach_dev),_e.forEach(detach_dev),p=claim_space(he),k=claim_element(he,"STYLE",{"data-svelte-h":!0}),get_svelte_dataset(k)!=="svelte-f0208p"&&(k.textContent=L),this.h()},h:function(){attr_dev(s,"class","fas fa-sign-out-alt"),add_location(s,file,138,9,2714),attr_dev(n,"class","btn btn-secondary btn-sm"),add_location(n,file,137,6,2633),attr_dev(t,"class","flex items-center justify-between p-4"),add_location(t,file,135,4,2535),attr_dev(l,"class","text-4xl font-bold text-center mb-4"),add_location(l,file,142,6,2814),attr_dev(u,"class","text-lg text-center"),add_location(u,file,143,6,2889),attr_dev(o,"class","app-header p-4"),add_location(o,file,141,4,2779),attr_dev(A,"class","flex-grow p-8"),add_location(A,file,150,4,3140),attr_dev(C,"class","text-lg text-blue-500 hover:underline cursor-pointer"),add_location(C,file,163,6,3559),attr_dev(D,"class","text-lg text-blue-500 hover:underline cursor-pointer"),add_location(D,file,167,6,3713),attr_dev(f,"class","text-lg text-blue-500 hover:underline cursor-pointer"),add_location(f,file,172,6,3890),attr_dev(T,"class","flex justify-center space-x-8 mt-8 p-4"),add_location(T,file,162,4,3500),attr_dev(e,"class","flex flex-col min-h-screen bg-gray-800 text-white"),add_location(e,file,134,2,2467),add_location(k,file,179,2,4047)},m:function(he,_e){insert_hydration_dev(he,e,_e),append_hydration_dev(e,t),append_hydration_dev(t,n),append_hydration_dev(n,s),append_hydration_dev(e,a),append_hydration_dev(e,o),append_hydration_dev(o,l),append_hydration_dev(o,c),append_hydration_dev(o,u),append_hydration_dev(e,b),append_hydration_dev(e,A),~w&&oe[w].m(A,null),append_hydration_dev(e,v),append_hydration_dev(e,T),append_hydration_dev(T,C),append_hydration_dev(T,S),append_hydration_dev(T,D),append_hydration_dev(T,_),append_hydration_dev(T,f),insert_hydration_dev(he,p,_e),insert_hydration_dev(he,k,_e),X=!0,N||(q=[listen_dev(n,"click",r[3],!1,!1,!1,!1),listen_dev(C,"click",r[4],!1,!1,!1,!1),listen_dev(D,"click",r[5],!1,!1,!1,!1),listen_dev(f,"click",r[6],!1,!1,!1,!1)],N=!0)},p:function(he,_e){let Oe=w;w=Q(he),w!==Oe&&(g&&(group_outros(),transition_out(oe[Oe],1,1,()=>{oe[Oe]=null}),check_outros()),~w?(g=oe[w],g||(g=oe[w]=te[w](he),g.c()),transition_in(g,1),g.m(A,null)):g=null)},i:function(he){X||(transition_in(g),X=!0)},o:function(he){transition_out(g),X=!1},d:function(he){he&&(detach_dev(e),detach_dev(p),detach_dev(k)),~w&&oe[w].d(),N=!1,run_all(q)}};return dispatch_dev("SvelteRegisterBlock",{block:W,id:create_default_slot.name,type:"slot",source:"(83:0) <AuthCheck>",ctx:r}),W}function create_fragment(r){let e,t,n,s,a,o;a=new AuthCheck({props:{$$slots:{default:[create_default_slot]},$$scope:{ctx:r}},$$inline:!0});const l={c:function(){e=element("link"),t=space(),n=element("link"),s=space(),create_component(a.$$.fragment),this.h()},l:function(c){e=claim_element(c,"LINK",{href:!0,rel:!0}),t=claim_space(c),n=claim_element(c,"LINK",{rel:!0,href:!0}),s=claim_space(c),claim_component(a.$$.fragment,c),this.h()},h:function(){attr_dev(e,"href","https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"),attr_dev(e,"rel","stylesheet"),add_location(e,file,123,0,2220),attr_dev(n,"rel","stylesheet"),attr_dev(n,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),add_location(n,file,128,0,2335)},m:function(c,u){insert_hydration_dev(c,e,u),insert_hydration_dev(c,t,u),insert_hydration_dev(c,n,u),insert_hydration_dev(c,s,u),mount_component(a,c,u),o=!0},p:function(c,[u]){const h={};u&1048577&&(h.$$scope={dirty:u,ctx:c}),a.$set(h)},i:function(c){o||(transition_in(a.$$.fragment,c),o=!0)},o:function(c){transition_out(a.$$.fragment,c),o=!1},d:function(c){c&&(detach_dev(e),detach_dev(t),detach_dev(n),detach_dev(s)),destroy_component(a,c)}};return dispatch_dev("SvelteRegisterBlock",{block:l,id:create_fragment.name,type:"component",source:"",ctx:r}),l}function instance(r,e,t){let n,{$$slots:s={},$$scope:a}=e;validate_slots("Page",s,[]);let o=writable("Add Knowledge");validate_store(o,"mode"),component_subscribe(r,o,p=>t(0,n=p));let l=writable("tiiuae/falcon-7b-instruct"),d=writable(.2),c=writable(500),u=writable(0),h,b,A="",w,g,v,T="";async function C(){const{error:p}=await w.auth.signOut();p?console.log(p):window.location.reload()}async function x(){let p=await chatWithDoc(PUBLIC_HUGGINGFACE_API_KEY,g,l,d,A);const k=document.getElementById("displayTextContainer");k.textContent=p}onMount(()=>{w=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),console.log("public_supabase_url",PUBLIC_SUPABASE_URL),console.log("public_supabase_key",PUBLIC_SUPABASE_KEY);const p=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);v=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY}),g=new SupabaseVectorStore(v,{client:p,tableName:"documents"})});async function S(p){h=p.target.files[0]}const D=[];Object.keys(e).forEach(p=>{!~D.indexOf(p)&&p.slice(0,2)!=="$$"&&p!=="slot"&&console_1.warn(`<Page> was created with unknown prop '${p}'`)});const m=()=>C(),_=()=>set_store_value(o,n="Add Knowledge",n),f=()=>set_store_value(o,n="Chat with your Brain",n),y=()=>set_store_value(o,n="Forget",n);return r.$capture_state=()=>({onMount,file_uploader,url_uploader,chatWithDoc,brain,createClient,OpenAIEmbeddings,SupabaseVectorStore,writable,HuggingFaceInferenceEmbeddings,PUBLIC_SUPABASE_KEY,PUBLIC_SUPABASE_URL,PUBLIC_HUGGINGFACE_API_KEY,AuthCheck,Insert,Ask,Forget,mode:o,model:l,temperature:d,chunkSize:c,chunkOverlap:u,files:h,url:b,question:A,supabase:w,vector:g,embeddings:v,retrievedText:T,signOutUser:C,getAIResponse:x,upload:S,$mode:n}),r.$inject_state=p=>{"mode"in p&&t(1,o=p.mode),"model"in p&&(l=p.model),"temperature"in p&&(d=p.temperature),"chunkSize"in p&&(c=p.chunkSize),"chunkOverlap"in p&&(u=p.chunkOverlap),"files"in p&&(h=p.files),"url"in p&&(b=p.url),"question"in p&&(A=p.question),"supabase"in p&&(w=p.supabase),"vector"in p&&(g=p.vector),"embeddings"in p&&(v=p.embeddings),"retrievedText"in p&&(T=p.retrievedText)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[n,o,C,m,_,f,y]}class Page extends SvelteComponentDev{constructor(e){super(e),init(this,e,instance,create_fragment,safe_not_equal,{}),dispatch_dev("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:create_fragment.name})}}export{AIMessage as A,BaseLLM as B,CallbackManager as C,HumanMessage as H,LLM as L,PromptTemplate as P,RUN_KEY as R,SystemMessage as S,__viteBrowserExternal_fs as _,getEndpoint as a,chunkArray as b,commonjsRequire as c,dist as d,calculateMaxTokens as e,fetchAdapter as f,getEnvironmentVariable$1 as g,BaseChain as h,isNode$1 as i,LLMChain as j,BaseStringPromptTemplate as k,loadQAStuffChain as l,checkValidTemplate as m,BaseLanguageModel as n,getModelNameForTiktoken as o,ChatMessage as p,Page as q,renderTemplate as r,zodToJsonSchema$2 as z};
