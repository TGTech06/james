var Dn=Object.defineProperty;var On=(tt,e,O)=>e in tt?Dn(tt,e,{enumerable:!0,configurable:!0,writable:!0,value:O}):tt[e]=O;var Xt=(tt,e,O)=>(On(tt,typeof e!="symbol"?e+"":e,O),O),xe=(tt,e,O)=>{if(!e.has(tt))throw TypeError("Cannot "+O)};var s=(tt,e,O)=>(xe(tt,e,"read from private field"),O?O.call(tt):e.get(tt)),q=(tt,e,O)=>{if(e.has(tt))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(tt):e.set(tt,O)},ct=(tt,e,O,a)=>(xe(tt,e,"write to private field"),a?a.call(tt,O):e.set(tt,O),O);var be=(tt,e,O,a)=>({set _(m){ct(tt,e,m,O)},get _(){return s(tt,e,a)}}),st=(tt,e,O)=>(xe(tt,e,"access private method"),O);import{b as Serializable,D as Document,H as HuggingFaceInferenceEmbeddings,S as SupabaseVectorStore,j as getEnv}from"./NavBar.adcb78d3.js";import{c as commonjsRequire}from"./_commonjs-dynamic-modules.089d3295.js";import{d as getAugmentedNamespace,c as createClient,P as PUBLIC_SUPABASE_KEY,a as PUBLIC_SUPABASE_URL,b as PUBLIC_HUGGINGFACE_API_KEY,_ as __vitePreload}from"./public.8bae8052.js";class BaseDocumentTransformer extends Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers"]})}}class TextSplitter extends BaseDocumentTransformer{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:O=>O.length}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(O=>O.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,O={}){return this.splitDocuments(e,O)}splitOnSeparator(e,O){let a;if(O)if(this.keepSeparator){const m=O.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");a=e.split(new RegExp(`(?=${m})`))}else a=e.split(O);else a=e.split("");return a.filter(m=>m!=="")}async createDocuments(e,O=[],a={}){const m=O.length>0?O:new Array(e.length).fill({}),{chunkHeader:G="",chunkOverlapHeader:U="(cont'd) ",appendChunkOverlapHeader:et=!1}=a,X=new Array;for(let S=0;S<e.length;S+=1){const d=e[S];let R=1,I=null;for(const v of await this.splitText(d)){let D=G,o=0;if(I){const b=d.indexOf(v),u=d.indexOf(I)+this.lengthFunction(I);o=(d.slice(u,b).match(/\n/g)||[]).length,et&&(D+=U)}R+=o;const g=(v.match(/\n/g)||[]).length,_=m[S].loc&&typeof m[S].loc=="object"?{...m[S].loc}:{};_.lines={from:R,to:R+g};const w={...m[S],loc:_};D+=v,X.push(new Document({pageContent:D,metadata:w})),R+=g,I=v}}return X}async splitDocuments(e,O={}){const a=e.filter(U=>U.pageContent!==void 0),m=a.map(U=>U.pageContent),G=a.map(U=>U.metadata);return this.createDocuments(m,G,O)}joinDocs(e,O){const a=e.join(O).trim();return a===""?null:a}mergeSplits(e,O){const a=[],m=[];let G=0;for(const et of e){const X=this.lengthFunction(et);if(G+X+(m.length>0?O.length:0)>this.chunkSize&&(G>this.chunkSize&&console.warn(`Created a chunk of size ${G}, +
which is longer than the specified ${this.chunkSize}`),m.length>0)){const S=this.joinDocs(m,O);for(S!==null&&a.push(S);G>this.chunkOverlap||G+X>this.chunkSize&&G>0;)G-=this.lengthFunction(m[0]),m.shift()}m.push(et),G+=X}const U=this.joinDocs(m,O);return U!==null&&a.push(U),a}}class RecursiveCharacterTextSplitter extends TextSplitter{constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,O){const a=[];let m=O[O.length-1],G;for(let S=0;S<O.length;S+=1){const d=O[S];if(d===""){m=d;break}if(e.includes(d)){m=d,G=O.slice(S+1);break}}const U=this.splitOnSeparator(e,m);let et=[];const X=this.keepSeparator?"":m;for(const S of U)if(this.lengthFunction(S)<this.chunkSize)et.push(S);else{if(et.length){const d=this.mergeSplits(et,X);a.push(...d),et=[]}if(!G)a.push(S);else{const d=await this._splitText(S,G);a.push(...d)}}if(et.length){const S=this.mergeSplits(et,X);a.push(...S)}return a}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,O){return new RecursiveCharacterTextSplitter({...O,separators:RecursiveCharacterTextSplitter.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}async function computeSHA1FromFile(tt){const O=await(await fetch(tt)).arrayBuffer(),a=await crypto.subtle.digest("SHA-1",O),G=Array.from(new Uint8Array(a)).map(U=>U.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromFile: ",G),G}async function computeSHA1FromContent(tt){const O=new TextEncoder().encode(tt),a=await crypto.subtle.digest("SHA-1",O),G=Array.from(new Uint8Array(a)).map(U=>U.toString(16).padStart(2,"0")).join("");return console.log("readableHash from computeSHA1FromContent: ",G),G}var pdf={exports:{}};const __viteBrowserExternal=new Proxy({},{get(tt,e){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(e,O){module.exports=O()})(globalThis,()=>(()=>{var __webpack_modules__=[,(tt,e)=>{var Ft;Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.RenderingIntentFlag=e.PromiseCapability=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.MAX_IMAGE_SIZE_TO_CACHE=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=V,e.bytesToString=H,e.createValidAbsoluteUrl=St,e.getModificationDate=mt,e.getVerbosityLevel=x,e.info=$,e.isArrayBuffer=Y,e.isArrayEqual=ft,e.normalizeUnicode=It,e.objectFromMap=ot,e.objectSize=rt,e.setVerbosityLevel=K,e.shadow=vt,e.string32=Q,e.stringToBytes=z,e.stringToPDFString=Tt,e.stringToUTF8String=bt,e.unreachable=dt,e.utf8StringToString=nt,e.warn=at;const O=[1,0,0,1,0,0];e.IDENTITY_MATRIX=O;const a=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=a;const m=1e7;e.MAX_IMAGE_SIZE_TO_CACHE=m;const G=1.35;e.LINE_FACTOR=G;const U=.35;e.LINE_DESCENT_FACTOR=U;const et=U/G;e.BASELINE_FACTOR=et;const X={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=X;const S={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=S;const d="pdfjs_internal_editor_";e.AnnotationEditorPrefix=d;const R={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};e.AnnotationEditorType=R;const I={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=I;const v={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=v;const D={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=D;const o={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=o;const g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=g;const _={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=_;const w={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=w;const b={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=b;const u={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=u;const E={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=E;const i={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=i;const t={O:"PageOpen",C:"PageClose"};e.PageActionEventType=t;const n={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=n;const h={NONE:0,BINARY:1};e.CMapCompressionType=h;const p={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=p;const F={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=F;let L=n.WARNINGS;function K(C){Number.isInteger(C)&&(L=C)}function x(){return L}function $(C){L>=n.INFOS&&console.log(`Info: ${C}`)}function at(C){L>=n.WARNINGS&&console.log(`Warning: ${C}`)}function dt(C){throw new Error(C)}function V(C,P){C||dt(P)}function it(C){switch(C==null?void 0:C.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function St(C,P=null,B=null){if(!C)return null;try{if(B&&typeof C=="string"){if(B.addDefaultProtocol&&C.startsWith("www.")){const kt=C.match(/\./g);(kt==null?void 0:kt.length)>=2&&(C=`http://${C}`)}if(B.tryConvertEncoding)try{C=bt(C)}catch{}}const lt=P?new URL(C,P):new URL(C);if(it(lt))return lt}catch{}return null}function vt(C,P,B,lt=!1){return Object.defineProperty(C,P,{value:B,enumerable:!lt,configurable:!0,writable:!1}),B}const yt=function(){function P(B,lt){this.constructor===P&&dt("Cannot initialize BaseException."),this.message=B,this.name=lt}return P.prototype=new Error,P.constructor=P,P}();e.BaseException=yt;class Dt extends yt{constructor(P,B){super(P,"PasswordException"),this.code=B}}e.PasswordException=Dt;class j extends yt{constructor(P,B){super(P,"UnknownErrorException"),this.details=B}}e.UnknownErrorException=j;class c extends yt{constructor(P){super(P,"InvalidPDFException")}}e.InvalidPDFException=c;class l extends yt{constructor(P){super(P,"MissingPDFException")}}e.MissingPDFException=l;class y extends yt{constructor(P,B){super(P,"UnexpectedResponseException"),this.status=B}}e.UnexpectedResponseException=y;class M extends yt{constructor(P){super(P,"FormatError")}}e.FormatError=M;class N extends yt{constructor(P){super(P,"AbortException")}}e.AbortException=N;function H(C){(typeof C!="object"||(C==null?void 0:C.length)===void 0)&&dt("Invalid argument for bytesToString");const P=C.length,B=8192;if(P<B)return String.fromCharCode.apply(null,C);const lt=[];for(let kt=0;kt<P;kt+=B){const Lt=Math.min(kt+B,P),Ut=C.subarray(kt,Lt);lt.push(String.fromCharCode.apply(null,Ut))}return lt.join("")}function z(C){typeof C!="string"&&dt("Invalid argument for stringToBytes");const P=C.length,B=new Uint8Array(P);for(let lt=0;lt<P;++lt)B[lt]=C.charCodeAt(lt)&255;return B}function Q(C){return String.fromCharCode(C>>24&255,C>>16&255,C>>8&255,C&255)}function rt(C){return Object.keys(C).length}function ot(C){const P=Object.create(null);for(const[B,lt]of C)P[B]=lt;return P}function ht(){const C=new Uint8Array(4);return C[0]=1,new Uint32Array(C.buffer,0,1)[0]===1}function ut(){try{return new Function(""),!0}catch{return!1}}class Et{static get isLittleEndian(){return vt(this,"isLittleEndian",ht())}static get isEvalSupported(){return vt(this,"isEvalSupported",ut())}static get isOffscreenCanvasSupported(){return vt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?vt(this,"platform",{isWin:!1,isMac:!1}):vt(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}e.FeatureTest=Et;const pt=[...Array(256).keys()].map(C=>C.toString(16).padStart(2,"0"));class xt{static makeHexColor(P,B,lt){return`#${pt[P]}${pt[B]}${pt[lt]}`}static scaleMinMax(P,B){let lt;P[0]?(P[0]<0&&(lt=B[0],B[0]=B[1],B[1]=lt),B[0]*=P[0],B[1]*=P[0],P[3]<0&&(lt=B[2],B[2]=B[3],B[3]=lt),B[2]*=P[3],B[3]*=P[3]):(lt=B[0],B[0]=B[2],B[2]=lt,lt=B[1],B[1]=B[3],B[3]=lt,P[1]<0&&(lt=B[2],B[2]=B[3],B[3]=lt),B[2]*=P[1],B[3]*=P[1],P[2]<0&&(lt=B[0],B[0]=B[1],B[1]=lt),B[0]*=P[2],B[1]*=P[2]),B[0]+=P[4],B[1]+=P[4],B[2]+=P[5],B[3]+=P[5]}static transform(P,B){return[P[0]*B[0]+P[2]*B[1],P[1]*B[0]+P[3]*B[1],P[0]*B[2]+P[2]*B[3],P[1]*B[2]+P[3]*B[3],P[0]*B[4]+P[2]*B[5]+P[4],P[1]*B[4]+P[3]*B[5]+P[5]]}static applyTransform(P,B){const lt=P[0]*B[0]+P[1]*B[2]+B[4],kt=P[0]*B[1]+P[1]*B[3]+B[5];return[lt,kt]}static applyInverseTransform(P,B){const lt=B[0]*B[3]-B[1]*B[2],kt=(P[0]*B[3]-P[1]*B[2]+B[2]*B[5]-B[4]*B[3])/lt,Lt=(-P[0]*B[1]+P[1]*B[0]+B[4]*B[1]-B[5]*B[0])/lt;return[kt,Lt]}static getAxialAlignedBoundingBox(P,B){const lt=this.applyTransform(P,B),kt=this.applyTransform(P.slice(2,4),B),Lt=this.applyTransform([P[0],P[3]],B),Ut=this.applyTransform([P[2],P[1]],B);return[Math.min(lt[0],kt[0],Lt[0],Ut[0]),Math.min(lt[1],kt[1],Lt[1],Ut[1]),Math.max(lt[0],kt[0],Lt[0],Ut[0]),Math.max(lt[1],kt[1],Lt[1],Ut[1])]}static inverseTransform(P){const B=P[0]*P[3]-P[1]*P[2];return[P[3]/B,-P[1]/B,-P[2]/B,P[0]/B,(P[2]*P[5]-P[4]*P[3])/B,(P[4]*P[1]-P[5]*P[0])/B]}static singularValueDecompose2dScale(P){const B=[P[0],P[2],P[1],P[3]],lt=P[0]*B[0]+P[1]*B[2],kt=P[0]*B[1]+P[1]*B[3],Lt=P[2]*B[0]+P[3]*B[2],Ut=P[2]*B[1]+P[3]*B[3],Ht=(lt+Ut)/2,Jt=Math.sqrt((lt+Ut)**2-4*(lt*Ut-Lt*kt))/2,$t=Ht+Jt||1,Yt=Ht-Jt||1;return[Math.sqrt($t),Math.sqrt(Yt)]}static normalizeRect(P){const B=P.slice(0);return P[0]>P[2]&&(B[0]=P[2],B[2]=P[0]),P[1]>P[3]&&(B[1]=P[3],B[3]=P[1]),B}static intersect(P,B){const lt=Math.max(Math.min(P[0],P[2]),Math.min(B[0],B[2])),kt=Math.min(Math.max(P[0],P[2]),Math.max(B[0],B[2]));if(lt>kt)return null;const Lt=Math.max(Math.min(P[1],P[3]),Math.min(B[1],B[3])),Ut=Math.min(Math.max(P[1],P[3]),Math.max(B[1],B[3]));return Lt>Ut?null:[lt,Lt,kt,Ut]}static bezierBoundingBox(P,B,lt,kt,Lt,Ut,Ht,Jt){const $t=[],Yt=[[],[]];let Mt,T,f,r,A,k,W,Z;for(let Ct=0;Ct<2;++Ct){if(Ct===0?(T=6*P-12*lt+6*Lt,Mt=-3*P+9*lt-9*Lt+3*Ht,f=3*lt-3*P):(T=6*B-12*kt+6*Ut,Mt=-3*B+9*kt-9*Ut+3*Jt,f=3*kt-3*B),Math.abs(Mt)<1e-12){if(Math.abs(T)<1e-12)continue;r=-f/T,0<r&&r<1&&$t.push(r);continue}W=T*T-4*f*Mt,Z=Math.sqrt(W),!(W<0)&&(A=(-T+Z)/(2*Mt),0<A&&A<1&&$t.push(A),k=(-T-Z)/(2*Mt),0<k&&k<1&&$t.push(k))}let gt=$t.length,At;const J=gt;for(;gt--;)r=$t[gt],At=1-r,Yt[0][gt]=At*At*At*P+3*At*At*r*lt+3*At*r*r*Lt+r*r*r*Ht,Yt[1][gt]=At*At*At*B+3*At*At*r*kt+3*At*r*r*Ut+r*r*r*Jt;return Yt[0][J]=P,Yt[1][J]=B,Yt[0][J+1]=Ht,Yt[1][J+1]=Jt,Yt[0].length=Yt[1].length=J+2,[Math.min(...Yt[0]),Math.min(...Yt[1]),Math.max(...Yt[0]),Math.max(...Yt[1])]}}e.Util=xt;const Ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Tt(C){if(C[0]>="ï"){let B;if(C[0]==="þ"&&C[1]==="ÿ"?B="utf-16be":C[0]==="ÿ"&&C[1]==="þ"?B="utf-16le":C[0]==="ï"&&C[1]==="»"&&C[2]==="¿"&&(B="utf-8"),B)try{const lt=new TextDecoder(B,{fatal:!0}),kt=z(C);return lt.decode(kt)}catch(lt){at(`stringToPDFString: "${lt}".`)}}const P=[];for(let B=0,lt=C.length;B<lt;B++){const kt=Ot[C.charCodeAt(B)];P.push(kt?String.fromCharCode(kt):C.charAt(B))}return P.join("")}function bt(C){return decodeURIComponent(escape(C))}function nt(C){return unescape(encodeURIComponent(C))}function Y(C){return typeof C=="object"&&(C==null?void 0:C.byteLength)!==void 0}function ft(C,P){if(C.length!==P.length)return!1;for(let B=0,lt=C.length;B<lt;B++)if(C[B]!==P[B])return!1;return!0}function mt(C=new Date){return[C.getUTCFullYear().toString(),(C.getUTCMonth()+1).toString().padStart(2,"0"),C.getUTCDate().toString().padStart(2,"0"),C.getUTCHours().toString().padStart(2,"0"),C.getUTCMinutes().toString().padStart(2,"0"),C.getUTCSeconds().toString().padStart(2,"0")].join("")}class wt{constructor(){q(this,Ft,!1);this.promise=new Promise((P,B)=>{this.resolve=lt=>{ct(this,Ft,!0),P(lt)},this.reject=lt=>{ct(this,Ft,!0),B(lt)}})}get settled(){return s(this,Ft)}}Ft=new WeakMap,e.PromiseCapability=wt;let Rt=null,Bt=null;function It(C){return Rt||(Rt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Bt=new Map([["ﬅ","ſt"]])),C.replaceAll(Rt,(P,B,lt)=>B?B.normalize("NFKC"):Bt.get(lt))}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var tt,O,a,m,se,U,_e,X,S,d,R,I,v,D,o,ke,_,w,Fe,u,E;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:t}=__w_pdfjs_require__(21);createPDFNetworkStream=n=>new t(n)}else{const{PDFNetworkStream:t}=__w_pdfjs_require__(24),{PDFFetchStream:n}=__w_pdfjs_require__(25);createPDFNetworkStream=h=>(0,_display_utils.isValidFetchUrl)(h.url)?new n(h):new t(h)}function getDocument(t){if(typeof t=="string"||t instanceof URL?t={url:t}:(0,_util.isArrayBuffer)(t)&&(t={data:t}),typeof t!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!t.url&&!t.data&&!t.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const n=new PDFDocumentLoadingTask,{docId:h}=n,p=t.url?getUrlProp(t.url):null,F=t.data?getDataProp(t.data):null,L=t.httpHeaders||null,K=t.withCredentials===!0,x=t.password??null,$=t.range instanceof PDFDataRangeTransport?t.range:null,at=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let dt=t.worker instanceof PDFWorker?t.worker:null;const V=t.verbosity,it=typeof t.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(t.docBaseUrl)?t.docBaseUrl:null,St=typeof t.cMapUrl=="string"?t.cMapUrl:null,vt=t.cMapPacked!==!1,yt=t.CMapReaderFactory||DefaultCMapReaderFactory,Dt=typeof t.standardFontDataUrl=="string"?t.standardFontDataUrl:null,j=t.StandardFontDataFactory||DefaultStandardFontDataFactory,c=t.stopAtErrors!==!0,l=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1,y=t.isEvalSupported!==!1,M=typeof t.isOffscreenCanvasSupported=="boolean"?t.isOffscreenCanvasSupported:!_is_node.isNodeJS,N=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,H=typeof t.disableFontFace=="boolean"?t.disableFontFace:_is_node.isNodeJS,z=t.fontExtraProperties===!0,Q=t.enableXfa===!0,rt=t.ownerDocument||globalThis.document,ot=t.disableRange===!0,ht=t.disableStream===!0,ut=t.disableAutoFetch===!0,Et=t.pdfBug===!0,pt=$?$.length:t.length??NaN,xt=typeof t.useSystemFonts=="boolean"?t.useSystemFonts:!_is_node.isNodeJS&&!H,Ot=typeof t.useWorkerFetch=="boolean"?t.useWorkerFetch:yt===_display_utils.DOMCMapReaderFactory&&j===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(St,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Dt,document.baseURI),Tt=t.canvasFactory||new DefaultCanvasFactory({ownerDocument:rt}),bt=t.filterFactory||new DefaultFilterFactory({docId:h,ownerDocument:rt}),nt=null;(0,_util.setVerbosityLevel)(V);const Y={canvasFactory:Tt,filterFactory:bt};if(Ot||(Y.cMapReaderFactory=new yt({baseUrl:St,isCompressed:vt}),Y.standardFontDataFactory=new j({baseUrl:Dt})),!dt){const wt={verbosity:V,port:_worker_options.GlobalWorkerOptions.workerPort};dt=wt.port?PDFWorker.fromPort(wt):new PDFWorker(wt),n._worker=dt}const ft={docId:h,apiVersion:"3.8.162",data:F,password:x,disableAutoFetch:ut,rangeChunkSize:at,length:pt,docBaseUrl:it,enableXfa:Q,evaluatorOptions:{maxImageSize:l,disableFontFace:H,ignoreErrors:c,isEvalSupported:y,isOffscreenCanvasSupported:M,canvasMaxAreaInBytes:N,fontExtraProperties:z,useSystemFonts:xt,cMapUrl:Ot?St:null,standardFontDataUrl:Ot?Dt:null}},mt={ignoreErrors:c,isEvalSupported:y,disableFontFace:H,fontExtraProperties:z,enableXfa:Q,ownerDocument:rt,disableAutoFetch:ut,pdfBug:Et,styleElement:nt};return dt.promise.then(function(){if(n.destroyed)throw new Error("Loading aborted");const wt=_fetchDocument(dt,ft),Rt=new Promise(function(Bt){let It;$?It=new _transport_stream.PDFDataTransportStream({length:pt,initialData:$.initialData,progressiveDone:$.progressiveDone,contentDispositionFilename:$.contentDispositionFilename,disableRange:ot,disableStream:ht},$):F||(It=createPDFNetworkStream({url:p,length:pt,httpHeaders:L,withCredentials:K,rangeChunkSize:at,disableRange:ot,disableStream:ht})),Bt(It)});return Promise.all([wt,Rt]).then(function([Bt,It]){if(n.destroyed)throw new Error("Loading aborted");const Ft=new _message_handler.MessageHandler(h,Bt,dt.port),C=new WorkerTransport(Ft,n,It,mt,Y);n._transport=C,Ft.send("Ready",null)})}).catch(n._capability.reject),n}async function _fetchDocument(t,n){if(t.destroyed)throw new Error("Worker was destroyed");const h=await t.messageHandler.sendWithPromise("GetDocRequest",n,n.data?[n.data.buffer]:null);if(t.destroyed)throw new Error("Worker was destroyed");return h}function getUrlProp(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch{if(_is_node.isNodeJS&&typeof t=="string")return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(t){if(_is_node.isNodeJS&&typeof Buffer<"u"&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if(typeof t=="string")return(0,_util.stringToBytes)(t);if(typeof t=="object"&&!isNaN(t==null?void 0:t.length)||(0,_util.isArrayBuffer)(t))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const e=class e{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${be(e,tt)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var n;this.destroyed=!0,await((n=this._transport)==null?void 0:n.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};tt=new WeakMap,q(e,tt,0);let PDFDocumentLoadingTask=e;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(n,h,p=!1,F=null){this.length=n,this.initialData=h,this.progressiveDone=p,this.contentDispositionFilename=F,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(n){this._rangeListeners.push(n)}addProgressListener(n){this._progressListeners.push(n)}addProgressiveReadListener(n){this._progressiveReadListeners.push(n)}addProgressiveDoneListener(n){this._progressiveDoneListeners.push(n)}onDataRange(n,h){for(const p of this._rangeListeners)p(n,h)}onDataProgress(n,h){this._readyCapability.promise.then(()=>{for(const p of this._progressListeners)p(n,h)})}onDataProgressiveRead(n){this._readyCapability.promise.then(()=>{for(const h of this._progressiveReadListeners)h(n)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const n of this._progressiveDoneListeners)n()})}transportReady(){this._readyCapability.resolve()}requestDataRange(n,h){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(n,h){this._pdfInfo=n,this._transport=h}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(n){return this._transport.getPage(n)}getPageIndex(n){return this._transport.getPageIndex(n)}getDestinations(){return this._transport.getDestinations()}getDestination(n){return this._transport.getDestination(n)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(n=!1){return this._transport.startCleanup(n||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(n,h,p,F=!1){q(this,m);q(this,U);q(this,O,null);q(this,a,!1);this._pageIndex=n,this._pageInfo=h,this._transport=p,this._stats=F?new _display_utils.StatTimer:null,this._pdfBug=F,this.commonObjs=p.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:n,rotation:h=this.rotate,offsetX:p=0,offsetY:F=0,dontFlip:L=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:n,rotation:h,offsetX:p,offsetY:F,dontFlip:L})}getAnnotations({intent:n="display"}={}){const h=this._transport.getRenderingIntent(n);return this._transport.getAnnotations(this._pageIndex,h.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var n;return((n=this._transport._htmlForXfa)==null?void 0:n.children[this._pageIndex])||null}render({canvasContext:n,viewport:h,intent:p="display",annotationMode:F=_util.AnnotationMode.ENABLE,transform:L=null,background:K=null,optionalContentConfigPromise:x=null,annotationCanvasMap:$=null,pageColors:at=null,printAnnotationStorage:dt=null}){var j,c;(j=this._stats)==null||j.time("Overall");const V=this._transport.getRenderingIntent(p,F,dt);ct(this,a,!1),st(this,U,_e).call(this),x||(x=this._transport.getOptionalContentConfig());let it=this._intentStates.get(V.cacheKey);it||(it=Object.create(null),this._intentStates.set(V.cacheKey,it)),it.streamReaderCancelTimeout&&(clearTimeout(it.streamReaderCancelTimeout),it.streamReaderCancelTimeout=null);const St=!!(V.renderingIntent&_util.RenderingIntentFlag.PRINT);it.displayReadyCapability||(it.displayReadyCapability=new _util.PromiseCapability,it.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(V));const vt=l=>{var y,M;it.renderTasks.delete(yt),(this._maybeCleanupAfterRender||St)&&ct(this,a,!0),st(this,m,se).call(this,!St),l?(yt.capability.reject(l),this._abortOperatorList({intentState:it,reason:l instanceof Error?l:new Error(l)})):yt.capability.resolve(),(y=this._stats)==null||y.timeEnd("Rendering"),(M=this._stats)==null||M.timeEnd("Overall")},yt=new InternalRenderTask({callback:vt,params:{canvasContext:n,viewport:h,transform:L,background:K},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:$,operatorList:it.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!St,pdfBug:this._pdfBug,pageColors:at});(it.renderTasks||(it.renderTasks=new Set)).add(yt);const Dt=yt.task;return Promise.all([it.displayReadyCapability.promise,x]).then(([l,y])=>{var M;if(this.destroyed){vt();return}(M=this._stats)==null||M.time("Rendering"),yt.initializeGraphics({transparency:l,optionalContentConfig:y}),yt.operatorListChanged()}).catch(vt),Dt}getOperatorList({intent:n="display",annotationMode:h=_util.AnnotationMode.ENABLE,printAnnotationStorage:p=null}={}){var $;function F(){K.operatorList.lastChunk&&(K.opListReadCapability.resolve(K.operatorList),K.renderTasks.delete(x))}const L=this._transport.getRenderingIntent(n,h,p,!0);let K=this._intentStates.get(L.cacheKey);K||(K=Object.create(null),this._intentStates.set(L.cacheKey,K));let x;return K.opListReadCapability||(x=Object.create(null),x.operatorListChanged=F,K.opListReadCapability=new _util.PromiseCapability,(K.renderTasks||(K.renderTasks=new Set)).add(x),K.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},($=this._stats)==null||$.time("Page Request"),this._pumpOperatorList(L)),K.opListReadCapability.promise}streamTextContent({includeMarkedContent:n=!1,disableNormalization:h=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:n===!0,disableNormalization:h===!0},{highWaterMark:100,size(F){return F.items.length}})}getTextContent(n={}){if(this._transport._htmlForXfa)return this.getXfa().then(p=>_xfa_text.XfaText.textContent(p));const h=this.streamTextContent(n);return new Promise(function(p,F){function L(){K.read().then(function({value:$,done:at}){if(at){p(x);return}Object.assign(x.styles,$.styles),x.items.push(...$.items),L()},F)}const K=h.getReader(),x={items:[],styles:Object.create(null)};L()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const n=[];for(const h of this._intentStates.values())if(this._abortOperatorList({intentState:h,reason:new Error("Page was destroyed."),force:!0}),!h.opListReadCapability)for(const p of h.renderTasks)n.push(p.completed),p.cancel();return this.objs.clear(),ct(this,a,!1),st(this,U,_e).call(this),Promise.all(n)}cleanup(n=!1){ct(this,a,!0);const h=st(this,m,se).call(this,!1);return n&&h&&this._stats&&(this._stats=new _display_utils.StatTimer),h}_startRenderPage(n,h){var F,L;const p=this._intentStates.get(h);p&&((F=this._stats)==null||F.timeEnd("Page Request"),(L=p.displayReadyCapability)==null||L.resolve(n))}_renderPageChunk(n,h){for(let p=0,F=n.length;p<F;p++)h.operatorList.fnArray.push(n.fnArray[p]),h.operatorList.argsArray.push(n.argsArray[p]);h.operatorList.lastChunk=n.lastChunk,h.operatorList.separateAnnots=n.separateAnnots;for(const p of h.renderTasks)p.operatorListChanged();n.lastChunk&&st(this,m,se).call(this,!0)}_pumpOperatorList({renderingIntent:n,cacheKey:h,annotationStorageSerializable:p}){const{map:F,transfers:L}=p,x=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:n,cacheKey:h,annotationStorage:F},L).getReader(),$=this._intentStates.get(h);$.streamReader=x;const at=()=>{x.read().then(({value:dt,done:V})=>{if(V){$.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(dt,$),at())},dt=>{if($.streamReader=null,!this._transport.destroyed){if($.operatorList){$.operatorList.lastChunk=!0;for(const V of $.renderTasks)V.operatorListChanged();st(this,m,se).call(this,!0)}if($.displayReadyCapability)$.displayReadyCapability.reject(dt);else if($.opListReadCapability)$.opListReadCapability.reject(dt);else throw dt}})};at()}_abortOperatorList({intentState:n,reason:h,force:p=!1}){if(n.streamReader){if(n.streamReaderCancelTimeout&&(clearTimeout(n.streamReaderCancelTimeout),n.streamReaderCancelTimeout=null),!p){if(n.renderTasks.size>0)return;if(h instanceof _display_utils.RenderingCancelledException){let F=RENDERING_CANCELLED_TIMEOUT;h.extraDelay>0&&h.extraDelay<1e3&&(F+=h.extraDelay),n.streamReaderCancelTimeout=setTimeout(()=>{n.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:n,reason:h,force:!0})},F);return}}if(n.streamReader.cancel(new _util.AbortException(h.message)).catch(()=>{}),n.streamReader=null,!this._transport.destroyed){for(const[F,L]of this._intentStates)if(L===n){this._intentStates.delete(F);break}this.cleanup()}}}get stats(){return this._stats}}O=new WeakMap,a=new WeakMap,m=new WeakSet,se=function(n=!1){if(st(this,U,_e).call(this),!s(this,a)||this.destroyed)return!1;if(n)return ct(this,O,setTimeout(()=>{ct(this,O,null),st(this,m,se).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:h,operatorList:p}of this._intentStates.values())if(h.size>0||!p.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ct(this,a,!1),!0},U=new WeakSet,_e=function(){s(this,O)&&(clearTimeout(s(this,O)),ct(this,O,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){q(this,X,new Set);q(this,S,Promise.resolve())}postMessage(n,h){const p={data:structuredClone(n,h?{transfer:h}:null)};s(this,S).then(()=>{for(const F of s(this,X))F.call(this,p)})}addEventListener(n,h){s(this,X).add(h)}removeEventListener(n,h){s(this,X).delete(h)}terminate(){s(this,X).clear()}}X=new WeakMap,S=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const t=(d=document==null?void 0:document.currentScript)==null?void 0:d.src;t&&(PDFWorkerUtil.fallbackWorkerSrc=t.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(t,n){let h;try{if(h=new URL(t),!h.origin||h.origin==="null")return!1}catch{return!1}const p=new URL(n,h);return h.origin===p.origin},PDFWorkerUtil.createCDNWrapper=function(t){const n=`importScripts("${t}");`;return URL.createObjectURL(new Blob([n]))}}const _PDFWorker=class _PDFWorker{constructor({name:t=null,port:n=null,verbosity:h=(0,_util.getVerbosityLevel)()}={}){if(n&&s(_PDFWorker,R).has(n))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=t,this.destroyed=!1,this.verbosity=h,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,n){s(_PDFWorker,R).set(n,this),this._initializeFromPort(n);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new _message_handler.MessageHandler("main","worker",t),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:t}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,t)||(t=PDFWorkerUtil.createCDNWrapper(new URL(t,window.location).href));const n=new Worker(t),h=new _message_handler.MessageHandler("main","worker",n),p=()=>{n.removeEventListener("error",F),h.destroy(),n.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},F=()=>{this._webWorker||p()};n.addEventListener("error",F),h.on("test",K=>{if(n.removeEventListener("error",F),this.destroyed){p();return}K?(this._messageHandler=h,this._port=n,this._webWorker=n,this._readyCapability.resolve(),h.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),h.destroy(),n.terminate())}),h.on("ready",K=>{if(n.removeEventListener("error",F),this.destroyed){p();return}try{L()}catch{this._setupFakeWorker()}});const L=()=>{const K=new Uint8Array;h.send("test",K,[K.buffer])};L();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const n=new LoopbackPort;this._port=n;const h=`fake${PDFWorkerUtil.fakeWorkerId++}`,p=new _message_handler.MessageHandler(h+"_worker",h,n);t.setup(p,n);const F=new _message_handler.MessageHandler(h,h+"_worker",n);this._messageHandler=F,this._readyCapability.resolve(),F.send("configure",{verbosity:this.verbosity})}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),s(_PDFWorker,R).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return s(this,R).has(t.port)?s(this,R).get(t.port):new _PDFWorker(t)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};R=new WeakMap,q(_PDFWorker,R,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(n,h,p,F,L){q(this,o);q(this,I,new Map);q(this,v,new Map);q(this,D,new Map);this.messageHandler=n,this.loadingTask=h,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:F.ownerDocument,styleElement:F.styleElement}),this._params=F,this.canvasFactory=L.canvasFactory,this.filterFactory=L.filterFactory,this.cMapReaderFactory=L.cMapReaderFactory,this.standardFontDataFactory=L.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=p,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(n,h=_util.AnnotationMode.ENABLE,p=null,F=!1){let L=_util.RenderingIntentFlag.DISPLAY,K=_annotation_storage.SerializableEmpty;switch(n){case"any":L=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":L=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${n}`)}switch(h){case _util.AnnotationMode.DISABLE:L+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:L+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:L+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,K=(L&_util.RenderingIntentFlag.PRINT&&p instanceof _annotation_storage.PrintAnnotationStorage?p:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${h}`)}return F&&(L+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:L,cacheKey:`${L}_${K.hash}`,annotationStorageSerializable:K}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const n=[];for(const p of s(this,v).values())n.push(p._destroy());s(this,v).clear(),s(this,D).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const h=this.messageHandler.sendWithPromise("Terminate",null);return n.push(h),Promise.all(n).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),s(this,I).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:n,loadingTask:h}=this;n.on("GetReader",(p,F)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=L=>{this._lastProgress={loaded:L.loaded,total:L.total}},F.onPull=()=>{this._fullReader.read().then(function({value:L,done:K}){if(K){F.close();return}(0,_util.assert)(L instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),F.enqueue(new Uint8Array(L),1,[L])}).catch(L=>{F.error(L)})},F.onCancel=L=>{this._fullReader.cancel(L),F.ready.catch(K=>{if(!this.destroyed)throw K})}}),n.on("ReaderHeadersReady",p=>{const F=new _util.PromiseCapability,L=this._fullReader;return L.headersReady.then(()=>{var K;(!L.isStreamingSupported||!L.isRangeSupported)&&(this._lastProgress&&((K=h.onProgress)==null||K.call(h,this._lastProgress)),L.onProgress=x=>{var $;($=h.onProgress)==null||$.call(h,{loaded:x.loaded,total:x.total})}),F.resolve({isStreamingSupported:L.isStreamingSupported,isRangeSupported:L.isRangeSupported,contentLength:L.contentLength})},F.reject),F.promise}),n.on("GetRangeReader",(p,F)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const L=this._networkStream.getRangeReader(p.begin,p.end);if(!L){F.close();return}F.onPull=()=>{L.read().then(function({value:K,done:x}){if(x){F.close();return}(0,_util.assert)(K instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),F.enqueue(new Uint8Array(K),1,[K])}).catch(K=>{F.error(K)})},F.onCancel=K=>{L.cancel(K),F.ready.catch(x=>{if(!this.destroyed)throw x})}}),n.on("GetDoc",({pdfInfo:p})=>{this._numPages=p.numPages,this._htmlForXfa=p.htmlForXfa,delete p.htmlForXfa,h._capability.resolve(new PDFDocumentProxy(p,this))}),n.on("DocException",function(p){let F;switch(p.name){case"PasswordException":F=new _util.PasswordException(p.message,p.code);break;case"InvalidPDFException":F=new _util.InvalidPDFException(p.message);break;case"MissingPDFException":F=new _util.MissingPDFException(p.message);break;case"UnexpectedResponseException":F=new _util.UnexpectedResponseException(p.message,p.status);break;case"UnknownErrorException":F=new _util.UnknownErrorException(p.message,p.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}h._capability.reject(F)}),n.on("PasswordRequest",p=>{if(this._passwordCapability=new _util.PromiseCapability,h.onPassword){const F=L=>{L instanceof Error?this._passwordCapability.reject(L):this._passwordCapability.resolve({password:L})};try{h.onPassword(F,p.code)}catch(L){this._passwordCapability.reject(L)}}else this._passwordCapability.reject(new _util.PasswordException(p.message,p.code));return this._passwordCapability.promise}),n.on("DataLoaded",p=>{var F;(F=h.onProgress)==null||F.call(h,{loaded:p.length,total:p.length}),this.downloadInfoCapability.resolve(p)}),n.on("StartRenderPage",p=>{if(this.destroyed)return;s(this,v).get(p.pageIndex)._startRenderPage(p.transparency,p.cacheKey)}),n.on("commonobj",([p,F,L])=>{var K;if(!this.destroyed&&!this.commonObjs.has(p))switch(F){case"Font":const x=this._params;if("error"in L){const dt=L.error;(0,_util.warn)(`Error during font loading: ${dt}`),this.commonObjs.resolve(p,dt);break}const $=x.pdfBug&&((K=globalThis.FontInspector)!=null&&K.enabled)?(dt,V)=>globalThis.FontInspector.fontAdded(dt,V):null,at=new _font_loader.FontFaceObject(L,{isEvalSupported:x.isEvalSupported,disableFontFace:x.disableFontFace,ignoreErrors:x.ignoreErrors,inspectFont:$});this.fontLoader.bind(at).catch(dt=>n.sendWithPromise("FontFallback",{id:p})).finally(()=>{!x.fontExtraProperties&&at.data&&(at.data=null),this.commonObjs.resolve(p,at)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(p,L);break;default:throw new Error(`Got unknown common object type ${F}`)}}),n.on("obj",([p,F,L,K])=>{var $;if(this.destroyed)return;const x=s(this,v).get(F);if(!x.objs.has(p))switch(L){case"Image":if(x.objs.resolve(p,K),K){let at;if(K.bitmap){const{width:dt,height:V}=K;at=dt*V*4}else at=(($=K.data)==null?void 0:$.length)||0;at>_util.MAX_IMAGE_SIZE_TO_CACHE&&(x._maybeCleanupAfterRender=!0)}break;case"Pattern":x.objs.resolve(p,K);break;default:throw new Error(`Got unknown object type ${L}`)}}),n.on("DocProgress",p=>{var F;this.destroyed||(F=h.onProgress)==null||F.call(h,{loaded:p.loaded,total:p.total})}),n.on("FetchBuiltInCMap",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(p):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),n.on("FetchStandardFontData",p=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(p):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var p;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:n,transfers:h}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:n,filename:((p=this._fullReader)==null?void 0:p.filename)??null},h).finally(()=>{this.annotationStorage.resetModified()})}getPage(n){if(!Number.isInteger(n)||n<=0||n>this._numPages)return Promise.reject(new Error("Invalid page request."));const h=n-1,p=s(this,D).get(h);if(p)return p;const F=this.messageHandler.sendWithPromise("GetPage",{pageIndex:h}).then(L=>{if(this.destroyed)throw new Error("Transport destroyed");const K=new PDFPageProxy(h,L,this,this._params.pdfBug);return s(this,v).set(h,K),K});return s(this,D).set(h,F),F}getPageIndex(n){return typeof n!="object"||n===null||!Number.isInteger(n.num)||n.num<0||!Number.isInteger(n.gen)||n.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:n.num,gen:n.gen})}getAnnotations(n,h){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:n,intent:h})}getFieldObjects(){return st(this,o,ke).call(this,"GetFieldObjects")}hasJSActions(){return st(this,o,ke).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(n){return typeof n!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:n})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(n){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:n})}getStructTree(n){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:n})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(n=>new _optional_content_config.OptionalContentConfig(n))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const n="GetMetadata",h=s(this,I).get(n);if(h)return h;const p=this.messageHandler.sendWithPromise(n,null).then(F=>{var L,K;return{info:F[0],metadata:F[1]?new _metadata.Metadata(F[1]):null,contentDispositionFilename:((L=this._fullReader)==null?void 0:L.filename)??null,contentLength:((K=this._fullReader)==null?void 0:K.contentLength)??null}});return s(this,I).set(n,p),p}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(n=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const h of s(this,v).values())if(!h.cleanup())throw new Error(`startCleanup: Page ${h.pageNumber} is currently rendering.`);this.commonObjs.clear(),n||this.fontLoader.clear(),s(this,I).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:n,enableXfa:h}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:n,enableXfa:h})}}I=new WeakMap,v=new WeakMap,D=new WeakMap,o=new WeakSet,ke=function(n,h=null){const p=s(this,I).get(n);if(p)return p;const F=this.messageHandler.sendWithPromise(n,h);return s(this,I).set(n,F),F};class PDFObjects{constructor(){q(this,w);q(this,_,Object.create(null))}get(n,h=null){if(h){const F=st(this,w,Fe).call(this,n);return F.capability.promise.then(()=>h(F.data)),null}const p=s(this,_)[n];if(!(p!=null&&p.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${n}.`);return p.data}has(n){const h=s(this,_)[n];return(h==null?void 0:h.capability.settled)||!1}resolve(n,h=null){const p=st(this,w,Fe).call(this,n);p.data=h,p.capability.resolve()}clear(){var n;for(const h in s(this,_)){const{data:p}=s(this,_)[h];(n=p==null?void 0:p.bitmap)==null||n.close()}ct(this,_,Object.create(null))}}_=new WeakMap,w=new WeakSet,Fe=function(n){const h=s(this,_)[n];return h||(s(this,_)[n]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(n){q(this,u,null);ct(this,u,n),this.onContinue=null}get promise(){return s(this,u).capability.promise}cancel(n=0){s(this,u).cancel(null,n)}get separateAnnots(){const{separateAnnots:n}=s(this,u).operatorList;if(!n)return!1;const{annotationCanvasMap:h}=s(this,u);return n.form||n.canvas&&(h==null?void 0:h.size)>0}}u=new WeakMap,exports.RenderTask=RenderTask;const i=class i{constructor({callback:n,params:h,objs:p,commonObjs:F,annotationCanvasMap:L,operatorList:K,pageIndex:x,canvasFactory:$,filterFactory:at,useRequestAnimationFrame:dt=!1,pdfBug:V=!1,pageColors:it=null}){this.callback=n,this.params=h,this.objs=p,this.commonObjs=F,this.annotationCanvasMap=L,this.operatorListIdx=null,this.operatorList=K,this._pageIndex=x,this.canvasFactory=$,this.filterFactory=at,this._pdfBug=V,this.pageColors=it,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=dt===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=h.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:n=!1,optionalContentConfig:h}){var x,$;if(this.cancelled)return;if(this._canvas){if(s(i,E).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");s(i,E).add(this._canvas)}this._pdfBug&&((x=globalThis.StepperManager)!=null&&x.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:p,viewport:F,transform:L,background:K}=this.params;this.gfx=new _canvas.CanvasGraphics(p,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:h},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:L,viewport:F,transparency:n,background:K}),this.operatorListIdx=0,this.graphicsReady=!0,($=this.graphicsReadyCallback)==null||$.call(this)}cancel(n=null,h=0){var p;this.running=!1,this.cancelled=!0,(p=this.gfx)==null||p.endDrawing(),this._canvas&&s(i,E).delete(this._canvas),this.callback(n||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,h))}operatorListChanged(){var n;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(n=this.stepper)==null||n.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&s(i,E).delete(this._canvas),this.callback())))}};E=new WeakMap,q(i,E,new WeakSet);let InternalRenderTask=i;const version="3.8.162";exports.version=version;const build="2c74323e3";exports.build=build},(tt,e,O)=>{var S,d,R,sn,v;Object.defineProperty(e,"__esModule",{value:!0}),e.SerializableEmpty=e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var a=O(1),m=O(4),G=O(8);const U=Object.freeze({map:null,hash:"",transfers:void 0});e.SerializableEmpty=U;class et{constructor(){q(this,R);q(this,S,!1);q(this,d,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(o,g){const _=s(this,d).get(o);return _===void 0?g:Object.assign(g,_)}getRawValue(o){return s(this,d).get(o)}remove(o){if(s(this,d).delete(o),s(this,d).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const g of s(this,d).values())if(g instanceof m.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(o,g){const _=s(this,d).get(o);let w=!1;if(_!==void 0)for(const[b,u]of Object.entries(g))_[b]!==u&&(w=!0,_[b]=u);else w=!0,s(this,d).set(o,g);w&&st(this,R,sn).call(this),g instanceof m.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(g.constructor._type)}has(o){return s(this,d).has(o)}getAll(){return s(this,d).size>0?(0,a.objectFromMap)(s(this,d)):null}setAll(o){for(const[g,_]of Object.entries(o))this.setValue(g,_)}get size(){return s(this,d).size}resetModified(){s(this,S)&&(ct(this,S,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new X(this)}get serializable(){if(s(this,d).size===0)return U;const o=new Map,g=new G.MurmurHash3_64,_=[];for(const[w,b]of s(this,d)){const u=b instanceof m.AnnotationEditor?b.serialize():b;u&&(o.set(w,u),g.update(`${w}:${JSON.stringify(u)}`),u.bitmap&&_.push(u.bitmap))}return o.size>0?{map:o,hash:g.hexdigest(),transfers:_}:U}}S=new WeakMap,d=new WeakMap,R=new WeakSet,sn=function(){s(this,S)||(ct(this,S,!0),typeof this.onSetModified=="function"&&this.onSetModified())},e.AnnotationStorage=et;class X extends et{constructor(g){super();q(this,v,void 0);const{map:_,hash:w,transfers:b}=g.serializable,u=structuredClone(_,b?{transfer:b}:null);ct(this,v,{map:u,hash:w,transfers:b})}get print(){(0,a.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return s(this,v)}}v=new WeakMap,e.PrintAnnotationStorage=X},(tt,e,O)=>{var et,X,S,d,R,I;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var a=O(5),m=O(1);const v=class v{constructor(o){q(this,et,this.focusin.bind(this));q(this,X,this.focusout.bind(this));q(this,S,!1);q(this,d,!1);q(this,R,!1);Xt(this,"_uiManager",null);q(this,I,v._zIndex++);this.constructor===v&&(0,m.unreachable)("Cannot initialize AnnotationEditor."),this.parent=o.parent,this.id=o.id,this.width=this.height=null,this.pageIndex=o.parent.pageIndex,this.name=o.name,this.div=null,this._uiManager=o.uiManager,this.annotationElementId=null;const{rotation:g,rawDims:{pageWidth:_,pageHeight:w,pageX:b,pageY:u}}=this.parent.viewport;this.rotation=g,this.pageRotation=(360+g-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[_,w],this.pageTranslation=[b,u];const[E,i]=this.parentDimensions;this.x=o.x/E,this.y=o.y/i,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,m.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(o){const g=new U({id:o.parent.getNextId(),parent:o.parent,uiManager:o._uiManager});g.annotationElementId=o.annotationElementId,g.deleted=!0,g._uiManager.addToAnnotationStorage(g)}addCommands(o){this._uiManager.addCommands(o)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=s(this,I)}setParent(o){o!==null&&(this.pageIndex=o.pageIndex,this.pageDimensions=o.pageDimensions),this.parent=o}focusin(o){s(this,S)?ct(this,S,!1):this.parent.setSelected(this)}focusout(o){var _;if(!this.isAttachedToDOM)return;const g=o.relatedTarget;g!=null&&g.closest(`#${this.id}`)||(o.preventDefault(),(_=this.parent)!=null&&_.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(o){const g=this.parent.div.getBoundingClientRect();this.startX=o.clientX-g.x,this.startY=o.clientY-g.y,o.dataTransfer.setData("text/plain",this.id),o.dataTransfer.effectAllowed="move"}setAt(o,g,_,w){const[b,u]=this.parentDimensions;[_,w]=this.screenToPageTranslation(_,w),this.x=(o+_)/b,this.y=(g+w)/u,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(o,g){const[_,w]=this.parentDimensions;[o,g]=this.screenToPageTranslation(o,g),this.x+=o/_,this.y+=g/w,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(o,g){switch(this.parentRotation){case 90:return[g,-o];case 180:return[-o,-g];case 270:return[-g,o];default:return[o,g]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:o}=this._uiManager.viewParameters,[g,_]=this.pageDimensions;return[g*o,_*o]}setDims(o,g){const[_,w]=this.parentDimensions;this.div.style.width=`${100*o/_}%`,this.div.style.height=`${100*g/w}%`}fixDims(){const{style:o}=this.div,{height:g,width:_}=o,w=_.endsWith("%"),b=g.endsWith("%");if(w&&b)return;const[u,E]=this.parentDimensions;w||(o.width=`${100*parseFloat(_)/u}%`),b||(o.height=`${100*parseFloat(g)/E}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",s(this,et)),this.div.addEventListener("focusout",s(this,X));const[o,g]=this.getInitialTranslation();return this.translate(o,g),(0,a.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(o){const{isMac:g}=m.FeatureTest.platform;if(o.button!==0||o.ctrlKey&&g){o.preventDefault();return}o.ctrlKey&&!g||o.shiftKey||o.metaKey&&g?this.parent.toggleSelected(this):this.parent.setSelected(this),ct(this,S,!0)}getRect(o,g){const _=this.parentScale,[w,b]=this.pageDimensions,[u,E]=this.pageTranslation,i=o/_,t=g/_,n=this.x*w,h=this.y*b,p=this.width*w,F=this.height*b;switch(this.rotation){case 0:return[n+i+u,b-h-t-F+E,n+i+p+u,b-h-t+E];case 90:return[n+t+u,b-h+i+E,n+t+F+u,b-h+i+p+E];case 180:return[n-i-p+u,b-h+t+E,n-i+u,b-h+t+F+E];case 270:return[n-t-F+u,b-h-i-p+E,n-t+u,b-h-i+E];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(o,g){const[_,w,b,u]=o,E=b-_,i=u-w;switch(this.rotation){case 0:return[_,g-u,E,i];case 90:return[_,g-w,i,E];case 180:return[b,g-w,E,i];case 270:return[b,g-u,i,E];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ct(this,R,!0)}disableEditMode(){ct(this,R,!1)}isInEditMode(){return s(this,R)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var o,g;(o=this.div)==null||o.addEventListener("focusin",s(this,et)),(g=this.div)==null||g.addEventListener("focusout",s(this,X))}serialize(o=!1){(0,m.unreachable)("An editor must be serializable")}static deserialize(o,g,_){const w=new this.prototype.constructor({parent:g,id:g.getNextId(),uiManager:_});w.rotation=o.rotation;const[b,u]=w.pageDimensions,[E,i,t,n]=w.getRectInCurrentCoords(o.rect,u);return w.x=E/b,w.y=i/u,w.width=t/b,w.height=n/u,w}remove(){this.div.removeEventListener("focusin",s(this,et)),this.div.removeEventListener("focusout",s(this,X)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var o;(o=this.div)==null||o.classList.add("selectedEditor")}unselect(){var o;(o=this.div)==null||o.classList.remove("selectedEditor")}updateParams(o,g){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return s(this,d)}set isEditing(o){ct(this,d,o),o?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};et=new WeakMap,X=new WeakMap,S=new WeakMap,d=new WeakMap,R=new WeakMap,I=new WeakMap,Xt(v,"_colorManager",new a.ColorManager),Xt(v,"_zIndex",1);let G=v;e.AnnotationEditor=G;class U extends G{constructor(o){super(o),this.annotationElementId=o.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(tt,e,O)=>{var I,v,D,o,g,_,rn,u,E,i,t,n,h,p,F,L,K,x,$,at,dt,V,it,St,vt,yt,Dt,j,c,l,y,M,an,H,Re,Q,on,ot,ln,ut,Qt,pt,ce,Ot,cn,bt,hn,Y,Me,mt,he,Rt,De;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=G,e.opacityToHex=U;var a=O(1),m=O(6);function G(Ft,C,P){for(const B of P)C.addEventListener(B,Ft[B].bind(Ft))}function U(Ft){return Math.round(Math.min(255,Math.max(1,255*Ft))).toString(16).padStart(2,"0")}class et{constructor(){q(this,I,0)}getId(){return`${a.AnnotationEditorPrefix}${be(this,I)._++}`}}I=new WeakMap;class X{constructor(C=128){q(this,v,[]);q(this,D,!1);q(this,o,void 0);q(this,g,-1);ct(this,o,C)}add({cmd:C,undo:P,mustExec:B,type:lt=NaN,overwriteIfSameType:kt=!1,keepUndo:Lt=!1}){if(B&&C(),s(this,D))return;const Ut={cmd:C,undo:P,type:lt};if(s(this,g)===-1){s(this,v).length>0&&(s(this,v).length=0),ct(this,g,0),s(this,v).push(Ut);return}if(kt&&s(this,v)[s(this,g)].type===lt){Lt&&(Ut.undo=s(this,v)[s(this,g)].undo),s(this,v)[s(this,g)]=Ut;return}const Ht=s(this,g)+1;Ht===s(this,o)?s(this,v).splice(0,1):(ct(this,g,Ht),Ht<s(this,v).length&&s(this,v).splice(Ht)),s(this,v).push(Ut)}undo(){s(this,g)!==-1&&(ct(this,D,!0),s(this,v)[s(this,g)].undo(),ct(this,D,!1),ct(this,g,s(this,g)-1))}redo(){s(this,g)<s(this,v).length-1&&(ct(this,g,s(this,g)+1),ct(this,D,!0),s(this,v)[s(this,g)].cmd(),ct(this,D,!1))}hasSomethingToUndo(){return s(this,g)!==-1}hasSomethingToRedo(){return s(this,g)<s(this,v).length-1}destroy(){ct(this,v,null)}}v=new WeakMap,D=new WeakMap,o=new WeakMap,g=new WeakMap,e.CommandManager=X;class S{constructor(C){q(this,_);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:P}=a.FeatureTest.platform;for(const[B,lt,kt=!1]of C)for(const Lt of B){const Ut=Lt.startsWith("mac+");P&&Ut?(this.callbacks.set(Lt.slice(4),{callback:lt,bubbles:kt}),this.allKeys.add(Lt.split("+").at(-1))):!P&&!Ut&&(this.callbacks.set(Lt,{callback:lt,bubbles:kt}),this.allKeys.add(Lt.split("+").at(-1)))}}exec(C,P){if(!this.allKeys.has(P.key))return;const B=this.callbacks.get(st(this,_,rn).call(this,P));if(!B)return;const{callback:lt,bubbles:kt}=B;lt.bind(C)(),kt||(P.stopPropagation(),P.preventDefault())}}_=new WeakSet,rn=function(C){C.altKey&&this.buffer.push("alt"),C.ctrlKey&&this.buffer.push("ctrl"),C.metaKey&&this.buffer.push("meta"),C.shiftKey&&this.buffer.push("shift"),this.buffer.push(C.key);const P=this.buffer.join("+");return this.buffer.length=0,P},e.KeyboardManager=S;const b=class b{get _colors(){const C=new Map([["CanvasText",null],["Canvas",null]]);return(0,m.getColorValues)(C),(0,a.shadow)(this,"_colors",C)}convert(C){const P=(0,m.getRGB)(C);if(!window.matchMedia("(forced-colors: active)").matches)return P;for(const[B,lt]of this._colors)if(lt.every((kt,Lt)=>kt===P[Lt]))return b._colorsMapping.get(B);return P}getHexCode(C){const P=this._colors.get(C);return P?a.Util.makeHexColor(...P):C}};Xt(b,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let d=b;e.ColorManager=d;const It=class It{constructor(C,P,B){q(this,M);q(this,H);q(this,Q);q(this,ot);q(this,ut);q(this,pt);q(this,Ot);q(this,bt);q(this,Y);q(this,mt);q(this,Rt);q(this,u,null);q(this,E,new Map);q(this,i,new Map);q(this,t,null);q(this,n,new X);q(this,h,0);q(this,p,new Set);q(this,F,null);q(this,L,new Set);q(this,K,null);q(this,x,new et);q(this,$,!1);q(this,at,a.AnnotationEditorType.NONE);q(this,dt,new Set);q(this,V,this.copy.bind(this));q(this,it,this.cut.bind(this));q(this,St,this.paste.bind(this));q(this,vt,this.keydown.bind(this));q(this,yt,this.onEditingAction.bind(this));q(this,Dt,this.onPageChanging.bind(this));q(this,j,this.onScaleChanging.bind(this));q(this,c,this.onRotationChanging.bind(this));q(this,l,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});q(this,y,null);ct(this,y,C),ct(this,K,P),s(this,K)._on("editingaction",s(this,yt)),s(this,K)._on("pagechanging",s(this,Dt)),s(this,K)._on("scalechanging",s(this,j)),s(this,K)._on("rotationchanging",s(this,c)),ct(this,t,B),this.viewParameters={realScale:m.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){return(0,a.shadow)(this,"_keyboardManager",new S([[["ctrl+a","mac+meta+a"],It.prototype.selectAll],[["ctrl+z","mac+meta+z"],It.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],It.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],It.prototype.delete],[["Escape","mac+Escape"],It.prototype.unselectAll]]))}destroy(){st(this,H,Re).call(this),s(this,K)._off("editingaction",s(this,yt)),s(this,K)._off("pagechanging",s(this,Dt)),s(this,K)._off("scalechanging",s(this,j)),s(this,K)._off("rotationchanging",s(this,c));for(const C of s(this,i).values())C.destroy();s(this,i).clear(),s(this,E).clear(),s(this,L).clear(),ct(this,u,null),s(this,dt).clear(),s(this,n).destroy()}onPageChanging({pageNumber:C}){ct(this,h,C-1)}focusMainContainer(){s(this,y).focus()}addShouldRescale(C){s(this,L).add(C)}removeShouldRescale(C){s(this,L).delete(C)}onScaleChanging({scale:C}){this.commitOrRemove(),this.viewParameters.realScale=C*m.PixelsPerInch.PDF_TO_CSS_UNITS;for(const P of s(this,L))P.onScaleChanging()}onRotationChanging({pagesRotation:C}){this.commitOrRemove(),this.viewParameters.rotation=C}addToAnnotationStorage(C){!C.isEmpty()&&s(this,t)&&!s(this,t).has(C.id)&&s(this,t).setValue(C.id,C)}copy(C){if(C.preventDefault(),s(this,u)&&s(this,u).commitOrRemove(),!this.hasSelection)return;const P=[];for(const B of s(this,dt)){const lt=B.serialize(!0);lt&&P.push(lt)}P.length!==0&&C.clipboardData.setData("application/pdfjs",JSON.stringify(P))}cut(C){this.copy(C),this.delete()}paste(C){C.preventDefault();let P=C.clipboardData.getData("application/pdfjs");if(!P)return;try{P=JSON.parse(P)}catch(lt){(0,a.warn)(`paste: "${lt.message}".`);return}if(!Array.isArray(P))return;this.unselectAll();const B=s(this,i).get(s(this,h));try{const lt=[];for(const Ut of P){const Ht=B.deserialize(Ut);if(!Ht)return;lt.push(Ht)}const kt=()=>{for(const Ut of lt)st(this,Y,Me).call(this,Ut);st(this,Rt,De).call(this,lt)},Lt=()=>{for(const Ut of lt)Ut.remove()};this.addCommands({cmd:kt,undo:Lt,mustExec:!0})}catch(lt){(0,a.warn)(`paste: "${lt.message}".`)}}keydown(C){var P;(P=this.getActive())!=null&&P.shouldGetKeyboardEvents()||It._keyboardManager.exec(this,C)}onEditingAction(C){["undo","redo","delete","selectAll"].includes(C.name)&&this[C.name]()}setEditingState(C){C?(st(this,M,an).call(this),st(this,Q,on).call(this),st(this,ut,Qt).call(this,{isEditing:s(this,at)!==a.AnnotationEditorType.NONE,isEmpty:st(this,mt,he).call(this),hasSomethingToUndo:s(this,n).hasSomethingToUndo(),hasSomethingToRedo:s(this,n).hasSomethingToRedo(),hasSelectedEditor:!1})):(st(this,H,Re).call(this),st(this,ot,ln).call(this),st(this,ut,Qt).call(this,{isEditing:!1}))}registerEditorTypes(C){if(!s(this,F)){ct(this,F,C);for(const P of s(this,F))st(this,pt,ce).call(this,P.defaultPropertiesToUpdate)}}getId(){return s(this,x).getId()}get currentLayer(){return s(this,i).get(s(this,h))}get currentPageIndex(){return s(this,h)}addLayer(C){s(this,i).set(C.pageIndex,C),s(this,$)?C.enable():C.disable()}removeLayer(C){s(this,i).delete(C.pageIndex)}updateMode(C){if(ct(this,at,C),C===a.AnnotationEditorType.NONE)this.setEditingState(!1),st(this,bt,hn).call(this);else{this.setEditingState(!0),st(this,Ot,cn).call(this);for(const P of s(this,i).values())P.updateMode(C)}}updateToolbar(C){C!==s(this,at)&&s(this,K).dispatch("switchannotationeditormode",{source:this,mode:C})}updateParams(C,P){if(s(this,F)){for(const B of s(this,dt))B.updateParams(C,P);for(const B of s(this,F))B.updateDefaultParams(C,P)}}getEditors(C){const P=[];for(const B of s(this,E).values())B.pageIndex===C&&P.push(B);return P}getEditor(C){return s(this,E).get(C)}addEditor(C){s(this,E).set(C.id,C)}removeEditor(C){var P;s(this,E).delete(C.id),this.unselect(C),(!C.annotationElementId||!s(this,p).has(C.annotationElementId))&&((P=s(this,t))==null||P.remove(C.id))}addDeletedAnnotationElement(C){s(this,p).add(C.annotationElementId),C.deleted=!0}isDeletedAnnotationElement(C){return s(this,p).has(C)}removeDeletedAnnotationElement(C){s(this,p).delete(C.annotationElementId),C.deleted=!1}setActiveEditor(C){s(this,u)!==C&&(ct(this,u,C),C&&st(this,pt,ce).call(this,C.propertiesToUpdate))}toggleSelected(C){if(s(this,dt).has(C)){s(this,dt).delete(C),C.unselect(),st(this,ut,Qt).call(this,{hasSelectedEditor:this.hasSelection});return}s(this,dt).add(C),C.select(),st(this,pt,ce).call(this,C.propertiesToUpdate),st(this,ut,Qt).call(this,{hasSelectedEditor:!0})}setSelected(C){for(const P of s(this,dt))P!==C&&P.unselect();s(this,dt).clear(),s(this,dt).add(C),C.select(),st(this,pt,ce).call(this,C.propertiesToUpdate),st(this,ut,Qt).call(this,{hasSelectedEditor:!0})}isSelected(C){return s(this,dt).has(C)}unselect(C){C.unselect(),s(this,dt).delete(C),st(this,ut,Qt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return s(this,dt).size!==0}undo(){s(this,n).undo(),st(this,ut,Qt).call(this,{hasSomethingToUndo:s(this,n).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:st(this,mt,he).call(this)})}redo(){s(this,n).redo(),st(this,ut,Qt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:s(this,n).hasSomethingToRedo(),isEmpty:st(this,mt,he).call(this)})}addCommands(C){s(this,n).add(C),st(this,ut,Qt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:st(this,mt,he).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const C=[...s(this,dt)],P=()=>{for(const lt of C)lt.remove()},B=()=>{for(const lt of C)st(this,Y,Me).call(this,lt)};this.addCommands({cmd:P,undo:B,mustExec:!0})}commitOrRemove(){var C;(C=s(this,u))==null||C.commitOrRemove()}selectAll(){for(const C of s(this,dt))C.commit();st(this,Rt,De).call(this,s(this,E).values())}unselectAll(){if(s(this,u)){s(this,u).commitOrRemove();return}if(s(this,dt).size!==0){for(const C of s(this,dt))C.unselect();s(this,dt).clear(),st(this,ut,Qt).call(this,{hasSelectedEditor:!1})}}isActive(C){return s(this,u)===C}getActive(){return s(this,u)}getMode(){return s(this,at)}};u=new WeakMap,E=new WeakMap,i=new WeakMap,t=new WeakMap,n=new WeakMap,h=new WeakMap,p=new WeakMap,F=new WeakMap,L=new WeakMap,K=new WeakMap,x=new WeakMap,$=new WeakMap,at=new WeakMap,dt=new WeakMap,V=new WeakMap,it=new WeakMap,St=new WeakMap,vt=new WeakMap,yt=new WeakMap,Dt=new WeakMap,j=new WeakMap,c=new WeakMap,l=new WeakMap,y=new WeakMap,M=new WeakSet,an=function(){s(this,y).addEventListener("keydown",s(this,vt))},H=new WeakSet,Re=function(){s(this,y).removeEventListener("keydown",s(this,vt))},Q=new WeakSet,on=function(){document.addEventListener("copy",s(this,V)),document.addEventListener("cut",s(this,it)),document.addEventListener("paste",s(this,St))},ot=new WeakSet,ln=function(){document.removeEventListener("copy",s(this,V)),document.removeEventListener("cut",s(this,it)),document.removeEventListener("paste",s(this,St))},ut=new WeakSet,Qt=function(C){Object.entries(C).some(([B,lt])=>s(this,l)[B]!==lt)&&s(this,K).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(s(this,l),C)})},pt=new WeakSet,ce=function(C){s(this,K).dispatch("annotationeditorparamschanged",{source:this,details:C})},Ot=new WeakSet,cn=function(){if(!s(this,$)){ct(this,$,!0);for(const C of s(this,i).values())C.enable()}},bt=new WeakSet,hn=function(){if(this.unselectAll(),s(this,$)){ct(this,$,!1);for(const C of s(this,i).values())C.disable()}},Y=new WeakSet,Me=function(C){const P=s(this,i).get(C.pageIndex);P?P.addOrRebuild(C):this.addEditor(C)},mt=new WeakSet,he=function(){if(s(this,E).size===0)return!0;if(s(this,E).size===1)for(const C of s(this,E).values())return C.isEmpty();return!1},Rt=new WeakSet,De=function(C){s(this,dt).clear();for(const P of C)P.isEmpty()||(s(this,dt).add(P),P.select());st(this,ut,Qt).call(this,{hasSelectedEditor:!0})};let R=It;e.AnnotationEditorUIManager=R},(tt,e,O)=>{var dt,V,it,St,vt,yt,Dt,j,c,l,y,M,ie,H,re,Q,Oe,ot,Ae,ut,ye,pt,de,Ot,ue;Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMFilterFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=t,e.getColorValues=L,e.getCurrentTransform=K,e.getCurrentTransformInverse=x,e.getFilenameFromUrl=w,e.getPdfFilenameFromUrl=b,e.getRGB=F,e.getXfaPageViewport=p,e.isDataScheme=g,e.isPdfFile=_,e.isValidFetchUrl=E,e.loadScript=i,e.setLayerDimensions=$;var a=O(7),m=O(1);const G="http://www.w3.org/2000/svg",U="pdfjs_internal_id_";e.AnnotationPrefix=U;const at=class at{};Xt(at,"CSS",96),Xt(at,"PDF",72),Xt(at,"PDF_TO_CSS_UNITS",at.CSS/at.PDF);let et=at;e.PixelsPerInch=et;class X extends a.BaseFilterFactory{constructor({docId:Y,ownerDocument:ft=globalThis.document}={}){super();q(this,M);q(this,H);q(this,Q);q(this,ot);q(this,ut);q(this,pt);q(this,Ot);q(this,dt,void 0);q(this,V,void 0);q(this,it,void 0);q(this,St,void 0);q(this,vt,void 0);q(this,yt,void 0);q(this,Dt,void 0);q(this,j,void 0);q(this,c,void 0);q(this,l,void 0);q(this,y,0);ct(this,it,Y),ct(this,St,ft)}addFilter(Y){if(!Y)return"none";let ft=s(this,M,ie).get(Y);if(ft)return ft;let mt,wt,Rt,Bt;if(Y.length===1){const P=Y[0],B=new Array(256);for(let lt=0;lt<256;lt++)B[lt]=P[lt]/255;Bt=mt=wt=Rt=B.join(",")}else{const[P,B,lt]=Y,kt=new Array(256),Lt=new Array(256),Ut=new Array(256);for(let Ht=0;Ht<256;Ht++)kt[Ht]=P[Ht]/255,Lt[Ht]=B[Ht]/255,Ut[Ht]=lt[Ht]/255;mt=kt.join(","),wt=Lt.join(","),Rt=Ut.join(","),Bt=`${mt}${wt}${Rt}`}if(ft=s(this,M,ie).get(Bt),ft)return s(this,M,ie).set(Y,ft),ft;const It=`g_${s(this,it)}_transfer_map_${be(this,y)._++}`,Ft=`url(#${It})`;s(this,M,ie).set(Y,Ft),s(this,M,ie).set(Bt,Ft);const C=st(this,ot,Ae).call(this,It);return st(this,pt,de).call(this,mt,wt,Rt,C),Ft}addHCMFilter(Y,ft){var B;const mt=`${Y}-${ft}`;if(s(this,yt)===mt)return s(this,Dt);if(ct(this,yt,mt),ct(this,Dt,"none"),(B=s(this,vt))==null||B.remove(),!Y||!ft)return s(this,Dt);const wt=st(this,Ot,ue).call(this,Y);Y=m.Util.makeHexColor(...wt);const Rt=st(this,Ot,ue).call(this,ft);if(ft=m.Util.makeHexColor(...Rt),s(this,H,re).style.color="",Y==="#000000"&&ft==="#ffffff"||Y===ft)return s(this,Dt);const Bt=new Array(256);for(let lt=0;lt<=255;lt++){const kt=lt/255;Bt[lt]=kt<=.03928?kt/12.92:((kt+.055)/1.055)**2.4}const It=Bt.join(","),Ft=`g_${s(this,it)}_hcm_filter`,C=ct(this,j,st(this,ot,Ae).call(this,Ft));st(this,pt,de).call(this,It,It,It,C),st(this,Q,Oe).call(this,C);const P=(lt,kt)=>{const Lt=wt[lt]/255,Ut=Rt[lt]/255,Ht=new Array(kt+1);for(let Jt=0;Jt<=kt;Jt++)Ht[Jt]=Lt+Jt/kt*(Ut-Lt);return Ht.join(",")};return st(this,pt,de).call(this,P(0,5),P(1,5),P(2,5),C),ct(this,Dt,`url(#${Ft})`),s(this,Dt)}addHighlightHCMFilter(Y,ft,mt,wt){var Ut;const Rt=`${Y}-${ft}-${mt}-${wt}`;if(s(this,c)===Rt)return s(this,l);if(ct(this,c,Rt),ct(this,l,"none"),(Ut=s(this,j))==null||Ut.remove(),!Y||!ft)return s(this,l);const[Bt,It]=[Y,ft].map(st(this,Ot,ue).bind(this));let Ft=Math.round(.2126*Bt[0]+.7152*Bt[1]+.0722*Bt[2]),C=Math.round(.2126*It[0]+.7152*It[1]+.0722*It[2]),[P,B]=[mt,wt].map(st(this,Ot,ue).bind(this));C<Ft&&([Ft,C,P,B]=[C,Ft,B,P]),s(this,H,re).style.color="";const lt=(Ht,Jt,$t)=>{const Yt=new Array(256),Mt=(C-Ft)/$t,T=Ht/255,f=(Jt-Ht)/(255*$t);let r=0;for(let A=0;A<=$t;A++){const k=Math.round(Ft+A*Mt),W=T+A*f;for(let Z=r;Z<=k;Z++)Yt[Z]=W;r=k+1}for(let A=r;A<256;A++)Yt[A]=Yt[r-1];return Yt.join(",")},kt=`g_${s(this,it)}_hcm_highlight_filter`,Lt=ct(this,j,st(this,ot,Ae).call(this,kt));return st(this,Q,Oe).call(this,Lt),st(this,pt,de).call(this,lt(P[0],B[0],5),lt(P[1],B[1],5),lt(P[2],B[2],5),Lt),ct(this,l,`url(#${kt})`),s(this,l)}destroy(Y=!1){Y&&(s(this,Dt)||s(this,l))||(s(this,V)&&(s(this,V).parentNode.parentNode.remove(),ct(this,V,null)),s(this,dt)&&(s(this,dt).clear(),ct(this,dt,null)),ct(this,y,0))}}dt=new WeakMap,V=new WeakMap,it=new WeakMap,St=new WeakMap,vt=new WeakMap,yt=new WeakMap,Dt=new WeakMap,j=new WeakMap,c=new WeakMap,l=new WeakMap,y=new WeakMap,M=new WeakSet,ie=function(){return s(this,dt)||ct(this,dt,new Map)},H=new WeakSet,re=function(){if(!s(this,V)){const Y=s(this,St).createElement("div"),{style:ft}=Y;ft.visibility="hidden",ft.contain="strict",ft.width=ft.height=0,ft.position="absolute",ft.top=ft.left=0,ft.zIndex=-1;const mt=s(this,St).createElementNS(G,"svg");mt.setAttribute("width",0),mt.setAttribute("height",0),ct(this,V,s(this,St).createElementNS(G,"defs")),Y.append(mt),mt.append(s(this,V)),s(this,St).body.append(Y)}return s(this,V)},Q=new WeakSet,Oe=function(Y){const ft=s(this,St).createElementNS(G,"feColorMatrix");ft.setAttribute("type","matrix"),ft.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Y.append(ft)},ot=new WeakSet,Ae=function(Y){const ft=s(this,St).createElementNS(G,"filter");return ft.setAttribute("color-interpolation-filters","sRGB"),ft.setAttribute("id",Y),s(this,H,re).append(ft),ft},ut=new WeakSet,ye=function(Y,ft,mt){const wt=s(this,St).createElementNS(G,ft);wt.setAttribute("type","discrete"),wt.setAttribute("tableValues",mt),Y.append(wt)},pt=new WeakSet,de=function(Y,ft,mt,wt){const Rt=s(this,St).createElementNS(G,"feComponentTransfer");wt.append(Rt),st(this,ut,ye).call(this,Rt,"feFuncR",Y),st(this,ut,ye).call(this,Rt,"feFuncG",ft),st(this,ut,ye).call(this,Rt,"feFuncB",mt)},Ot=new WeakSet,ue=function(Y){return s(this,H,re).style.color=Y,F(getComputedStyle(s(this,H,re)).getPropertyValue("color"))},e.DOMFilterFactory=X;class S extends a.BaseCanvasFactory{constructor({ownerDocument:nt=globalThis.document}={}){super(),this._document=nt}_createCanvas(nt,Y){const ft=this._document.createElement("canvas");return ft.width=nt,ft.height=Y,ft}}e.DOMCanvasFactory=S;async function d(bt,nt=!1){if(E(bt,document.baseURI)){const Y=await fetch(bt);if(!Y.ok)throw new Error(Y.statusText);return nt?new Uint8Array(await Y.arrayBuffer()):(0,m.stringToBytes)(await Y.text())}return new Promise((Y,ft)=>{const mt=new XMLHttpRequest;mt.open("GET",bt,!0),nt&&(mt.responseType="arraybuffer"),mt.onreadystatechange=()=>{if(mt.readyState===XMLHttpRequest.DONE){if(mt.status===200||mt.status===0){let wt;if(nt&&mt.response?wt=new Uint8Array(mt.response):!nt&&mt.responseText&&(wt=(0,m.stringToBytes)(mt.responseText)),wt){Y(wt);return}}ft(new Error(mt.statusText))}},mt.send(null)})}class R extends a.BaseCMapReaderFactory{_fetchData(nt,Y){return d(nt,this.isCompressed).then(ft=>({cMapData:ft,compressionType:Y}))}}e.DOMCMapReaderFactory=R;class I extends a.BaseStandardFontDataFactory{_fetchData(nt){return d(nt,!0)}}e.DOMStandardFontDataFactory=I;class v extends a.BaseSVGFactory{_createSVG(nt){return document.createElementNS(G,nt)}}e.DOMSVGFactory=v;class D{constructor({viewBox:nt,scale:Y,rotation:ft,offsetX:mt=0,offsetY:wt=0,dontFlip:Rt=!1}){this.viewBox=nt,this.scale=Y,this.rotation=ft,this.offsetX=mt,this.offsetY=wt;const Bt=(nt[2]+nt[0])/2,It=(nt[3]+nt[1])/2;let Ft,C,P,B;switch(ft%=360,ft<0&&(ft+=360),ft){case 180:Ft=-1,C=0,P=0,B=1;break;case 90:Ft=0,C=1,P=1,B=0;break;case 270:Ft=0,C=-1,P=-1,B=0;break;case 0:Ft=1,C=0,P=0,B=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Rt&&(P=-P,B=-B);let lt,kt,Lt,Ut;Ft===0?(lt=Math.abs(It-nt[1])*Y+mt,kt=Math.abs(Bt-nt[0])*Y+wt,Lt=(nt[3]-nt[1])*Y,Ut=(nt[2]-nt[0])*Y):(lt=Math.abs(Bt-nt[0])*Y+mt,kt=Math.abs(It-nt[1])*Y+wt,Lt=(nt[2]-nt[0])*Y,Ut=(nt[3]-nt[1])*Y),this.transform=[Ft*Y,C*Y,P*Y,B*Y,lt-Ft*Y*Bt-P*Y*It,kt-C*Y*Bt-B*Y*It],this.width=Lt,this.height=Ut}get rawDims(){const{viewBox:nt}=this;return(0,m.shadow)(this,"rawDims",{pageWidth:nt[2]-nt[0],pageHeight:nt[3]-nt[1],pageX:nt[0],pageY:nt[1]})}clone({scale:nt=this.scale,rotation:Y=this.rotation,offsetX:ft=this.offsetX,offsetY:mt=this.offsetY,dontFlip:wt=!1}={}){return new D({viewBox:this.viewBox.slice(),scale:nt,rotation:Y,offsetX:ft,offsetY:mt,dontFlip:wt})}convertToViewportPoint(nt,Y){return m.Util.applyTransform([nt,Y],this.transform)}convertToViewportRectangle(nt){const Y=m.Util.applyTransform([nt[0],nt[1]],this.transform),ft=m.Util.applyTransform([nt[2],nt[3]],this.transform);return[Y[0],Y[1],ft[0],ft[1]]}convertToPdfPoint(nt,Y){return m.Util.applyInverseTransform([nt,Y],this.transform)}}e.PageViewport=D;class o extends m.BaseException{constructor(nt,Y=0){super(nt,"RenderingCancelledException"),this.extraDelay=Y}}e.RenderingCancelledException=o;function g(bt){const nt=bt.length;let Y=0;for(;Y<nt&&bt[Y].trim()==="";)Y++;return bt.substring(Y,Y+5).toLowerCase()==="data:"}function _(bt){return typeof bt=="string"&&/\.pdf$/i.test(bt)}function w(bt,nt=!1){return nt||([bt]=bt.split(/[#?]/,1)),bt.substring(bt.lastIndexOf("/")+1)}function b(bt,nt="document.pdf"){if(typeof bt!="string")return nt;if(g(bt))return(0,m.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),nt;const Y=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,ft=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,mt=Y.exec(bt);let wt=ft.exec(mt[1])||ft.exec(mt[2])||ft.exec(mt[3]);if(wt&&(wt=wt[0],wt.includes("%")))try{wt=ft.exec(decodeURIComponent(wt))[0]}catch{}return wt||nt}class u{constructor(){Xt(this,"started",Object.create(null));Xt(this,"times",[])}time(nt){nt in this.started&&(0,m.warn)(`Timer is already running for ${nt}`),this.started[nt]=Date.now()}timeEnd(nt){nt in this.started||(0,m.warn)(`Timer has not been started for ${nt}`),this.times.push({name:nt,start:this.started[nt],end:Date.now()}),delete this.started[nt]}toString(){const nt=[];let Y=0;for(const{name:ft}of this.times)Y=Math.max(ft.length,Y);for(const{name:ft,start:mt,end:wt}of this.times)nt.push(`${ft.padEnd(Y)} ${wt-mt}ms
`);return nt.join("")}}e.StatTimer=u;function E(bt,nt){try{const{protocol:Y}=nt?new URL(bt,nt):new URL(bt);return Y==="http:"||Y==="https:"}catch{return!1}}function i(bt,nt=!1){return new Promise((Y,ft)=>{const mt=document.createElement("script");mt.src=bt,mt.onload=function(wt){nt&&mt.remove(),Y(wt)},mt.onerror=function(){ft(new Error(`Cannot load script at: ${mt.src}`))},(document.head||document.documentElement).append(mt)})}function t(bt){console.log("Deprecated API usage: "+bt)}let n;class h{static toDateObject(nt){if(!nt||typeof nt!="string")return null;n||(n=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Y=n.exec(nt);if(!Y)return null;const ft=parseInt(Y[1],10);let mt=parseInt(Y[2],10);mt=mt>=1&&mt<=12?mt-1:0;let wt=parseInt(Y[3],10);wt=wt>=1&&wt<=31?wt:1;let Rt=parseInt(Y[4],10);Rt=Rt>=0&&Rt<=23?Rt:0;let Bt=parseInt(Y[5],10);Bt=Bt>=0&&Bt<=59?Bt:0;let It=parseInt(Y[6],10);It=It>=0&&It<=59?It:0;const Ft=Y[7]||"Z";let C=parseInt(Y[8],10);C=C>=0&&C<=23?C:0;let P=parseInt(Y[9],10)||0;return P=P>=0&&P<=59?P:0,Ft==="-"?(Rt+=C,Bt+=P):Ft==="+"&&(Rt-=C,Bt-=P),new Date(Date.UTC(ft,mt,wt,Rt,Bt,It))}}e.PDFDateString=h;function p(bt,{scale:nt=1,rotation:Y=0}){const{width:ft,height:mt}=bt.attributes.style,wt=[0,0,parseInt(ft),parseInt(mt)];return new D({viewBox:wt,scale:nt,rotation:Y})}function F(bt){if(bt.startsWith("#")){const nt=parseInt(bt.slice(1),16);return[(nt&16711680)>>16,(nt&65280)>>8,nt&255]}return bt.startsWith("rgb(")?bt.slice(4,-1).split(",").map(nt=>parseInt(nt)):bt.startsWith("rgba(")?bt.slice(5,-1).split(",").map(nt=>parseInt(nt)).slice(0,3):((0,m.warn)(`Not a valid color format: "${bt}"`),[0,0,0])}function L(bt){const nt=document.createElement("span");nt.style.visibility="hidden",document.body.append(nt);for(const Y of bt.keys()){nt.style.color=Y;const ft=window.getComputedStyle(nt).color;bt.set(Y,F(ft))}nt.remove()}function K(bt){const{a:nt,b:Y,c:ft,d:mt,e:wt,f:Rt}=bt.getTransform();return[nt,Y,ft,mt,wt,Rt]}function x(bt){const{a:nt,b:Y,c:ft,d:mt,e:wt,f:Rt}=bt.getTransform().invertSelf();return[nt,Y,ft,mt,wt,Rt]}function $(bt,nt,Y=!1,ft=!0){if(nt instanceof D){const{pageWidth:mt,pageHeight:wt}=nt.rawDims,{style:Rt}=bt,Bt=`calc(var(--scale-factor) * ${mt}px)`,It=`calc(var(--scale-factor) * ${wt}px)`;!Y||nt.rotation%180===0?(Rt.width=Bt,Rt.height=It):(Rt.width=It,Rt.height=Bt)}ft&&bt.setAttribute("data-main-rotation",nt.rotation)}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseFilterFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var a=O(1);class m{constructor(){this.constructor===m&&(0,a.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(d){return"none"}addHCMFilter(d,R){return"none"}addHighlightHCMFilter(d,R,I,v){return"none"}destroy(d=!1){}}e.BaseFilterFactory=m;class G{constructor(){this.constructor===G&&(0,a.unreachable)("Cannot initialize BaseCanvasFactory.")}create(d,R){if(d<=0||R<=0)throw new Error("Invalid canvas size");const I=this._createCanvas(d,R);return{canvas:I,context:I.getContext("2d")}}reset(d,R,I){if(!d.canvas)throw new Error("Canvas is not specified");if(R<=0||I<=0)throw new Error("Invalid canvas size");d.canvas.width=R,d.canvas.height=I}destroy(d){if(!d.canvas)throw new Error("Canvas is not specified");d.canvas.width=0,d.canvas.height=0,d.canvas=null,d.context=null}_createCanvas(d,R){(0,a.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=G;class U{constructor({baseUrl:d=null,isCompressed:R=!0}){this.constructor===U&&(0,a.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=d,this.isCompressed=R}async fetch({name:d}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!d)throw new Error("CMap name must be specified.");const R=this.baseUrl+d+(this.isCompressed?".bcmap":""),I=this.isCompressed?a.CMapCompressionType.BINARY:a.CMapCompressionType.NONE;return this._fetchData(R,I).catch(v=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${R}`)})}_fetchData(d,R){(0,a.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=U;class et{constructor({baseUrl:d=null}){this.constructor===et&&(0,a.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=d}async fetch({filename:d}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!d)throw new Error("Font filename must be specified.");const R=`${this.baseUrl}${d}`;return this._fetchData(R).catch(I=>{throw new Error(`Unable to load font data at: ${R}`)})}_fetchData(d){(0,a.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=et;class X{constructor(){this.constructor===X&&(0,a.unreachable)("Cannot initialize BaseSVGFactory.")}create(d,R,I=!1){if(d<=0||R<=0)throw new Error("Invalid SVG dimensions");const v=this._createSVG("svg:svg");return v.setAttribute("version","1.1"),I||(v.setAttribute("width",`${d}px`),v.setAttribute("height",`${R}px`)),v.setAttribute("preserveAspectRatio","none"),v.setAttribute("viewBox",`0 0 ${d} ${R}`),v}createElement(d){if(typeof d!="string")throw new Error("Invalid SVG element type");return this._createSVG(d)}_createSVG(d){(0,a.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=X},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var a=O(1);const m=3285377520,G=4294901760,U=65535;class et{constructor(S){this.h1=S?S&4294967295:m,this.h2=S?S&4294967295:m}update(S){let d,R;if(typeof S=="string"){d=new Uint8Array(S.length*2),R=0;for(let t=0,n=S.length;t<n;t++){const h=S.charCodeAt(t);h<=255?d[R++]=h:(d[R++]=h>>>8,d[R++]=h&255)}}else if((0,a.isArrayBuffer)(S))d=S.slice(),R=d.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const I=R>>2,v=R-I*4,D=new Uint32Array(d.buffer,0,I);let o=0,g=0,_=this.h1,w=this.h2;const b=3432918353,u=461845907,E=b&U,i=u&U;for(let t=0;t<I;t++)t&1?(o=D[t],o=o*b&G|o*E&U,o=o<<15|o>>>17,o=o*u&G|o*i&U,_^=o,_=_<<13|_>>>19,_=_*5+3864292196):(g=D[t],g=g*b&G|g*E&U,g=g<<15|g>>>17,g=g*u&G|g*i&U,w^=g,w=w<<13|w>>>19,w=w*5+3864292196);switch(o=0,v){case 3:o^=d[I*4+2]<<16;case 2:o^=d[I*4+1]<<8;case 1:o^=d[I*4],o=o*b&G|o*E&U,o=o<<15|o>>>17,o=o*u&G|o*i&U,I&1?_^=o:w^=o}this.h1=_,this.h2=w}hexdigest(){let S=this.h1,d=this.h2;return S^=d>>>1,S=S*3981806797&G|S*36045&U,d=d*4283543511&G|((d<<16|S>>>16)*2950163797&G)>>>16,S^=d>>>1,S=S*444984403&G|S*60499&U,d=d*3301882366&G|((d<<16|S>>>16)*3120437893&G)>>>16,S^=d>>>1,(S>>>0).toString(16).padStart(8,"0")+(d>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=et},(tt,e,O)=>{var et;Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var a=O(1),m=O(10);class G{constructor({ownerDocument:S=globalThis.document,styleElement:d=null}){q(this,et,new Set);this._document=S,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(S){this.nativeFontFaces.add(S),this._document.fonts.add(S)}removeNativeFontFace(S){this.nativeFontFaces.delete(S),this._document.fonts.delete(S)}insertRule(S){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const d=this.styleElement.sheet;d.insertRule(S,d.cssRules.length)}clear(){for(const S of this.nativeFontFaces)this._document.fonts.delete(S);this.nativeFontFaces.clear(),s(this,et).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(S){if(!(!S||s(this,et).has(S.loadedName))){if((0,a.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:d,src:R,style:I}=S,v=new FontFace(d,R,I);this.addNativeFontFace(v);try{await v.load(),s(this,et).add(d)}catch{(0,a.warn)(`Cannot load system font: ${S.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(v)}return}(0,a.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(S){if(S.attached||S.missingFile&&!S.systemFontInfo)return;if(S.attached=!0,S.systemFontInfo){await this.loadSystemFont(S.systemFontInfo);return}if(this.isFontLoadingAPISupported){const R=S.createNativeFontFace();if(R){this.addNativeFontFace(R);try{await R.loaded}catch(I){throw(0,a.warn)(`Failed to load font '${R.family}': '${I}'.`),S.disableFontFace=!0,I}}return}const d=S.createFontFaceRule();if(d){if(this.insertRule(d),this.isSyncFontLoadingSupported)return;await new Promise(R=>{const I=this._queueLoadingCallback(R);this._prepareFontLoadEvent(S,I)})}}get isFontLoadingAPISupported(){var d;const S=!!((d=this._document)!=null&&d.fonts);return(0,a.shadow)(this,"isFontLoadingAPISupported",S)}get isSyncFontLoadingSupported(){let S=!1;return(m.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(S=!0),(0,a.shadow)(this,"isSyncFontLoadingSupported",S)}_queueLoadingCallback(S){function d(){for((0,a.assert)(!I.done,"completeRequest() cannot be called twice."),I.done=!0;R.length>0&&R[0].done;){const v=R.shift();setTimeout(v.callback,0)}}const{loadingRequests:R}=this,I={done:!1,complete:d,callback:S};return R.push(I),I}get _loadTestFont(){const S=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,a.shadow)(this,"_loadTestFont",S)}_prepareFontLoadEvent(S,d){function R(L,K){return L.charCodeAt(K)<<24|L.charCodeAt(K+1)<<16|L.charCodeAt(K+2)<<8|L.charCodeAt(K+3)&255}function I(L,K,x,$){const at=L.substring(0,K),dt=L.substring(K+x);return at+$+dt}let v,D;const o=this._document.createElement("canvas");o.width=1,o.height=1;const g=o.getContext("2d");let _=0;function w(L,K){if(++_>30){(0,a.warn)("Load test font never loaded."),K();return}if(g.font="30px "+L,g.fillText(".",0,20),g.getImageData(0,0,1,1).data[3]>0){K();return}setTimeout(w.bind(null,L,K))}const b=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=I(u,976,b.length,b);const i=16,t=1482184792;let n=R(u,i);for(v=0,D=b.length-3;v<D;v+=4)n=n-t+R(b,v)|0;v<b.length&&(n=n-t+R(b+"XXX",v)|0),u=I(u,i,4,(0,a.string32)(n));const h=`url(data:font/opentype;base64,${btoa(u)});`,p=`@font-face {font-family:"${b}";src:${h}}`;this.insertRule(p);const F=this._document.createElement("div");F.style.visibility="hidden",F.style.width=F.style.height="10px",F.style.position="absolute",F.style.top=F.style.left="0px";for(const L of[S.loadedName,b]){const K=this._document.createElement("span");K.textContent="Hi",K.style.fontFamily=L,F.append(K)}this._document.body.append(F),w(b,()=>{F.remove(),d.complete()})}}et=new WeakMap,e.FontLoader=G;class U{constructor(S,{isEvalSupported:d=!0,disableFontFace:R=!1,ignoreErrors:I=!1,inspectFont:v=null}){this.compiledGlyphs=Object.create(null);for(const D in S)this[D]=S[D];this.isEvalSupported=d!==!1,this.disableFontFace=R===!0,this.ignoreErrors=I===!0,this._inspectFont=v}createNativeFontFace(){var d;if(!this.data||this.disableFontFace)return null;let S;if(!this.cssFontInfo)S=new FontFace(this.loadedName,this.data,{});else{const R={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(R.style=`oblique ${this.cssFontInfo.italicAngle}deg`),S=new FontFace(this.cssFontInfo.fontFamily,this.data,R)}return(d=this._inspectFont)==null||d.call(this,this),S}createFontFaceRule(){var I;if(!this.data||this.disableFontFace)return null;const S=(0,a.bytesToString)(this.data),d=`url(data:${this.mimetype};base64,${btoa(S)});`;let R;if(!this.cssFontInfo)R=`@font-face {font-family:"${this.loadedName}";src:${d}}`;else{let v=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(v+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),R=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${v}src:${d}}`}return(I=this._inspectFont)==null||I.call(this,this,d),R}getPathGenerator(S,d){if(this.compiledGlyphs[d]!==void 0)return this.compiledGlyphs[d];let R;try{R=S.get(this.loadedName+"_path_"+d)}catch(I){if(!this.ignoreErrors)throw I;return(0,a.warn)(`getPathGenerator - ignoring character: "${I}".`),this.compiledGlyphs[d]=function(v,D){}}if(this.isEvalSupported&&a.FeatureTest.isEvalSupported){const I=[];for(const v of R){const D=v.args!==void 0?v.args.join(","):"";I.push("c.",v.cmd,"(",D,`);
`)}return this.compiledGlyphs[d]=new Function("c","size",I.join(""))}return this.compiledGlyphs[d]=function(I,v){for(const D of R)D.cmd==="scale"&&(D.args=[v,-v]),I[D.cmd].apply(I,D.args)}}}e.FontFaceObject=U},(tt,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const O=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=O},(tt,e,O)=>{var it,Ie,vt,Le;Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var a=O(1),m=O(6),G=O(12),U=O(13),et=O(10);const X=16,S=100,d=4096,R=15,I=10,v=1e3,D=16;function o(j,c){if(j._removeMirroring)throw new Error("Context is already forwarding operations.");j.__originalSave=j.save,j.__originalRestore=j.restore,j.__originalRotate=j.rotate,j.__originalScale=j.scale,j.__originalTranslate=j.translate,j.__originalTransform=j.transform,j.__originalSetTransform=j.setTransform,j.__originalResetTransform=j.resetTransform,j.__originalClip=j.clip,j.__originalMoveTo=j.moveTo,j.__originalLineTo=j.lineTo,j.__originalBezierCurveTo=j.bezierCurveTo,j.__originalRect=j.rect,j.__originalClosePath=j.closePath,j.__originalBeginPath=j.beginPath,j._removeMirroring=()=>{j.save=j.__originalSave,j.restore=j.__originalRestore,j.rotate=j.__originalRotate,j.scale=j.__originalScale,j.translate=j.__originalTranslate,j.transform=j.__originalTransform,j.setTransform=j.__originalSetTransform,j.resetTransform=j.__originalResetTransform,j.clip=j.__originalClip,j.moveTo=j.__originalMoveTo,j.lineTo=j.__originalLineTo,j.bezierCurveTo=j.__originalBezierCurveTo,j.rect=j.__originalRect,j.closePath=j.__originalClosePath,j.beginPath=j.__originalBeginPath,delete j._removeMirroring},j.save=function(){c.save(),this.__originalSave()},j.restore=function(){c.restore(),this.__originalRestore()},j.translate=function(y,M){c.translate(y,M),this.__originalTranslate(y,M)},j.scale=function(y,M){c.scale(y,M),this.__originalScale(y,M)},j.transform=function(y,M,N,H,z,Q){c.transform(y,M,N,H,z,Q),this.__originalTransform(y,M,N,H,z,Q)},j.setTransform=function(y,M,N,H,z,Q){c.setTransform(y,M,N,H,z,Q),this.__originalSetTransform(y,M,N,H,z,Q)},j.resetTransform=function(){c.resetTransform(),this.__originalResetTransform()},j.rotate=function(y){c.rotate(y),this.__originalRotate(y)},j.clip=function(y){c.clip(y),this.__originalClip(y)},j.moveTo=function(l,y){c.moveTo(l,y),this.__originalMoveTo(l,y)},j.lineTo=function(l,y){c.lineTo(l,y),this.__originalLineTo(l,y)},j.bezierCurveTo=function(l,y,M,N,H,z){c.bezierCurveTo(l,y,M,N,H,z),this.__originalBezierCurveTo(l,y,M,N,H,z)},j.rect=function(l,y,M,N){c.rect(l,y,M,N),this.__originalRect(l,y,M,N)},j.closePath=function(){c.closePath(),this.__originalClosePath()},j.beginPath=function(){c.beginPath(),this.__originalBeginPath()}}class g{constructor(c){this.canvasFactory=c,this.cache=Object.create(null)}getCanvas(c,l,y){let M;return this.cache[c]!==void 0?(M=this.cache[c],this.canvasFactory.reset(M,l,y)):(M=this.canvasFactory.create(l,y),this.cache[c]=M),M}delete(c){delete this.cache[c]}clear(){for(const c in this.cache){const l=this.cache[c];this.canvasFactory.destroy(l),delete this.cache[c]}}}function _(j,c,l,y,M,N,H,z,Q,rt){const[ot,ht,ut,Et,pt,xt]=(0,m.getCurrentTransform)(j);if(ht===0&&ut===0){const bt=H*ot+pt,nt=Math.round(bt),Y=z*Et+xt,ft=Math.round(Y),mt=(H+Q)*ot+pt,wt=Math.abs(Math.round(mt)-nt)||1,Rt=(z+rt)*Et+xt,Bt=Math.abs(Math.round(Rt)-ft)||1;return j.setTransform(Math.sign(ot),0,0,Math.sign(Et),nt,ft),j.drawImage(c,l,y,M,N,0,0,wt,Bt),j.setTransform(ot,ht,ut,Et,pt,xt),[wt,Bt]}if(ot===0&&Et===0){const bt=z*ut+pt,nt=Math.round(bt),Y=H*ht+xt,ft=Math.round(Y),mt=(z+rt)*ut+pt,wt=Math.abs(Math.round(mt)-nt)||1,Rt=(H+Q)*ht+xt,Bt=Math.abs(Math.round(Rt)-ft)||1;return j.setTransform(0,Math.sign(ht),Math.sign(ut),0,nt,ft),j.drawImage(c,l,y,M,N,0,0,Bt,wt),j.setTransform(ot,ht,ut,Et,pt,xt),[Bt,wt]}j.drawImage(c,l,y,M,N,H,z,Q,rt);const Ot=Math.hypot(ot,ht),Tt=Math.hypot(ut,Et);return[Ot*Q,Tt*rt]}function w(j){const{width:c,height:l}=j;if(c>v||l>v)return null;const y=1e3,M=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),N=c+1;let H=new Uint8Array(N*(l+1)),z,Q,rt;const ot=c+7&-8;let ht=new Uint8Array(ot*l),ut=0;for(const Tt of j.data){let bt=128;for(;bt>0;)ht[ut++]=Tt&bt?0:255,bt>>=1}let Et=0;for(ut=0,ht[ut]!==0&&(H[0]=1,++Et),Q=1;Q<c;Q++)ht[ut]!==ht[ut+1]&&(H[Q]=ht[ut]?2:1,++Et),ut++;for(ht[ut]!==0&&(H[Q]=2,++Et),z=1;z<l;z++){ut=z*ot,rt=z*N,ht[ut-ot]!==ht[ut]&&(H[rt]=ht[ut]?1:8,++Et);let Tt=(ht[ut]?4:0)+(ht[ut-ot]?8:0);for(Q=1;Q<c;Q++)Tt=(Tt>>2)+(ht[ut+1]?4:0)+(ht[ut-ot+1]?8:0),M[Tt]&&(H[rt+Q]=M[Tt],++Et),ut++;if(ht[ut-ot]!==ht[ut]&&(H[rt+Q]=ht[ut]?2:4,++Et),Et>y)return null}for(ut=ot*(l-1),rt=z*N,ht[ut]!==0&&(H[rt]=8,++Et),Q=1;Q<c;Q++)ht[ut]!==ht[ut+1]&&(H[rt+Q]=ht[ut]?4:8,++Et),ut++;if(ht[ut]!==0&&(H[rt+Q]=4,++Et),Et>y)return null;const pt=new Int32Array([0,N,-1,0,-N,0,0,0,1]),xt=new Path2D;for(z=0;Et&&z<=l;z++){let Tt=z*N;const bt=Tt+c;for(;Tt<bt&&!H[Tt];)Tt++;if(Tt===bt)continue;xt.moveTo(Tt%N,z);const nt=Tt;let Y=H[Tt];do{const ft=pt[Y];do Tt+=ft;while(!H[Tt]);const mt=H[Tt];mt!==5&&mt!==10?(Y=mt,H[Tt]=0):(Y=mt&51*Y>>4,H[Tt]&=Y>>2|Y<<2),xt.lineTo(Tt%N,Tt/N|0),H[Tt]||--Et}while(nt!==Tt);--z}return ht=null,H=null,function(Tt){Tt.save(),Tt.scale(1/c,-1/l),Tt.translate(0,-l),Tt.fill(xt),Tt.beginPath(),Tt.restore()}}class b{constructor(c,l){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=a.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=a.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=a.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,c,l])}clone(){const c=Object.create(this);return c.clipBox=this.clipBox.slice(),c}setCurrentPoint(c,l){this.x=c,this.y=l}updatePathMinMax(c,l,y){[l,y]=a.Util.applyTransform([l,y],c),this.minX=Math.min(this.minX,l),this.minY=Math.min(this.minY,y),this.maxX=Math.max(this.maxX,l),this.maxY=Math.max(this.maxY,y)}updateRectMinMax(c,l){const y=a.Util.applyTransform(l,c),M=a.Util.applyTransform(l.slice(2),c);this.minX=Math.min(this.minX,y[0],M[0]),this.minY=Math.min(this.minY,y[1],M[1]),this.maxX=Math.max(this.maxX,y[0],M[0]),this.maxY=Math.max(this.maxY,y[1],M[1])}updateScalingPathMinMax(c,l){a.Util.scaleMinMax(c,l),this.minX=Math.min(this.minX,l[0]),this.maxX=Math.max(this.maxX,l[1]),this.minY=Math.min(this.minY,l[2]),this.maxY=Math.max(this.maxY,l[3])}updateCurvePathMinMax(c,l,y,M,N,H,z,Q,rt,ot){const ht=a.Util.bezierBoundingBox(l,y,M,N,H,z,Q,rt);if(ot){ot[0]=Math.min(ot[0],ht[0],ht[2]),ot[1]=Math.max(ot[1],ht[0],ht[2]),ot[2]=Math.min(ot[2],ht[1],ht[3]),ot[3]=Math.max(ot[3],ht[1],ht[3]);return}this.updateRectMinMax(c,ht)}getPathBoundingBox(c=G.PathType.FILL,l=null){const y=[this.minX,this.minY,this.maxX,this.maxY];if(c===G.PathType.STROKE){l||(0,a.unreachable)("Stroke bounding box must include transform.");const M=a.Util.singularValueDecompose2dScale(l),N=M[0]*this.lineWidth/2,H=M[1]*this.lineWidth/2;y[0]-=N,y[1]-=H,y[2]+=N,y[3]+=H}return y}updateClipFromPath(){const c=a.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(c||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(c){this.clipBox=c,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(c=G.PathType.FILL,l=null){return a.Util.intersect(this.clipBox,this.getPathBoundingBox(c,l))}}function u(j,c){if(typeof ImageData<"u"&&c instanceof ImageData){j.putImageData(c,0,0);return}const l=c.height,y=c.width,M=l%D,N=(l-M)/D,H=M===0?N:N+1,z=j.createImageData(y,D);let Q=0,rt;const ot=c.data,ht=z.data;let ut,Et,pt,xt;if(c.kind===a.ImageKind.GRAYSCALE_1BPP){const Ot=ot.byteLength,Tt=new Uint32Array(ht.buffer,0,ht.byteLength>>2),bt=Tt.length,nt=y+7>>3,Y=4294967295,ft=a.FeatureTest.isLittleEndian?4278190080:255;for(ut=0;ut<H;ut++){for(pt=ut<N?D:M,rt=0,Et=0;Et<pt;Et++){const mt=Ot-Q;let wt=0;const Rt=mt>nt?y:mt*8-7,Bt=Rt&-8;let It=0,Ft=0;for(;wt<Bt;wt+=8)Ft=ot[Q++],Tt[rt++]=Ft&128?Y:ft,Tt[rt++]=Ft&64?Y:ft,Tt[rt++]=Ft&32?Y:ft,Tt[rt++]=Ft&16?Y:ft,Tt[rt++]=Ft&8?Y:ft,Tt[rt++]=Ft&4?Y:ft,Tt[rt++]=Ft&2?Y:ft,Tt[rt++]=Ft&1?Y:ft;for(;wt<Rt;wt++)It===0&&(Ft=ot[Q++],It=128),Tt[rt++]=Ft&It?Y:ft,It>>=1}for(;rt<bt;)Tt[rt++]=0;j.putImageData(z,0,ut*D)}}else if(c.kind===a.ImageKind.RGBA_32BPP){for(Et=0,xt=y*D*4,ut=0;ut<N;ut++)ht.set(ot.subarray(Q,Q+xt)),Q+=xt,j.putImageData(z,0,Et),Et+=D;ut<H&&(xt=y*M*4,ht.set(ot.subarray(Q,Q+xt)),j.putImageData(z,0,Et))}else if(c.kind===a.ImageKind.RGB_24BPP)for(pt=D,xt=y*pt,ut=0;ut<H;ut++){for(ut>=N&&(pt=M,xt=y*pt),rt=0,Et=xt;Et--;)ht[rt++]=ot[Q++],ht[rt++]=ot[Q++],ht[rt++]=ot[Q++],ht[rt++]=255;j.putImageData(z,0,ut*D)}else throw new Error(`bad image kind: ${c.kind}`)}function E(j,c){if(c.bitmap){j.drawImage(c.bitmap,0,0);return}const l=c.height,y=c.width,M=l%D,N=(l-M)/D,H=M===0?N:N+1,z=j.createImageData(y,D);let Q=0;const rt=c.data,ot=z.data;for(let ht=0;ht<H;ht++){const ut=ht<N?D:M;({srcPos:Q}=(0,U.convertBlackAndWhiteToRGBA)({src:rt,srcPos:Q,dest:ot,width:y,height:ut,nonBlackColor:0})),j.putImageData(z,0,ht*D)}}function i(j,c){const l=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const y of l)j[y]!==void 0&&(c[y]=j[y]);j.setLineDash!==void 0&&(c.setLineDash(j.getLineDash()),c.lineDashOffset=j.lineDashOffset)}function t(j){j.strokeStyle=j.fillStyle="#000000",j.fillRule="nonzero",j.globalAlpha=1,j.lineWidth=1,j.lineCap="butt",j.lineJoin="miter",j.miterLimit=10,j.globalCompositeOperation="source-over",j.font="10px sans-serif",j.setLineDash!==void 0&&(j.setLineDash([]),j.lineDashOffset=0),et.isNodeJS||(j.filter="none")}function n(j,c,l,y){const M=j.length;for(let N=3;N<M;N+=4){const H=j[N];if(H===0)j[N-3]=c,j[N-2]=l,j[N-1]=y;else if(H<255){const z=255-H;j[N-3]=j[N-3]*H+c*z>>8,j[N-2]=j[N-2]*H+l*z>>8,j[N-1]=j[N-1]*H+y*z>>8}}}function h(j,c,l){const y=j.length,M=1/255;for(let N=3;N<y;N+=4){const H=l?l[j[N]]:j[N];c[N]=c[N]*H*M|0}}function p(j,c,l){const y=j.length;for(let M=3;M<y;M+=4){const N=j[M-3]*77+j[M-2]*152+j[M-1]*28;c[M]=l?c[M]*l[N>>8]>>8:c[M]*N>>16}}function F(j,c,l,y,M,N,H,z,Q,rt,ot){const ht=!!N,ut=ht?N[0]:0,Et=ht?N[1]:0,pt=ht?N[2]:0;let xt;M==="Luminosity"?xt=p:xt=h;const Tt=Math.min(y,Math.ceil(1048576/l));for(let bt=0;bt<y;bt+=Tt){const nt=Math.min(Tt,y-bt),Y=j.getImageData(z-rt,bt+(Q-ot),l,nt),ft=c.getImageData(z,bt+Q,l,nt);ht&&n(Y.data,ut,Et,pt),xt(Y.data,ft.data,H),c.putImageData(ft,z,bt+Q)}}function L(j,c,l,y){const M=y[0],N=y[1],H=y[2]-M,z=y[3]-N;H===0||z===0||(F(c.context,l,H,z,c.subtype,c.backdrop,c.transferMap,M,N,c.offsetX,c.offsetY),j.save(),j.globalAlpha=1,j.globalCompositeOperation="source-over",j.setTransform(1,0,0,1,0,0),j.drawImage(l.canvas,0,0),j.restore())}function K(j,c){const l=a.Util.singularValueDecompose2dScale(j);l[0]=Math.fround(l[0]),l[1]=Math.fround(l[1]);const y=Math.fround((globalThis.devicePixelRatio||1)*m.PixelsPerInch.PDF_TO_CSS_UNITS);return c!==void 0?c:l[0]<=y||l[1]<=y}const x=["butt","round","square"],$=["miter","round","bevel"],at={},dt={},Dt=class Dt{constructor(c,l,y,M,N,{optionalContentConfig:H,markedContentStack:z=null},Q,rt){q(this,it);q(this,vt);this.ctx=c,this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=l,this.objs=y,this.canvasFactory=M,this.filterFactory=N,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=z||[],this.optionalContentConfig=H,this.cachedCanvases=new g(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Q,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=rt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(c,l=null){return typeof c=="string"?c.startsWith("g_")?this.commonObjs.get(c):this.objs.get(c):l}beginDrawing({transform:c,viewport:l,transparency:y=!1,background:M=null}){const N=this.ctx.canvas.width,H=this.ctx.canvas.height,z=this.ctx.fillStyle;if(this.ctx.fillStyle=M||"#ffffff",this.ctx.fillRect(0,0,N,H),this.ctx.fillStyle=z,y){const Q=this.cachedCanvases.getCanvas("transparent",N,H);this.compositeCtx=this.ctx,this.transparentCanvas=Q.canvas,this.ctx=Q.context,this.ctx.save(),this.ctx.transform(...(0,m.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),t(this.ctx),c&&(this.ctx.transform(...c),this.outputScaleX=c[0],this.outputScaleY=c[0]),this.ctx.transform(...l.transform),this.viewportScale=l.scale,this.baseTransform=(0,m.getCurrentTransform)(this.ctx)}executeOperatorList(c,l,y,M){const N=c.argsArray,H=c.fnArray;let z=l||0;const Q=N.length;if(Q===z)return z;const rt=Q-z>I&&typeof y=="function",ot=rt?Date.now()+R:0;let ht=0;const ut=this.commonObjs,Et=this.objs;let pt;for(;;){if(M!==void 0&&z===M.nextBreakPoint)return M.breakIt(z,y),z;if(pt=H[z],pt!==a.OPS.dependency)this[pt].apply(this,N[z]);else for(const xt of N[z]){const Ot=xt.startsWith("g_")?ut:Et;if(!Ot.has(xt))return Ot.get(xt,y),z}if(z++,z===Q)return z;if(rt&&++ht>I){if(Date.now()>ot)return y(),z;ht=0}}}endDrawing(){st(this,it,Ie).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const c of this._cachedBitmapsMap.values()){for(const l of c.values())typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement&&(l.width=l.height=0);c.clear()}this._cachedBitmapsMap.clear(),st(this,vt,Le).call(this)}_scaleImage(c,l){const y=c.width,M=c.height;let N=Math.max(Math.hypot(l[0],l[1]),1),H=Math.max(Math.hypot(l[2],l[3]),1),z=y,Q=M,rt="prescale1",ot,ht;for(;N>2&&z>1||H>2&&Q>1;){let ut=z,Et=Q;N>2&&z>1&&(ut=z>=16384?Math.floor(z/2)-1||1:Math.ceil(z/2),N/=z/ut),H>2&&Q>1&&(Et=Q>=16384?Math.floor(Q/2)-1||1:Math.ceil(Q)/2,H/=Q/Et),ot=this.cachedCanvases.getCanvas(rt,ut,Et),ht=ot.context,ht.clearRect(0,0,ut,Et),ht.drawImage(c,0,0,z,Q,0,0,ut,Et),c=ot.canvas,z=ut,Q=Et,rt=rt==="prescale1"?"prescale2":"prescale1"}return{img:c,paintWidth:z,paintHeight:Q}}_createMaskCanvas(c){const l=this.ctx,{width:y,height:M}=c,N=this.current.fillColor,H=this.current.patternFill,z=(0,m.getCurrentTransform)(l);let Q,rt,ot,ht;if((c.bitmap||c.data)&&c.count>1){const wt=c.bitmap||c.data.buffer;rt=JSON.stringify(H?z:[z.slice(0,4),N]),Q=this._cachedBitmapsMap.get(wt),Q||(Q=new Map,this._cachedBitmapsMap.set(wt,Q));const Rt=Q.get(rt);if(Rt&&!H){const Bt=Math.round(Math.min(z[0],z[2])+z[4]),It=Math.round(Math.min(z[1],z[3])+z[5]);return{canvas:Rt,offsetX:Bt,offsetY:It}}ot=Rt}ot||(ht=this.cachedCanvases.getCanvas("maskCanvas",y,M),E(ht.context,c));let ut=a.Util.transform(z,[1/y,0,0,-1/M,0,0]);ut=a.Util.transform(ut,[1,0,0,1,0,-M]);const Et=a.Util.applyTransform([0,0],ut),pt=a.Util.applyTransform([y,M],ut),xt=a.Util.normalizeRect([Et[0],Et[1],pt[0],pt[1]]),Ot=Math.round(xt[2]-xt[0])||1,Tt=Math.round(xt[3]-xt[1])||1,bt=this.cachedCanvases.getCanvas("fillCanvas",Ot,Tt),nt=bt.context,Y=Math.min(Et[0],pt[0]),ft=Math.min(Et[1],pt[1]);nt.translate(-Y,-ft),nt.transform(...ut),ot||(ot=this._scaleImage(ht.canvas,(0,m.getCurrentTransformInverse)(nt)),ot=ot.img,Q&&H&&Q.set(rt,ot)),nt.imageSmoothingEnabled=K((0,m.getCurrentTransform)(nt),c.interpolate),_(nt,ot,0,0,ot.width,ot.height,0,0,y,M),nt.globalCompositeOperation="source-in";const mt=a.Util.transform((0,m.getCurrentTransformInverse)(nt),[1,0,0,1,-Y,-ft]);return nt.fillStyle=H?N.getPattern(l,this,mt,G.PathType.FILL):N,nt.fillRect(0,0,y,M),Q&&!H&&(this.cachedCanvases.delete("fillCanvas"),Q.set(rt,bt.canvas)),{canvas:bt.canvas,offsetX:Math.round(Y),offsetY:Math.round(ft)}}setLineWidth(c){c!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=c,this.ctx.lineWidth=c}setLineCap(c){this.ctx.lineCap=x[c]}setLineJoin(c){this.ctx.lineJoin=$[c]}setMiterLimit(c){this.ctx.miterLimit=c}setDash(c,l){const y=this.ctx;y.setLineDash!==void 0&&(y.setLineDash(c),y.lineDashOffset=l)}setRenderingIntent(c){}setFlatness(c){}setGState(c){for(const[l,y]of c)switch(l){case"LW":this.setLineWidth(y);break;case"LC":this.setLineCap(y);break;case"LJ":this.setLineJoin(y);break;case"ML":this.setMiterLimit(y);break;case"D":this.setDash(y[0],y[1]);break;case"RI":this.setRenderingIntent(y);break;case"FL":this.setFlatness(y);break;case"Font":this.setFont(y[0],y[1]);break;case"CA":this.current.strokeAlpha=y;break;case"ca":this.current.fillAlpha=y,this.ctx.globalAlpha=y;break;case"BM":this.ctx.globalCompositeOperation=y;break;case"SMask":this.current.activeSMask=y?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(y);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const c=this.inSMaskMode;this.current.activeSMask&&!c?this.beginSMaskMode():!this.current.activeSMask&&c&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const c=this.ctx.canvas.width,l=this.ctx.canvas.height,y="smaskGroupAt"+this.groupLevel,M=this.cachedCanvases.getCanvas(y,c,l);this.suspendedCtx=this.ctx,this.ctx=M.context;const N=this.ctx;N.setTransform(...(0,m.getCurrentTransform)(this.suspendedCtx)),i(this.suspendedCtx,N),o(N,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),i(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(c){if(!this.current.activeSMask)return;c?(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.ceil(c[2]),c[3]=Math.ceil(c[3])):c=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const l=this.current.activeSMask,y=this.suspendedCtx;L(y,l,this.ctx,c),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(i(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const c=this.current;this.stateStack.push(c),this.current=c.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),i(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(c,l,y,M,N,H){this.ctx.transform(c,l,y,M,N,H),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(c,l,y){const M=this.ctx,N=this.current;let H=N.x,z=N.y,Q,rt;const ot=(0,m.getCurrentTransform)(M),ht=ot[0]===0&&ot[3]===0||ot[1]===0&&ot[2]===0,ut=ht?y.slice(0):null;for(let Et=0,pt=0,xt=c.length;Et<xt;Et++)switch(c[Et]|0){case a.OPS.rectangle:H=l[pt++],z=l[pt++];const Ot=l[pt++],Tt=l[pt++],bt=H+Ot,nt=z+Tt;M.moveTo(H,z),Ot===0||Tt===0?M.lineTo(bt,nt):(M.lineTo(bt,z),M.lineTo(bt,nt),M.lineTo(H,nt)),ht||N.updateRectMinMax(ot,[H,z,bt,nt]),M.closePath();break;case a.OPS.moveTo:H=l[pt++],z=l[pt++],M.moveTo(H,z),ht||N.updatePathMinMax(ot,H,z);break;case a.OPS.lineTo:H=l[pt++],z=l[pt++],M.lineTo(H,z),ht||N.updatePathMinMax(ot,H,z);break;case a.OPS.curveTo:Q=H,rt=z,H=l[pt+4],z=l[pt+5],M.bezierCurveTo(l[pt],l[pt+1],l[pt+2],l[pt+3],H,z),N.updateCurvePathMinMax(ot,Q,rt,l[pt],l[pt+1],l[pt+2],l[pt+3],H,z,ut),pt+=6;break;case a.OPS.curveTo2:Q=H,rt=z,M.bezierCurveTo(H,z,l[pt],l[pt+1],l[pt+2],l[pt+3]),N.updateCurvePathMinMax(ot,Q,rt,H,z,l[pt],l[pt+1],l[pt+2],l[pt+3],ut),H=l[pt+2],z=l[pt+3],pt+=4;break;case a.OPS.curveTo3:Q=H,rt=z,H=l[pt+2],z=l[pt+3],M.bezierCurveTo(l[pt],l[pt+1],H,z,H,z),N.updateCurvePathMinMax(ot,Q,rt,l[pt],l[pt+1],H,z,H,z,ut),pt+=4;break;case a.OPS.closePath:M.closePath();break}ht&&N.updateScalingPathMinMax(ot,ut),N.setCurrentPoint(H,z)}closePath(){this.ctx.closePath()}stroke(c=!0){const l=this.ctx,y=this.current.strokeColor;l.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof y=="object"&&(y!=null&&y.getPattern)?(l.save(),l.strokeStyle=y.getPattern(l,this,(0,m.getCurrentTransformInverse)(l),G.PathType.STROKE),this.rescaleAndStroke(!1),l.restore()):this.rescaleAndStroke(!0)),c&&this.consumePath(this.current.getClippedPathBoundingBox()),l.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(c=!0){const l=this.ctx,y=this.current.fillColor,M=this.current.patternFill;let N=!1;M&&(l.save(),l.fillStyle=y.getPattern(l,this,(0,m.getCurrentTransformInverse)(l),G.PathType.FILL),N=!0);const H=this.current.getClippedPathBoundingBox();this.contentVisible&&H!==null&&(this.pendingEOFill?(l.fill("evenodd"),this.pendingEOFill=!1):l.fill()),N&&l.restore(),c&&this.consumePath(H)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=at}eoClip(){this.pendingClip=dt}beginText(){this.current.textMatrix=a.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const c=this.pendingTextPaths,l=this.ctx;if(c===void 0){l.beginPath();return}l.save(),l.beginPath();for(const y of c)l.setTransform(...y.transform),l.translate(y.x,y.y),y.addToPath(l,y.fontSize);l.restore(),l.clip(),l.beginPath(),delete this.pendingTextPaths}setCharSpacing(c){this.current.charSpacing=c}setWordSpacing(c){this.current.wordSpacing=c}setHScale(c){this.current.textHScale=c/100}setLeading(c){this.current.leading=-c}setFont(c,l){var ot;const y=this.commonObjs.get(c),M=this.current;if(!y)throw new Error(`Can't find font for ${c}`);if(M.fontMatrix=y.fontMatrix||a.FONT_IDENTITY_MATRIX,(M.fontMatrix[0]===0||M.fontMatrix[3]===0)&&(0,a.warn)("Invalid font matrix for font "+c),l<0?(l=-l,M.fontDirection=-1):M.fontDirection=1,this.current.font=y,this.current.fontSize=l,y.isType3Font)return;const N=y.loadedName||"sans-serif",H=((ot=y.systemFontInfo)==null?void 0:ot.css)||`"${N}", ${y.fallbackName}`;let z="normal";y.black?z="900":y.bold&&(z="bold");const Q=y.italic?"italic":"normal";let rt=l;l<X?rt=X:l>S&&(rt=S),this.current.fontSizeScale=l/rt,this.ctx.font=`${Q} ${z} ${rt}px ${H}`}setTextRenderingMode(c){this.current.textRenderingMode=c}setTextRise(c){this.current.textRise=c}moveText(c,l){this.current.x=this.current.lineX+=c,this.current.y=this.current.lineY+=l}setLeadingMoveText(c,l){this.setLeading(-l),this.moveText(c,l)}setTextMatrix(c,l,y,M,N,H){this.current.textMatrix=[c,l,y,M,N,H],this.current.textMatrixScale=Math.hypot(c,l),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(c,l,y,M){const N=this.ctx,H=this.current,z=H.font,Q=H.textRenderingMode,rt=H.fontSize/H.fontSizeScale,ot=Q&a.TextRenderingMode.FILL_STROKE_MASK,ht=!!(Q&a.TextRenderingMode.ADD_TO_PATH_FLAG),ut=H.patternFill&&!z.missingFile;let Et;(z.disableFontFace||ht||ut)&&(Et=z.getPathGenerator(this.commonObjs,c)),z.disableFontFace||ut?(N.save(),N.translate(l,y),N.beginPath(),Et(N,rt),M&&N.setTransform(...M),(ot===a.TextRenderingMode.FILL||ot===a.TextRenderingMode.FILL_STROKE)&&N.fill(),(ot===a.TextRenderingMode.STROKE||ot===a.TextRenderingMode.FILL_STROKE)&&N.stroke(),N.restore()):((ot===a.TextRenderingMode.FILL||ot===a.TextRenderingMode.FILL_STROKE)&&N.fillText(c,l,y),(ot===a.TextRenderingMode.STROKE||ot===a.TextRenderingMode.FILL_STROKE)&&N.strokeText(c,l,y)),ht&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,m.getCurrentTransform)(N),x:l,y,fontSize:rt,addToPath:Et})}get isFontSubpixelAAEnabled(){const{context:c}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);c.scale(1.5,1),c.fillText("I",0,10);const l=c.getImageData(0,0,10,10).data;let y=!1;for(let M=3;M<l.length;M+=4)if(l[M]>0&&l[M]<255){y=!0;break}return(0,a.shadow)(this,"isFontSubpixelAAEnabled",y)}showText(c){const l=this.current,y=l.font;if(y.isType3Font)return this.showType3Text(c);const M=l.fontSize;if(M===0)return;const N=this.ctx,H=l.fontSizeScale,z=l.charSpacing,Q=l.wordSpacing,rt=l.fontDirection,ot=l.textHScale*rt,ht=c.length,ut=y.vertical,Et=ut?1:-1,pt=y.defaultVMetrics,xt=M*l.fontMatrix[0],Ot=l.textRenderingMode===a.TextRenderingMode.FILL&&!y.disableFontFace&&!l.patternFill;N.save(),N.transform(...l.textMatrix),N.translate(l.x,l.y+l.textRise),rt>0?N.scale(ot,-1):N.scale(ot,1);let Tt;if(l.patternFill){N.save();const mt=l.fillColor.getPattern(N,this,(0,m.getCurrentTransformInverse)(N),G.PathType.FILL);Tt=(0,m.getCurrentTransform)(N),N.restore(),N.fillStyle=mt}let bt=l.lineWidth;const nt=l.textMatrixScale;if(nt===0||bt===0){const mt=l.textRenderingMode&a.TextRenderingMode.FILL_STROKE_MASK;(mt===a.TextRenderingMode.STROKE||mt===a.TextRenderingMode.FILL_STROKE)&&(bt=this.getSinglePixelWidth())}else bt/=nt;if(H!==1&&(N.scale(H,H),bt/=H),N.lineWidth=bt,y.isInvalidPDFjsFont){const mt=[];let wt=0;for(const Rt of c)mt.push(Rt.unicode),wt+=Rt.width;N.fillText(mt.join(""),0,0),l.x+=wt*xt*ot,N.restore(),this.compose();return}let Y=0,ft;for(ft=0;ft<ht;++ft){const mt=c[ft];if(typeof mt=="number"){Y+=Et*mt*M/1e3;continue}let wt=!1;const Rt=(mt.isSpace?Q:0)+z,Bt=mt.fontChar,It=mt.accent;let Ft,C,P=mt.width;if(ut){const lt=mt.vmetric||pt,kt=-(mt.vmetric?lt[1]:P*.5)*xt,Lt=lt[2]*xt;P=lt?-lt[0]:P,Ft=kt/H,C=(Y+Lt)/H}else Ft=Y/H,C=0;if(y.remeasure&&P>0){const lt=N.measureText(Bt).width*1e3/M*H;if(P<lt&&this.isFontSubpixelAAEnabled){const kt=P/lt;wt=!0,N.save(),N.scale(kt,1),Ft/=kt}else P!==lt&&(Ft+=(P-lt)/2e3*M/H)}if(this.contentVisible&&(mt.isInFont||y.missingFile)){if(Ot&&!It)N.fillText(Bt,Ft,C);else if(this.paintChar(Bt,Ft,C,Tt),It){const lt=Ft+M*It.offset.x/H,kt=C-M*It.offset.y/H;this.paintChar(It.fontChar,lt,kt,Tt)}}let B;ut?B=P*xt-Rt*rt:B=P*xt+Rt*rt,Y+=B,wt&&N.restore()}ut?l.y-=Y:l.x+=Y*ot,N.restore(),this.compose()}showType3Text(c){const l=this.ctx,y=this.current,M=y.font,N=y.fontSize,H=y.fontDirection,z=M.vertical?1:-1,Q=y.charSpacing,rt=y.wordSpacing,ot=y.textHScale*H,ht=y.fontMatrix||a.FONT_IDENTITY_MATRIX,ut=c.length,Et=y.textRenderingMode===a.TextRenderingMode.INVISIBLE;let pt,xt,Ot,Tt;if(!(Et||N===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,l.save(),l.transform(...y.textMatrix),l.translate(y.x,y.y),l.scale(ot,H),pt=0;pt<ut;++pt){if(xt=c[pt],typeof xt=="number"){Tt=z*xt*N/1e3,this.ctx.translate(Tt,0),y.x+=Tt*ot;continue}const bt=(xt.isSpace?rt:0)+Q,nt=M.charProcOperatorList[xt.operatorListId];if(!nt){(0,a.warn)(`Type3 character "${xt.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=xt,this.save(),l.scale(N,N),l.transform(...ht),this.executeOperatorList(nt),this.restore()),Ot=a.Util.applyTransform([xt.width,0],ht)[0]*N+bt,l.translate(Ot,0),y.x+=Ot*ot}l.restore(),this.processingType3=null}}setCharWidth(c,l){}setCharWidthAndBounds(c,l,y,M,N,H){this.ctx.rect(y,M,N-y,H-M),this.ctx.clip(),this.endPath()}getColorN_Pattern(c){let l;if(c[0]==="TilingPattern"){const y=c[1],M=this.baseTransform||(0,m.getCurrentTransform)(this.ctx),N={createCanvasGraphics:H=>new Dt(H,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};l=new G.TilingPattern(c,y,this.ctx,N,M)}else l=this._getPattern(c[1],c[2]);return l}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(c,l,y){const M=a.Util.makeHexColor(c,l,y);this.ctx.strokeStyle=M,this.current.strokeColor=M}setFillRGBColor(c,l,y){const M=a.Util.makeHexColor(c,l,y);this.ctx.fillStyle=M,this.current.fillColor=M,this.current.patternFill=!1}_getPattern(c,l=null){let y;return this.cachedPatterns.has(c)?y=this.cachedPatterns.get(c):(y=(0,G.getShadingPattern)(this.getObject(c)),this.cachedPatterns.set(c,y)),l&&(y.matrix=l),y}shadingFill(c){if(!this.contentVisible)return;const l=this.ctx;this.save();const y=this._getPattern(c);l.fillStyle=y.getPattern(l,this,(0,m.getCurrentTransformInverse)(l),G.PathType.SHADING);const M=(0,m.getCurrentTransformInverse)(l);if(M){const{width:N,height:H}=l.canvas,[z,Q,rt,ot]=a.Util.getAxialAlignedBoundingBox([0,0,N,H],M);this.ctx.fillRect(z,Q,rt-z,ot-Q)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,a.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,a.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(c,l){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(c)&&c.length===6&&this.transform(...c),this.baseTransform=(0,m.getCurrentTransform)(this.ctx),l)){const y=l[2]-l[0],M=l[3]-l[1];this.ctx.rect(l[0],l[1],y,M),this.current.updateRectMinMax((0,m.getCurrentTransform)(this.ctx),l),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(c){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const l=this.ctx;c.isolated||(0,a.info)("TODO: Support non-isolated groups."),c.knockout&&(0,a.warn)("Knockout groups not supported.");const y=(0,m.getCurrentTransform)(l);if(c.matrix&&l.transform(...c.matrix),!c.bbox)throw new Error("Bounding box is required.");let M=a.Util.getAxialAlignedBoundingBox(c.bbox,(0,m.getCurrentTransform)(l));const N=[0,0,l.canvas.width,l.canvas.height];M=a.Util.intersect(M,N)||[0,0,0,0];const H=Math.floor(M[0]),z=Math.floor(M[1]);let Q=Math.max(Math.ceil(M[2])-H,1),rt=Math.max(Math.ceil(M[3])-z,1),ot=1,ht=1;Q>d&&(ot=Q/d,Q=d),rt>d&&(ht=rt/d,rt=d),this.current.startNewPathAndClipBox([0,0,Q,rt]);let ut="groupAt"+this.groupLevel;c.smask&&(ut+="_smask_"+this.smaskCounter++%2);const Et=this.cachedCanvases.getCanvas(ut,Q,rt),pt=Et.context;pt.scale(1/ot,1/ht),pt.translate(-H,-z),pt.transform(...y),c.smask?this.smaskStack.push({canvas:Et.canvas,context:pt,offsetX:H,offsetY:z,scaleX:ot,scaleY:ht,subtype:c.smask.subtype,backdrop:c.smask.backdrop,transferMap:c.smask.transferMap||null,startTransformInverse:null}):(l.setTransform(1,0,0,1,0,0),l.translate(H,z),l.scale(ot,ht),l.save()),i(l,pt),this.ctx=pt,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(l),this.groupLevel++}endGroup(c){if(!this.contentVisible)return;this.groupLevel--;const l=this.ctx,y=this.groupStack.pop();if(this.ctx=y,this.ctx.imageSmoothingEnabled=!1,c.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const M=(0,m.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...M);const N=a.Util.getAxialAlignedBoundingBox([0,0,l.canvas.width,l.canvas.height],M);this.ctx.drawImage(l.canvas,0,0),this.ctx.restore(),this.compose(N)}}beginAnnotation(c,l,y,M,N){if(st(this,it,Ie).call(this),t(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(l)&&l.length===4){const H=l[2]-l[0],z=l[3]-l[1];if(N&&this.annotationCanvasMap){y=y.slice(),y[4]-=l[0],y[5]-=l[1],l=l.slice(),l[0]=l[1]=0,l[2]=H,l[3]=z;const[Q,rt]=a.Util.singularValueDecompose2dScale((0,m.getCurrentTransform)(this.ctx)),{viewportScale:ot}=this,ht=Math.ceil(H*this.outputScaleX*ot),ut=Math.ceil(z*this.outputScaleY*ot);this.annotationCanvas=this.canvasFactory.create(ht,ut);const{canvas:Et,context:pt}=this.annotationCanvas;this.annotationCanvasMap.set(c,Et),this.annotationCanvas.savedCtx=this.ctx,this.ctx=pt,this.ctx.save(),this.ctx.setTransform(Q,0,0,-rt,0,z*rt),t(this.ctx)}else t(this.ctx),this.ctx.rect(l[0],l[1],H,z),this.ctx.clip(),this.endPath()}this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...y),this.transform(...M)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),st(this,vt,Le).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(c){if(!this.contentVisible)return;const l=c.count;c=this.getObject(c.data,c),c.count=l;const y=this.ctx,M=this.processingType3;if(M&&(M.compiled===void 0&&(M.compiled=w(c)),M.compiled)){M.compiled(y);return}const N=this._createMaskCanvas(c),H=N.canvas;y.save(),y.setTransform(1,0,0,1,0,0),y.drawImage(H,N.offsetX,N.offsetY),y.restore(),this.compose()}paintImageMaskXObjectRepeat(c,l,y=0,M=0,N,H){if(!this.contentVisible)return;c=this.getObject(c.data,c);const z=this.ctx;z.save();const Q=(0,m.getCurrentTransform)(z);z.transform(l,y,M,N,0,0);const rt=this._createMaskCanvas(c);z.setTransform(1,0,0,1,rt.offsetX-Q[4],rt.offsetY-Q[5]);for(let ot=0,ht=H.length;ot<ht;ot+=2){const ut=a.Util.transform(Q,[l,y,M,N,H[ot],H[ot+1]]),[Et,pt]=a.Util.applyTransform([0,0],ut);z.drawImage(rt.canvas,Et,pt)}z.restore(),this.compose()}paintImageMaskXObjectGroup(c){if(!this.contentVisible)return;const l=this.ctx,y=this.current.fillColor,M=this.current.patternFill;for(const N of c){const{data:H,width:z,height:Q,transform:rt}=N,ot=this.cachedCanvases.getCanvas("maskCanvas",z,Q),ht=ot.context;ht.save();const ut=this.getObject(H,N);E(ht,ut),ht.globalCompositeOperation="source-in",ht.fillStyle=M?y.getPattern(ht,this,(0,m.getCurrentTransformInverse)(l),G.PathType.FILL):y,ht.fillRect(0,0,z,Q),ht.restore(),l.save(),l.transform(...rt),l.scale(1,-1),_(l,ot.canvas,0,0,z,Q,0,-1,1,1),l.restore()}this.compose()}paintImageXObject(c){if(!this.contentVisible)return;const l=this.getObject(c);if(!l){(0,a.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(l)}paintImageXObjectRepeat(c,l,y,M){if(!this.contentVisible)return;const N=this.getObject(c);if(!N){(0,a.warn)("Dependent image isn't ready yet");return}const H=N.width,z=N.height,Q=[];for(let rt=0,ot=M.length;rt<ot;rt+=2)Q.push({transform:[l,0,0,y,M[rt],M[rt+1]],x:0,y:0,w:H,h:z});this.paintInlineImageXObjectGroup(N,Q)}applyTransferMapsToCanvas(c){return this.current.transferMaps!=="none"&&(c.filter=this.current.transferMaps,c.drawImage(c.canvas,0,0),c.filter="none"),c.canvas}applyTransferMapsToBitmap(c){if(this.current.transferMaps==="none")return c.bitmap;const{bitmap:l,width:y,height:M}=c,N=this.cachedCanvases.getCanvas("inlineImage",y,M),H=N.context;return H.filter=this.current.transferMaps,H.drawImage(l,0,0),H.filter="none",N.canvas}paintInlineImageXObject(c){if(!this.contentVisible)return;const l=c.width,y=c.height,M=this.ctx;this.save(),et.isNodeJS||(M.filter="none"),M.scale(1/l,-1/y);let N;if(c.bitmap)N=this.applyTransferMapsToBitmap(c);else if(typeof HTMLElement=="function"&&c instanceof HTMLElement||!c.data)N=c;else{const Q=this.cachedCanvases.getCanvas("inlineImage",l,y).context;u(Q,c),N=this.applyTransferMapsToCanvas(Q)}const H=this._scaleImage(N,(0,m.getCurrentTransformInverse)(M));M.imageSmoothingEnabled=K((0,m.getCurrentTransform)(M),c.interpolate),_(M,H.img,0,0,H.paintWidth,H.paintHeight,0,-y,l,y),this.compose(),this.restore()}paintInlineImageXObjectGroup(c,l){if(!this.contentVisible)return;const y=this.ctx;let M;if(c.bitmap)M=c.bitmap;else{const N=c.width,H=c.height,Q=this.cachedCanvases.getCanvas("inlineImage",N,H).context;u(Q,c),M=this.applyTransferMapsToCanvas(Q)}for(const N of l)y.save(),y.transform(...N.transform),y.scale(1,-1),_(y,M,N.x,N.y,N.w,N.h,0,-1,1,1),y.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(c){}markPointProps(c,l){}beginMarkedContent(c){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(c,l){c==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(l)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(c){const l=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(c);const y=this.ctx;this.pendingClip&&(l||(this.pendingClip===dt?y.clip("evenodd"):y.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),y.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const c=(0,m.getCurrentTransform)(this.ctx);if(c[1]===0&&c[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(c[0]),Math.abs(c[3]));else{const l=Math.abs(c[0]*c[3]-c[2]*c[1]),y=Math.hypot(c[0],c[2]),M=Math.hypot(c[1],c[3]);this._cachedGetSinglePixelWidth=Math.max(y,M)/l}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:c}=this.current,{a:l,b:y,c:M,d:N}=this.ctx.getTransform();let H,z;if(y===0&&M===0){const Q=Math.abs(l),rt=Math.abs(N);if(Q===rt)if(c===0)H=z=1/Q;else{const ot=Q*c;H=z=ot<1?1/ot:1}else if(c===0)H=1/Q,z=1/rt;else{const ot=Q*c,ht=rt*c;H=ot<1?1/ot:1,z=ht<1?1/ht:1}}else{const Q=Math.abs(l*N-y*M),rt=Math.hypot(l,y),ot=Math.hypot(M,N);if(c===0)H=ot/Q,z=rt/Q;else{const ht=c*Q;H=ot>ht?ot/ht:1,z=rt>ht?rt/ht:1}}this._cachedScaleForStroking[0]=H,this._cachedScaleForStroking[1]=z}return this._cachedScaleForStroking}rescaleAndStroke(c){const{ctx:l}=this,{lineWidth:y}=this.current,[M,N]=this.getScaleForStroking();if(l.lineWidth=y||1,M===1&&N===1){l.stroke();return}const H=l.getLineDash();if(c&&l.save(),l.scale(M,N),H.length>0){const z=Math.max(M,N);l.setLineDash(H.map(Q=>Q/z)),l.lineDashOffset/=z}l.stroke(),c&&l.restore()}isContentVisible(){for(let c=this.markedContentStack.length-1;c>=0;c--)if(!this.markedContentStack[c].visible)return!1;return!0}};it=new WeakSet,Ie=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},vt=new WeakSet,Le=function(){if(this.pageColors){const c=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(c!=="none"){const l=this.ctx.filter;this.ctx.filter=c,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=l}}};let V=Dt;e.CanvasGraphics=V;for(const j in a.OPS)V.prototype[j]!==void 0&&(V.prototype[a.OPS[j]]=V.prototype[j])},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=v;var a=O(1),m=O(6);const G={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=G;function U(_,w){if(!w)return;const b=w[2]-w[0],u=w[3]-w[1],E=new Path2D;E.rect(w[0],w[1],b,u),_.clip(E)}class et{constructor(){this.constructor===et&&(0,a.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,a.unreachable)("Abstract method `getPattern` called.")}}class X extends et{constructor(w){super(),this._type=w[1],this._bbox=w[2],this._colorStops=w[3],this._p0=w[4],this._p1=w[5],this._r0=w[6],this._r1=w[7],this.matrix=null}_createGradient(w){let b;this._type==="axial"?b=w.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(b=w.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const u of this._colorStops)b.addColorStop(u[0],u[1]);return b}getPattern(w,b,u,E){let i;if(E===G.STROKE||E===G.FILL){const t=b.current.getClippedPathBoundingBox(E,(0,m.getCurrentTransform)(w))||[0,0,0,0],n=Math.ceil(t[2]-t[0])||1,h=Math.ceil(t[3]-t[1])||1,p=b.cachedCanvases.getCanvas("pattern",n,h,!0),F=p.context;F.clearRect(0,0,F.canvas.width,F.canvas.height),F.beginPath(),F.rect(0,0,F.canvas.width,F.canvas.height),F.translate(-t[0],-t[1]),u=a.Util.transform(u,[1,0,0,1,t[0],t[1]]),F.transform(...b.baseTransform),this.matrix&&F.transform(...this.matrix),U(F,this._bbox),F.fillStyle=this._createGradient(F),F.fill(),i=w.createPattern(p.canvas,"no-repeat");const L=new DOMMatrix(u);i.setTransform(L)}else U(w,this._bbox),i=this._createGradient(w);return i}}function S(_,w,b,u,E,i,t,n){const h=w.coords,p=w.colors,F=_.data,L=_.width*4;let K;h[b+1]>h[u+1]&&(K=b,b=u,u=K,K=i,i=t,t=K),h[u+1]>h[E+1]&&(K=u,u=E,E=K,K=t,t=n,n=K),h[b+1]>h[u+1]&&(K=b,b=u,u=K,K=i,i=t,t=K);const x=(h[b]+w.offsetX)*w.scaleX,$=(h[b+1]+w.offsetY)*w.scaleY,at=(h[u]+w.offsetX)*w.scaleX,dt=(h[u+1]+w.offsetY)*w.scaleY,V=(h[E]+w.offsetX)*w.scaleX,it=(h[E+1]+w.offsetY)*w.scaleY;if($>=it)return;const St=p[i],vt=p[i+1],yt=p[i+2],Dt=p[t],j=p[t+1],c=p[t+2],l=p[n],y=p[n+1],M=p[n+2],N=Math.round($),H=Math.round(it);let z,Q,rt,ot,ht,ut,Et,pt;for(let xt=N;xt<=H;xt++){if(xt<dt){let Y;xt<$?Y=0:Y=($-xt)/($-dt),z=x-(x-at)*Y,Q=St-(St-Dt)*Y,rt=vt-(vt-j)*Y,ot=yt-(yt-c)*Y}else{let Y;xt>it?Y=1:dt===it?Y=0:Y=(dt-xt)/(dt-it),z=at-(at-V)*Y,Q=Dt-(Dt-l)*Y,rt=j-(j-y)*Y,ot=c-(c-M)*Y}let Ot;xt<$?Ot=0:xt>it?Ot=1:Ot=($-xt)/($-it),ht=x-(x-V)*Ot,ut=St-(St-l)*Ot,Et=vt-(vt-y)*Ot,pt=yt-(yt-M)*Ot;const Tt=Math.round(Math.min(z,ht)),bt=Math.round(Math.max(z,ht));let nt=L*xt+Tt*4;for(let Y=Tt;Y<=bt;Y++)Ot=(z-Y)/(z-ht),Ot<0?Ot=0:Ot>1&&(Ot=1),F[nt++]=Q-(Q-ut)*Ot|0,F[nt++]=rt-(rt-Et)*Ot|0,F[nt++]=ot-(ot-pt)*Ot|0,F[nt++]=255}}function d(_,w,b){const u=w.coords,E=w.colors;let i,t;switch(w.type){case"lattice":const n=w.verticesPerRow,h=Math.floor(u.length/n)-1,p=n-1;for(i=0;i<h;i++){let F=i*n;for(let L=0;L<p;L++,F++)S(_,b,u[F],u[F+1],u[F+n],E[F],E[F+1],E[F+n]),S(_,b,u[F+n+1],u[F+1],u[F+n],E[F+n+1],E[F+1],E[F+n])}break;case"triangles":for(i=0,t=u.length;i<t;i+=3)S(_,b,u[i],u[i+1],u[i+2],E[i],E[i+1],E[i+2]);break;default:throw new Error("illegal figure")}}class R extends et{constructor(w){super(),this._coords=w[2],this._colors=w[3],this._figures=w[4],this._bounds=w[5],this._bbox=w[7],this._background=w[8],this.matrix=null}_createMeshCanvas(w,b,u){const n=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),p=Math.ceil(this._bounds[2])-n,F=Math.ceil(this._bounds[3])-h,L=Math.min(Math.ceil(Math.abs(p*w[0]*1.1)),3e3),K=Math.min(Math.ceil(Math.abs(F*w[1]*1.1)),3e3),x=p/L,$=F/K,at={coords:this._coords,colors:this._colors,offsetX:-n,offsetY:-h,scaleX:1/x,scaleY:1/$},dt=L+2*2,V=K+2*2,it=u.getCanvas("mesh",dt,V,!1),St=it.context,vt=St.createImageData(L,K);if(b){const Dt=vt.data;for(let j=0,c=Dt.length;j<c;j+=4)Dt[j]=b[0],Dt[j+1]=b[1],Dt[j+2]=b[2],Dt[j+3]=255}for(const Dt of this._figures)d(vt,Dt,at);return St.putImageData(vt,2,2),{canvas:it.canvas,offsetX:n-2*x,offsetY:h-2*$,scaleX:x,scaleY:$}}getPattern(w,b,u,E){U(w,this._bbox);let i;if(E===G.SHADING)i=a.Util.singularValueDecompose2dScale((0,m.getCurrentTransform)(w));else if(i=a.Util.singularValueDecompose2dScale(b.baseTransform),this.matrix){const n=a.Util.singularValueDecompose2dScale(this.matrix);i=[i[0]*n[0],i[1]*n[1]]}const t=this._createMeshCanvas(i,E===G.SHADING?null:this._background,b.cachedCanvases);return E!==G.SHADING&&(w.setTransform(...b.baseTransform),this.matrix&&w.transform(...this.matrix)),w.translate(t.offsetX,t.offsetY),w.scale(t.scaleX,t.scaleY),w.createPattern(t.canvas,"no-repeat")}}class I extends et{getPattern(){return"hotpink"}}function v(_){switch(_[0]){case"RadialAxial":return new X(_);case"Mesh":return new R(_);case"Dummy":return new I}throw new Error(`Unknown IR type: ${_[0]}`)}const D={COLORED:1,UNCOLORED:2},g=class g{constructor(w,b,u,E,i){this.operatorList=w[2],this.matrix=w[3]||[1,0,0,1,0,0],this.bbox=w[4],this.xstep=w[5],this.ystep=w[6],this.paintType=w[7],this.tilingType=w[8],this.color=b,this.ctx=u,this.canvasGraphicsFactory=E,this.baseTransform=i}createPatternCanvas(w){const b=this.operatorList,u=this.bbox,E=this.xstep,i=this.ystep,t=this.paintType,n=this.tilingType,h=this.color,p=this.canvasGraphicsFactory;(0,a.info)("TilingType: "+n);const F=u[0],L=u[1],K=u[2],x=u[3],$=a.Util.singularValueDecompose2dScale(this.matrix),at=a.Util.singularValueDecompose2dScale(this.baseTransform),dt=[$[0]*at[0],$[1]*at[1]],V=this.getSizeAndScale(E,this.ctx.canvas.width,dt[0]),it=this.getSizeAndScale(i,this.ctx.canvas.height,dt[1]),St=w.cachedCanvases.getCanvas("pattern",V.size,it.size,!0),vt=St.context,yt=p.createCanvasGraphics(vt);yt.groupLevel=w.groupLevel,this.setFillAndStrokeStyleToContext(yt,t,h);let Dt=F,j=L,c=K,l=x;return F<0&&(Dt=0,c+=Math.abs(F)),L<0&&(j=0,l+=Math.abs(L)),vt.translate(-(V.scale*Dt),-(it.scale*j)),yt.transform(V.scale,0,0,it.scale,0,0),vt.save(),this.clipBbox(yt,Dt,j,c,l),yt.baseTransform=(0,m.getCurrentTransform)(yt.ctx),yt.executeOperatorList(b),yt.endDrawing(),{canvas:St.canvas,scaleX:V.scale,scaleY:it.scale,offsetX:Dt,offsetY:j}}getSizeAndScale(w,b,u){w=Math.abs(w);const E=Math.max(g.MAX_PATTERN_SIZE,b);let i=Math.ceil(w*u);return i>=E?i=E:u=i/w,{scale:u,size:i}}clipBbox(w,b,u,E,i){const t=E-b,n=i-u;w.ctx.rect(b,u,t,n),w.current.updateRectMinMax((0,m.getCurrentTransform)(w.ctx),[b,u,E,i]),w.clip(),w.endPath()}setFillAndStrokeStyleToContext(w,b,u){const E=w.ctx,i=w.current;switch(b){case D.COLORED:const t=this.ctx;E.fillStyle=t.fillStyle,E.strokeStyle=t.strokeStyle,i.fillColor=t.fillStyle,i.strokeColor=t.strokeStyle;break;case D.UNCOLORED:const n=a.Util.makeHexColor(u[0],u[1],u[2]);E.fillStyle=n,E.strokeStyle=n,i.fillColor=n,i.strokeColor=n;break;default:throw new a.FormatError(`Unsupported paint type: ${b}`)}}getPattern(w,b,u,E){let i=u;E!==G.SHADING&&(i=a.Util.transform(i,b.baseTransform),this.matrix&&(i=a.Util.transform(i,this.matrix)));const t=this.createPatternCanvas(b);let n=new DOMMatrix(i);n=n.translate(t.offsetX,t.offsetY),n=n.scale(1/t.scaleX,1/t.scaleY);const h=w.createPattern(t.canvas,"repeat");return h.setTransform(n),h}};Xt(g,"MAX_PATTERN_SIZE",3e3);let o=g;e.TilingPattern=o},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertBlackAndWhiteToRGBA=G,e.convertToRGBA=m,e.grayToRGBA=et;var a=O(1);function m(X){switch(X.kind){case a.ImageKind.GRAYSCALE_1BPP:return G(X);case a.ImageKind.RGB_24BPP:return U(X)}return null}function G({src:X,srcPos:S=0,dest:d,width:R,height:I,nonBlackColor:v=4294967295,inverseDecode:D=!1}){const o=a.FeatureTest.isLittleEndian?4278190080:255,[g,_]=D?[v,o]:[o,v],w=R>>3,b=R&7,u=X.length;d=new Uint32Array(d.buffer);let E=0;for(let i=0;i<I;i++){for(const n=S+w;S<n;S++){const h=S<u?X[S]:255;d[E++]=h&128?_:g,d[E++]=h&64?_:g,d[E++]=h&32?_:g,d[E++]=h&16?_:g,d[E++]=h&8?_:g,d[E++]=h&4?_:g,d[E++]=h&2?_:g,d[E++]=h&1?_:g}if(b===0)continue;const t=S<u?X[S++]:255;for(let n=0;n<b;n++)d[E++]=t&1<<7-n?_:g}return{srcPos:S,destPos:E}}function U({src:X,srcPos:S=0,dest:d,destPos:R=0,width:I,height:v}){let D=0;const o=X.length>>2,g=new Uint32Array(X.buffer,S,o);if(a.FeatureTest.isLittleEndian){for(;D<o-2;D+=3,R+=4){const _=g[D],w=g[D+1],b=g[D+2];d[R]=_|4278190080,d[R+1]=_>>>24|w<<8|4278190080,d[R+2]=w>>>16|b<<16|4278190080,d[R+3]=b>>>8|4278190080}for(let _=D*4,w=X.length;_<w;_+=3)d[R++]=X[_]|X[_+1]<<8|X[_+2]<<16|4278190080}else{for(;D<o-2;D+=3,R+=4){const _=g[D],w=g[D+1],b=g[D+2];d[R]=_|255,d[R+1]=_<<24|w>>>8|255,d[R+2]=w<<16|b>>>16|255,d[R+3]=b<<8|255}for(let _=D*4,w=X.length;_<w;_+=3)d[R++]=X[_]<<24|X[_+1]<<16|X[_+2]<<8|255}return{srcPos:S,destPos:R}}function et(X,S){if(a.FeatureTest.isLittleEndian)for(let d=0,R=X.length;d<R;d++)S[d]=X[d]*65793|4278190080;else for(let d=0,R=X.length;d<R;d++)S[d]=X[d]*16843008|255}},(tt,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const O=Object.create(null);e.GlobalWorkerOptions=O,O.workerPort=null,O.workerSrc=""},(tt,e,O)=>{var X,dn,d,un,I,ve;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var a=O(1);const m={UNKNOWN:0,DATA:1,ERROR:2},G={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function U(D){switch(D instanceof Error||typeof D=="object"&&D!==null||(0,a.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),D.name){case"AbortException":return new a.AbortException(D.message);case"MissingPDFException":return new a.MissingPDFException(D.message);case"PasswordException":return new a.PasswordException(D.message,D.code);case"UnexpectedResponseException":return new a.UnexpectedResponseException(D.message,D.status);case"UnknownErrorException":return new a.UnknownErrorException(D.message,D.details);default:return new a.UnknownErrorException(D.message,D.toString())}}class et{constructor(o,g,_){q(this,X);q(this,d);q(this,I);this.sourceName=o,this.targetName=g,this.comObj=_,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=w=>{const b=w.data;if(b.targetName!==this.sourceName)return;if(b.stream){st(this,d,un).call(this,b);return}if(b.callback){const E=b.callbackId,i=this.callbackCapabilities[E];if(!i)throw new Error(`Cannot resolve callback ${E}`);if(delete this.callbackCapabilities[E],b.callback===m.DATA)i.resolve(b.data);else if(b.callback===m.ERROR)i.reject(U(b.reason));else throw new Error("Unexpected callback case");return}const u=this.actionHandler[b.action];if(!u)throw new Error(`Unknown action from worker: ${b.action}`);if(b.callbackId){const E=this.sourceName,i=b.sourceName;new Promise(function(t){t(u(b.data))}).then(function(t){_.postMessage({sourceName:E,targetName:i,callback:m.DATA,callbackId:b.callbackId,data:t})},function(t){_.postMessage({sourceName:E,targetName:i,callback:m.ERROR,callbackId:b.callbackId,reason:U(t)})});return}if(b.streamId){st(this,X,dn).call(this,b);return}u(b.data)},_.addEventListener("message",this._onComObjOnMessage)}on(o,g){const _=this.actionHandler;if(_[o])throw new Error(`There is already an actionName called "${o}"`);_[o]=g}send(o,g,_){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,data:g},_)}sendWithPromise(o,g,_){const w=this.callbackId++,b=new a.PromiseCapability;this.callbackCapabilities[w]=b;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,callbackId:w,data:g},_)}catch(u){b.reject(u)}return b.promise}sendWithStream(o,g,_,w){const b=this.streamId++,u=this.sourceName,E=this.targetName,i=this.comObj;return new ReadableStream({start:t=>{const n=new a.PromiseCapability;return this.streamControllers[b]={controller:t,startCall:n,pullCall:null,cancelCall:null,isClosed:!1},i.postMessage({sourceName:u,targetName:E,action:o,streamId:b,data:g,desiredSize:t.desiredSize},w),n.promise},pull:t=>{const n=new a.PromiseCapability;return this.streamControllers[b].pullCall=n,i.postMessage({sourceName:u,targetName:E,stream:G.PULL,streamId:b,desiredSize:t.desiredSize}),n.promise},cancel:t=>{(0,a.assert)(t instanceof Error,"cancel must have a valid reason");const n=new a.PromiseCapability;return this.streamControllers[b].cancelCall=n,this.streamControllers[b].isClosed=!0,i.postMessage({sourceName:u,targetName:E,stream:G.CANCEL,streamId:b,reason:U(t)}),n.promise}},_)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}X=new WeakSet,dn=function(o){const g=o.streamId,_=this.sourceName,w=o.sourceName,b=this.comObj,u=this,E=this.actionHandler[o.action],i={enqueue(t,n=1,h){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=n,p>0&&this.desiredSize<=0&&(this.sinkCapability=new a.PromiseCapability,this.ready=this.sinkCapability.promise),b.postMessage({sourceName:_,targetName:w,stream:G.ENQUEUE,streamId:g,chunk:t},h)},close(){this.isCancelled||(this.isCancelled=!0,b.postMessage({sourceName:_,targetName:w,stream:G.CLOSE,streamId:g}),delete u.streamSinks[g])},error(t){(0,a.assert)(t instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,b.postMessage({sourceName:_,targetName:w,stream:G.ERROR,streamId:g,reason:U(t)}))},sinkCapability:new a.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:o.desiredSize,ready:null};i.sinkCapability.resolve(),i.ready=i.sinkCapability.promise,this.streamSinks[g]=i,new Promise(function(t){t(E(o.data,i))}).then(function(){b.postMessage({sourceName:_,targetName:w,stream:G.START_COMPLETE,streamId:g,success:!0})},function(t){b.postMessage({sourceName:_,targetName:w,stream:G.START_COMPLETE,streamId:g,reason:U(t)})})},d=new WeakSet,un=function(o){const g=o.streamId,_=this.sourceName,w=o.sourceName,b=this.comObj,u=this.streamControllers[g],E=this.streamSinks[g];switch(o.stream){case G.START_COMPLETE:o.success?u.startCall.resolve():u.startCall.reject(U(o.reason));break;case G.PULL_COMPLETE:o.success?u.pullCall.resolve():u.pullCall.reject(U(o.reason));break;case G.PULL:if(!E){b.postMessage({sourceName:_,targetName:w,stream:G.PULL_COMPLETE,streamId:g,success:!0});break}E.desiredSize<=0&&o.desiredSize>0&&E.sinkCapability.resolve(),E.desiredSize=o.desiredSize,new Promise(function(i){var t;i((t=E.onPull)==null?void 0:t.call(E))}).then(function(){b.postMessage({sourceName:_,targetName:w,stream:G.PULL_COMPLETE,streamId:g,success:!0})},function(i){b.postMessage({sourceName:_,targetName:w,stream:G.PULL_COMPLETE,streamId:g,reason:U(i)})});break;case G.ENQUEUE:if((0,a.assert)(u,"enqueue should have stream controller"),u.isClosed)break;u.controller.enqueue(o.chunk);break;case G.CLOSE:if((0,a.assert)(u,"close should have stream controller"),u.isClosed)break;u.isClosed=!0,u.controller.close(),st(this,I,ve).call(this,u,g);break;case G.ERROR:(0,a.assert)(u,"error should have stream controller"),u.controller.error(U(o.reason)),st(this,I,ve).call(this,u,g);break;case G.CANCEL_COMPLETE:o.success?u.cancelCall.resolve():u.cancelCall.reject(U(o.reason)),st(this,I,ve).call(this,u,g);break;case G.CANCEL:if(!E)break;new Promise(function(i){var t;i((t=E.onCancel)==null?void 0:t.call(E,U(o.reason)))}).then(function(){b.postMessage({sourceName:_,targetName:w,stream:G.CANCEL_COMPLETE,streamId:g,success:!0})},function(i){b.postMessage({sourceName:_,targetName:w,stream:G.CANCEL_COMPLETE,streamId:g,reason:U(i)})}),E.sinkCapability.reject(U(o.reason)),E.isCancelled=!0,delete this.streamSinks[g];break;default:throw new Error("Unexpected stream case")}},I=new WeakSet,ve=async function(o,g){var _,w,b;await Promise.allSettled([(_=o.startCall)==null?void 0:_.promise,(w=o.pullCall)==null?void 0:w.promise,(b=o.cancelCall)==null?void 0:b.promise]),delete this.streamControllers[g]},e.MessageHandler=et},(tt,e,O)=>{var G,U;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var a=O(1);class m{constructor({parsedData:X,rawData:S}){q(this,G,void 0);q(this,U,void 0);ct(this,G,X),ct(this,U,S)}getRaw(){return s(this,U)}get(X){return s(this,G).get(X)??null}getAll(){return(0,a.objectFromMap)(s(this,G))}has(X){return s(this,G).has(X)}}G=new WeakMap,U=new WeakMap,e.Metadata=m},(tt,e,O)=>{var X,S,d,R,I,v,Ne;Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var a=O(1),m=O(8);const G=Symbol("INTERNAL");class U{constructor(g,_){q(this,X,!0);this.name=g,this.intent=_}get visible(){return s(this,X)}_setVisible(g,_){g!==G&&(0,a.unreachable)("Internal method `_setVisible` called."),ct(this,X,_)}}X=new WeakMap;class et{constructor(g){q(this,v);q(this,S,null);q(this,d,new Map);q(this,R,null);q(this,I,null);if(this.name=null,this.creator=null,g!==null){this.name=g.name,this.creator=g.creator,ct(this,I,g.order);for(const _ of g.groups)s(this,d).set(_.id,new U(_.name,_.intent));if(g.baseState==="OFF")for(const _ of s(this,d).values())_._setVisible(G,!1);for(const _ of g.on)s(this,d).get(_)._setVisible(G,!0);for(const _ of g.off)s(this,d).get(_)._setVisible(G,!1);ct(this,R,this.getHash())}}isVisible(g){if(s(this,d).size===0)return!0;if(!g)return(0,a.warn)("Optional content group not defined."),!0;if(g.type==="OCG")return s(this,d).has(g.id)?s(this,d).get(g.id).visible:((0,a.warn)(`Optional content group not found: ${g.id}`),!0);if(g.type==="OCMD"){if(g.expression)return st(this,v,Ne).call(this,g.expression);if(!g.policy||g.policy==="AnyOn"){for(const _ of g.ids){if(!s(this,d).has(_))return(0,a.warn)(`Optional content group not found: ${_}`),!0;if(s(this,d).get(_).visible)return!0}return!1}else if(g.policy==="AllOn"){for(const _ of g.ids){if(!s(this,d).has(_))return(0,a.warn)(`Optional content group not found: ${_}`),!0;if(!s(this,d).get(_).visible)return!1}return!0}else if(g.policy==="AnyOff"){for(const _ of g.ids){if(!s(this,d).has(_))return(0,a.warn)(`Optional content group not found: ${_}`),!0;if(!s(this,d).get(_).visible)return!0}return!1}else if(g.policy==="AllOff"){for(const _ of g.ids){if(!s(this,d).has(_))return(0,a.warn)(`Optional content group not found: ${_}`),!0;if(s(this,d).get(_).visible)return!1}return!0}return(0,a.warn)(`Unknown optional content policy ${g.policy}.`),!0}return(0,a.warn)(`Unknown group type ${g.type}.`),!0}setVisibility(g,_=!0){if(!s(this,d).has(g)){(0,a.warn)(`Optional content group not found: ${g}`);return}s(this,d).get(g)._setVisible(G,!!_),ct(this,S,null)}get hasInitialVisibility(){return this.getHash()===s(this,R)}getOrder(){return s(this,d).size?s(this,I)?s(this,I).slice():[...s(this,d).keys()]:null}getGroups(){return s(this,d).size>0?(0,a.objectFromMap)(s(this,d)):null}getGroup(g){return s(this,d).get(g)||null}getHash(){if(s(this,S)!==null)return s(this,S);const g=new m.MurmurHash3_64;for(const[_,w]of s(this,d))g.update(`${_}:${w.visible}`);return ct(this,S,g.hexdigest())}}S=new WeakMap,d=new WeakMap,R=new WeakMap,I=new WeakMap,v=new WeakSet,Ne=function(g){const _=g.length;if(_<2)return!0;const w=g[0];for(let b=1;b<_;b++){const u=g[b];let E;if(Array.isArray(u))E=st(this,v,Ne).call(this,u);else if(s(this,d).has(u))E=s(this,d).get(u).visible;else return(0,a.warn)(`Optional content group not found: ${u}`),!0;switch(w){case"And":if(!E)return!1;break;case"Or":if(E)return!0;break;case"Not":return!E;default:return!0}}return w==="And"},e.OptionalContentConfig=et},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var a=O(1),m=O(6);class G{constructor({length:S,initialData:d,progressiveDone:R=!1,contentDispositionFilename:I=null,disableRange:v=!1,disableStream:D=!1},o){if((0,a.assert)(o,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=R,this._contentDispositionFilename=I,(d==null?void 0:d.length)>0){const g=d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength?d.buffer:new Uint8Array(d).buffer;this._queuedChunks.push(g)}this._pdfDataRangeTransport=o,this._isStreamingSupported=!D,this._isRangeSupported=!v,this._contentLength=S,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((g,_)=>{this._onReceiveData({begin:g,chunk:_})}),this._pdfDataRangeTransport.addProgressListener((g,_)=>{this._onProgress({loaded:g,total:_})}),this._pdfDataRangeTransport.addProgressiveReadListener(g=>{this._onReceiveData({chunk:g})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:S,chunk:d}){const R=d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength?d.buffer:new Uint8Array(d).buffer;if(S===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(R):this._queuedChunks.push(R);else{const I=this._rangeReaders.some(function(v){return v._begin!==S?!1:(v._enqueue(R),!0)});(0,a.assert)(I,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var S;return((S=this._fullRequestReader)==null?void 0:S._loaded)??0}_onProgress(S){var d,R,I,v;S.total===void 0?(R=(d=this._rangeReaders[0])==null?void 0:d.onProgress)==null||R.call(d,{loaded:S.loaded}):(v=(I=this._fullRequestReader)==null?void 0:I.onProgress)==null||v.call(I,{loaded:S.loaded,total:S.total})}_onProgressiveDone(){var S;(S=this._fullRequestReader)==null||S.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(S){const d=this._rangeReaders.indexOf(S);d>=0&&this._rangeReaders.splice(d,1)}getFullReader(){(0,a.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const S=this._queuedChunks;return this._queuedChunks=null,new U(this,S,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(S,d){if(d<=this._progressiveDataLength)return null;const R=new et(this,S,d);return this._pdfDataRangeTransport.requestDataRange(S,d),this._rangeReaders.push(R),R}cancelAllRequests(S){var d;(d=this._fullRequestReader)==null||d.cancel(S);for(const R of this._rangeReaders.slice(0))R.cancel(S);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=G;class U{constructor(S,d,R=!1,I=null){this._stream=S,this._done=R||!1,this._filename=(0,m.isPdfFile)(I)?I:null,this._queuedChunks=d||[],this._loaded=0;for(const v of this._queuedChunks)this._loaded+=v.byteLength;this._requests=[],this._headersReady=Promise.resolve(),S._fullRequestReader=this,this.onProgress=null}_enqueue(S){this._done||(this._requests.length>0?this._requests.shift().resolve({value:S,done:!1}):this._queuedChunks.push(S),this._loaded+=S.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const S=new a.PromiseCapability;return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class et{constructor(S,d,R){this._stream=S,this._begin=d,this._end=R,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(S){if(!this._done){if(this._requests.length===0)this._queuedChunk=S;else{this._requests.shift().resolve({value:S,done:!1});for(const R of this._requests)R.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};const S=new a.PromiseCapability;return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(tt,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class O{static textContent(m){const G=[],U={items:G,styles:Object.create(null)};function et(X){var R;if(!X)return;let S=null;const d=X.name;if(d==="#text")S=X.value;else if(O.shouldBuildText(d))(R=X==null?void 0:X.attributes)!=null&&R.textContent?S=X.attributes.textContent:X.value&&(S=X.value);else return;if(S!==null&&G.push({str:S}),!!X.children)for(const I of X.children)et(I)}return et(m),U}static shouldBuildText(m){return!(m==="textarea"||m==="input"||m==="option"||m==="select")}}e.XfaText=O},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeFilterFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var a=O(7);const m=function(S){return new Promise((d,R)=>{require$$5.readFile(S,(v,D)=>{if(v||!D){R(new Error(v));return}d(new Uint8Array(D))})})};class G extends a.BaseFilterFactory{}e.NodeFilterFactory=G;class U extends a.BaseCanvasFactory{_createCanvas(d,R){return require$$5.createCanvas(d,R)}}e.NodeCanvasFactory=U;class et extends a.BaseCMapReaderFactory{_fetchData(d,R){return m(d).then(I=>({cMapData:I,compressionType:R}))}}e.NodeCMapReaderFactory=et;class X extends a.BaseStandardFontDataFactory{_fetchData(d){return m(d)}}e.NodeStandardFontDataFactory=X},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var a=O(1),m=O(22);const G=require$$5,U=require$$5,et=require$$5,X=require$$5,S=/^file:\/\/\/[a-zA-Z]:\//;function d(b){const u=X.parse(b);return u.protocol==="file:"||u.host?u:/^[a-z]:[/\\]/i.test(b)?X.parse(`file:///${b}`):(u.host||(u.protocol="file:"),u)}class R{constructor(u){this.source=u,this.url=d(u.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&u.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var u;return((u=this._fullRequestReader)==null?void 0:u._loaded)??0}getFullReader(){return(0,a.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new _(this):new o(this),this._fullRequestReader}getRangeReader(u,E){if(E<=this._progressiveDataLength)return null;const i=this.isFsUrl?new w(this,u,E):new g(this,u,E);return this._rangeRequestReaders.push(i),i}cancelAllRequests(u){var E;(E=this._fullRequestReader)==null||E.cancel(u);for(const i of this._rangeRequestReaders.slice(0))i.cancel(u)}}e.PDFNodeStream=R;class I{constructor(u){this._url=u.url,this._done=!1,this._storedError=null,this.onProgress=null;const E=u.source;this._contentLength=E.length,this._loaded=0,this._filename=null,this._disableRange=E.disableRange||!1,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!E.disableStream,this._isRangeSupported=!E.disableRange,this._readableStream=null,this._readCapability=new a.PromiseCapability,this._headersCapability=new a.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const u=this._readableStream.read();return u===null?(this._readCapability=new a.PromiseCapability,this.read()):(this._loaded+=u.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(u).buffer,done:!1})}cancel(u){if(!this._readableStream){this._error(u);return}this._readableStream.destroy(u)}_error(u){this._storedError=u,this._readCapability.resolve()}_setReadableStream(u){this._readableStream=u,u.on("readable",()=>{this._readCapability.resolve()}),u.on("end",()=>{u.destroy(),this._done=!0,this._readCapability.resolve()}),u.on("error",E=>{this._error(E)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new a.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class v{constructor(u){this._url=u.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new a.PromiseCapability;const E=u.source;this._isStreamingSupported=!E.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const u=this._readableStream.read();return u===null?(this._readCapability=new a.PromiseCapability,this.read()):(this._loaded+=u.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(u).buffer,done:!1})}cancel(u){if(!this._readableStream){this._error(u);return}this._readableStream.destroy(u)}_error(u){this._storedError=u,this._readCapability.resolve()}_setReadableStream(u){this._readableStream=u,u.on("readable",()=>{this._readCapability.resolve()}),u.on("end",()=>{u.destroy(),this._done=!0,this._readCapability.resolve()}),u.on("error",E=>{this._error(E)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function D(b,u){return{protocol:b.protocol,auth:b.auth,host:b.hostname,port:b.port,path:b.path,method:"GET",headers:u}}class o extends I{constructor(u){super(u);const E=i=>{if(i.statusCode===404){const p=new a.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=p,this._headersCapability.reject(p);return}this._headersCapability.resolve(),this._setReadableStream(i);const t=p=>this._readableStream.headers[p.toLowerCase()],{allowRangeRequests:n,suggestedLength:h}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:u.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=h||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(t)};this._request=null,this._url.protocol==="http:"?this._request=U.request(D(this._url,u.httpHeaders),E):this._request=et.request(D(this._url,u.httpHeaders),E),this._request.on("error",i=>{this._storedError=i,this._headersCapability.reject(i)}),this._request.end()}}class g extends v{constructor(u,E,i){super(u),this._httpHeaders={};for(const n in u.httpHeaders){const h=u.httpHeaders[n];h!==void 0&&(this._httpHeaders[n]=h)}this._httpHeaders.Range=`bytes=${E}-${i-1}`;const t=n=>{if(n.statusCode===404){const h=new a.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=h;return}this._setReadableStream(n)};this._request=null,this._url.protocol==="http:"?this._request=U.request(D(this._url,this._httpHeaders),t):this._request=et.request(D(this._url,this._httpHeaders),t),this._request.on("error",n=>{this._storedError=n}),this._request.end()}}class _ extends I{constructor(u){super(u);let E=decodeURIComponent(this._url.path);S.test(this._url.href)&&(E=E.replace(/^\//,"")),G.lstat(E,(i,t)=>{if(i){i.code==="ENOENT"&&(i=new a.MissingPDFException(`Missing PDF "${E}".`)),this._storedError=i,this._headersCapability.reject(i);return}this._contentLength=t.size,this._setReadableStream(G.createReadStream(E)),this._headersCapability.resolve()})}}class w extends v{constructor(u,E,i){super(u);let t=decodeURIComponent(this._url.path);S.test(this._url.href)&&(t=t.replace(/^\//,"")),this._setReadableStream(G.createReadStream(t,{start:E,end:i-1}))}}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=X,e.extractFilenameFromHeader=et,e.validateRangeRequestCapabilities=U,e.validateResponseStatus=S;var a=O(1),m=O(23),G=O(6);function U({getResponseHeader:d,isHttp:R,rangeChunkSize:I,disableRange:v}){const D={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(d("Content-Length"),10);return!Number.isInteger(o)||(D.suggestedLength=o,o<=2*I)||v||!R||d("Accept-Ranges")!=="bytes"||(d("Content-Encoding")||"identity")!=="identity"||(D.allowRangeRequests=!0),D}function et(d){const R=d("Content-Disposition");if(R){let I=(0,m.getFilenameFromContentDispositionHeader)(R);if(I.includes("%"))try{I=decodeURIComponent(I)}catch{}if((0,G.isPdfFile)(I))return I}return null}function X(d,R){return d===404||d===0&&R.startsWith("file:")?new a.MissingPDFException('Missing PDF "'+R+'".'):new a.UnexpectedResponseException(`Unexpected server response (${d}) while retrieving PDF "${R}".`,d)}function S(d){return d===200||d===206}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=m;var a=O(1);function m(G){let U=!0,et=X("filename\\*","i").exec(G);if(et){et=et[1];let o=I(et);return o=unescape(o),o=v(o),o=D(o),d(o)}if(et=R(G),et){const o=D(et);return d(o)}if(et=X("filename","i").exec(G),et){et=et[1];let o=I(et);return o=D(o),d(o)}function X(o,g){return new RegExp("(?:^|;)\\s*"+o+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function S(o,g){if(o){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const _=new TextDecoder(o,{fatal:!0}),w=(0,a.stringToBytes)(g);g=_.decode(w),U=!1}catch{}}return g}function d(o){return U&&/[\x80-\xff]/.test(o)&&(o=S("utf-8",o),U&&(o=S("iso-8859-1",o))),o}function R(o){const g=[];let _;const w=X("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(_=w.exec(o))!==null;){let[,u,E,i]=_;if(u=parseInt(u,10),u in g){if(u===0)break;continue}g[u]=[E,i]}const b=[];for(let u=0;u<g.length&&u in g;++u){let[E,i]=g[u];i=I(i),E&&(i=unescape(i),u===0&&(i=v(i))),b.push(i)}return b.join("")}function I(o){if(o.startsWith('"')){const g=o.slice(1).split('\\"');for(let _=0;_<g.length;++_){const w=g[_].indexOf('"');w!==-1&&(g[_]=g[_].slice(0,w),g.length=_+1),g[_]=g[_].replaceAll(/\\(.)/g,"$1")}o=g.join('"')}return o}function v(o){const g=o.indexOf("'");if(g===-1)return o;const _=o.slice(0,g),b=o.slice(g+1).replace(/^[^']*'/,"");return S(_,b)}function D(o){return!o.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(o)?o:o.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,_,w,b){if(w==="q"||w==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(u,E){return String.fromCharCode(parseInt(E,16))}),S(_,b);try{b=atob(b)}catch{}return S(_,b)})}return""}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var a=O(1),m=O(22);const G=200,U=206;function et(I){const v=I.response;return typeof v!="string"?v:(0,a.stringToBytes)(v).buffer}class X{constructor(v,D={}){this.url=v,this.isHttp=/^https?:/i.test(v),this.httpHeaders=this.isHttp&&D.httpHeaders||Object.create(null),this.withCredentials=D.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(v,D,o){const g={begin:v,end:D};for(const _ in o)g[_]=o[_];return this.request(g)}requestFull(v){return this.request(v)}request(v){const D=new XMLHttpRequest,o=this.currXhrId++,g=this.pendingRequests[o]={xhr:D};D.open("GET",this.url),D.withCredentials=this.withCredentials;for(const _ in this.httpHeaders){const w=this.httpHeaders[_];w!==void 0&&D.setRequestHeader(_,w)}return this.isHttp&&"begin"in v&&"end"in v?(D.setRequestHeader("Range",`bytes=${v.begin}-${v.end-1}`),g.expectedStatus=U):g.expectedStatus=G,D.responseType="arraybuffer",v.onError&&(D.onerror=function(_){v.onError(D.status)}),D.onreadystatechange=this.onStateChange.bind(this,o),D.onprogress=this.onProgress.bind(this,o),g.onHeadersReceived=v.onHeadersReceived,g.onDone=v.onDone,g.onError=v.onError,g.onProgress=v.onProgress,D.send(null),o}onProgress(v,D){var g;const o=this.pendingRequests[v];o&&((g=o.onProgress)==null||g.call(o,D))}onStateChange(v,D){var u,E,i;const o=this.pendingRequests[v];if(!o)return;const g=o.xhr;if(g.readyState>=2&&o.onHeadersReceived&&(o.onHeadersReceived(),delete o.onHeadersReceived),g.readyState!==4||!(v in this.pendingRequests))return;if(delete this.pendingRequests[v],g.status===0&&this.isHttp){(u=o.onError)==null||u.call(o,g.status);return}const _=g.status||G;if(!(_===G&&o.expectedStatus===U)&&_!==o.expectedStatus){(E=o.onError)==null||E.call(o,g.status);return}const b=et(g);if(_===U){const t=g.getResponseHeader("Content-Range"),n=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);o.onDone({begin:parseInt(n[1],10),chunk:b})}else b?o.onDone({begin:0,chunk:b}):(i=o.onError)==null||i.call(o,g.status)}getRequestXhr(v){return this.pendingRequests[v].xhr}isPendingRequest(v){return v in this.pendingRequests}abortRequest(v){const D=this.pendingRequests[v].xhr;delete this.pendingRequests[v],D.abort()}}class S{constructor(v){this._source=v,this._manager=new X(v.url,{httpHeaders:v.httpHeaders,withCredentials:v.withCredentials}),this._rangeChunkSize=v.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(v){const D=this._rangeRequestReaders.indexOf(v);D>=0&&this._rangeRequestReaders.splice(D,1)}getFullReader(){return(0,a.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new d(this._manager,this._source),this._fullRequestReader}getRangeReader(v,D){const o=new R(this._manager,v,D);return o.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(o),o}cancelAllRequests(v){var D;(D=this._fullRequestReader)==null||D.cancel(v);for(const o of this._rangeRequestReaders.slice(0))o.cancel(v)}}e.PDFNetworkStream=S;class d{constructor(v,D){this._manager=v;const o={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=D.url,this._fullRequestId=v.requestFull(o),this._headersReceivedCapability=new a.PromiseCapability,this._disableRange=D.disableRange||!1,this._contentLength=D.length,this._rangeChunkSize=D.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const v=this._fullRequestId,D=this._manager.getRequestXhr(v),o=w=>D.getResponseHeader(w),{allowRangeRequests:g,suggestedLength:_}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:o,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=_||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(o),this._isRangeSupported&&this._manager.abortRequest(v),this._headersReceivedCapability.resolve()}_onDone(v){if(v&&(this._requests.length>0?this._requests.shift().resolve({value:v.chunk,done:!1}):this._cachedChunks.push(v.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const D of this._requests)D.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(v){this._storedError=(0,m.createResponseStatusError)(v,this._url),this._headersReceivedCapability.reject(this._storedError);for(const D of this._requests)D.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(v){var D;(D=this.onProgress)==null||D.call(this,{loaded:v.loaded,total:v.lengthComputable?v.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const v=new a.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0,this._headersReceivedCapability.reject(v);for(const D of this._requests)D.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class R{constructor(v,D,o){this._manager=v;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._requestId=v.requestRange(D,o,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var v;(v=this.onClosed)==null||v.call(this,this)}_onDone(v){const D=v.chunk;this._requests.length>0?this._requests.shift().resolve({value:D,done:!1}):this._queuedChunk=D,this._done=!0;for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(v){this._storedError=(0,m.createResponseStatusError)(v,this._url);for(const D of this._requests)D.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(v){var D;this.isStreamingSupported||(D=this.onProgress)==null||D.call(this,{loaded:v.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const D=this._queuedChunk;return this._queuedChunk=null,{value:D,done:!1}}if(this._done)return{value:void 0,done:!0};const v=new a.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const D of this._requests)D.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var a=O(1),m=O(22);function G(R,I,v){return{method:"GET",headers:R,signal:v.signal,mode:"cors",credentials:I?"include":"same-origin",redirect:"follow"}}function U(R){const I=new Headers;for(const v in R){const D=R[v];D!==void 0&&I.append(v,D)}return I}function et(R){return R instanceof Uint8Array?R.buffer:R instanceof ArrayBuffer?R:((0,a.warn)(`getArrayBuffer - unexpected data format: ${R}`),new Uint8Array(R).buffer)}class X{constructor(I){this.source=I,this.isHttp=/^https?:/i.test(I.url),this.httpHeaders=this.isHttp&&I.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var I;return((I=this._fullRequestReader)==null?void 0:I._loaded)??0}getFullReader(){return(0,a.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new S(this),this._fullRequestReader}getRangeReader(I,v){if(v<=this._progressiveDataLength)return null;const D=new d(this,I,v);return this._rangeRequestReaders.push(D),D}cancelAllRequests(I){var v;(v=this._fullRequestReader)==null||v.cancel(I);for(const D of this._rangeRequestReaders.slice(0))D.cancel(I)}}e.PDFFetchStream=X;class S{constructor(I){this._stream=I,this._reader=null,this._loaded=0,this._filename=null;const v=I.source;this._withCredentials=v.withCredentials||!1,this._contentLength=v.length,this._headersCapability=new a.PromiseCapability,this._disableRange=v.disableRange||!1,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!v.disableStream,this._isRangeSupported=!v.disableRange,this._headers=U(this._stream.httpHeaders);const D=v.url;fetch(D,G(this._headers,this._withCredentials,this._abortController)).then(o=>{if(!(0,m.validateResponseStatus)(o.status))throw(0,m.createResponseStatusError)(o.status,D);this._reader=o.body.getReader(),this._headersCapability.resolve();const g=b=>o.headers.get(b),{allowRangeRequests:_,suggestedLength:w}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=_,this._contentLength=w||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new a.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var D;await this._headersCapability.promise;const{value:I,done:v}=await this._reader.read();return v?{value:I,done:v}:(this._loaded+=I.byteLength,(D=this.onProgress)==null||D.call(this,{loaded:this._loaded,total:this._contentLength}),{value:et(I),done:!1})}cancel(I){var v;(v=this._reader)==null||v.cancel(I),this._abortController.abort()}}class d{constructor(I,v,D){this._stream=I,this._reader=null,this._loaded=0;const o=I.source;this._withCredentials=o.withCredentials||!1,this._readCapability=new a.PromiseCapability,this._isStreamingSupported=!o.disableStream,this._abortController=new AbortController,this._headers=U(this._stream.httpHeaders),this._headers.append("Range",`bytes=${v}-${D-1}`);const g=o.url;fetch(g,G(this._headers,this._withCredentials,this._abortController)).then(_=>{if(!(0,m.validateResponseStatus)(_.status))throw(0,m.createResponseStatusError)(_.status,g);this._readCapability.resolve(),this._reader=_.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var D;await this._readCapability.promise;const{value:I,done:v}=await this._reader.read();return v?{value:I,done:v}:(this._loaded+=I.byteLength,(D=this.onProgress)==null||D.call(this,{loaded:this._loaded}),{value:et(I),done:!1})}cancel(I){var v;(v=this._reader)==null||v.cancel(I),this._abortController.abort()}}},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=o,e.updateTextLayer=g;var a=O(1),m=O(6);const G=1e5,U=30,et=.8,X=new Map;function S(_,w){let b;if(w&&a.FeatureTest.isOffscreenCanvasSupported)b=new OffscreenCanvas(_,_).getContext("2d",{alpha:!1});else{const u=document.createElement("canvas");u.width=u.height=_,b=u.getContext("2d",{alpha:!1})}return b}function d(_,w){const b=X.get(_);if(b)return b;const u=S(U,w);u.font=`${U}px ${_}`;const E=u.measureText("");let i=E.fontBoundingBoxAscent,t=Math.abs(E.fontBoundingBoxDescent);if(i){const h=i/(i+t);return X.set(_,h),u.canvas.width=u.canvas.height=0,h}u.strokeStyle="red",u.clearRect(0,0,U,U),u.strokeText("g",0,0);let n=u.getImageData(0,0,U,U).data;t=0;for(let h=n.length-1-3;h>=0;h-=4)if(n[h]>0){t=Math.ceil(h/4/U);break}u.clearRect(0,0,U,U),u.strokeText("A",0,U),n=u.getImageData(0,0,U,U).data,i=0;for(let h=0,p=n.length;h<p;h+=4)if(n[h]>0){i=U-Math.floor(h/4/U);break}if(u.canvas.width=u.canvas.height=0,i){const h=i/(i+t);return X.set(_,h),h}return X.set(_,et),et}function R(_,w,b){const u=document.createElement("span"),E={angle:0,canvasWidth:0,hasText:w.str!=="",hasEOL:w.hasEOL,fontSize:0};_._textDivs.push(u);const i=a.Util.transform(_._transform,w.transform);let t=Math.atan2(i[1],i[0]);const n=b[w.fontName];n.vertical&&(t+=Math.PI/2);const h=Math.hypot(i[2],i[3]),p=h*d(n.fontFamily,_._isOffscreenCanvasSupported);let F,L;t===0?(F=i[4],L=i[5]-p):(F=i[4]+p*Math.sin(t),L=i[5]-p*Math.cos(t));const K="calc(var(--scale-factor)*",x=u.style;_._container===_._rootContainer?(x.left=`${(100*F/_._pageWidth).toFixed(2)}%`,x.top=`${(100*L/_._pageHeight).toFixed(2)}%`):(x.left=`${K}${F.toFixed(2)}px)`,x.top=`${K}${L.toFixed(2)}px)`),x.fontSize=`${K}${h.toFixed(2)}px)`,x.fontFamily=n.fontFamily,E.fontSize=h,u.setAttribute("role","presentation"),u.textContent=w.str,u.dir=w.dir,_._fontInspectorEnabled&&(u.dataset.fontName=w.fontName),t!==0&&(E.angle=t*(180/Math.PI));let $=!1;if(w.str.length>1)$=!0;else if(w.str!==" "&&w.transform[0]!==w.transform[3]){const at=Math.abs(w.transform[0]),dt=Math.abs(w.transform[3]);at!==dt&&Math.max(at,dt)/Math.min(at,dt)>1.5&&($=!0)}$&&(E.canvasWidth=n.vertical?w.height:w.width),_._textDivProperties.set(u,E),_._isReadableStream&&_._layoutText(u)}function I(_){const{div:w,scale:b,properties:u,ctx:E,prevFontSize:i,prevFontFamily:t}=_,{style:n}=w;let h="";if(u.canvasWidth!==0&&u.hasText){const{fontFamily:p}=n,{canvasWidth:F,fontSize:L}=u;(i!==L||t!==p)&&(E.font=`${L*b}px ${p}`,_.prevFontSize=L,_.prevFontFamily=p);const{width:K}=E.measureText(w.textContent);K>0&&(h=`scaleX(${F*b/K})`)}u.angle!==0&&(h=`rotate(${u.angle}deg) ${h}`),h.length>0&&(n.transform=h)}function v(_){if(_._canceled)return;const w=_._textDivs,b=_._capability;if(w.length>G){b.resolve();return}if(!_._isReadableStream)for(const E of w)_._layoutText(E);b.resolve()}class D{constructor({textContentSource:w,container:b,viewport:u,textDivs:E,textDivProperties:i,textContentItemsStr:t,isOffscreenCanvasSupported:n}){var K;this._textContentSource=w,this._isReadableStream=w instanceof ReadableStream,this._container=this._rootContainer=b,this._textDivs=E||[],this._textContentItemsStr=t||[],this._isOffscreenCanvasSupported=n,this._fontInspectorEnabled=!!((K=globalThis.FontInspector)!=null&&K.enabled),this._reader=null,this._textDivProperties=i||new WeakMap,this._canceled=!1,this._capability=new a.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:u.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:S(0,n)};const{pageWidth:h,pageHeight:p,pageX:F,pageY:L}=u.rawDims;this._transform=[1,0,0,-1,-F,L+p],this._pageWidth=h,this._pageHeight=p,(0,m.setLayerDimensions)(b,u),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new a.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new a.AbortException("TextLayer task cancelled."))}_processItems(w,b){for(const u of w){if(u.str===void 0){if(u.type==="beginMarkedContentProps"||u.type==="beginMarkedContent"){const E=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),u.id!==null&&this._container.setAttribute("id",`${u.id}`),E.append(this._container)}else u.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(u.str),R(this,u,b)}}_layoutText(w){const b=this._layoutTextParams.properties=this._textDivProperties.get(w);if(this._layoutTextParams.div=w,I(this._layoutTextParams),b.hasText&&this._container.append(w),b.hasEOL){const u=document.createElement("br");u.setAttribute("role","presentation"),this._container.append(u)}}_render(){const w=new a.PromiseCapability;let b=Object.create(null);if(this._isReadableStream){const u=()=>{this._reader.read().then(({value:E,done:i})=>{if(i){w.resolve();return}Object.assign(b,E.styles),this._processItems(E.items,b),u()},w.reject)};this._reader=this._textContentSource.getReader(),u()}else if(this._textContentSource){const{items:u,styles:E}=this._textContentSource;this._processItems(u,E),w.resolve()}else throw new Error('No "textContentSource" parameter specified.');w.promise.then(()=>{b=null,v(this)},this._capability.reject)}}e.TextLayerRenderTask=D;function o(_){!_.textContentSource&&(_.textContent||_.textContentStream)&&((0,m.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),_.textContentSource=_.textContent||_.textContentStream);const{container:w,viewport:b}=_,u=getComputedStyle(w),E=u.getPropertyValue("visibility"),i=parseFloat(u.getPropertyValue("--scale-factor"));E==="visible"&&(!i||Math.abs(i-b.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const t=new D(_);return t._render(),t}function g({container:_,viewport:w,textDivs:b,textDivProperties:u,isOffscreenCanvasSupported:E,mustRotate:i=!0,mustRescale:t=!0}){if(i&&(0,m.setLayerDimensions)(_,{rotation:w.rotation}),t){const n=S(0,E),p={prevFontSize:null,prevFontFamily:null,div:null,scale:w.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n};for(const F of b)p.properties=u.get(F),p.div=F,I(p)}}},(tt,e,O)=>{var d,R,I,v,D,o,g,_,w,b,u,Be,i,fn,n,je,p,Ue;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var a=O(1),m=O(4),G=O(5),U=O(28),et=O(33),X=O(6);const L=class L{constructor(x){q(this,u);q(this,i);q(this,n);q(this,p);q(this,d,void 0);q(this,R,!1);q(this,I,null);q(this,v,this.pointerup.bind(this));q(this,D,this.pointerdown.bind(this));q(this,o,new Map);q(this,g,!1);q(this,_,!1);q(this,w,!1);q(this,b,void 0);L._initialized||(L._initialized=!0,U.FreeTextEditor.initialize(x.l10n),et.InkEditor.initialize(x.l10n)),x.uiManager.registerEditorTypes([U.FreeTextEditor,et.InkEditor]),ct(this,b,x.uiManager),this.pageIndex=x.pageIndex,this.div=x.div,ct(this,d,x.accessibilityManager),ct(this,I,x.annotationLayer),this.viewport=x.viewport,s(this,b).addLayer(this)}get isEmpty(){return s(this,o).size===0}updateToolbar(x){s(this,b).updateToolbar(x)}updateMode(x=s(this,b).getMode()){st(this,p,Ue).call(this),x===a.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),s(this,b).unselectAll(),x!==a.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",x===a.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",x===a.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(x){if(!x&&s(this,b).getMode()!==a.AnnotationEditorType.INK)return;if(!x){for(const at of s(this,o).values())if(at.isEmpty()){at.setInBackground();return}}st(this,n,je).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(x){s(this,b).setEditingState(x)}addCommands(x){s(this,b).addCommands(x)}enable(){this.div.style.pointerEvents="auto";const x=new Set;for(const at of s(this,o).values())at.enableEditing(),at.annotationElementId&&x.add(at.annotationElementId);if(!s(this,I))return;const $=s(this,I).getEditableAnnotations();for(const at of $){if(at.hide(),s(this,b).isDeletedAnnotationElement(at.data.id)||x.has(at.data.id))continue;const dt=this.deserialize(at);dt&&(this.addOrRebuild(dt),dt.enableEditing())}}disable(){var $;ct(this,w,!0),this.div.style.pointerEvents="none";const x=new Set;for(const at of s(this,o).values()){if(at.disableEditing(),!at.annotationElementId||at.serialize()!==null){x.add(at.annotationElementId);continue}($=this.getEditableAnnotation(at.annotationElementId))==null||$.show(),at.remove()}if(s(this,I)){const at=s(this,I).getEditableAnnotations();for(const dt of at){const{id:V}=dt.data;x.has(V)||s(this,b).isDeletedAnnotationElement(V)||dt.show()}}st(this,p,Ue).call(this),this.isEmpty&&(this.div.hidden=!0),ct(this,w,!1)}getEditableAnnotation(x){var $;return(($=s(this,I))==null?void 0:$.getEditableAnnotation(x))||null}setActiveEditor(x){s(this,b).getActive()!==x&&s(this,b).setActiveEditor(x)}enableClick(){this.div.addEventListener("pointerdown",s(this,D)),this.div.addEventListener("pointerup",s(this,v))}disableClick(){this.div.removeEventListener("pointerdown",s(this,D)),this.div.removeEventListener("pointerup",s(this,v))}attach(x){s(this,o).set(x.id,x);const{annotationElementId:$}=x;$&&s(this,b).isDeletedAnnotationElement($)&&s(this,b).removeDeletedAnnotationElement(x)}detach(x){var $;s(this,o).delete(x.id),($=s(this,d))==null||$.removePointerInTextLayer(x.contentDiv),!s(this,w)&&x.annotationElementId&&s(this,b).addDeletedAnnotationElement(x)}remove(x){this.detach(x),s(this,b).removeEditor(x),x.div.style.display="none",setTimeout(()=>{x.div.style.display="",x.div.remove(),x.isAttachedToDOM=!1,document.activeElement===document.body&&s(this,b).focusMainContainer()},0),s(this,_)||this.addInkEditorIfNeeded(!1)}add(x){if(st(this,u,Be).call(this,x),s(this,b).addEditor(x),this.attach(x),!x.isAttachedToDOM){const $=x.render();this.div.append($),x.isAttachedToDOM=!0}this.moveEditorInDOM(x),x.onceAdded(),s(this,b).addToAnnotationStorage(x)}moveEditorInDOM(x){var $;($=s(this,d))==null||$.moveElementInDOM(this.div,x.div,x.contentDiv,!0)}addOrRebuild(x){x.needsToBeRebuilt()?x.rebuild():this.add(x)}getNextId(){return s(this,b).getId()}deserialize(x){switch(x.annotationType??x.annotationEditorType){case a.AnnotationEditorType.FREETEXT:return U.FreeTextEditor.deserialize(x,this,s(this,b));case a.AnnotationEditorType.INK:return et.InkEditor.deserialize(x,this,s(this,b))}return null}setSelected(x){s(this,b).setSelected(x)}toggleSelected(x){s(this,b).toggleSelected(x)}isSelected(x){return s(this,b).isSelected(x)}unselect(x){s(this,b).unselect(x)}pointerup(x){const{isMac:$}=a.FeatureTest.platform;if(!(x.button!==0||x.ctrlKey&&$)&&x.target===this.div&&s(this,g)){if(ct(this,g,!1),!s(this,R)){ct(this,R,!0);return}st(this,n,je).call(this,x)}}pointerdown(x){const{isMac:$}=a.FeatureTest.platform;if(x.button!==0||x.ctrlKey&&$||x.target!==this.div)return;ct(this,g,!0);const at=s(this,b).getActive();ct(this,R,!at||at.isEmpty())}drop(x){const $=x.dataTransfer.getData("text/plain"),at=s(this,b).getEditor($);if(!at)return;x.preventDefault(),x.dataTransfer.dropEffect="move",st(this,u,Be).call(this,at);const dt=this.div.getBoundingClientRect(),V=x.clientX-dt.x,it=x.clientY-dt.y;at.translate(V-at.startX,it-at.startY),this.moveEditorInDOM(at),at.div.focus()}dragover(x){x.preventDefault()}destroy(){var x,$;((x=s(this,b).getActive())==null?void 0:x.parent)===this&&s(this,b).setActiveEditor(null);for(const at of s(this,o).values())($=s(this,d))==null||$.removePointerInTextLayer(at.contentDiv),at.setParent(null),at.isAttachedToDOM=!1,at.div.remove();this.div=null,s(this,o).clear(),s(this,b).removeLayer(this)}render({viewport:x}){this.viewport=x,(0,X.setLayerDimensions)(this.div,x),(0,G.bindEvents)(this,this.div,["dragover","drop"]);for(const $ of s(this,b).getEditors(this.pageIndex))this.add($);this.updateMode()}update({viewport:x}){s(this,b).commitOrRemove(),this.viewport=x,(0,X.setLayerDimensions)(this.div,{rotation:x.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:x,pageHeight:$}=this.viewport.rawDims;return[x,$]}};d=new WeakMap,R=new WeakMap,I=new WeakMap,v=new WeakMap,D=new WeakMap,o=new WeakMap,g=new WeakMap,_=new WeakMap,w=new WeakMap,b=new WeakMap,u=new WeakSet,Be=function(x){var $;x.parent!==this&&(x.annotationElementId&&(s(this,b).addDeletedAnnotationElement(x.annotationElementId),m.AnnotationEditor.deleteAnnotationElement(x),x.annotationElementId=null),this.attach(x),($=x.parent)==null||$.detach(x),x.setParent(this),x.div&&x.isAttachedToDOM&&(x.div.remove(),this.div.append(x.div)))},i=new WeakSet,fn=function(x){switch(s(this,b).getMode()){case a.AnnotationEditorType.FREETEXT:return new U.FreeTextEditor(x);case a.AnnotationEditorType.INK:return new et.InkEditor(x)}return null},n=new WeakSet,je=function(x){const $=this.getNextId(),at=st(this,i,fn).call(this,{parent:this,id:$,x:x.offsetX,y:x.offsetY,uiManager:s(this,b)});return at&&this.add(at),at},p=new WeakSet,Ue=function(){ct(this,_,!0);for(const x of s(this,o).values())x.isEmpty()&&x.remove();ct(this,_,!1)},Xt(L,"_initialized",!1);let S=L;e.AnnotationEditorLayer=S},(tt,e,O)=>{var X,S,d,R,I,v,D,o,g,_,pn,b,gn,E,mn,t,fe,h,He,F,bn,K,We;Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var a=O(1),m=O(5),G=O(4),U=O(29);const $=class $ extends G.AnnotationEditor{constructor(V){super({...V,name:"freeTextEditor"});q(this,_);q(this,b);q(this,E);q(this,t);q(this,h);q(this,F);q(this,K);q(this,X,this.editorDivBlur.bind(this));q(this,S,this.editorDivFocus.bind(this));q(this,d,this.editorDivInput.bind(this));q(this,R,this.editorDivKeydown.bind(this));q(this,I,void 0);q(this,v,"");q(this,D,`${this.id}-editor`);q(this,o,void 0);q(this,g,null);ct(this,I,V.color||$._defaultColor||G.AnnotationEditor._defaultLineColor),ct(this,o,V.fontSize||$._defaultFontSize)}static get _keyboardManager(){return(0,a.shadow)(this,"_keyboardManager",new m.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],$.prototype.commitOrRemove,!0],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],$.prototype.commitOrRemove]]))}static initialize(V){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(St=>[St,V.get(St)]));const it=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(it.getPropertyValue("--freetext-padding"))}static updateDefaultParams(V,it){switch(V){case a.AnnotationEditorParamsType.FREETEXT_SIZE:$._defaultFontSize=it;break;case a.AnnotationEditorParamsType.FREETEXT_COLOR:$._defaultColor=it;break}}updateParams(V,it){switch(V){case a.AnnotationEditorParamsType.FREETEXT_SIZE:st(this,_,pn).call(this,it);break;case a.AnnotationEditorParamsType.FREETEXT_COLOR:st(this,b,gn).call(this,it);break}}static get defaultPropertiesToUpdate(){return[[a.AnnotationEditorParamsType.FREETEXT_SIZE,$._defaultFontSize],[a.AnnotationEditorParamsType.FREETEXT_COLOR,$._defaultColor||G.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[a.AnnotationEditorParamsType.FREETEXT_SIZE,s(this,o)],[a.AnnotationEditorParamsType.FREETEXT_COLOR,s(this,I)]]}getInitialTranslation(){const V=this.parentScale;return[-$._internalPadding*V,-($._internalPadding+s(this,o))*V]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(a.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",s(this,R)),this.editorDiv.addEventListener("focus",s(this,S)),this.editorDiv.addEventListener("blur",s(this,X)),this.editorDiv.addEventListener("input",s(this,d)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",s(this,D)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",s(this,R)),this.editorDiv.removeEventListener("focus",s(this,S)),this.editorDiv.removeEventListener("blur",s(this,X)),this.editorDiv.removeEventListener("input",s(this,d)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(V){super.focusin(V),V.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){if(this.width){st(this,K,We).call(this);return}this.enableEditMode(),this.editorDiv.focus()}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const V=s(this,v),it=ct(this,v,st(this,E,mn).call(this).trimEnd());if(V===it)return;const St=vt=>{if(ct(this,v,vt),!vt){this.remove();return}st(this,h,He).call(this),this.rebuild(),st(this,t,fe).call(this)};this.addCommands({cmd:()=>{St(it)},undo:()=>{St(V)},mustExec:!1}),st(this,t,fe).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(V){this.enableEditMode(),this.editorDiv.focus()}keydown(V){V.target===this.div&&V.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(V){$._keyboardManager.exec(this,V)}editorDivFocus(V){this.isEditing=!0}editorDivBlur(V){this.isEditing=!1}editorDivInput(V){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let V,it;this.width&&(V=this.x,it=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",s(this,D)),this.enableEditing(),$._l10nPromise.get("editor_free_text2_aria_label").then(vt=>{var yt;return(yt=this.editorDiv)==null?void 0:yt.setAttribute("aria-label",vt)}),$._l10nPromise.get("free_text2_default_content").then(vt=>{var yt;return(yt=this.editorDiv)==null?void 0:yt.setAttribute("default-content",vt)}),this.editorDiv.contentEditable=!0;const{style:St}=this.editorDiv;if(St.fontSize=`calc(${s(this,o)}px * var(--scale-factor))`,St.color=s(this,I),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,m.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[vt,yt]=this.parentDimensions;if(this.annotationElementId){const[Dt]=this.getInitialTranslation();this.setAt(V*vt,it*yt,Dt,Dt)}else this.setAt(V*vt,it*yt,this.width*vt,this.height*yt);st(this,h,He).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(V,it,St){let vt=null;if(V instanceof U.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Dt,fontColor:j},rect:c,rotation:l,id:y},textContent:M,parent:{page:{pageNumber:N}}}=V;if(!M||M.length===0)return null;vt=V={annotationType:a.AnnotationEditorType.FREETEXT,color:Array.from(j),fontSize:Dt,value:M.join(`
`),pageIndex:N-1,rect:c,rotation:l,id:y,deleted:!1}}const yt=super.deserialize(V,it,St);return ct(yt,o,V.fontSize),ct(yt,I,a.Util.makeHexColor(...V.color)),ct(yt,v,V.value),yt.annotationElementId=V.id||null,ct(yt,g,vt),yt}serialize(V=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const it=$._internalPadding*this.parentScale,St=this.getRect(it,it),vt=G.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:s(this,I)),yt={annotationType:a.AnnotationEditorType.FREETEXT,color:vt,fontSize:s(this,o),value:s(this,v),pageIndex:this.pageIndex,rect:St,rotation:this.rotation};return V?yt:this.annotationElementId&&!st(this,F,bn).call(this,yt)?null:(yt.id=this.annotationElementId,yt)}};X=new WeakMap,S=new WeakMap,d=new WeakMap,R=new WeakMap,I=new WeakMap,v=new WeakMap,D=new WeakMap,o=new WeakMap,g=new WeakMap,_=new WeakSet,pn=function(V){const it=vt=>{this.editorDiv.style.fontSize=`calc(${vt}px * var(--scale-factor))`,this.translate(0,-(vt-s(this,o))*this.parentScale),ct(this,o,vt),st(this,t,fe).call(this)},St=s(this,o);this.addCommands({cmd:()=>{it(V)},undo:()=>{it(St)},mustExec:!0,type:a.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},b=new WeakSet,gn=function(V){const it=s(this,I);this.addCommands({cmd:()=>{ct(this,I,this.editorDiv.style.color=V)},undo:()=>{ct(this,I,this.editorDiv.style.color=it)},mustExec:!0,type:a.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},E=new WeakSet,mn=function(){const V=this.editorDiv.getElementsByTagName("div");if(V.length===0)return this.editorDiv.innerText;const it=[];for(const St of V)it.push(St.innerText.replace(/\r\n?|\n/,""));return it.join(`
`)},t=new WeakSet,fe=function(){const[V,it]=this.parentDimensions;let St;if(this.isAttachedToDOM)St=this.div.getBoundingClientRect();else{const{currentLayer:vt,div:yt}=this,Dt=yt.style.display;yt.style.display="hidden",vt.div.append(this.div),St=yt.getBoundingClientRect(),yt.remove(),yt.style.display=Dt}this.width=St.width/V,this.height=St.height/it},h=new WeakSet,He=function(){if(this.editorDiv.replaceChildren(),!!s(this,v))for(const V of s(this,v).split(`
`)){const it=document.createElement("div");it.append(V?document.createTextNode(V):document.createElement("br")),this.editorDiv.append(it)}},F=new WeakSet,bn=function(V){const{value:it,fontSize:St,color:vt,rect:yt,pageIndex:Dt}=s(this,g);return V.value!==it||V.fontSize!==St||V.rect.some((j,c)=>Math.abs(j-yt[c])>=1)||V.color.some((j,c)=>j!==vt[c])||V.pageIndex!==Dt},K=new WeakSet,We=function(V=!1){if(!this.annotationElementId)return;if(st(this,t,fe).call(this),!V&&(this.width===0||this.height===0)){setTimeout(()=>st(this,K,We).call(this,!0),0);return}const it=$._internalPadding*this.parentScale;s(this,g).rect=this.getRect(it,it)},Xt($,"_freeTextDefaultContent",""),Xt($,"_l10nPromise"),Xt($,"_internalPadding",0),Xt($,"_defaultColor",null),Xt($,"_defaultFontSize",10),Xt($,"_type","freetext");let et=$;e.FreeTextEditor=et},(tt,e,O)=>{var j,ne,l,_n,M,N,H,z,Q,rt,ot,ht,ut,Et,pt,xt,Ot,Tt,bt,nt,Y,Ge,mt,ze,Rt,qe,It,Ft,C,P,B,lt,kt,Lt,Ut,Ht,$e,$t,Ve;Object.defineProperty(e,"__esModule",{value:!0}),e.InkAnnotationElement=e.FreeTextAnnotationElement=e.AnnotationLayer=void 0;var a=O(1),m=O(6),G=O(3),U=O(30),et=O(31);const X=1e3,S=9,d=new WeakSet;function R(Mt){return{width:Mt[2]-Mt[0],height:Mt[3]-Mt[1]}}class I{static create(T){switch(T.data.annotationType){case a.AnnotationType.LINK:return new D(T);case a.AnnotationType.TEXT:return new o(T);case a.AnnotationType.WIDGET:switch(T.data.fieldType){case"Tx":return new _(T);case"Btn":return T.data.radioButton?new u(T):T.data.checkBox?new b(T):new E(T);case"Ch":return new i(T);case"Sig":return new w(T)}return new g(T);case a.AnnotationType.POPUP:return new t(T);case a.AnnotationType.FREETEXT:return new h(T);case a.AnnotationType.LINE:return new p(T);case a.AnnotationType.SQUARE:return new F(T);case a.AnnotationType.CIRCLE:return new L(T);case a.AnnotationType.POLYLINE:return new K(T);case a.AnnotationType.CARET:return new $(T);case a.AnnotationType.INK:return new at(T);case a.AnnotationType.POLYGON:return new x(T);case a.AnnotationType.HIGHLIGHT:return new dt(T);case a.AnnotationType.UNDERLINE:return new V(T);case a.AnnotationType.SQUIGGLY:return new it(T);case a.AnnotationType.STRIKEOUT:return new St(T);case a.AnnotationType.STAMP:return new vt(T);case a.AnnotationType.FILEATTACHMENT:return new yt(T);default:return new v(T)}}}class v{constructor(T,{isRenderable:f=!1,ignoreBorder:r=!1,createQuadrilaterals:A=!1}={}){this.isRenderable=f,this.data=T.data,this.layer=T.layer,this.linkService=T.linkService,this.downloadManager=T.downloadManager,this.imageResourcesPath=T.imageResourcesPath,this.renderForms=T.renderForms,this.svgFactory=T.svgFactory,this.annotationStorage=T.annotationStorage,this.enableScripting=T.enableScripting,this.hasJSActions=T.hasJSActions,this._fieldObjects=T.fieldObjects,this.parent=T.parent,f&&(this.container=this._createContainer(r)),A&&(this.quadrilaterals=this._createQuadrilaterals(r))}_createContainer(T){const{data:f,parent:{page:r,viewport:A}}=this,k=document.createElement("section");k.setAttribute("data-annotation-id",f.id),k.style.zIndex=this.parent.zIndex++,this.data.popupRef&&k.setAttribute("aria-haspopup","dialog"),f.noRotate&&k.classList.add("norotate");const{pageWidth:W,pageHeight:Z,pageX:gt,pageY:At}=A.rawDims;if(!f.rect||this instanceof t){const{rotation:Nt}=f;return!f.hasOwnCanvas&&Nt!==0&&this.setRotation(Nt,k),k}const{width:J,height:Ct}=R(f.rect),_t=a.Util.normalizeRect([f.rect[0],r.view[3]-f.rect[1]+r.view[1],f.rect[2],r.view[3]-f.rect[3]+r.view[1]]);if(!T&&f.borderStyle.width>0){k.style.borderWidth=`${f.borderStyle.width}px`;const Nt=f.borderStyle.horizontalCornerRadius,jt=f.borderStyle.verticalCornerRadius;if(Nt>0||jt>0){const Gt=`calc(${Nt}px * var(--scale-factor)) / calc(${jt}px * var(--scale-factor))`;k.style.borderRadius=Gt}else if(this instanceof u){const Gt=`calc(${J}px * var(--scale-factor)) / calc(${Ct}px * var(--scale-factor))`;k.style.borderRadius=Gt}switch(f.borderStyle.style){case a.AnnotationBorderStyleType.SOLID:k.style.borderStyle="solid";break;case a.AnnotationBorderStyleType.DASHED:k.style.borderStyle="dashed";break;case a.AnnotationBorderStyleType.BEVELED:(0,a.warn)("Unimplemented border style: beveled");break;case a.AnnotationBorderStyleType.INSET:(0,a.warn)("Unimplemented border style: inset");break;case a.AnnotationBorderStyleType.UNDERLINE:k.style.borderBottomStyle="solid";break}const Wt=f.borderColor||null;Wt?k.style.borderColor=a.Util.makeHexColor(Wt[0]|0,Wt[1]|0,Wt[2]|0):k.style.borderWidth=0}k.style.left=`${100*(_t[0]-gt)/W}%`,k.style.top=`${100*(_t[1]-At)/Z}%`;const{rotation:Pt}=f;return f.hasOwnCanvas||Pt===0?(k.style.width=`${100*J/W}%`,k.style.height=`${100*Ct/Z}%`):this.setRotation(Pt,k),k}setRotation(T,f=this.container){const{pageWidth:r,pageHeight:A}=this.parent.viewport.rawDims,{width:k,height:W}=R(this.data.rect);let Z,gt;T%180===0?(Z=100*k/r,gt=100*W/A):(Z=100*W/r,gt=100*k/A),f.style.width=`${Z}%`,f.style.height=`${gt}%`,f.setAttribute("data-main-rotation",(360-T)%360)}get _commonActions(){const T=(f,r,A)=>{const k=A.detail[f];A.target.style[r]=U.ColorConverters[`${k[0]}_HTML`](k.slice(1))};return(0,a.shadow)(this,"_commonActions",{display:f=>{const r=f.detail.display%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:r,print:f.detail.display===0||f.detail.display===3})},print:f=>{this.annotationStorage.setValue(this.data.id,{print:f.detail.print})},hidden:f=>{this.container.style.visibility=f.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:f.detail.hidden})},focus:f=>{setTimeout(()=>f.target.focus({preventScroll:!1}),0)},userName:f=>{f.target.title=f.detail.userName},readonly:f=>{f.detail.readonly?f.target.setAttribute("readonly",""):f.target.removeAttribute("readonly")},required:f=>{this._setRequired(f.target,f.detail.required)},bgColor:f=>{T("bgColor","backgroundColor",f)},fillColor:f=>{T("fillColor","backgroundColor",f)},fgColor:f=>{T("fgColor","color",f)},textColor:f=>{T("textColor","color",f)},borderColor:f=>{T("borderColor","borderColor",f)},strokeColor:f=>{T("strokeColor","borderColor",f)},rotation:f=>{const r=f.detail.rotation;this.setRotation(r),this.annotationStorage.setValue(this.data.id,{rotation:r})}})}_dispatchEventFromSandbox(T,f){const r=this._commonActions;for(const A of Object.keys(f.detail)){const k=T[A]||r[A];k==null||k(f)}}_setDefaultPropertiesFromJS(T){if(!this.enableScripting)return;const f=this.annotationStorage.getRawValue(this.data.id);if(!f)return;const r=this._commonActions;for(const[A,k]of Object.entries(f)){const W=r[A];if(W){const Z={detail:{[A]:k},target:T};W(Z),delete f[A]}}}_createQuadrilaterals(T=!1){if(!this.data.quadPoints)return null;const f=[],r=this.data.rect;let A=null;for(const k of this.data.quadPoints)this.data.rect=[k[2].x,k[2].y,k[1].x,k[1].y],f.push(this._createContainer(T)),A||(A=this.data.rect);return this.data.rect=r,this.firstQuadRect=A,f}_createPopup(){const{container:T,data:f}=this;T.setAttribute("aria-haspopup","dialog");const r=new t({data:{color:f.color,titleObj:f.titleObj,modificationDate:f.modificationDate,contentsObj:f.contentsObj,richText:f.richText,parentRect:this.firstQuadRect||f.rect,borderStyle:0,id:`popup_${f.id}`,rotation:f.rotation},parent:this.parent,elements:[this]});this.parent.div.append(r.render())}_renderQuadrilaterals(T){for(const f of this.quadrilaterals)f.classList.add(T);return this.quadrilaterals}render(){(0,a.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(T,f=null){const r=[];if(this._fieldObjects){const A=this._fieldObjects[T];if(A)for(const{page:k,id:W,exportValues:Z}of A){if(k===-1||W===f)continue;const gt=typeof Z=="string"?Z:null,At=document.querySelector(`[data-element-id="${W}"]`);if(At&&!d.has(At)){(0,a.warn)(`_getElementsByName - element not allowed: ${W}`);continue}r.push({id:W,exportValue:gt,domElement:At})}return r}for(const A of document.getElementsByName(T)){const{exportValue:k}=A,W=A.getAttribute("data-element-id");W!==f&&d.has(A)&&r.push({id:W,exportValue:k,domElement:A})}return r}show(){var T;this.container&&(this.container.hidden=!1),(T=this.popup)==null||T.maybeShow()}hide(){var T;this.container&&(this.container.hidden=!0),(T=this.popup)==null||T.forceHide()}getElementsToTriggerPopup(){return this.quadrilaterals||this.container}addHighlightArea(){const T=this.getElementsToTriggerPopup();if(Array.isArray(T))for(const f of T)f.classList.add("highlightArea");else T.classList.add("highlightArea")}}class D extends v{constructor(f,r=null){super(f,{isRenderable:!0,ignoreBorder:!!(r!=null&&r.ignoreBorder),createQuadrilaterals:!0});q(this,j);q(this,l);this.isTooltipOnly=f.data.isTooltipOnly}render(){const{data:f,linkService:r}=this,A=document.createElement("a");A.setAttribute("data-element-id",f.id);let k=!1;return f.url?(r.addLinkAttributes(A,f.url,f.newWindow),k=!0):f.action?(this._bindNamedAction(A,f.action),k=!0):f.attachment?(this._bindAttachment(A,f.attachment),k=!0):f.setOCGState?(st(this,l,_n).call(this,A,f.setOCGState),k=!0):f.dest?(this._bindLink(A,f.dest),k=!0):(f.actions&&(f.actions.Action||f.actions["Mouse Up"]||f.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(A,f),k=!0),f.resetForm?(this._bindResetFormAction(A,f.resetForm),k=!0):this.isTooltipOnly&&!k&&(this._bindLink(A,""),k=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((W,Z)=>{const gt=Z===0?A:A.cloneNode();return W.append(gt),W}):(this.container.classList.add("linkAnnotation"),k&&this.container.append(A),this.container)}_bindLink(f,r){f.href=this.linkService.getDestinationHash(r),f.onclick=()=>(r&&this.linkService.goToDestination(r),!1),(r||r==="")&&st(this,j,ne).call(this)}_bindNamedAction(f,r){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>(this.linkService.executeNamedAction(r),!1),st(this,j,ne).call(this)}_bindAttachment(f,r){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>{var A;return(A=this.downloadManager)==null||A.openOrDownloadData(this.container,r.content,r.filename),!1},st(this,j,ne).call(this)}_bindJSAction(f,r){f.href=this.linkService.getAnchorUrl("");const A=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const k of Object.keys(r.actions)){const W=A.get(k);W&&(f[W]=()=>{var Z;return(Z=this.linkService.eventBus)==null||Z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r.id,name:k}}),!1})}f.onclick||(f.onclick=()=>!1),st(this,j,ne).call(this)}_bindResetFormAction(f,r){const A=f.onclick;if(A||(f.href=this.linkService.getAnchorUrl("")),st(this,j,ne).call(this),!this._fieldObjects){(0,a.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),A||(f.onclick=()=>!1);return}f.onclick=()=>{var Ct;A==null||A();const{fields:k,refs:W,include:Z}=r,gt=[];if(k.length!==0||W.length!==0){const _t=new Set(W);for(const Pt of k){const Nt=this._fieldObjects[Pt]||[];for(const{id:jt}of Nt)_t.add(jt)}for(const Pt of Object.values(this._fieldObjects))for(const Nt of Pt)_t.has(Nt.id)===Z&&gt.push(Nt)}else for(const _t of Object.values(this._fieldObjects))gt.push(..._t);const At=this.annotationStorage,J=[];for(const _t of gt){const{id:Pt}=_t;switch(J.push(Pt),_t.type){case"text":{const jt=_t.defaultValue||"";At.setValue(Pt,{value:jt});break}case"checkbox":case"radiobutton":{const jt=_t.defaultValue===_t.exportValues;At.setValue(Pt,{value:jt});break}case"combobox":case"listbox":{const jt=_t.defaultValue||"";At.setValue(Pt,{value:jt});break}default:continue}const Nt=document.querySelector(`[data-element-id="${Pt}"]`);if(Nt){if(!d.has(Nt)){(0,a.warn)(`_bindResetFormAction - element not allowed: ${Pt}`);continue}}else continue;Nt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Ct=this.linkService.eventBus)==null||Ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:J,name:"ResetForm"}})),!1}}}j=new WeakSet,ne=function(){this.container.setAttribute("data-internal-link","")},l=new WeakSet,_n=function(f,r){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>(this.linkService.executeSetOCGState(r),!1),st(this,j,ne).call(this)};class o extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f})}render(){this.container.classList.add("textAnnotation");const T=document.createElement("img");return T.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",T.alt="[{{type}} Annotation]",T.dataset.l10nId="text_annotation_type",T.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(T),this.container}}class g extends v{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(T){var f;this.data.hasOwnCanvas&&(((f=T.previousSibling)==null?void 0:f.nodeName)==="CANVAS"&&(T.previousSibling.hidden=!0),T.hidden=!1)}_getKeyModifier(T){const{isWin:f,isMac:r}=a.FeatureTest.platform;return f&&T.ctrlKey||r&&T.metaKey}_setEventListener(T,f,r,A){f.includes("mouse")?T.addEventListener(f,k=>{var W;(W=this.linkService.eventBus)==null||W.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:A(k),shift:k.shiftKey,modifier:this._getKeyModifier(k)}})}):T.addEventListener(f,k=>{var W;(W=this.linkService.eventBus)==null||W.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:A(k)}})})}_setEventListeners(T,f,r){var A;for(const[k,W]of f)(W==="Action"||(A=this.data.actions)!=null&&A[W])&&this._setEventListener(T,k,W,r)}_setBackgroundColor(T){const f=this.data.backgroundColor||null;T.style.backgroundColor=f===null?"transparent":a.Util.makeHexColor(f[0],f[1],f[2])}_setTextStyle(T){const f=["left","center","right"],{fontColor:r}=this.data.defaultAppearanceData,A=this.data.defaultAppearanceData.fontSize||S,k=T.style;let W;const Z=2,gt=At=>Math.round(10*At)/10;if(this.data.multiLine){const At=Math.abs(this.data.rect[3]-this.data.rect[1]-Z),J=Math.round(At/(a.LINE_FACTOR*A))||1,Ct=At/J;W=Math.min(A,gt(Ct/a.LINE_FACTOR))}else{const At=Math.abs(this.data.rect[3]-this.data.rect[1]-Z);W=Math.min(A,gt(At/a.LINE_FACTOR))}k.fontSize=`calc(${W}px * var(--scale-factor))`,k.color=a.Util.makeHexColor(r[0],r[1],r[2]),this.data.textAlignment!==null&&(k.textAlign=f[this.data.textAlignment])}_setRequired(T,f){f?T.setAttribute("required",!0):T.removeAttribute("required"),T.setAttribute("aria-required",f)}}class _ extends g{constructor(T){const f=T.renderForms||!T.data.hasAppearance&&!!T.data.fieldValue;super(T,{isRenderable:f})}setPropertyOnSiblings(T,f,r,A){const k=this.annotationStorage;for(const W of this._getElementsByName(T.name,T.id))W.domElement&&(W.domElement[f]=r),k.setValue(W.id,{[A]:r})}render(){var A,k;const T=this.annotationStorage,f=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){const W=T.getValue(f,{value:this.data.fieldValue});let Z=W.value||"";const gt=T.getValue(f,{charLimit:this.data.maxLen}).charLimit;gt&&Z.length>gt&&(Z=Z.slice(0,gt));let At=W.formattedValue||((A=this.data.textContent)==null?void 0:A.join(`
`))||null;At&&this.data.comb&&(At=At.replaceAll(/\s+/g,""));const J={userValue:Z,formattedValue:At,lastCommittedValue:null,commitKey:1};this.data.multiLine?(r=document.createElement("textarea"),r.textContent=At??Z,this.data.doNotScroll&&(r.style.overflowY="hidden")):(r=document.createElement("input"),r.type="text",r.setAttribute("value",At??Z),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),d.add(r),r.setAttribute("data-element-id",f),r.disabled=this.data.readOnly,r.name=this.data.baseFieldName||this.data.fieldName,r.tabIndex=X,this._setRequired(r,this.data.required),gt&&(r.maxLength=gt),r.addEventListener("input",_t=>{T.setValue(f,{value:_t.target.value}),this.setPropertyOnSiblings(r,"value",_t.target.value,"value"),J.formattedValue=null}),r.addEventListener("resetform",_t=>{const Pt=this.data.defaultFieldValue??"";r.value=J.userValue=Pt,J.formattedValue=null});let Ct=_t=>{const{formattedValue:Pt}=J;Pt!=null&&(_t.target.value=Pt),_t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",Pt=>{const{target:Nt}=Pt;J.userValue&&(Nt.value=J.userValue),J.lastCommittedValue=Nt.value,J.commitKey=1}),r.addEventListener("updatefromsandbox",Pt=>{this.showElementAndHideCanvas(Pt.target);const Nt={value(jt){J.userValue=jt.detail.value??"",T.setValue(f,{value:J.userValue.toString()}),jt.target.value=J.userValue},formattedValue(jt){const{formattedValue:Wt}=jt.detail;J.formattedValue=Wt,Wt!=null&&jt.target!==document.activeElement&&(jt.target.value=Wt),T.setValue(f,{formattedValue:Wt})},selRange(jt){jt.target.setSelectionRange(...jt.detail.selRange)},charLimit:jt=>{var zt;const{charLimit:Wt}=jt.detail,{target:Gt}=jt;if(Wt===0){Gt.removeAttribute("maxLength");return}Gt.setAttribute("maxLength",Wt);let qt=J.userValue;!qt||qt.length<=Wt||(qt=qt.slice(0,Wt),Gt.value=J.userValue=qt,T.setValue(f,{value:qt}),(zt=this.linkService.eventBus)==null||zt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f,name:"Keystroke",value:qt,willCommit:!0,commitKey:1,selStart:Gt.selectionStart,selEnd:Gt.selectionEnd}}))}};this._dispatchEventFromSandbox(Nt,Pt)}),r.addEventListener("keydown",Pt=>{var Wt;J.commitKey=1;let Nt=-1;if(Pt.key==="Escape"?Nt=0:Pt.key==="Enter"&&!this.data.multiLine?Nt=2:Pt.key==="Tab"&&(J.commitKey=3),Nt===-1)return;const{value:jt}=Pt.target;J.lastCommittedValue!==jt&&(J.lastCommittedValue=jt,J.userValue=jt,(Wt=this.linkService.eventBus)==null||Wt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f,name:"Keystroke",value:jt,willCommit:!0,commitKey:Nt,selStart:Pt.target.selectionStart,selEnd:Pt.target.selectionEnd}}))});const _t=Ct;Ct=null,r.addEventListener("blur",Pt=>{var jt;if(!Pt.relatedTarget)return;const{value:Nt}=Pt.target;J.userValue=Nt,J.lastCommittedValue!==Nt&&((jt=this.linkService.eventBus)==null||jt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f,name:"Keystroke",value:Nt,willCommit:!0,commitKey:J.commitKey,selStart:Pt.target.selectionStart,selEnd:Pt.target.selectionEnd}})),_t(Pt)}),(k=this.data.actions)!=null&&k.Keystroke&&r.addEventListener("beforeinput",Pt=>{var Kt;J.lastCommittedValue=null;const{data:Nt,target:jt}=Pt,{value:Wt,selectionStart:Gt,selectionEnd:qt}=jt;let zt=Gt,Vt=qt;switch(Pt.inputType){case"deleteWordBackward":{const Zt=Wt.substring(0,Gt).match(/\w*[^\w]*$/);Zt&&(zt-=Zt[0].length);break}case"deleteWordForward":{const Zt=Wt.substring(Gt).match(/^[^\w]*\w*/);Zt&&(Vt+=Zt[0].length);break}case"deleteContentBackward":Gt===qt&&(zt-=1);break;case"deleteContentForward":Gt===qt&&(Vt+=1);break}Pt.preventDefault(),(Kt=this.linkService.eventBus)==null||Kt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f,name:"Keystroke",value:Wt,change:Nt||"",willCommit:!1,selStart:zt,selEnd:Vt}})}),this._setEventListeners(r,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Pt=>Pt.target.value)}if(Ct&&r.addEventListener("blur",Ct),this.data.comb){const Pt=(this.data.rect[2]-this.data.rect[0])/gt;r.classList.add("comb"),r.style.letterSpacing=`calc(${Pt}px * var(--scale-factor) - 1ch)`}}else r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell";return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class w extends g{constructor(T){super(T,{isRenderable:!!T.data.hasOwnCanvas})}}class b extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){const T=this.annotationStorage,f=this.data,r=f.id;let A=T.getValue(r,{value:f.exportValue===f.fieldValue}).value;typeof A=="string"&&(A=A!=="Off",T.setValue(r,{value:A})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const k=document.createElement("input");return d.add(k),k.setAttribute("data-element-id",r),k.disabled=f.readOnly,this._setRequired(k,this.data.required),k.type="checkbox",k.name=f.baseFieldName||f.fieldName,A&&k.setAttribute("checked",!0),k.setAttribute("exportValue",f.exportValue),k.tabIndex=X,k.addEventListener("change",W=>{const{name:Z,checked:gt}=W.target;for(const At of this._getElementsByName(Z,r)){const J=gt&&At.exportValue===f.exportValue;At.domElement&&(At.domElement.checked=J),T.setValue(At.id,{value:J})}T.setValue(r,{value:gt})}),k.addEventListener("resetform",W=>{const Z=f.defaultFieldValue||"Off";W.target.checked=Z===f.exportValue}),this.enableScripting&&this.hasJSActions&&(k.addEventListener("updatefromsandbox",W=>{const Z={value(gt){gt.target.checked=gt.detail.value!=="Off",T.setValue(r,{value:gt.target.checked})}};this._dispatchEventFromSandbox(Z,W)}),this._setEventListeners(k,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],W=>W.target.checked)),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class u extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const T=this.annotationStorage,f=this.data,r=f.id;let A=T.getValue(r,{value:f.fieldValue===f.buttonValue}).value;typeof A=="string"&&(A=A!==f.buttonValue,T.setValue(r,{value:A}));const k=document.createElement("input");if(d.add(k),k.setAttribute("data-element-id",r),k.disabled=f.readOnly,this._setRequired(k,this.data.required),k.type="radio",k.name=f.baseFieldName||f.fieldName,A&&k.setAttribute("checked",!0),k.tabIndex=X,k.addEventListener("change",W=>{const{name:Z,checked:gt}=W.target;for(const At of this._getElementsByName(Z,r))T.setValue(At.id,{value:!1});T.setValue(r,{value:gt})}),k.addEventListener("resetform",W=>{const Z=f.defaultFieldValue;W.target.checked=Z!=null&&Z===f.buttonValue}),this.enableScripting&&this.hasJSActions){const W=f.buttonValue;k.addEventListener("updatefromsandbox",Z=>{const gt={value:At=>{const J=W===At.detail.value;for(const Ct of this._getElementsByName(At.target.name)){const _t=J&&Ct.id===r;Ct.domElement&&(Ct.domElement.checked=_t),T.setValue(Ct.id,{value:_t})}}};this._dispatchEventFromSandbox(gt,Z)}),this._setEventListeners(k,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.checked)}return this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class E extends D{constructor(T){super(T,{ignoreBorder:T.data.hasAppearance})}render(){const T=super.render();T.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(T.title=this.data.alternativeText);const f=T.lastChild;return this.enableScripting&&this.hasJSActions&&f&&(this._setDefaultPropertiesFromJS(f),f.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({},r)})),T}}class i extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const T=this.annotationStorage,f=this.data.id,r=T.getValue(f,{value:this.data.fieldValue}),A=document.createElement("select");d.add(A),A.setAttribute("data-element-id",f),A.disabled=this.data.readOnly,this._setRequired(A,this.data.required),A.name=this.data.baseFieldName||this.data.fieldName,A.tabIndex=X;let k=this.data.combo&&this.data.options.length>0;this.data.combo||(A.size=this.data.options.length,this.data.multiSelect&&(A.multiple=!0)),A.addEventListener("resetform",J=>{const Ct=this.data.defaultFieldValue;for(const _t of A.options)_t.selected=_t.value===Ct});for(const J of this.data.options){const Ct=document.createElement("option");Ct.textContent=J.displayValue,Ct.value=J.exportValue,r.value.includes(J.exportValue)&&(Ct.setAttribute("selected",!0),k=!1),A.append(Ct)}let W=null;if(k){const J=document.createElement("option");J.value=" ",J.setAttribute("hidden",!0),J.setAttribute("selected",!0),A.prepend(J),W=()=>{J.remove(),A.removeEventListener("input",W),W=null},A.addEventListener("input",W)}const Z=J=>{const Ct=J?"value":"textContent",{options:_t,multiple:Pt}=A;return Pt?Array.prototype.filter.call(_t,Nt=>Nt.selected).map(Nt=>Nt[Ct]):_t.selectedIndex===-1?null:_t[_t.selectedIndex][Ct]};let gt=Z(!1);const At=J=>{const Ct=J.target.options;return Array.prototype.map.call(Ct,_t=>({displayValue:_t.textContent,exportValue:_t.value}))};return this.enableScripting&&this.hasJSActions?(A.addEventListener("updatefromsandbox",J=>{const Ct={value(_t){W==null||W();const Pt=_t.detail.value,Nt=new Set(Array.isArray(Pt)?Pt:[Pt]);for(const jt of A.options)jt.selected=Nt.has(jt.value);T.setValue(f,{value:Z(!0)}),gt=Z(!1)},multipleSelection(_t){A.multiple=!0},remove(_t){const Pt=A.options,Nt=_t.detail.remove;Pt[Nt].selected=!1,A.remove(Nt),Pt.length>0&&Array.prototype.findIndex.call(Pt,Wt=>Wt.selected)===-1&&(Pt[0].selected=!0),T.setValue(f,{value:Z(!0),items:At(_t)}),gt=Z(!1)},clear(_t){for(;A.length!==0;)A.remove(0);T.setValue(f,{value:null,items:[]}),gt=Z(!1)},insert(_t){const{index:Pt,displayValue:Nt,exportValue:jt}=_t.detail.insert,Wt=A.children[Pt],Gt=document.createElement("option");Gt.textContent=Nt,Gt.value=jt,Wt?Wt.before(Gt):A.append(Gt),T.setValue(f,{value:Z(!0),items:At(_t)}),gt=Z(!1)},items(_t){const{items:Pt}=_t.detail;for(;A.length!==0;)A.remove(0);for(const Nt of Pt){const{displayValue:jt,exportValue:Wt}=Nt,Gt=document.createElement("option");Gt.textContent=jt,Gt.value=Wt,A.append(Gt)}A.options.length>0&&(A.options[0].selected=!0),T.setValue(f,{value:Z(!0),items:At(_t)}),gt=Z(!1)},indices(_t){const Pt=new Set(_t.detail.indices);for(const Nt of _t.target.options)Nt.selected=Pt.has(Nt.index);T.setValue(f,{value:Z(!0)}),gt=Z(!1)},editable(_t){_t.target.disabled=!_t.detail.editable}};this._dispatchEventFromSandbox(Ct,J)}),A.addEventListener("input",J=>{var _t;const Ct=Z(!0);T.setValue(f,{value:Ct}),J.preventDefault(),(_t=this.linkService.eventBus)==null||_t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f,name:"Keystroke",value:gt,changeEx:Ct,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(A,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],J=>J.target.value)):A.addEventListener("input",function(J){T.setValue(f,{value:Z(!0)})}),this.data.combo&&this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class t extends v{constructor(T){var k,W,Z;const{data:f,elements:r}=T,A=!!((k=f.titleObj)!=null&&k.str||(W=f.contentsObj)!=null&&W.str||(Z=f.richText)!=null&&Z.str);super(T,{isRenderable:A}),this.elements=r}render(){this.container.classList.add("popupAnnotation");const T=new n({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),f=[];for(const r of this.elements)r.popup=T,f.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",f.join(",")),this.container}}class n{constructor({container:T,color:f,elements:r,titleObj:A,modificationDate:k,contentsObj:W,richText:Z,parent:gt,rect:At,parentRect:J,open:Ct}){q(this,Y);q(this,mt);q(this,Rt);q(this,M,null);q(this,N,st(this,Rt,qe).bind(this));q(this,H,st(this,mt,ze).bind(this));q(this,z,st(this,Y,Ge).bind(this));q(this,Q,null);q(this,rt,null);q(this,ot,null);q(this,ht,null);q(this,ut,null);q(this,Et,null);q(this,pt,!1);q(this,xt,null);q(this,Ot,null);q(this,Tt,null);q(this,bt,null);q(this,nt,!1);ct(this,rt,T),ct(this,bt,A),ct(this,ot,W),ct(this,Tt,Z),ct(this,ut,gt),ct(this,Q,f),ct(this,Ot,At),ct(this,Et,J),ct(this,ht,r);const _t=m.PDFDateString.toDateObject(k);_t&&ct(this,M,gt.l10n.get("annotation_date_string",{date:_t.toLocaleDateString(),time:_t.toLocaleTimeString()})),this.trigger=r.flatMap(Pt=>Pt.getElementsToTriggerPopup());for(const Pt of this.trigger)Pt.addEventListener("click",s(this,z)),Pt.addEventListener("mouseenter",s(this,H)),Pt.addEventListener("mouseleave",s(this,N));s(this,rt).hidden=!0,Ct&&st(this,Y,Ge).call(this)}render(){if(s(this,xt))return;const{page:{view:T},viewport:{rawDims:{pageWidth:f,pageHeight:r,pageX:A,pageY:k}}}=s(this,ut),W=ct(this,xt,document.createElement("div"));if(W.className="popup",s(this,Q)){const zt=W.style.outlineColor=a.Util.makeHexColor(...s(this,Q));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?W.style.backgroundColor=`color-mix(in srgb, ${zt} 30%, white)`:W.style.backgroundColor=a.Util.makeHexColor(...s(this,Q).map(Kt=>Math.floor(.7*(255-Kt)+Kt)))}const Z=document.createElement("span");Z.className="header";const gt=document.createElement("h1");if(Z.append(gt),{dir:gt.dir,str:gt.textContent}=s(this,bt),W.append(Z),s(this,M)){const zt=document.createElement("span");zt.classList.add("popupDate"),s(this,M).then(Vt=>{zt.textContent=Vt}),Z.append(zt)}const At=s(this,ot),J=s(this,Tt);if(J!=null&&J.str&&(!(At!=null&&At.str)||At.str===J.str))et.XfaLayer.render({xfaHtml:J.html,intent:"richText",div:W}),W.lastChild.classList.add("richText","popupContent");else{const zt=this._formatContents(At);W.append(zt)}let Ct=!!s(this,Et),_t=Ct?s(this,Et):s(this,Ot);for(const zt of s(this,ht))if(!_t||a.Util.intersect(zt.data.rect,_t)!==null){_t=zt.data.rect,Ct=!0;break}const Pt=a.Util.normalizeRect([_t[0],T[3]-_t[1]+T[1],_t[2],T[3]-_t[3]+T[1]]),Nt=5,jt=Ct?_t[2]-_t[0]+Nt:0,Wt=Pt[0]+jt,Gt=Pt[1],{style:qt}=s(this,rt);qt.left=`${100*(Wt-A)/f}%`,qt.top=`${100*(Gt-k)/r}%`,s(this,rt).append(W)}_formatContents({str:T,dir:f}){const r=document.createElement("p");r.classList.add("popupContent"),r.dir=f;const A=T.split(/(?:\r\n?|\n)/);for(let k=0,W=A.length;k<W;++k){const Z=A[k];r.append(document.createTextNode(Z)),k<W-1&&r.append(document.createElement("br"))}return r}forceHide(){ct(this,nt,this.isVisible),s(this,nt)&&(s(this,rt).hidden=!0)}maybeShow(){s(this,nt)&&(ct(this,nt,!1),s(this,rt).hidden=!1)}get isVisible(){return s(this,rt).hidden===!1}}M=new WeakMap,N=new WeakMap,H=new WeakMap,z=new WeakMap,Q=new WeakMap,rt=new WeakMap,ot=new WeakMap,ht=new WeakMap,ut=new WeakMap,Et=new WeakMap,pt=new WeakMap,xt=new WeakMap,Ot=new WeakMap,Tt=new WeakMap,bt=new WeakMap,nt=new WeakMap,Y=new WeakSet,Ge=function(){ct(this,pt,!s(this,pt)),s(this,pt)?(st(this,mt,ze).call(this),s(this,rt).addEventListener("click",s(this,z))):(st(this,Rt,qe).call(this),s(this,rt).removeEventListener("click",s(this,z)))},mt=new WeakSet,ze=function(){s(this,xt)||this.render(),this.isVisible?s(this,pt)&&s(this,rt).classList.add("focused"):(s(this,rt).hidden=!1,s(this,rt).style.zIndex=parseInt(s(this,rt).style.zIndex)+1e3)},Rt=new WeakSet,qe=function(){s(this,rt).classList.remove("focused"),!s(this,pt)&&(s(this,rt).hidden=!0,s(this,rt).style.zIndex=parseInt(s(this,rt).style.zIndex)-1e3)};class h extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0}),this.textContent=T.data.textContent,this.annotationEditorType=a.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const T=document.createElement("div");T.classList.add("annotationTextContent"),T.setAttribute("role","comment");for(const f of this.textContent){const r=document.createElement("span");r.textContent=f,T.append(r)}this.container.append(T)}return this.data.popupRef||this._createPopup(),this.container}}e.FreeTextAnnotationElement=h;class p extends v{constructor(f){var A,k,W;const r=!!(f.data.popupRef||(A=f.data.titleObj)!=null&&A.str||(k=f.data.contentsObj)!=null&&k.str||(W=f.data.richText)!=null&&W.str);super(f,{isRenderable:r,ignoreBorder:!0});q(this,It,null)}render(){this.container.classList.add("lineAnnotation");const f=this.data,{width:r,height:A}=R(f.rect),k=this.svgFactory.create(r,A,!0),W=ct(this,It,this.svgFactory.createElement("svg:line"));return W.setAttribute("x1",f.rect[2]-f.lineCoordinates[0]),W.setAttribute("y1",f.rect[3]-f.lineCoordinates[1]),W.setAttribute("x2",f.rect[2]-f.lineCoordinates[2]),W.setAttribute("y2",f.rect[3]-f.lineCoordinates[3]),W.setAttribute("stroke-width",f.borderStyle.width||1),W.setAttribute("stroke","transparent"),W.setAttribute("fill","transparent"),k.append(W),this.container.append(k),f.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return s(this,It)}addHighlightArea(){this.container.classList.add("highlightArea")}}It=new WeakMap;class F extends v{constructor(f){var A,k,W;const r=!!(f.data.popupRef||(A=f.data.titleObj)!=null&&A.str||(k=f.data.contentsObj)!=null&&k.str||(W=f.data.richText)!=null&&W.str);super(f,{isRenderable:r,ignoreBorder:!0});q(this,Ft,null)}render(){this.container.classList.add("squareAnnotation");const f=this.data,{width:r,height:A}=R(f.rect),k=this.svgFactory.create(r,A,!0),W=f.borderStyle.width,Z=ct(this,Ft,this.svgFactory.createElement("svg:rect"));return Z.setAttribute("x",W/2),Z.setAttribute("y",W/2),Z.setAttribute("width",r-W),Z.setAttribute("height",A-W),Z.setAttribute("stroke-width",W||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),k.append(Z),this.container.append(k),f.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return s(this,Ft)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ft=new WeakMap;class L extends v{constructor(f){var A,k,W;const r=!!(f.data.popupRef||(A=f.data.titleObj)!=null&&A.str||(k=f.data.contentsObj)!=null&&k.str||(W=f.data.richText)!=null&&W.str);super(f,{isRenderable:r,ignoreBorder:!0});q(this,C,null)}render(){this.container.classList.add("circleAnnotation");const f=this.data,{width:r,height:A}=R(f.rect),k=this.svgFactory.create(r,A,!0),W=f.borderStyle.width,Z=ct(this,C,this.svgFactory.createElement("svg:ellipse"));return Z.setAttribute("cx",r/2),Z.setAttribute("cy",A/2),Z.setAttribute("rx",r/2-W/2),Z.setAttribute("ry",A/2-W/2),Z.setAttribute("stroke-width",W||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),k.append(Z),this.container.append(k),f.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return s(this,C)}addHighlightArea(){this.container.classList.add("highlightArea")}}C=new WeakMap;class K extends v{constructor(f){var A,k,W;const r=!!(f.data.popupRef||(A=f.data.titleObj)!=null&&A.str||(k=f.data.contentsObj)!=null&&k.str||(W=f.data.richText)!=null&&W.str);super(f,{isRenderable:r,ignoreBorder:!0});q(this,P,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const f=this.data,{width:r,height:A}=R(f.rect),k=this.svgFactory.create(r,A,!0);let W=[];for(const gt of f.vertices){const At=gt.x-f.rect[0],J=f.rect[3]-gt.y;W.push(At+","+J)}W=W.join(" ");const Z=ct(this,P,this.svgFactory.createElement(this.svgElementName));return Z.setAttribute("points",W),Z.setAttribute("stroke-width",f.borderStyle.width||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),k.append(Z),this.container.append(k),f.popupRef||this._createPopup(Z,f),this.container}getElementsToTriggerPopup(){return s(this,P)}addHighlightArea(){this.container.classList.add("highlightArea")}}P=new WeakMap;class x extends K{constructor(T){super(T),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $ extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class at extends v{constructor(f){var A,k,W;const r=!!(f.data.popupRef||(A=f.data.titleObj)!=null&&A.str||(k=f.data.contentsObj)!=null&&k.str||(W=f.data.richText)!=null&&W.str);super(f,{isRenderable:r,ignoreBorder:!0});q(this,B,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=a.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const f=this.data,{width:r,height:A}=R(f.rect),k=this.svgFactory.create(r,A,!0);for(const W of f.inkLists){let Z=[];for(const At of W){const J=At.x-f.rect[0],Ct=f.rect[3]-At.y;Z.push(`${J},${Ct}`)}Z=Z.join(" ");const gt=this.svgFactory.createElement(this.svgElementName);s(this,B).push(gt),gt.setAttribute("points",Z),gt.setAttribute("stroke-width",f.borderStyle.width||1),gt.setAttribute("stroke","transparent"),gt.setAttribute("fill","transparent"),f.popupRef||this._createPopup(gt,f),k.append(gt)}return this.container.append(k),this.container}getElementsToTriggerPopup(){return s(this,B)}addHighlightArea(){this.container.classList.add("highlightArea")}}B=new WeakMap,e.InkAnnotationElement=at;class dt extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class V extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class it extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class St extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class vt extends v{constructor(T){var r,A,k;const f=!!(T.data.popupRef||(r=T.data.titleObj)!=null&&r.str||(A=T.data.contentsObj)!=null&&A.str||(k=T.data.richText)!=null&&k.str);super(T,{isRenderable:f,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class yt extends v{constructor(f){var k;super(f,{isRenderable:!0});q(this,lt,null);const{filename:r,content:A}=this.data.file;this.filename=(0,m.getFilenameFromUrl)(r,!0),this.content=A,(k=this.linkService.eventBus)==null||k.dispatch("fileattachmentannotation",{source:this,filename:r,content:A})}render(){var r,A;this.container.classList.add("fileAttachmentAnnotation");let f;return this.data.hasAppearance?f=document.createElement("div"):(f=document.createElement("img"),f.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),f.classList.add("popupTriggerArea"),f.addEventListener("dblclick",this._download.bind(this)),ct(this,lt,f),!this.data.popupRef&&((r=this.data.titleObj)!=null&&r.str||(A=this.data.contentsObj)!=null&&A.str||this.data.richText)&&this._createPopup(),this.container.append(f),this.container}getElementsToTriggerPopup(){return s(this,lt)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var f;(f=this.downloadManager)==null||f.openOrDownloadData(this.container,this.content,this.filename)}}lt=new WeakMap;class Dt{constructor({div:T,accessibilityManager:f,annotationCanvasMap:r,l10n:A,page:k,viewport:W}){q(this,Ht);q(this,$t);q(this,kt,null);q(this,Lt,null);q(this,Ut,new Map);this.div=T,ct(this,kt,f),ct(this,Lt,r),this.l10n=A,this.page=k,this.viewport=W,this.zIndex=0;const{NullL10n:Z}=O(32);this.l10n||(this.l10n=Z)}async render(T){const{annotations:f}=T,r=this.div;(0,m.setLayerDimensions)(r,this.viewport);const A=new Map,k={data:null,layer:r,linkService:T.linkService,downloadManager:T.downloadManager,imageResourcesPath:T.imageResourcesPath||"",renderForms:T.renderForms!==!1,svgFactory:new m.DOMSVGFactory,annotationStorage:T.annotationStorage||new G.AnnotationStorage,enableScripting:T.enableScripting===!0,hasJSActions:T.hasJSActions,fieldObjects:T.fieldObjects,parent:this,elements:null};for(const W of f){if(W.noHTML)continue;const Z=W.annotationType===a.AnnotationType.POPUP;if(Z){const J=A.get(W.id);if(!J)continue;k.elements=J}else{const{width:J,height:Ct}=R(W.rect);if(J<=0||Ct<=0)continue}k.data=W;const gt=I.create(k);if(!gt.isRenderable)continue;if(!Z&&W.popupRef){const J=A.get(W.popupRef);J?J.push(gt):A.set(W.popupRef,[gt])}gt.annotationEditorType>0&&s(this,Ut).set(gt.data.id,gt);const At=gt.render();if(W.hidden&&(At.style.visibility="hidden"),Array.isArray(At))for(const J of At)st(this,Ht,$e).call(this,J,W.id);else st(this,Ht,$e).call(this,At,W.id)}st(this,$t,Ve).call(this),await this.l10n.translate(r)}update({viewport:T}){const f=this.div;this.viewport=T,(0,m.setLayerDimensions)(f,{rotation:T.rotation}),st(this,$t,Ve).call(this),f.hidden=!1}getEditableAnnotations(){return Array.from(s(this,Ut).values())}getEditableAnnotation(T){return s(this,Ut).get(T)}}kt=new WeakMap,Lt=new WeakMap,Ut=new WeakMap,Ht=new WeakSet,$e=function(T,f){var A;const r=T.firstChild||T;r.id=`${m.AnnotationPrefix}${f}`,this.div.append(T),(A=s(this,kt))==null||A.moveElementInDOM(this.div,T,r,!1)},$t=new WeakSet,Ve=function(){if(!s(this,Lt))return;const T=this.div;for(const[f,r]of s(this,Lt)){const A=T.querySelector(`[data-annotation-id="${f}"]`);if(!A)continue;const{firstChild:k}=A;k?k.nodeName==="CANVAS"?k.replaceWith(r):k.before(r):A.append(r)}s(this,Lt).clear()},e.AnnotationLayer=Dt},(tt,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function O(m){return Math.floor(Math.max(0,Math.min(1,m))*255).toString(16).padStart(2,"0")}class a{static CMYK_G([G,U,et,X]){return["G",1-Math.min(1,.3*G+.59*et+.11*U+X)]}static G_CMYK([G]){return["CMYK",0,0,0,1-G]}static G_RGB([G]){return["RGB",G,G,G]}static G_HTML([G]){const U=O(G);return`#${U}${U}${U}`}static RGB_G([G,U,et]){return["G",.3*G+.59*U+.11*et]}static RGB_HTML([G,U,et]){const X=O(G),S=O(U),d=O(et);return`#${X}${S}${d}`}static T_HTML(){return"#00000000"}static CMYK_RGB([G,U,et,X]){return["RGB",1-Math.min(1,G+X),1-Math.min(1,et+X),1-Math.min(1,U+X)]}static CMYK_HTML(G){const U=this.CMYK_RGB(G).slice(1);return this.RGB_HTML(U)}static RGB_CMYK([G,U,et]){const X=1-G,S=1-U,d=1-et,R=Math.min(X,S,d);return["CMYK",X,S,d,R]}}e.ColorConverters=a},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var a=O(19);class m{static setupStorage(U,et,X,S,d){const R=S.getValue(et,{value:null});switch(X.name){case"textarea":if(R.value!==null&&(U.textContent=R.value),d==="print")break;U.addEventListener("input",I=>{S.setValue(et,{value:I.target.value})});break;case"input":if(X.attributes.type==="radio"||X.attributes.type==="checkbox"){if(R.value===X.attributes.xfaOn?U.setAttribute("checked",!0):R.value===X.attributes.xfaOff&&U.removeAttribute("checked"),d==="print")break;U.addEventListener("change",I=>{S.setValue(et,{value:I.target.checked?I.target.getAttribute("xfaOn"):I.target.getAttribute("xfaOff")})})}else{if(R.value!==null&&U.setAttribute("value",R.value),d==="print")break;U.addEventListener("input",I=>{S.setValue(et,{value:I.target.value})})}break;case"select":if(R.value!==null)for(const I of X.children)I.attributes.value===R.value&&(I.attributes.selected=!0);U.addEventListener("input",I=>{const v=I.target.options,D=v.selectedIndex===-1?"":v[v.selectedIndex].value;S.setValue(et,{value:D})});break}}static setAttributes({html:U,element:et,storage:X=null,intent:S,linkService:d}){const{attributes:R}=et,I=U instanceof HTMLAnchorElement;R.type==="radio"&&(R.name=`${R.name}-${S}`);for(const[v,D]of Object.entries(R))if(D!=null)switch(v){case"class":D.length&&U.setAttribute(v,D.join(" "));break;case"dataId":break;case"id":U.setAttribute("data-element-id",D);break;case"style":Object.assign(U.style,D);break;case"textContent":U.textContent=D;break;default:(!I||v!=="href"&&v!=="newWindow")&&U.setAttribute(v,D)}I&&d.addLinkAttributes(U,R.href,R.newWindow),X&&R.dataId&&this.setupStorage(U,R.dataId,et,X)}static render(U){var o;const et=U.annotationStorage,X=U.linkService,S=U.xfaHtml,d=U.intent||"display",R=document.createElement(S.name);S.attributes&&this.setAttributes({html:R,element:S,intent:d,linkService:X});const I=[[S,-1,R]],v=U.div;if(v.append(R),U.viewport){const g=`matrix(${U.viewport.transform.join(",")})`;v.style.transform=g}d!=="richText"&&v.setAttribute("class","xfaLayer xfaFont");const D=[];for(;I.length>0;){const[g,_,w]=I.at(-1);if(_+1===g.children.length){I.pop();continue}const b=g.children[++I.at(-1)[1]];if(b===null)continue;const{name:u}=b;if(u==="#text"){const i=document.createTextNode(b.value);D.push(i),w.append(i);continue}let E;if((o=b==null?void 0:b.attributes)!=null&&o.xmlns?E=document.createElementNS(b.attributes.xmlns,u):E=document.createElement(u),w.append(E),b.attributes&&this.setAttributes({html:E,element:b,storage:et,intent:d,linkService:X}),b.children&&b.children.length>0)I.push([b,-1,E]);else if(b.value){const i=document.createTextNode(b.value);a.XfaText.shouldBuildText(u)&&D.push(i),E.append(i)}}for(const g of v.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:D}}static update(U){const et=`matrix(${U.viewport.transform.join(",")})`;U.div.style.transform=et,U.div.hidden=!1}}e.XfaLayer=m},(tt,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullL10n=void 0,e.getL10nFallback=a;const O={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};O.print_progress_percent="{{progress}}%";function a(U,et){switch(U){case"find_match_count":U=`find_match_count[${et.total===1?"one":"other"}]`;break;case"find_match_count_limit":U=`find_match_count_limit[${et.limit===1?"one":"other"}]`;break}return O[U]||""}function m(U,et){return et?U.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(X,S)=>S in et?et[S]:"{{"+S+"}}"):U}const G={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(U,et=null,X=a(U,et)){return m(X,et)},async translate(U){}};e.NullL10n=G},(tt,e,O)=>{var S,d,R,I,v,D,o,g,_,w,b,u,E,i,t,n,h,An,F,yn,K,vn,$,Sn,dt,Xe,it,En,vt,Ye,Dt,Cn,c,wn,y,Tn,N,Pn,z,xn,rt,ee,ht,Ke,Et,Se,xt,Ee,Tt,ae,nt,Je,ft,Ce,wt,kn,Bt,Qe,Ft,Fn,P,Rn,lt,Ze,Lt,we,Ht,oe,$t,tn;Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0;var a=O(1),m=O(4),G=O(29),U=O(5);const et=16,Mt=class Mt extends m.AnnotationEditor{constructor(r){super({...r,name:"inkEditor"});q(this,h);q(this,F);q(this,K);q(this,$);q(this,dt);q(this,it);q(this,vt);q(this,Dt);q(this,c);q(this,y);q(this,N);q(this,z);q(this,rt);q(this,ht);q(this,Et);q(this,xt);q(this,Tt);q(this,nt);q(this,ft);q(this,P);q(this,lt);q(this,Lt);q(this,Ht);q(this,$t);q(this,S,0);q(this,d,0);q(this,R,0);q(this,I,this.canvasContextMenu.bind(this));q(this,v,this.canvasPointermove.bind(this));q(this,D,this.canvasPointerleave.bind(this));q(this,o,this.canvasPointerup.bind(this));q(this,g,this.canvasPointerdown.bind(this));q(this,_,new Path2D);q(this,w,!1);q(this,b,!1);q(this,u,!1);q(this,E,null);q(this,i,0);q(this,t,0);q(this,n,null);this.color=r.color||null,this.thickness=r.thickness||null,this.opacity=r.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(r){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(A=>[A,r.get(A)]))}static updateDefaultParams(r,A){switch(r){case a.AnnotationEditorParamsType.INK_THICKNESS:Mt._defaultThickness=A;break;case a.AnnotationEditorParamsType.INK_COLOR:Mt._defaultColor=A;break;case a.AnnotationEditorParamsType.INK_OPACITY:Mt._defaultOpacity=A/100;break}}updateParams(r,A){switch(r){case a.AnnotationEditorParamsType.INK_THICKNESS:st(this,h,An).call(this,A);break;case a.AnnotationEditorParamsType.INK_COLOR:st(this,F,yn).call(this,A);break;case a.AnnotationEditorParamsType.INK_OPACITY:st(this,K,vn).call(this,A);break}}static get defaultPropertiesToUpdate(){return[[a.AnnotationEditorParamsType.INK_THICKNESS,Mt._defaultThickness],[a.AnnotationEditorParamsType.INK_COLOR,Mt._defaultColor||m.AnnotationEditor._defaultLineColor],[a.AnnotationEditorParamsType.INK_OPACITY,Math.round(Mt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[a.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Mt._defaultThickness],[a.AnnotationEditorParamsType.INK_COLOR,this.color||Mt._defaultColor||m.AnnotationEditor._defaultLineColor],[a.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Mt._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(st(this,Et,Se).call(this),st(this,xt,Ee).call(this)),this.isAttachedToDOM||(this.parent.add(this),st(this,Tt,ae).call(this)),st(this,Ht,oe).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,s(this,E).disconnect(),ct(this,E,null),super.remove())}setParent(r){!this.parent&&r?this._uiManager.removeShouldRescale(this):this.parent&&r===null&&this._uiManager.addShouldRescale(this),super.setParent(r)}onScaleChanging(){const[r,A]=this.parentDimensions,k=this.width*r,W=this.height*A;this.setDimensions(k,W)}enableEditMode(){s(this,w)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",s(this,g)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",s(this,g)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){s(this,w)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ct(this,w,!0),this.div.classList.add("disabled"),st(this,Ht,oe).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(r){super.focusin(r),this.enableEditMode()}canvasPointerdown(r){r.button!==0||!this.isInEditMode()||s(this,w)||(this.setInForeground(),r.preventDefault(),r.type!=="mouse"&&this.div.focus(),st(this,it,En).call(this,r.offsetX,r.offsetY))}canvasContextMenu(r){r.preventDefault()}canvasPointermove(r){r.preventDefault(),st(this,vt,Ye).call(this,r.offsetX,r.offsetY)}canvasPointerup(r){r.preventDefault(),st(this,ht,Ke).call(this,r)}canvasPointerleave(r){st(this,ht,Ke).call(this,r)}render(){if(this.div)return this.div;let r,A;this.width&&(r=this.x,A=this.y),super.render(),Mt._l10nPromise.get("editor_ink2_aria_label").then(At=>{var J;return(J=this.div)==null?void 0:J.setAttribute("aria-label",At)});const[k,W,Z,gt]=st(this,$,Sn).call(this);if(this.setAt(k,W,0,0),this.setDims(Z,gt),st(this,Et,Se).call(this),this.width){const[At,J]=this.parentDimensions;this.setAt(r*At,A*J,this.width*At,this.height*J),ct(this,u,!0),st(this,Tt,ae).call(this),this.setDims(this.width*At,this.height*J),st(this,rt,ee).call(this),st(this,$t,tn).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return st(this,xt,Ee).call(this),this.div}setDimensions(r,A){const k=Math.round(r),W=Math.round(A);if(s(this,i)===k&&s(this,t)===W)return;ct(this,i,k),ct(this,t,W),this.canvas.style.visibility="hidden",s(this,S)&&Math.abs(s(this,S)-r/A)>.01&&(A=Math.ceil(r/s(this,S)),this.setDims(r,A));const[Z,gt]=this.parentDimensions;this.width=r/Z,this.height=A/gt,s(this,w)&&st(this,nt,Je).call(this,r,A),st(this,Tt,ae).call(this),st(this,rt,ee).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(r,A,k){var Gt,qt,zt;if(r instanceof G.InkAnnotationElement)return null;const W=super.deserialize(r,A,k);W.thickness=r.thickness,W.color=a.Util.makeHexColor(...r.color),W.opacity=r.opacity;const[Z,gt]=W.pageDimensions,At=W.width*Z,J=W.height*gt,Ct=W.parentScale,_t=r.thickness/2;ct(W,S,At/J),ct(W,w,!0),ct(W,i,Math.round(At)),ct(W,t,Math.round(J));const{paths:Pt,rect:Nt,rotation:jt}=r;for(let{bezier:Vt}of Pt){Vt=st(Gt=Mt,Ft,Fn).call(Gt,Vt,Nt,jt);const Kt=[];W.paths.push(Kt);let Zt=Ct*(Vt[0]-_t),le=Ct*(Vt[1]-_t);for(let te=2,Te=Vt.length;te<Te;te+=6){const Pe=Ct*(Vt[te]-_t),ge=Ct*(Vt[te+1]-_t),me=Ct*(Vt[te+2]-_t),Mn=Ct*(Vt[te+3]-_t),en=Ct*(Vt[te+4]-_t),nn=Ct*(Vt[te+5]-_t);Kt.push([[Zt,le],[Pe,ge],[me,Mn],[en,nn]]),Zt=en,le=nn}const pe=st(this,wt,kn).call(this,Kt);W.bezierPath2D.push(pe)}const Wt=st(qt=W,lt,Ze).call(qt);return ct(W,R,Math.max(et,Wt[2]-Wt[0])),ct(W,d,Math.max(et,Wt[3]-Wt[1])),st(zt=W,nt,Je).call(zt,At,J),W}serialize(){if(this.isEmpty())return null;const r=this.getRect(0,0),A=m.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:a.AnnotationEditorType.INK,color:A,thickness:this.thickness,opacity:this.opacity,paths:st(this,P,Rn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,r),pageIndex:this.pageIndex,rect:r,rotation:this.rotation}}};S=new WeakMap,d=new WeakMap,R=new WeakMap,I=new WeakMap,v=new WeakMap,D=new WeakMap,o=new WeakMap,g=new WeakMap,_=new WeakMap,w=new WeakMap,b=new WeakMap,u=new WeakMap,E=new WeakMap,i=new WeakMap,t=new WeakMap,n=new WeakMap,h=new WeakSet,An=function(r){const A=this.thickness;this.addCommands({cmd:()=>{this.thickness=r,st(this,Ht,oe).call(this)},undo:()=>{this.thickness=A,st(this,Ht,oe).call(this)},mustExec:!0,type:a.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},F=new WeakSet,yn=function(r){const A=this.color;this.addCommands({cmd:()=>{this.color=r,st(this,rt,ee).call(this)},undo:()=>{this.color=A,st(this,rt,ee).call(this)},mustExec:!0,type:a.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},K=new WeakSet,vn=function(r){r/=100;const A=this.opacity;this.addCommands({cmd:()=>{this.opacity=r,st(this,rt,ee).call(this)},undo:()=>{this.opacity=A,st(this,rt,ee).call(this)},mustExec:!0,type:a.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},$=new WeakSet,Sn=function(){const{parentRotation:r,parentDimensions:[A,k]}=this;switch(r){case 90:return[0,k,k,A];case 180:return[A,k,A,k];case 270:return[A,0,k,A];default:return[0,0,A,k]}},dt=new WeakSet,Xe=function(){const{ctx:r,color:A,opacity:k,thickness:W,parentScale:Z,scaleFactor:gt}=this;r.lineWidth=W*Z/gt,r.lineCap="round",r.lineJoin="round",r.miterLimit=10,r.strokeStyle=`${A}${(0,U.opacityToHex)(k)}`},it=new WeakSet,En=function(r,A){this.canvas.addEventListener("contextmenu",s(this,I)),this.canvas.addEventListener("pointerleave",s(this,D)),this.canvas.addEventListener("pointermove",s(this,v)),this.canvas.addEventListener("pointerup",s(this,o)),this.canvas.removeEventListener("pointerdown",s(this,g)),this.isEditing=!0,s(this,u)||(ct(this,u,!0),st(this,Tt,ae).call(this),this.thickness||(this.thickness=Mt._defaultThickness),this.color||(this.color=Mt._defaultColor||m.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Mt._defaultOpacity)),this.currentPath.push([r,A]),ct(this,b,!1),st(this,dt,Xe).call(this),ct(this,n,()=>{st(this,y,Tn).call(this),s(this,n)&&window.requestAnimationFrame(s(this,n))}),window.requestAnimationFrame(s(this,n))},vt=new WeakSet,Ye=function(r,A){const[k,W]=this.currentPath.at(-1);if(this.currentPath.length>1&&r===k&&A===W)return;const Z=this.currentPath;let gt=s(this,_);if(Z.push([r,A]),ct(this,b,!0),Z.length<=2){gt.moveTo(...Z[0]),gt.lineTo(r,A);return}Z.length===3&&(ct(this,_,gt=new Path2D),gt.moveTo(...Z[0])),st(this,N,Pn).call(this,gt,...Z.at(-3),...Z.at(-2),r,A)},Dt=new WeakSet,Cn=function(){if(this.currentPath.length===0)return;const r=this.currentPath.at(-1);s(this,_).lineTo(...r)},c=new WeakSet,wn=function(r,A){ct(this,n,null),r=Math.min(Math.max(r,0),this.canvas.width),A=Math.min(Math.max(A,0),this.canvas.height),st(this,vt,Ye).call(this,r,A),st(this,Dt,Cn).call(this);let k;if(this.currentPath.length!==1)k=st(this,z,xn).call(this);else{const J=[r,A];k=[[J,J.slice(),J.slice(),J]]}const W=s(this,_),Z=this.currentPath;this.currentPath=[],ct(this,_,new Path2D);const gt=()=>{this.allRawPaths.push(Z),this.paths.push(k),this.bezierPath2D.push(W),this.rebuild()},At=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(st(this,Et,Se).call(this),st(this,xt,Ee).call(this)),st(this,Ht,oe).call(this))};this.addCommands({cmd:gt,undo:At,mustExec:!0})},y=new WeakSet,Tn=function(){if(!s(this,b))return;ct(this,b,!1);const r=Math.ceil(this.thickness*this.parentScale),A=this.currentPath.slice(-3),k=A.map(gt=>gt[0]),W=A.map(gt=>gt[1]);Math.min(...k)-r,Math.max(...k)+r,Math.min(...W)-r,Math.max(...W)+r;const{ctx:Z}=this;Z.save(),Z.clearRect(0,0,this.canvas.width,this.canvas.height);for(const gt of this.bezierPath2D)Z.stroke(gt);Z.stroke(s(this,_)),Z.restore()},N=new WeakSet,Pn=function(r,A,k,W,Z,gt,At){const J=(A+W)/2,Ct=(k+Z)/2,_t=(W+gt)/2,Pt=(Z+At)/2;r.bezierCurveTo(J+2*(W-J)/3,Ct+2*(Z-Ct)/3,_t+2*(W-_t)/3,Pt+2*(Z-Pt)/3,_t,Pt)},z=new WeakSet,xn=function(){const r=this.currentPath;if(r.length<=2)return[[r[0],r[0],r.at(-1),r.at(-1)]];const A=[];let k,[W,Z]=r[0];for(k=1;k<r.length-2;k++){const[Nt,jt]=r[k],[Wt,Gt]=r[k+1],qt=(Nt+Wt)/2,zt=(jt+Gt)/2,Vt=[W+2*(Nt-W)/3,Z+2*(jt-Z)/3],Kt=[qt+2*(Nt-qt)/3,zt+2*(jt-zt)/3];A.push([[W,Z],Vt,Kt,[qt,zt]]),[W,Z]=[qt,zt]}const[gt,At]=r[k],[J,Ct]=r[k+1],_t=[W+2*(gt-W)/3,Z+2*(At-Z)/3],Pt=[J+2*(gt-J)/3,Ct+2*(At-Ct)/3];return A.push([[W,Z],_t,Pt,[J,Ct]]),A},rt=new WeakSet,ee=function(){if(this.isEmpty()){st(this,ft,Ce).call(this);return}st(this,dt,Xe).call(this);const{canvas:r,ctx:A}=this;A.setTransform(1,0,0,1,0,0),A.clearRect(0,0,r.width,r.height),st(this,ft,Ce).call(this);for(const k of this.bezierPath2D)A.stroke(k)},ht=new WeakSet,Ke=function(r){this.canvas.removeEventListener("pointerleave",s(this,D)),this.canvas.removeEventListener("pointermove",s(this,v)),this.canvas.removeEventListener("pointerup",s(this,o)),this.canvas.addEventListener("pointerdown",s(this,g)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",s(this,I))},10),st(this,c,wn).call(this,r.offsetX,r.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Et=new WeakSet,Se=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Mt._l10nPromise.get("editor_ink_canvas_aria_label").then(r=>{var A;return(A=this.canvas)==null?void 0:A.setAttribute("aria-label",r)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},xt=new WeakSet,Ee=function(){ct(this,E,new ResizeObserver(r=>{const A=r[0].contentRect;A.width&&A.height&&this.setDimensions(A.width,A.height)})),s(this,E).observe(this.div)},Tt=new WeakSet,ae=function(){if(!s(this,u))return;const[r,A]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*r),this.canvas.height=Math.ceil(this.height*A),st(this,ft,Ce).call(this)},nt=new WeakSet,Je=function(r,A){const k=st(this,Lt,we).call(this),W=(r-k)/s(this,R),Z=(A-k)/s(this,d);this.scaleFactor=Math.min(W,Z)},ft=new WeakSet,Ce=function(){const r=st(this,Lt,we).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+r,this.translationY*this.scaleFactor+r)},wt=new WeakSet,kn=function(r){const A=new Path2D;for(let k=0,W=r.length;k<W;k++){const[Z,gt,At,J]=r[k];k===0&&A.moveTo(...Z),A.bezierCurveTo(gt[0],gt[1],At[0],At[1],J[0],J[1])}return A},Bt=new WeakSet,Qe=function(r,A,k){const[W,Z,gt,At]=A;switch(k){case 0:for(let J=0,Ct=r.length;J<Ct;J+=2)r[J]+=W,r[J+1]=At-r[J+1];break;case 90:for(let J=0,Ct=r.length;J<Ct;J+=2){const _t=r[J];r[J]=r[J+1]+W,r[J+1]=_t+Z}break;case 180:for(let J=0,Ct=r.length;J<Ct;J+=2)r[J]=gt-r[J],r[J+1]+=Z;break;case 270:for(let J=0,Ct=r.length;J<Ct;J+=2){const _t=r[J];r[J]=gt-r[J+1],r[J+1]=At-_t}break;default:throw new Error("Invalid rotation")}return r},Ft=new WeakSet,Fn=function(r,A,k){const[W,Z,gt,At]=A;switch(k){case 0:for(let J=0,Ct=r.length;J<Ct;J+=2)r[J]-=W,r[J+1]=At-r[J+1];break;case 90:for(let J=0,Ct=r.length;J<Ct;J+=2){const _t=r[J];r[J]=r[J+1]-Z,r[J+1]=_t-W}break;case 180:for(let J=0,Ct=r.length;J<Ct;J+=2)r[J]=gt-r[J],r[J+1]-=Z;break;case 270:for(let J=0,Ct=r.length;J<Ct;J+=2){const _t=r[J];r[J]=At-r[J+1],r[J+1]=gt-_t}break;default:throw new Error("Invalid rotation")}return r},P=new WeakSet,Rn=function(r,A,k,W){var Ct,_t;const Z=[],gt=this.thickness/2,At=r*A+gt,J=r*k+gt;for(const Pt of this.paths){const Nt=[],jt=[];for(let Wt=0,Gt=Pt.length;Wt<Gt;Wt++){const[qt,zt,Vt,Kt]=Pt[Wt],Zt=r*qt[0]+At,le=r*qt[1]+J,pe=r*zt[0]+At,te=r*zt[1]+J,Te=r*Vt[0]+At,Pe=r*Vt[1]+J,ge=r*Kt[0]+At,me=r*Kt[1]+J;Wt===0&&(Nt.push(Zt,le),jt.push(Zt,le)),Nt.push(pe,te,Te,Pe,ge,me),jt.push(pe,te),Wt===Gt-1&&jt.push(ge,me)}Z.push({bezier:st(Ct=Mt,Bt,Qe).call(Ct,Nt,W,this.rotation),points:st(_t=Mt,Bt,Qe).call(_t,jt,W,this.rotation)})}return Z},lt=new WeakSet,Ze=function(){let r=1/0,A=-1/0,k=1/0,W=-1/0;for(const Z of this.paths)for(const[gt,At,J,Ct]of Z){const _t=a.Util.bezierBoundingBox(...gt,...At,...J,...Ct);r=Math.min(r,_t[0]),k=Math.min(k,_t[1]),A=Math.max(A,_t[2]),W=Math.max(W,_t[3])}return[r,k,A,W]},Lt=new WeakSet,we=function(){return s(this,w)?Math.ceil(this.thickness*this.parentScale):0},Ht=new WeakSet,oe=function(r=!1){if(this.isEmpty())return;if(!s(this,w)){st(this,rt,ee).call(this);return}const A=st(this,lt,Ze).call(this),k=st(this,Lt,we).call(this);ct(this,R,Math.max(et,A[2]-A[0])),ct(this,d,Math.max(et,A[3]-A[1]));const W=Math.ceil(k+s(this,R)*this.scaleFactor),Z=Math.ceil(k+s(this,d)*this.scaleFactor),[gt,At]=this.parentDimensions;this.width=W/gt,this.height=Z/At,ct(this,S,W/Z),st(this,$t,tn).call(this);const J=this.translationX,Ct=this.translationY;this.translationX=-A[0],this.translationY=-A[1],st(this,Tt,ae).call(this),st(this,rt,ee).call(this),ct(this,i,W),ct(this,t,Z),this.setDims(W,Z);const _t=r?k/this.scaleFactor/2:0;this.translate(J-this.translationX-_t,Ct-this.translationY-_t)},$t=new WeakSet,tn=function(){const{style:r}=this.div;s(this,S)>=1?(r.minHeight=`${et}px`,r.minWidth=`${Math.round(s(this,S)*et)}px`):(r.minWidth=`${et}px`,r.minHeight=`${Math.round(et/s(this,S))}px`)},q(Mt,wt),q(Mt,Bt),q(Mt,Ft),Xt(Mt,"_defaultColor",null),Xt(Mt,"_defaultOpacity",1),Xt(Mt,"_defaultThickness",1),Xt(Mt,"_l10nPromise"),Xt(Mt,"_type","ink");let X=Mt;e.InkEditor=X},(tt,e,O)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var a=O(6),m=O(1),G=O(10);const U={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},et="http://www.w3.org/XML/1998/namespace",X="http://www.w3.org/1999/xlink",S=["butt","round","square"],d=["miter","round","bevel"],R=function(E,i="",t=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!t)return URL.createObjectURL(new Blob([E],{type:i}));const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let h=`data:${i};base64,`;for(let p=0,F=E.length;p<F;p+=3){const L=E[p]&255,K=E[p+1]&255,x=E[p+2]&255,$=L>>2,at=(L&3)<<4|K>>4,dt=p+1<F?(K&15)<<2|x>>6:64,V=p+2<F?x&63:64;h+=n[$]+n[at]+n[dt]+n[V]}return h},I=function(){const E=new Uint8Array([137,80,78,71,13,10,26,10]),i=12,t=new Int32Array(256);for(let x=0;x<256;x++){let $=x;for(let at=0;at<8;at++)$&1?$=3988292384^$>>1&2147483647:$=$>>1&2147483647;t[x]=$}function n(x,$,at){let dt=-1;for(let V=$;V<at;V++){const it=(dt^x[V])&255,St=t[it];dt=dt>>>8^St}return dt^-1}function h(x,$,at,dt){let V=dt;const it=$.length;at[V]=it>>24&255,at[V+1]=it>>16&255,at[V+2]=it>>8&255,at[V+3]=it&255,V+=4,at[V]=x.charCodeAt(0)&255,at[V+1]=x.charCodeAt(1)&255,at[V+2]=x.charCodeAt(2)&255,at[V+3]=x.charCodeAt(3)&255,V+=4,at.set($,V),V+=$.length;const St=n(at,dt+4,V);at[V]=St>>24&255,at[V+1]=St>>16&255,at[V+2]=St>>8&255,at[V+3]=St&255}function p(x,$,at){let dt=1,V=0;for(let it=$;it<at;++it)dt=(dt+(x[it]&255))%65521,V=(V+dt)%65521;return V<<16|dt}function F(x){if(!G.isNodeJS)return L(x);try{let $;parseInt(process.versions.node)>=8?$=x:$=Buffer.from(x);const at=require$$5.deflateSync($,{level:9});return at instanceof Uint8Array?at:new Uint8Array(at)}catch($){(0,m.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+$)}return L(x)}function L(x){let $=x.length;const at=65535,dt=Math.ceil($/at),V=new Uint8Array(2+$+dt*5+4);let it=0;V[it++]=120,V[it++]=156;let St=0;for(;$>at;)V[it++]=0,V[it++]=255,V[it++]=255,V[it++]=0,V[it++]=0,V.set(x.subarray(St,St+at),it),it+=at,St+=at,$-=at;V[it++]=1,V[it++]=$&255,V[it++]=$>>8&255,V[it++]=~$&65535&255,V[it++]=(~$&65535)>>8&255,V.set(x.subarray(St),it),it+=x.length-St;const vt=p(x,0,x.length);return V[it++]=vt>>24&255,V[it++]=vt>>16&255,V[it++]=vt>>8&255,V[it++]=vt&255,V}function K(x,$,at,dt){const V=x.width,it=x.height;let St,vt,yt;const Dt=x.data;switch($){case m.ImageKind.GRAYSCALE_1BPP:vt=0,St=1,yt=V+7>>3;break;case m.ImageKind.RGB_24BPP:vt=2,St=8,yt=V*3;break;case m.ImageKind.RGBA_32BPP:vt=6,St=8,yt=V*4;break;default:throw new Error("invalid format")}const j=new Uint8Array((1+yt)*it);let c=0,l=0;for(let Q=0;Q<it;++Q)j[c++]=0,j.set(Dt.subarray(l,l+yt),c),l+=yt,c+=yt;if($===m.ImageKind.GRAYSCALE_1BPP&&dt){c=0;for(let Q=0;Q<it;Q++){c++;for(let rt=0;rt<yt;rt++)j[c++]^=255}}const y=new Uint8Array([V>>24&255,V>>16&255,V>>8&255,V&255,it>>24&255,it>>16&255,it>>8&255,it&255,St,vt,0,0,0]),M=F(j),N=E.length+i*3+y.length+M.length,H=new Uint8Array(N);let z=0;return H.set(E,z),z+=E.length,h("IHDR",y,H,z),z+=i+y.length,h("IDATA",M,H,z),z+=i+M.length,h("IEND",new Uint8Array(0),H,z),R(H,"image/png",at)}return function($,at,dt){const V=$.kind===void 0?m.ImageKind.GRAYSCALE_1BPP:$.kind;return K($,V,at,dt)}}();class v{constructor(){this.fontSizeScale=1,this.fontWeight=U.fontWeight,this.fontSize=0,this.textMatrix=m.IDENTITY_MATRIX,this.fontMatrix=m.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=m.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=U.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(i,t){this.x=i,this.y=t}}function D(E){let i=[];const t=[];for(const n of E){if(n.fn==="save"){i.push({fnId:92,fn:"group",items:[]}),t.push(i),i=i.at(-1).items;continue}n.fn==="restore"?i=t.pop():i.push(n)}return i}function o(E){if(Number.isInteger(E))return E.toString();const i=E.toFixed(10);let t=i.length-1;if(i[t]!=="0")return i;do t--;while(i[t]==="0");return i.substring(0,i[t]==="."?t:t+1)}function g(E){if(E[4]===0&&E[5]===0){if(E[1]===0&&E[2]===0)return E[0]===1&&E[3]===1?"":`scale(${o(E[0])} ${o(E[3])})`;if(E[0]===E[3]&&E[1]===-E[2]){const i=Math.acos(E[0])*180/Math.PI;return`rotate(${o(i)})`}}else if(E[0]===1&&E[1]===0&&E[2]===0&&E[3]===1)return`translate(${o(E[4])} ${o(E[5])})`;return`matrix(${o(E[0])} ${o(E[1])} ${o(E[2])} ${o(E[3])} ${o(E[4])} ${o(E[5])})`}let _=0,w=0,b=0;class u{constructor(i,t,n=!1){(0,a.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new a.DOMSVGFactory,this.current=new v,this.transformMatrix=m.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=i,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!n,this._operatorIdMapping=[];for(const h in m.OPS)this._operatorIdMapping[m.OPS[h]]=h}getObject(i,t=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):t}save(){this.transformStack.push(this.transformMatrix);const i=this.current;this.extraStack.push(i),this.current=i.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(i){this.save(),this.executeOpTree(i),this.restore()}loadDependencies(i){const t=i.fnArray,n=i.argsArray;for(let h=0,p=t.length;h<p;h++)if(t[h]===m.OPS.dependency)for(const F of n[h]){const L=F.startsWith("g_")?this.commonObjs:this.objs,K=new Promise(x=>{L.get(F,x)});this.current.dependencies.push(K)}return Promise.all(this.current.dependencies)}transform(i,t,n,h,p,F){const L=[i,t,n,h,p,F];this.transformMatrix=m.Util.transform(this.transformMatrix,L),this.tgrp=null}getSVG(i,t){this.viewport=t;const n=this._initialize(t);return this.loadDependencies(i).then(()=>(this.transformMatrix=m.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(i)),n))}convertOpList(i){const t=this._operatorIdMapping,n=i.argsArray,h=i.fnArray,p=[];for(let F=0,L=h.length;F<L;F++){const K=h[F];p.push({fnId:K,fn:t[K],args:n[F]})}return D(p)}executeOpTree(i){for(const t of i){const n=t.fn,h=t.fnId,p=t.args;switch(h|0){case m.OPS.beginText:this.beginText();break;case m.OPS.dependency:break;case m.OPS.setLeading:this.setLeading(p);break;case m.OPS.setLeadingMoveText:this.setLeadingMoveText(p[0],p[1]);break;case m.OPS.setFont:this.setFont(p);break;case m.OPS.showText:this.showText(p[0]);break;case m.OPS.showSpacedText:this.showText(p[0]);break;case m.OPS.endText:this.endText();break;case m.OPS.moveText:this.moveText(p[0],p[1]);break;case m.OPS.setCharSpacing:this.setCharSpacing(p[0]);break;case m.OPS.setWordSpacing:this.setWordSpacing(p[0]);break;case m.OPS.setHScale:this.setHScale(p[0]);break;case m.OPS.setTextMatrix:this.setTextMatrix(p[0],p[1],p[2],p[3],p[4],p[5]);break;case m.OPS.setTextRise:this.setTextRise(p[0]);break;case m.OPS.setTextRenderingMode:this.setTextRenderingMode(p[0]);break;case m.OPS.setLineWidth:this.setLineWidth(p[0]);break;case m.OPS.setLineJoin:this.setLineJoin(p[0]);break;case m.OPS.setLineCap:this.setLineCap(p[0]);break;case m.OPS.setMiterLimit:this.setMiterLimit(p[0]);break;case m.OPS.setFillRGBColor:this.setFillRGBColor(p[0],p[1],p[2]);break;case m.OPS.setStrokeRGBColor:this.setStrokeRGBColor(p[0],p[1],p[2]);break;case m.OPS.setStrokeColorN:this.setStrokeColorN(p);break;case m.OPS.setFillColorN:this.setFillColorN(p);break;case m.OPS.shadingFill:this.shadingFill(p[0]);break;case m.OPS.setDash:this.setDash(p[0],p[1]);break;case m.OPS.setRenderingIntent:this.setRenderingIntent(p[0]);break;case m.OPS.setFlatness:this.setFlatness(p[0]);break;case m.OPS.setGState:this.setGState(p[0]);break;case m.OPS.fill:this.fill();break;case m.OPS.eoFill:this.eoFill();break;case m.OPS.stroke:this.stroke();break;case m.OPS.fillStroke:this.fillStroke();break;case m.OPS.eoFillStroke:this.eoFillStroke();break;case m.OPS.clip:this.clip("nonzero");break;case m.OPS.eoClip:this.clip("evenodd");break;case m.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case m.OPS.paintImageXObject:this.paintImageXObject(p[0]);break;case m.OPS.paintInlineImageXObject:this.paintInlineImageXObject(p[0]);break;case m.OPS.paintImageMaskXObject:this.paintImageMaskXObject(p[0]);break;case m.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(p[0],p[1]);break;case m.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case m.OPS.closePath:this.closePath();break;case m.OPS.closeStroke:this.closeStroke();break;case m.OPS.closeFillStroke:this.closeFillStroke();break;case m.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case m.OPS.nextLine:this.nextLine();break;case m.OPS.transform:this.transform(p[0],p[1],p[2],p[3],p[4],p[5]);break;case m.OPS.constructPath:this.constructPath(p[0],p[1]);break;case m.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,m.warn)(`Unimplemented operator ${n}`);break}}}setWordSpacing(i){this.current.wordSpacing=i}setCharSpacing(i){this.current.charSpacing=i}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(i,t,n,h,p,F){const L=this.current;L.textMatrix=L.lineMatrix=[i,t,n,h,p,F],L.textMatrixScale=Math.hypot(i,t),L.x=L.lineX=0,L.y=L.lineY=0,L.xcoords=[],L.ycoords=[],L.tspan=this.svgFactory.createElement("svg:tspan"),L.tspan.setAttributeNS(null,"font-family",L.fontFamily),L.tspan.setAttributeNS(null,"font-size",`${o(L.fontSize)}px`),L.tspan.setAttributeNS(null,"y",o(-L.y)),L.txtElement=this.svgFactory.createElement("svg:text"),L.txtElement.append(L.tspan)}beginText(){const i=this.current;i.x=i.lineX=0,i.y=i.lineY=0,i.textMatrix=m.IDENTITY_MATRIX,i.lineMatrix=m.IDENTITY_MATRIX,i.textMatrixScale=1,i.tspan=this.svgFactory.createElement("svg:tspan"),i.txtElement=this.svgFactory.createElement("svg:text"),i.txtgrp=this.svgFactory.createElement("svg:g"),i.xcoords=[],i.ycoords=[]}moveText(i,t){const n=this.current;n.x=n.lineX+=i,n.y=n.lineY+=t,n.xcoords=[],n.ycoords=[],n.tspan=this.svgFactory.createElement("svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",`${o(n.fontSize)}px`),n.tspan.setAttributeNS(null,"y",o(-n.y))}showText(i){const t=this.current,n=t.font,h=t.fontSize;if(h===0)return;const p=t.fontSizeScale,F=t.charSpacing,L=t.wordSpacing,K=t.fontDirection,x=t.textHScale*K,$=n.vertical,at=$?1:-1,dt=n.defaultVMetrics,V=h*t.fontMatrix[0];let it=0;for(const yt of i){if(yt===null){it+=K*L;continue}else if(typeof yt=="number"){it+=at*yt*h/1e3;continue}const Dt=(yt.isSpace?L:0)+F,j=yt.fontChar;let c,l,y=yt.width;if($){let N;const H=yt.vmetric||dt;N=yt.vmetric?H[1]:y*.5,N=-N*V;const z=H[2]*V;y=H?-H[0]:y,c=N/p,l=(it+z)/p}else c=it/p,l=0;(yt.isInFont||n.missingFile)&&(t.xcoords.push(t.x+c),$&&t.ycoords.push(-t.y+l),t.tspan.textContent+=j);let M;$?M=y*V-Dt*K:M=y*V+Dt*K,it+=M}t.tspan.setAttributeNS(null,"x",t.xcoords.map(o).join(" ")),$?t.tspan.setAttributeNS(null,"y",t.ycoords.map(o).join(" ")):t.tspan.setAttributeNS(null,"y",o(-t.y)),$?t.y-=it:t.x+=it*x,t.tspan.setAttributeNS(null,"font-family",t.fontFamily),t.tspan.setAttributeNS(null,"font-size",`${o(t.fontSize)}px`),t.fontStyle!==U.fontStyle&&t.tspan.setAttributeNS(null,"font-style",t.fontStyle),t.fontWeight!==U.fontWeight&&t.tspan.setAttributeNS(null,"font-weight",t.fontWeight);const St=t.textRenderingMode&m.TextRenderingMode.FILL_STROKE_MASK;if(St===m.TextRenderingMode.FILL||St===m.TextRenderingMode.FILL_STROKE?(t.fillColor!==U.fillColor&&t.tspan.setAttributeNS(null,"fill",t.fillColor),t.fillAlpha<1&&t.tspan.setAttributeNS(null,"fill-opacity",t.fillAlpha)):t.textRenderingMode===m.TextRenderingMode.ADD_TO_PATH?t.tspan.setAttributeNS(null,"fill","transparent"):t.tspan.setAttributeNS(null,"fill","none"),St===m.TextRenderingMode.STROKE||St===m.TextRenderingMode.FILL_STROKE){const yt=1/(t.textMatrixScale||1);this._setStrokeAttributes(t.tspan,yt)}let vt=t.textMatrix;t.textRise!==0&&(vt=vt.slice(),vt[5]+=t.textRise),t.txtElement.setAttributeNS(null,"transform",`${g(vt)} scale(${o(x)}, -1)`),t.txtElement.setAttributeNS(et,"xml:space","preserve"),t.txtElement.append(t.tspan),t.txtgrp.append(t.txtElement),this._ensureTransformGroup().append(t.txtElement)}setLeadingMoveText(i,t){this.setLeading(-t),this.moveText(i,t)}addFontStyle(i){if(!i.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const t=R(i.data,i.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${i.loadedName}"; src: url(${t}); }
`}setFont(i){const t=this.current,n=this.commonObjs.get(i[0]);let h=i[1];t.font=n,this.embedFonts&&!n.missingFile&&!this.embeddedFonts[n.loadedName]&&(this.addFontStyle(n),this.embeddedFonts[n.loadedName]=n),t.fontMatrix=n.fontMatrix||m.FONT_IDENTITY_MATRIX;let p="normal";n.black?p="900":n.bold&&(p="bold");const F=n.italic?"italic":"normal";h<0?(h=-h,t.fontDirection=-1):t.fontDirection=1,t.fontSize=h,t.fontFamily=n.loadedName,t.fontWeight=p,t.fontStyle=F,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",o(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){var t;const i=this.current;i.textRenderingMode&m.TextRenderingMode.ADD_TO_PATH_FLAG&&((t=i.txtElement)!=null&&t.hasChildNodes())&&(i.element=i.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(i){i>0&&(this.current.lineWidth=i)}setLineCap(i){this.current.lineCap=S[i]}setLineJoin(i){this.current.lineJoin=d[i]}setMiterLimit(i){this.current.miterLimit=i}setStrokeAlpha(i){this.current.strokeAlpha=i}setStrokeRGBColor(i,t,n){this.current.strokeColor=m.Util.makeHexColor(i,t,n)}setFillAlpha(i){this.current.fillAlpha=i}setFillRGBColor(i,t,n){this.current.fillColor=m.Util.makeHexColor(i,t,n),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(i){this.current.strokeColor=this._makeColorN_Pattern(i)}setFillColorN(i){this.current.fillColor=this._makeColorN_Pattern(i)}shadingFill(i){const{width:t,height:n}=this.viewport,h=m.Util.inverseTransform(this.transformMatrix),[p,F,L,K]=m.Util.getAxialAlignedBoundingBox([0,0,t,n],h),x=this.svgFactory.createElement("svg:rect");x.setAttributeNS(null,"x",p),x.setAttributeNS(null,"y",F),x.setAttributeNS(null,"width",L-p),x.setAttributeNS(null,"height",K-F),x.setAttributeNS(null,"fill",this._makeShadingPattern(i)),this.current.fillAlpha<1&&x.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(x)}_makeColorN_Pattern(i){return i[0]==="TilingPattern"?this._makeTilingPattern(i):this._makeShadingPattern(i)}_makeTilingPattern(i){const t=i[1],n=i[2],h=i[3]||m.IDENTITY_MATRIX,[p,F,L,K]=i[4],x=i[5],$=i[6],at=i[7],dt=`shading${b++}`,[V,it,St,vt]=m.Util.normalizeRect([...m.Util.applyTransform([p,F],h),...m.Util.applyTransform([L,K],h)]),[yt,Dt]=m.Util.singularValueDecompose2dScale(h),j=x*yt,c=$*Dt,l=this.svgFactory.createElement("svg:pattern");l.setAttributeNS(null,"id",dt),l.setAttributeNS(null,"patternUnits","userSpaceOnUse"),l.setAttributeNS(null,"width",j),l.setAttributeNS(null,"height",c),l.setAttributeNS(null,"x",`${V}`),l.setAttributeNS(null,"y",`${it}`);const y=this.svg,M=this.transformMatrix,N=this.current.fillColor,H=this.current.strokeColor,z=this.svgFactory.create(St-V,vt-it);if(this.svg=z,this.transformMatrix=h,at===2){const Q=m.Util.makeHexColor(...t);this.current.fillColor=Q,this.current.strokeColor=Q}return this.executeOpTree(this.convertOpList(n)),this.svg=y,this.transformMatrix=M,this.current.fillColor=N,this.current.strokeColor=H,l.append(z.childNodes[0]),this.defs.append(l),`url(#${dt})`}_makeShadingPattern(i){switch(typeof i=="string"&&(i=this.objs.get(i)),i[0]){case"RadialAxial":const t=`shading${b++}`,n=i[3];let h;switch(i[1]){case"axial":const p=i[4],F=i[5];h=this.svgFactory.createElement("svg:linearGradient"),h.setAttributeNS(null,"id",t),h.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),h.setAttributeNS(null,"x1",p[0]),h.setAttributeNS(null,"y1",p[1]),h.setAttributeNS(null,"x2",F[0]),h.setAttributeNS(null,"y2",F[1]);break;case"radial":const L=i[4],K=i[5],x=i[6],$=i[7];h=this.svgFactory.createElement("svg:radialGradient"),h.setAttributeNS(null,"id",t),h.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),h.setAttributeNS(null,"cx",K[0]),h.setAttributeNS(null,"cy",K[1]),h.setAttributeNS(null,"r",$),h.setAttributeNS(null,"fx",L[0]),h.setAttributeNS(null,"fy",L[1]),h.setAttributeNS(null,"fr",x);break;default:throw new Error(`Unknown RadialAxial type: ${i[1]}`)}for(const p of n){const F=this.svgFactory.createElement("svg:stop");F.setAttributeNS(null,"offset",p[0]),F.setAttributeNS(null,"stop-color",p[1]),h.append(F)}return this.defs.append(h),`url(#${t})`;case"Mesh":return(0,m.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${i[0]}`)}}setDash(i,t){this.current.dashArray=i,this.current.dashPhase=t}constructPath(i,t){const n=this.current;let h=n.x,p=n.y,F=[],L=0;for(const K of i)switch(K|0){case m.OPS.rectangle:h=t[L++],p=t[L++];const x=t[L++],$=t[L++],at=h+x,dt=p+$;F.push("M",o(h),o(p),"L",o(at),o(p),"L",o(at),o(dt),"L",o(h),o(dt),"Z");break;case m.OPS.moveTo:h=t[L++],p=t[L++],F.push("M",o(h),o(p));break;case m.OPS.lineTo:h=t[L++],p=t[L++],F.push("L",o(h),o(p));break;case m.OPS.curveTo:h=t[L+4],p=t[L+5],F.push("C",o(t[L]),o(t[L+1]),o(t[L+2]),o(t[L+3]),o(h),o(p)),L+=6;break;case m.OPS.curveTo2:F.push("C",o(h),o(p),o(t[L]),o(t[L+1]),o(t[L+2]),o(t[L+3])),h=t[L+2],p=t[L+3],L+=4;break;case m.OPS.curveTo3:h=t[L+2],p=t[L+3],F.push("C",o(t[L]),o(t[L+1]),o(h),o(p),o(h),o(p)),L+=4;break;case m.OPS.closePath:F.push("Z");break}F=F.join(" "),n.path&&i.length>0&&i[0]!==m.OPS.rectangle&&i[0]!==m.OPS.moveTo?F=n.path.getAttributeNS(null,"d")+F:(n.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(n.path)),n.path.setAttributeNS(null,"d",F),n.path.setAttributeNS(null,"fill","none"),n.element=n.path,n.setCurrentPoint(h,p)}endPath(){const i=this.current;if(i.path=null,!this.pendingClip)return;if(!i.element){this.pendingClip=null;return}const t=`clippath${_++}`,n=this.svgFactory.createElement("svg:clipPath");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"transform",g(this.transformMatrix));const h=i.element.cloneNode(!0);if(this.pendingClip==="evenodd"?h.setAttributeNS(null,"clip-rule","evenodd"):h.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,n.append(h),this.defs.append(n),i.activeClipUrl){i.clipGroup=null;for(const p of this.extraStack)p.clipGroup=null;n.setAttributeNS(null,"clip-path",i.activeClipUrl)}i.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(i){this.pendingClip=i}closePath(){const i=this.current;if(i.path){const t=`${i.path.getAttributeNS(null,"d")}Z`;i.path.setAttributeNS(null,"d",t)}}setLeading(i){this.current.leading=-i}setTextRise(i){this.current.textRise=i}setTextRenderingMode(i){this.current.textRenderingMode=i}setHScale(i){this.current.textHScale=i/100}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[t,n]of i)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n);break;case"CA":this.setStrokeAlpha(n);break;case"ca":this.setFillAlpha(n);break;default:(0,m.warn)(`Unimplemented graphic state operator ${t}`);break}}fill(){const i=this.current;i.element&&(i.element.setAttributeNS(null,"fill",i.fillColor),i.element.setAttributeNS(null,"fill-opacity",i.fillAlpha),this.endPath())}stroke(){const i=this.current;i.element&&(this._setStrokeAttributes(i.element),i.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(i,t=1){const n=this.current;let h=n.dashArray;t!==1&&h.length>0&&(h=h.map(function(p){return t*p})),i.setAttributeNS(null,"stroke",n.strokeColor),i.setAttributeNS(null,"stroke-opacity",n.strokeAlpha),i.setAttributeNS(null,"stroke-miterlimit",o(n.miterLimit)),i.setAttributeNS(null,"stroke-linecap",n.lineCap),i.setAttributeNS(null,"stroke-linejoin",n.lineJoin),i.setAttributeNS(null,"stroke-width",o(t*n.lineWidth)+"px"),i.setAttributeNS(null,"stroke-dasharray",h.map(o).join(" ")),i.setAttributeNS(null,"stroke-dashoffset",o(t*n.dashPhase)+"px")}eoFill(){var i;(i=this.current.element)==null||i.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var i;(i=this.current.element)==null||i.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const i=this.svgFactory.createElement("svg:rect");i.setAttributeNS(null,"x","0"),i.setAttributeNS(null,"y","0"),i.setAttributeNS(null,"width","1px"),i.setAttributeNS(null,"height","1px"),i.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(i)}paintImageXObject(i){const t=this.getObject(i);if(!t){(0,m.warn)(`Dependent image with object ID ${i} is not ready yet`);return}this.paintInlineImageXObject(t)}paintInlineImageXObject(i,t){const n=i.width,h=i.height,p=I(i,this.forceDataSchema,!!t),F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",o(n)),F.setAttributeNS(null,"height",o(h)),this.current.element=F,this.clip("nonzero");const L=this.svgFactory.createElement("svg:image");L.setAttributeNS(X,"xlink:href",p),L.setAttributeNS(null,"x","0"),L.setAttributeNS(null,"y",o(-h)),L.setAttributeNS(null,"width",o(n)+"px"),L.setAttributeNS(null,"height",o(h)+"px"),L.setAttributeNS(null,"transform",`scale(${o(1/n)} ${o(-1/h)})`),t?t.append(L):this._ensureTransformGroup().append(L)}paintImageMaskXObject(i){const t=this.getObject(i.data,i);if(t.bitmap){(0,m.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const n=this.current,h=t.width,p=t.height,F=n.fillColor;n.maskId=`mask${w++}`;const L=this.svgFactory.createElement("svg:mask");L.setAttributeNS(null,"id",n.maskId);const K=this.svgFactory.createElement("svg:rect");K.setAttributeNS(null,"x","0"),K.setAttributeNS(null,"y","0"),K.setAttributeNS(null,"width",o(h)),K.setAttributeNS(null,"height",o(p)),K.setAttributeNS(null,"fill",F),K.setAttributeNS(null,"mask",`url(#${n.maskId})`),this.defs.append(L),this._ensureTransformGroup().append(K),this.paintInlineImageXObject(t,L)}paintFormXObjectBegin(i,t){if(Array.isArray(i)&&i.length===6&&this.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t){const n=t[2]-t[0],h=t[3]-t[1],p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",t[0]),p.setAttributeNS(null,"y",t[1]),p.setAttributeNS(null,"width",o(n)),p.setAttributeNS(null,"height",o(h)),this.current.element=p,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(i){const t=this.svgFactory.create(i.width,i.height),n=this.svgFactory.createElement("svg:defs");t.append(n),this.defs=n;const h=this.svgFactory.createElement("svg:g");return h.setAttributeNS(null,"transform",g(i.transform)),t.append(h),this.svg=h,t}_ensureClipGroup(){if(!this.current.clipGroup){const i=this.svgFactory.createElement("svg:g");i.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(i),this.current.clipGroup=i}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",g(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}e.SVGGraphics=u}],__webpack_module_cache__={};function __w_pdfjs_require__(tt){var e=__webpack_module_cache__[tt];if(e!==void 0)return e.exports;var O=__webpack_module_cache__[tt]={exports:{}};return __webpack_modules__[tt](O,O.exports,__w_pdfjs_require__),O.exports}var __webpack_exports__={};return(()=>{var tt=__webpack_exports__;Object.defineProperty(tt,"__esModule",{value:!0}),Object.defineProperty(tt,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(tt,"AnnotationEditorLayer",{enumerable:!0,get:function(){return G.AnnotationEditorLayer}}),Object.defineProperty(tt,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(tt,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(tt,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return U.AnnotationEditorUIManager}}),Object.defineProperty(tt,"AnnotationLayer",{enumerable:!0,get:function(){return et.AnnotationLayer}}),Object.defineProperty(tt,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(tt,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(tt,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(tt,"GlobalWorkerOptions",{enumerable:!0,get:function(){return X.GlobalWorkerOptions}}),Object.defineProperty(tt,"ImageKind",{enumerable:!0,get:function(){return e.ImageKind}}),Object.defineProperty(tt,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(tt,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(tt,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(tt,"PDFDataRangeTransport",{enumerable:!0,get:function(){return O.PDFDataRangeTransport}}),Object.defineProperty(tt,"PDFDateString",{enumerable:!0,get:function(){return a.PDFDateString}}),Object.defineProperty(tt,"PDFWorker",{enumerable:!0,get:function(){return O.PDFWorker}}),Object.defineProperty(tt,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(tt,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(tt,"PixelsPerInch",{enumerable:!0,get:function(){return a.PixelsPerInch}}),Object.defineProperty(tt,"PromiseCapability",{enumerable:!0,get:function(){return e.PromiseCapability}}),Object.defineProperty(tt,"RenderingCancelledException",{enumerable:!0,get:function(){return a.RenderingCancelledException}}),tt.SVGGraphics=void 0,Object.defineProperty(tt,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(tt,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(tt,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(tt,"XfaLayer",{enumerable:!0,get:function(){return S.XfaLayer}}),Object.defineProperty(tt,"build",{enumerable:!0,get:function(){return O.build}}),Object.defineProperty(tt,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(tt,"getDocument",{enumerable:!0,get:function(){return O.getDocument}}),Object.defineProperty(tt,"getFilenameFromUrl",{enumerable:!0,get:function(){return a.getFilenameFromUrl}}),Object.defineProperty(tt,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return a.getPdfFilenameFromUrl}}),Object.defineProperty(tt,"getXfaPageViewport",{enumerable:!0,get:function(){return a.getXfaPageViewport}}),Object.defineProperty(tt,"isDataScheme",{enumerable:!0,get:function(){return a.isDataScheme}}),Object.defineProperty(tt,"isPdfFile",{enumerable:!0,get:function(){return a.isPdfFile}}),Object.defineProperty(tt,"loadScript",{enumerable:!0,get:function(){return a.loadScript}}),Object.defineProperty(tt,"normalizeUnicode",{enumerable:!0,get:function(){return e.normalizeUnicode}}),Object.defineProperty(tt,"renderTextLayer",{enumerable:!0,get:function(){return m.renderTextLayer}}),Object.defineProperty(tt,"setLayerDimensions",{enumerable:!0,get:function(){return a.setLayerDimensions}}),Object.defineProperty(tt,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(tt,"updateTextLayer",{enumerable:!0,get:function(){return m.updateTextLayer}}),Object.defineProperty(tt,"version",{enumerable:!0,get:function(){return O.version}});var e=__w_pdfjs_require__(1),O=__w_pdfjs_require__(2),a=__w_pdfjs_require__(6),m=__w_pdfjs_require__(26),G=__w_pdfjs_require__(27),U=__w_pdfjs_require__(5),et=__w_pdfjs_require__(29),X=__w_pdfjs_require__(14),S=__w_pdfjs_require__(31);const d=__w_pdfjs_require__(34).SVGGraphics;tt.SVGGraphics=d})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;async function process_file(tt,e,O,a,m,G,U){const et=e.name,X=e.size,S=new Date;let d;pdfExports.GlobalWorkerOptions.workerSrc="/Users/tommasogiovannini/VSCode Projects/james/node_modules/pdfjs-dist/build/pdf.worker.js";const R=m,I=G,v=new RecursiveCharacterTextSplitter({chunkSize:R,chunkOverlap:I}),D=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);let g=(await D.auth.getUser()).data.user.id;console.log("userID",g);let _;if(console.log("isUrl",U),U===!0){console.log("isUrl",U);const E=new FileReader;E.onload=async function(i){const t=i.target.result,n={pageContent:t.toString(),metadata:{file_sha1:d,file_size:X,file_name:et,chunk_size:m,chunk_overlap:G,date:S}};_=await v.splitDocuments([n]),console.log("splittedDocuments",_[0].user_id),d=await computeSHA1FromContent(t);const h=[];for(const K of _){const x={pageContent:K.pageContent,metadata:{file_sha1:d,file_size:X,file_name:et,chunk_size:m,chunk_overlap:G,date:S}};h.push(x)}const p=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),F=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",g),new SupabaseVectorStore(F,{client:p,queryName:"insert",tableName:"documents"}).addDocuments(h)},await E.readAsText(e)}else if(a===".pdf"){console.log("isPdf");const E=new File([e],et,{type:e.type});d=await computeSHA1FromFile(E);const i=await fetchFileAsArrayBuffer(E),t=await pdfExports.getDocument({data:i}).promise,n=await extractTextFromPDF(t);console.log("pdfText",n);const h={pageContent:n,metadata:{file_sha1:d,file_size:X,file_name:et,chunk_size:m,chunk_overlap:G,date:S}};_=await v.splitDocuments([h]),console.log("splittedDocuments",_);const p=[];for(const x of _){const $={pageContent:x.pageContent,metadata:{file_sha1:d,file_size:X,file_name:et,chunk_size:m,chunk_overlap:G,date:S}};p.push($)}const F=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY),L=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",g);let K=new SupabaseVectorStore(L,{client:F,queryName:"insert",tableName:"documents"});console.log("docs Metadata",p[0].user_id),K.addDocuments(p)}else{const E=new File([e],et,{type:e.type});d=await computeSHA1FromFile(E);const t=await new O(E).load();_=await v.splitDocuments(t)}const w=[];for(const E of _){const i={pageContent:E.pageContent,metadata:{file_sha1:d,file_size:X,file_name:et,chunk_size:m,chunk_overlap:G,date:S}};w.push(i)}const b=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});console.log("user_id",g);let u=new SupabaseVectorStore(b,{client:D,tableName:"documents",queryName:"insert"});console.log("docsWithMetadata",w);try{u.addDocuments(w)}catch(E){console.log("error",E)}}async function extractTextFromPDF(tt){let e="";for(let O=1;O<=tt.numPages;O++){const G=(await(await tt.getPage(O)).getTextContent()).items.map(U=>U.str).join(" ");e+=G+" "}return e}async function fetchFileAsArrayBuffer(tt){return await(await fetch(URL.createObjectURL(tt))).arrayBuffer()}class BaseDocumentLoader{async loadAndSplit(e=new RecursiveCharacterTextSplitter){const O=await this.load();return e.splitDocuments(O)}}class TextLoader extends BaseDocumentLoader{constructor(e){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:e})}async parse(e){return[e]}async load(){let e,O;if(typeof this.filePathOrBlob=="string"){const{readFile:m}=await TextLoader.imports();e=await m(this.filePathOrBlob,"utf8"),O={source:this.filePathOrBlob}}else e=await this.filePathOrBlob.text(),O={source:"blob",blobType:this.filePathOrBlob.type};const a=await this.parse(e);return a.forEach((m,G)=>{if(typeof m!="string")throw new Error(`Expected string, at position ${G} got ${typeof m}`)}),a.map((m,G)=>new Document({pageContent:m,metadata:a.length===1?O:{...O,line:G+1}}))}static async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]);return{readFile:e}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv()}'. See https://<link to docs> for alternatives.`)}}}function processTxt(tt,e){return process_file(tt,e,TextLoader,".txt",500,0)}class BufferLoader extends BaseDocumentLoader{constructor(e){super(),Object.defineProperty(this,"filePathOrBlob",{enumerable:!0,configurable:!0,writable:!0,value:e})}async load(){let e,O;if(typeof this.filePathOrBlob=="string"){const{readFile:a}=await BufferLoader.imports();e=await a(this.filePathOrBlob),O={source:this.filePathOrBlob}}else e=await this.filePathOrBlob.arrayBuffer().then(a=>Buffer.from(a)),O={source:"blob",blobType:this.filePathOrBlob.type};return this.parse(e,O)}static async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]);return{readFile:e}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv()}'. See https://<link to docs> for alternatives.`)}}}class PDFLoader extends BufferLoader{constructor(e,{splitPages:O=!0,pdfjs:a=PDFLoaderImports}={}){super(e),Object.defineProperty(this,"splitPages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pdfjs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.splitPages=O,this.pdfjs=a}async parse(e,O){const{getDocument:a,version:m}=await this.pdfjs(),G=await a({data:new Uint8Array(e.buffer),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,U=await G.getMetadata().catch(()=>null),et=[];for(let X=1;X<=G.numPages;X+=1){const d=await(await G.getPage(X)).getTextContent();if(d.items.length===0)continue;const R=d.items.map(I=>I.str).join(`
`);et.push(new Document({pageContent:R,metadata:{...O,pdf:{version:m,info:U==null?void 0:U.info,metadata:U==null?void 0:U.metadata,totalPages:G.numPages},loc:{pageNumber:X}}}))}return this.splitPages?et:et.length===0?[]:[new Document({pageContent:et.map(X=>X.pageContent).join(`

`),metadata:{...O,pdf:{version:m,info:U==null?void 0:U.info,metadata:U==null?void 0:U.metadata,totalPages:G.numPages}}})]}}async function PDFLoaderImports(){try{const{default:tt}=await __vitePreload(()=>import("./pdf.8255a4f2.js").then(a=>a.p),["_app/immutable/chunks/pdf.8255a4f2.js","_app/immutable/chunks/public.8bae8052.js","_app/immutable/chunks/_commonjs-dynamic-modules.089d3295.js"]),{getDocument:e,version:O}=tt;return{getDocument:e,version:O}}catch(tt){throw console.error(tt),new Error("Failed to load pdf-parse. Please install it with eg. `npm install pdf-parse`.")}}function process_pdf(tt,e){return process_file(tt,e,PDFLoader,".pdf",500,0)}class UnstructuredLoader extends BaseDocumentLoader{constructor(e,O={}){super(),Object.defineProperty(this,"filePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:"https://api.unstructured.io/general/v0/general"}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strategy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof O=="string"?(this.filePath=O,this.apiUrl=e):(this.filePath=e,this.apiKey=O.apiKey,this.apiUrl=O.apiUrl??this.apiUrl,this.strategy=O.strategy??"hi_res")}async _partition(){const{readFile:e,basename:O}=await this.imports(),a=await e(this.filePath),m=O(this.filePath),G=new FormData;G.append("files",new Blob([a]),m),G.append("strategy",this.strategy);const U={"UNSTRUCTURED-API-KEY":this.apiKey??""},et=await fetch(this.apiUrl,{method:"POST",body:G,headers:U});if(!et.ok)throw new Error(`Failed to partition file ${this.filePath} with error ${et.status} and message ${await et.text()}`);const X=await et.json();if(!Array.isArray(X))throw new Error(`Expected partitioning request to return an array, but got ${X}`);return X.filter(S=>typeof S.text=="string")}async load(){const e=await this._partition(),O=[];for(const a of e){const{metadata:m,text:G}=a;O.push(new Document({pageContent:G,metadata:{...m,category:a.type}}))}return O}async imports(){try{const{readFile:e}=await __vitePreload(()=>import("./promises.0ef77ad7.js"),[]),{basename:O}=await __vitePreload(()=>import("./__vite-browser-external_node_path.042c5bd1.js"),[]);return{readFile:e,basename:O}}catch(e){throw console.error(e),new Error(`Failed to load fs/promises. TextLoader available only on environment 'node'. It appears you are running environment '${getEnv()}'. See https://<link to docs> for alternatives.`)}}}const fs=new Proxy({},{get(tt,e){throw new Error(`Module "fs" has been externalized for browser compatibility. Cannot access "fs.${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal_fs=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"}));async function processHtml(tt,e){return process_file(tt,e,UnstructuredLoader,".html")}async function getHtml(tt){try{const O=`/api?${new URLSearchParams({url:tt}).toString()}`,a=await fetch(O,{method:"GET"});return a.status===200?await a.text():null}catch{return null}}class CustomFile extends Blob{constructor(e,O){super(e,O),this.name=O.name,this.lastModifiedDate=new Date}}function createHtmlFile(tt,e){const O=slugify(tt)+".html";return new CustomFile([e],{type:"text/html",name:O})}function slugify(tt){return tt=tt.normalize("NFKD").replace(/[\u0300-\u036f]/g,""),tt=tt.replace(/[^\w\s-]/g,"").trim().toLowerCase(),tt=tt.replace(/[-\s]+/g,"-"),tt}const file_processors={".txt":processTxt,".pdf":process_pdf,".html":processHtml};async function file_uploader(tt,e,O,a){Array.isArray(a)||(a=[a]),console.log(a);for(const m of a)await filter_file(m,tt)}async function file_already_exists(tt,e){const O=computeSHA1FromContent(e);let a=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const{data:m,error:G}=await a.from("documents").select("id").eq("metadata->>file_sha1",O);return G?(console.log(`Error retrieving data: ${G.message}`),!1):m.length>0}async function filter_file(tt,e,O){if(await file_already_exists(e,tt))return console.log(`😎 ${tt.name} is already in the database.`),!1;if(tt.size<1)return console.log(`💨 ${tt.name} is empty.`),!1;{const a=`.${tt.name.split(".").pop()}`;if(console.log(tt.name,a),a in file_processors){let m=createClient(PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_KEY);const G=new HuggingFaceInferenceEmbeddings({apiKey:PUBLIC_HUGGINGFACE_API_KEY});let U=new SupabaseVectorStore(G,{client:m,tableName:"documents"});return await file_processors[a](U,tt),console.log(`✅ ${tt.name}`),!0}else return console.log(`❌ ${tt.name} is not a valid file type.`),!1}}async function url_uploader(tt,e,O,a){const m=await getHtml(a);console.log(m);const G=createHtmlFile(a,m);console.log(G),await process_file(O,G,UnstructuredLoader,".html",500,0,!0)}export{__viteBrowserExternal_fs as _,file_uploader as f,url_uploader as u};
