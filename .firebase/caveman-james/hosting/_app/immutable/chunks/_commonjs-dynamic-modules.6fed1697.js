var A=Object.defineProperty;var T=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var h=(e,t,r)=>(T(e,typeof t!="symbol"?t+"":t,r),r);var _=Object.defineProperty,C=(e,t,r)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,j=(e,t,r)=>(C(e,typeof t!="symbol"?t+"":t,r),r),f={};f.byteLength=M;f.toByteArray=S;f.fromByteArray=P;var u=[],d=[],E=typeof Uint8Array<"u"?Uint8Array:Array,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var g=0,L=x.length;g<L;++g)u[g]=x[g],d[x.charCodeAt(g)]=g;d["-".charCodeAt(0)]=62;d["_".charCodeAt(0)]=63;function y(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var s=r===t?0:4-r%4;return[r,s]}function M(e){var t=y(e),r=t[0],s=t[1];return(r+s)*3/4-s}function R(e,t,r){return(t+r)*3/4-r}function S(e){var t,r=y(e),s=r[0],a=r[1],n=new E(R(e,s,a)),c=0,l=a>0?s-4:s,o;for(o=0;o<l;o+=4)t=d[e.charCodeAt(o)]<<18|d[e.charCodeAt(o+1)]<<12|d[e.charCodeAt(o+2)]<<6|d[e.charCodeAt(o+3)],n[c++]=t>>16&255,n[c++]=t>>8&255,n[c++]=t&255;return a===2&&(t=d[e.charCodeAt(o)]<<2|d[e.charCodeAt(o+1)]>>4,n[c++]=t&255),a===1&&(t=d[e.charCodeAt(o)]<<10|d[e.charCodeAt(o+1)]<<4|d[e.charCodeAt(o+2)]>>2,n[c++]=t>>8&255,n[c++]=t&255),n}function B(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[e&63]}function O(e,t,r){for(var s,a=[],n=t;n<r;n+=3)s=(e[n]<<16&16711680)+(e[n+1]<<8&65280)+(e[n+2]&255),a.push(B(s));return a.join("")}function P(e){for(var t,r=e.length,s=r%3,a=[],n=16383,c=0,l=r-s;c<l;c+=n)a.push(O(e,c,c+n>l?l:c+n));return s===1?(t=e[r-1],a.push(u[t>>2]+u[t<<4&63]+"==")):s===2&&(t=(e[r-2]<<8)+e[r-1],a.push(u[t>>10]+u[t>>4&63]+u[t<<2&63]+"=")),a.join("")}function q(e,t){let r=Array.from({length:e.length},(s,a)=>({start:a,end:a+1}));for(;r.length>1;){let s=null;for(let a=0;a<r.length-1;a++){const n=e.slice(r[a].start,r[a+1].end),c=t.get(n.join(","));c!=null&&(s==null||c<s[0])&&(s=[c,a])}if(s!=null){const a=s[1];r[a]={start:r[a].start,end:r[a+1].end},r.splice(a+1,1)}else break}return r}function D(e,t){return e.length===1?[t.get(e.join(","))]:q(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function U(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var v=class{constructor(e,t){h(this,"specialTokens");h(this,"inverseSpecialTokens");h(this,"patStr");h(this,"textEncoder",new TextEncoder);h(this,"textDecoder",new TextDecoder("utf-8"));h(this,"rankMap",new Map);h(this,"textMap",new Map);this.patStr=e.pat_str;const r=e.bpe_ranks.split(`
`).filter(Boolean).reduce((s,a)=>{const[n,c,...l]=a.split(" "),o=Number.parseInt(c,10);return l.forEach((i,p)=>s[i]=o+p),s},{});for(const[s,a]of Object.entries(r)){const n=f.toByteArray(s);this.rankMap.set(n.join(","),a),this.textMap.set(a,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((s,[a,n])=>(s[n]=this.textEncoder.encode(a),s),{})}encode(e,t=[],r="all"){const s=new RegExp(this.patStr,"ug"),a=v.specialTokenRegex(Object.keys(this.specialTokens)),n=[],c=new Set(t==="all"?Object.keys(this.specialTokens):t),l=new Set(r==="all"?Object.keys(this.specialTokens).filter(i=>!c.has(i)):r);if(l.size>0){const i=v.specialTokenRegex([...l]),p=e.match(i);if(p!=null)throw new Error(`The text contains a special token that is not allowed: ${p[0]}`)}let o=0;for(;;){let i=null,p=o;for(;a.lastIndex=p,i=a.exec(e),!(i==null||c.has(i[0]));)p=i.index+1;const m=(i==null?void 0:i.index)??e.length;for(const w of e.substring(o,m).matchAll(s)){const k=this.textEncoder.encode(w[0]),b=this.rankMap.get(k.join(","));if(b!=null){n.push(b);continue}n.push(...D(k,this.rankMap))}if(i==null)break;let F=this.specialTokens[i[0]];n.push(F),o=i.index+i[0].length}return n}decode(e){const t=[];let r=0;for(let n=0;n<e.length;++n){const c=e[n],l=this.textMap.get(c)??this.inverseSpecialTokens[c];l!=null&&(t.push(l),r+=l.length)}const s=new Uint8Array(r);let a=0;for(const n of t)s.set(n,a),a+=n.length;return this.textDecoder.decode(s)}},I=v;j(I,"specialTokenRegex",e=>new RegExp(e.map(t=>U(t)).join("|"),"g"));function H(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}function $(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}export{I as T,$ as c,H as g};
